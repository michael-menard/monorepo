# Deferred KB Writes - WKFL-009
# Generated by elab-autonomous-decider
# These non-blocking findings will be written to KB by completion phase

generated_at: 2026-02-07T21:45:00-07:00
story_id: WKFL-009
total_entries: 14

entries:
  # Non-blocking gaps from FUTURE-OPPORTUNITIES.md
  - id: gap-1
    entry_type: finding
    category: performance-optimization
    title: "Similarity Computation Optimization for Large KBs"
    content: |
      **Finding**: Story presents Option B (fetch all embeddings, compute in-memory pairwise similarity) as optimization over Option A (N queries via semanticSearch). For large KBs (>1000 entries), in-memory approach would be significantly faster.

      **Impact**: Medium (performance)
      **Effort**: High (requires vector library like FAISS, more complex implementation)

      **Recommendation**: Implement Option A for MVP. Add WKFL-009-B story for Option B optimization when KB exceeds 500 entries. Track query time in compression report to detect when optimization is needed.

      **Context**: WKFL-009 compression algorithm uses Option A (semanticSearch per entry) for MVP.
    tags:
      - performance
      - optimization
      - kb-compression
      - future-work
      - non-blocking
    story_id: WKFL-009
    source_stage: elab

  - id: gap-2
    entry_type: finding
    category: automation
    title: "Weekly/Monthly Cron Automation for KB Compression"
    content: |
      **Finding**: Story mentions "monthly cron" but implementation is manual `/kb-compress` command only. Automation deferred to future.

      **Impact**: Low (manual trigger sufficient for MVP)
      **Effort**: Medium (GitHub Actions workflow + scheduling)

      **Recommendation**: Create follow-up story for cron automation after manual command proves reliable. Include monitoring/alerting for cron failures.

      **Context**: WKFL-009 provides manual compression command, automation not MVP-critical.
    tags:
      - automation
      - cron
      - kb-compression
      - future-work
      - non-blocking
    story_id: WKFL-009
    source_stage: elab

  - id: gap-3
    entry_type: finding
    category: infrastructure
    title: "Automated Rollback Command for KB Compression"
    content: |
      **Finding**: Story documents rollback procedure (unarchive entries, delete canonicals) but doesn't provide automated rollback command. Manual SQL required.

      **Impact**: Low (low rollback frequency expected)
      **Effort**: Medium (create /kb-compress-rollback command)

      **Recommendation**: Add automated rollback feature if compression runs become frequent or risky. Track rollback requests to determine priority.

      **Context**: WKFL-009 provides manual rollback SQL, automated command deferred to future.
    tags:
      - infrastructure
      - rollback
      - kb-compression
      - future-work
      - non-blocking
    story_id: WKFL-009
    source_stage: elab

  - id: gap-4
    entry_type: finding
    category: edge-case
    title: "Cluster Size Upper Bound for KB Compression"
    content: |
      **Finding**: Story doesn't specify maximum cluster size. Very large clusters (e.g., 50+ entries about same topic) could produce unwieldy canonical entries.

      **Impact**: Low (unlikely in practice)
      **Effort**: Low (add --max-cluster-size flag)

      **Recommendation**: Monitor cluster sizes in compression reports. If clusters exceed 20 members, consider adding cluster size limit with sub-clustering.

      **Context**: WKFL-009 clusters entries without size limit, monitoring recommended.
    tags:
      - edge-case
      - kb-compression
      - clustering
      - future-work
      - non-blocking
    story_id: WKFL-009
    source_stage: elab

  - id: gap-5
    entry_type: finding
    category: ux-polish
    title: "Enhanced Dry-Run Reporting for KB Compression"
    content: |
      **Finding**: Story mentions `--dry-run` flag but doesn't specify what gets reported. Users need preview of: which clusters would form, which entries would be merged, what canonical entries would look like.

      **Impact**: Medium (reduces risk of accidental compression)
      **Effort**: Low (output logic already exists)

      **Recommendation**: Enhance dry-run mode to output detailed preview: cluster memberships, sample canonical entry content, estimated token savings. Consider adding --preview-canonical flag to show what merged entries would look like.

      **Context**: WKFL-009 dry-run mode basic implementation, enhanced preview deferred.
    tags:
      - ux-polish
      - dry-run
      - kb-compression
      - enhancement
      - non-blocking
    story_id: WKFL-009
    source_stage: elab

  - id: gap-6
    entry_type: finding
    category: observability
    title: "Archive Entry Queryability Filter in KB Search"
    content: |
      **Finding**: Story says "Archived entries still queryable with flag" but doesn't specify the flag or update kb_search to support it. Current kb_search would return archived entries mixed with active entries.

      **Impact**: Medium (confusing search results)
      **Effort**: Medium (update kb_search to filter by archived status)

      **Recommendation**: Add `exclude_archived: boolean` parameter to kb_search (default: true). Update semanticSearch to filter `WHERE archived = false` (using dedicated column from AC-7). Document that archived entries are excluded by default.

      **Context**: WKFL-009 archives entries but doesn't update search filters, enhancement deferred.
    tags:
      - observability
      - kb-search
      - archived-entries
      - future-work
      - non-blocking
    story_id: WKFL-009
    source_stage: elab

  - id: gap-7
    entry_type: finding
    category: infrastructure
    title: "Embedding Model Upgrade Path for KB"
    content: |
      **Finding**: Story says "no embedding model changes" but WKFL-006 documented upgrade path from text similarity (0.70 threshold) to embeddings (0.85 similarity). Future models may have higher accuracy.

      **Impact**: Low (current model sufficient)
      **Effort**: High (requires re-embedding all entries)

      **Recommendation**: Document model upgrade procedure: 1. Add new embedding column, 2. Backfill embeddings, 3. Update clustering to use new embeddings, 4. Drop old embedding column. Consider this for WKFL-009-C if compression accuracy becomes an issue.

      **Context**: WKFL-009 uses text-embedding-3-small (1536 dims), upgrade path documented for future.
    tags:
      - infrastructure
      - embeddings
      - model-upgrade
      - future-work
      - non-blocking
    story_id: WKFL-009
    source_stage: elab

  # Enhancements from FUTURE-OPPORTUNITIES.md
  - id: enhancement-1
    entry_type: finding
    category: performance-optimization
    title: "Incremental Compression for KB - Process Only New Entries"
    content: |
      **Finding**: Current design processes ALL non-archived entries every run. For large KBs, could process only new entries since last compression run (e.g., entries created in last 30 days).

      **Impact**: Medium (performance)
      **Effort**: Medium (track last compression date, filter by createdAt)

      **Recommendation**: Add `--incremental` flag that only considers entries created since last compression run. Store last_compression_date in report or DB. Benefits: faster runs, less API load. Trade-off: won't merge new entries with old canonical entries.

      **Context**: WKFL-009 full compression only, incremental mode enhancement opportunity.
    tags:
      - performance
      - optimization
      - incremental
      - kb-compression
      - enhancement
      - non-blocking
    story_id: WKFL-009
    source_stage: elab

  - id: enhancement-2
    entry_type: finding
    category: quality-improvement
    title: "LLM-Based Canonical Entry Refinement"
    content: |
      **Finding**: First-pass canonical entries may have awkward merged titles or redundant examples. Could add refinement step that uses LLM to polish canonical entry content.

      **Impact**: Medium (quality)
      **Effort**: High (requires LLM call per canonical entry, adds cost)

      **Recommendation**: Log canonical entry quality issues during manual AC-5 verification. If quality problems are common, add WKFL-009-D story for LLM-based refinement. Use haiku model to keep costs low.

      **Context**: WKFL-009 merges mechanically, LLM refinement deferred pending quality assessment.
    tags:
      - quality
      - llm-refinement
      - canonical-entries
      - enhancement
      - non-blocking
    story_id: WKFL-009
    source_stage: elab

  - id: enhancement-3
    entry_type: finding
    category: observability
    title: "Compression Analytics Dashboard for KB"
    content: |
      **Finding**: Report generates YAML with stats, but no visualization. Could create dashboard showing: compression trends over time, largest clusters, token savings, archive/canonical ratio.

      **Impact**: Low (nice-to-have)
      **Effort**: High (requires visualization tool)

      **Recommendation**: After 3+ compression runs, evaluate if analytics justify effort. Could integrate into existing KB analytics if WKFL-008 or similar creates analytics infrastructure.

      **Context**: WKFL-009 YAML reports only, dashboard visualization deferred.
    tags:
      - observability
      - analytics
      - dashboard
      - kb-compression
      - enhancement
      - non-blocking
    story_id: WKFL-009
    source_stage: elab

  - id: enhancement-4
    entry_type: finding
    category: quality-improvement
    title: "Smart Threshold Tuning for KB Compression Clustering"
    content: |
      **Finding**: Story uses fixed 0.9 similarity threshold. Could analyze compression results to recommend optimal threshold per entry type (lessons vs decisions vs constraints may cluster differently).

      **Impact**: Medium (quality)
      **Effort**: Medium (add threshold experimentation to report)

      **Recommendation**: Run compression with multiple thresholds (0.85, 0.90, 0.95) in dry-run mode, compare cluster quality. Report recommended threshold per entry_type. Requires manual validation of clustering quality.

      **Context**: WKFL-009 fixed 0.9 threshold, adaptive tuning enhancement opportunity.
    tags:
      - quality
      - threshold-tuning
      - clustering
      - kb-compression
      - enhancement
      - non-blocking
    story_id: WKFL-009
    source_stage: elab

  - id: enhancement-5
    entry_type: finding
    category: quality-improvement
    title: "Canonical Entry Versioning - Keep Canonicals Fresh"
    content: |
      **Finding**: Once canonical entry created, future updates to member entries won't propagate to canonical. Could track canonical entry versions and regenerate when new similar content appears.

      **Impact**: Medium (keeps canonicals fresh)
      **Effort**: High (complex tracking, re-merge logic)

      **Recommendation**: Defer until canonical entries become stale. Track issue: "Canonical entry X doesn't reflect recent lessons." If this becomes common (>10% of canonicals), create follow-up story for versioned canonicals.

      **Context**: WKFL-009 creates static canonicals, versioning enhancement deferred pending staleness assessment.
    tags:
      - quality
      - versioning
      - canonical-entries
      - kb-compression
      - enhancement
      - non-blocking
    story_id: WKFL-009
    source_stage: elab

  - id: enhancement-6
    entry_type: finding
    category: edge-case
    title: "Cross-Entry-Type Clustering in KB Compression"
    content: |
      **Finding**: Current design assumes same entry_type only clusters together (lessons with lessons, decisions with decisions). But some patterns span types (e.g., a lesson and a decision about same architectural pattern).

      **Impact**: Low (rare occurrence)
      **Effort**: Medium (relax entry_type filtering in clustering)

      **Recommendation**: Monitor for cases where users manually reference both archived lesson and decision about same topic. If this is common, consider allowing cross-type clustering with entry_type preserved as tag on canonical entry.

      **Context**: WKFL-009 same-type clustering only, cross-type enhancement deferred.
    tags:
      - edge-case
      - cross-type
      - clustering
      - kb-compression
      - enhancement
      - non-blocking
    story_id: WKFL-009
    source_stage: elab

  - id: enhancement-7
    entry_type: finding
    category: quality-improvement
    title: "User Feedback Integration for Canonical Entry Quality"
    content: |
      **Finding**: No mechanism for users to reject bad merges or flag canonical entries for refinement. Could add /kb-feedback command for canonical entry quality.

      **Impact**: Medium (quality improvement)
      **Effort**: Medium (extends existing feedback system)

      **Recommendation**: If WKFL-004 feedback system proves valuable, extend it to capture canonical entry quality feedback. Use feedback to improve merge logic or manual refinement priority.

      **Context**: WKFL-009 no feedback mechanism, enhancement depends on WKFL-004 success.
    tags:
      - quality
      - user-feedback
      - canonical-entries
      - kb-compression
      - enhancement
      - non-blocking
    story_id: WKFL-009
    source_stage: elab

summary:
  total_findings: 14
  gaps: 7
  enhancements: 7
  categories:
    - performance-optimization: 2
    - automation: 1
    - infrastructure: 2
    - edge-case: 2
    - ux-polish: 1
    - observability: 2
    - quality-improvement: 4

notes: |
  All non-blocking findings from FUTURE-OPPORTUNITIES.md logged for KB write during completion phase.
  These items were not MVP-critical and do not block story implementation.
  KB writer will process these entries with appropriate tags and metadata.
