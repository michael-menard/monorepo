---
perspective: security
verdict: READY
created_at: "2026-01-25T00:00:00Z"

security_assessment:
  - story: KNOW-001
    auth_required: true
    data_sensitivity: sensitive
    risk_level: medium
  - story: KNOW-002
    auth_required: true
    data_sensitivity: sensitive
    risk_level: medium
  - story: KNOW-003
    auth_required: true
    data_sensitivity: sensitive
    risk_level: medium
  - story: KNOW-004
    auth_required: true
    data_sensitivity: sensitive
    risk_level: low
  - story: KNOW-005
    auth_required: true
    data_sensitivity: sensitive
    risk_level: medium
  - story: KNOW-006
    auth_required: true
    data_sensitivity: sensitive
    risk_level: high
  - story: KNOW-007
    auth_required: true
    data_sensitivity: sensitive
    risk_level: low
  - story: KNOW-008
    auth_required: true
    data_sensitivity: sensitive
    risk_level: medium

owasp_coverage:
  - risk: "A01 Broken Access Control"
    stories: [KNOW-005, KNOW-008]
    gap: true
  - risk: "A02 Cryptographic Failures"
    stories: [KNOW-001, KNOW-002]
    gap: true
  - risk: "A03 Injection"
    stories: [KNOW-003, KNOW-004]
    gap: false
  - risk: "A05 Access Control"
    stories: [KNOW-005, KNOW-008]
    gap: true
  - risk: "A06 Vulnerable Components"
    stories: [KNOW-001, KNOW-002, KNOW-005]
    gap: false

input_validation:
  - story: KNOW-003
    user_inputs: "content, entry_type, roles, tags, source_file, source_story"
    validation_planned: true
  - story: KNOW-006
    user_inputs: "YAML file contents during bulk import"
    validation_planned: true
  - story: KNOW-004
    user_inputs: "search query, filters (roles, tags)"
    validation_planned: true
  - story: KNOW-005
    user_inputs: "MCP tool input schemas"
    validation_planned: true

data_handling:
  - story: KNOW-001
    data_type: "Knowledge entries (text + embeddings)"
    storage: "PostgreSQL with pgvector"
    encryption: false
  - story: KNOW-002
    data_type: "OpenAI API keys, embedding cache"
    storage: "Environment variables and PostgreSQL"
    encryption: false
  - story: KNOW-003
    data_type: "User-submitted knowledge entries"
    storage: "PostgreSQL"
    encryption: false
  - story: KNOW-006
    data_type: "Bulk import entries (YAML or markdown parsed)"
    storage: "PostgreSQL"
    encryption: false

critical: []

high:
  - id: SEC-001
    issue: "MCP tool authentication/authorization not specified; all agents can access all tools"
    stories: [KNOW-005, KNOW-008]
    action: "Implement role-based access control for MCP tools (pm/dev/qa can only call role-filtered searches)"
  - id: SEC-002
    issue: "OpenAI API key exposed in environment; no secrets rotation policy"
    stories: [KNOW-002]
    action: "Use AWS Secrets Manager or HashiCorp Vault for API key management; rotate regularly"
  - id: SEC-003
    issue: "PostgreSQL connection not TLS-encrypted in docker-compose.yaml"
    stories: [KNOW-001]
    action: "Enable PostgreSQL SSL in production; use RDS with encryption in transit/at-rest"

medium:
  - id: SEC-004
    issue: "Input validation for bulk import (KNOW-006) may be insufficient for untrusted YAML"
    stories: [KNOW-006]
    action: "Implement strict YAML parsing with allowlist; reject unexpected fields"
  - id: SEC-005
    issue: "Search queries could expose knowledge base structure via error messages"
    stories: [KNOW-004, KNOW-005]
    action: "Sanitize error responses; log full errors server-side only"
  - id: SEC-006
    issue: "No rate limiting on kb_search or write operations; DoS risk"
    stories: [KNOW-003, KNOW-004, KNOW-005]
    action: "Implement per-agent query rate limiting (e.g., 100 searches/minute)"

compliance:
  gdpr: gaps
  soc2: gaps

missing_stories:
  - title: "Authentication and authorization for MCP tools"
    gap: "No access control; all agents can call all tools"
    priority: P0
  - title: "API rate limiting and quota management"
    gap: "No DoS protection"
    priority: P0
  - title: "Secrets management (API keys, database credentials)"
    gap: "Currently env vars; no rotation or audit"
    priority: P0
  - title: "Data encryption at-rest for PostgreSQL"
    gap: "Plain text storage in docker-compose"
    priority: P1
  - title: "Audit logging for KB modifications"
    gap: "No tracking of who changed what"
    priority: P1
  - title: "GDPR compliance for knowledge entries"
    gap: "No data retention or deletion policies"
    priority: P2

recommendations:
  - "Implement per-agent authentication for MCP tools (use Claude Code agent ID or session token)"
  - "Store API keys and secrets in AWS Secrets Manager (not env vars)"
  - "Enable PostgreSQL encryption in transit (SSL) and at-rest (KMS)"
  - "Add audit logging for all kb_add/kb_update/kb_delete operations"
  - "Implement query rate limiting to prevent DoS"
  - "Document and implement GDPR retention policy (e.g., auto-delete after N months)"
  - "Validate all user inputs with Zod schemas in MCP tool handlers"
  - "Use parameterized SQL queries to prevent injection (already planned)"
  - "Implement signed URLs for any future export/download features"
