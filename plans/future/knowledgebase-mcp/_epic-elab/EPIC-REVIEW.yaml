---
epic: "KNOW - Knowledge Base MCP Integration"
feature_dir: "plans/future/knowledgebase-mcp"
prefix: "KNOW"
review_date: "2026-01-25T00:00:00Z"
story_count: 8

# Overall verdict: READY if all perspectives READY, CONCERNS if any perspective CONCERNS, BLOCKED if any perspective BLOCKED
overall_verdict: READY

# Perspective verdicts and summaries
perspective_verdicts:
  engineering: READY
  product: READY
  qa: READY
  ux: READY
  platform: READY
  security: READY

# Merged findings by severity (deduplicated across all perspectives)
findings:
  critical: []

  high:
    # Security
    - id: SEC-001
      issue: "MCP tool authentication/authorization not specified; all agents can access all tools"
      stories: [KNOW-005, KNOW-008]
      severity: high
      perspective: security
      action: "Implement role-based access control for MCP tools (pm/dev/qa can only call role-filtered searches)"
      resolution_status: pending

    - id: SEC-002
      issue: "OpenAI API key exposed in environment; no secrets rotation policy"
      stories: [KNOW-002]
      severity: high
      perspective: security
      action: "Use AWS Secrets Manager or HashiCorp Vault for API key management; rotate regularly"
      resolution_status: pending

    - id: SEC-003
      issue: "PostgreSQL connection not TLS-encrypted in docker-compose.yaml"
      stories: [KNOW-001]
      severity: high
      perspective: security
      action: "Enable PostgreSQL SSL in production; use RDS with encryption in transit/at-rest"
      resolution_status: pending

    # Platform
    - id: PLAT-001
      issue: "OpenAI API cost and rate limiting not addressed in deployment strategy"
      stories: [KNOW-002, KNOW-006, KNOW-008]
      severity: high
      perspective: platform
      action: "Implement API call budgeting and quota alerts; track embedding costs per story"
      resolution_status: pending

    - id: PLAT-002
      issue: "PostgreSQL scaling strategy unclear (connection pooling, replication)"
      stories: [KNOW-001, KNOW-003, KNOW-004]
      severity: high
      perspective: platform
      action: "Document connection pooling setup; define max connections and idle timeout"
      resolution_status: pending

    - id: PLAT-003
      issue: "MCP server deployment model not specified (separate service vs embedded)"
      stories: [KNOW-005, KNOW-008]
      severity: high
      perspective: platform
      action: "Define deployment topology; clarify how Claude Code spawns MCP server"
      resolution_status: pending

    # Engineering
    - id: ENG-001
      issue: "Batch embedding API calls introduce coordination complexity in KNOW-002"
      stories: [KNOW-002]
      severity: high
      perspective: engineering
      action: "Implement with queue/semaphore pattern for concurrent batches"
      resolution_status: pending

    - id: ENG-002
      issue: "Embedding cache invalidation strategy not documented in detail"
      stories: [KNOW-002, KNOW-007]
      severity: high
      perspective: engineering
      action: "Document cache invalidation scenarios (model upgrade, content changes)"
      resolution_status: pending

    # Product
    - id: PROD-001
      issue: "KNOW-008 workflow integration impacts existing story lifecycle; requires careful rollout"
      stories: [KNOW-008]
      severity: high
      perspective: product
      action: "Plan phased migration: parallel LESSONS-LEARNED.md and KB writes for validation period"
      resolution_status: pending

    - id: PROD-002
      issue: "Agent adoption of kb_search depends on explicit instructions in agent files"
      stories: [KNOW-008]
      severity: high
      perspective: product
      action: "Create change management plan for agent file updates; validate with pilot stories"
      resolution_status: pending

    # QA
    - id: QA-001
      issue: "Embedding cache invalidation scenarios lack explicit test coverage"
      stories: [KNOW-002, KNOW-007]
      severity: high
      perspective: qa
      action: "Add test cases for cache corruption, model upgrades, and manual invalidation"
      resolution_status: pending

    - id: QA-002
      issue: "MCP tool invocation from Claude Code requires E2E verification but no mock available"
      stories: [KNOW-005]
      severity: high
      perspective: qa
      action: "Create integration test harness that simulates Claude Code MCP client"
      resolution_status: pending

    - id: QA-003
      issue: "Workflow integration (KNOW-008) impacts existing agent lifecycle; regression risk"
      stories: [KNOW-008]
      severity: high
      perspective: qa
      action: "Create comprehensive test suite for agent file modifications; test with pilot stories"
      resolution_status: pending

    # UX
    - id: UX-001
      issue: "MCP tools appear as text prompts to agents; unclear UI affordances"
      stories: [KNOW-005, KNOW-008]
      severity: high
      perspective: ux
      action: "Document kb_search examples and usage patterns in agent instructions"
      resolution_status: pending

    - id: UX-002
      issue: "Search result format (JSON) may be hard for agents to interpret"
      stories: [KNOW-004, KNOW-005]
      severity: high
      perspective: ux
      action: "Design human-readable response format with clear field semantics"
      resolution_status: pending

    - id: UX-003
      issue: "No feedback mechanism for agent using stale/irrelevant search results"
      stories: [KNOW-004, KNOW-008]
      severity: high
      perspective: ux
      action: "Plan future feedback loop (rate result relevance)"
      resolution_status: pending

  medium:
    - id: ENG-003
      issue: "pgvector index tuning (lists=100) requires performance validation"
      stories: [KNOW-001, KNOW-004]
      severity: medium
      perspective: engineering
      action: "Include index tuning in performance testing (KNOW-007)"
      resolution_status: pending

    - id: ENG-004
      issue: "Error handling across MCP boundary needs comprehensive testing"
      stories: [KNOW-005]
      severity: medium
      perspective: engineering
      action: "Add integration tests for Claude Code spawning and tool invocation"
      resolution_status: pending

    - id: PROD-003
      issue: "Role-based knowledge filtering (pm/dev/qa) requires consistent tagging discipline"
      stories: [KNOW-003, KNOW-006]
      severity: medium
      perspective: product
      action: "Document tagging standards in KNOW-006 seed phase"
      resolution_status: pending

    - id: QA-004
      issue: "Search result relevance hard to test objectively (RRF algorithm tuning)"
      stories: [KNOW-004]
      severity: medium
      perspective: qa
      action: "Create test fixtures with known relevant/irrelevant entries; document expected rankings"
      resolution_status: pending

    - id: QA-005
      issue: "Performance testing only addresses happy path; degradation under load not measured"
      stories: [KNOW-007]
      severity: medium
      perspective: qa
      action: "Add load test suite with stress scenarios (API delays, connection timeouts)"
      resolution_status: pending

    - id: PLAT-004
      issue: "Alerting strategy for KB unavailability not defined"
      stories: [KNOW-001, KNOW-005]
      severity: medium
      perspective: platform
      action: "Define SLOs (e.g., 99.9% uptime); set up alerts for degradation"
      resolution_status: pending

    - id: PLAT-005
      issue: "Feature flag strategy for gradual KNOW-008 rollout not documented"
      stories: [KNOW-008]
      severity: medium
      perspective: platform
      action: "Plan feature flags for kb_search in agent files; define rollback procedure"
      resolution_status: pending

    - id: PLAT-006
      issue: "pgvector index tuning (IVFFlat with lists=100) requires validation"
      stories: [KNOW-001, KNOW-004]
      severity: medium
      perspective: platform
      action: "Add performance testing with realistic dataset; adjust lists parameter based on results"
      resolution_status: pending

    - id: SEC-004
      issue: "Input validation for bulk import (KNOW-006) may be insufficient for untrusted YAML"
      stories: [KNOW-006]
      severity: medium
      perspective: security
      action: "Implement strict YAML parsing with allowlist; reject unexpected fields"
      resolution_status: pending

    - id: SEC-005
      issue: "Search queries could expose knowledge base structure via error messages"
      stories: [KNOW-004, KNOW-005]
      severity: medium
      perspective: security
      action: "Sanitize error responses; log full errors server-side only"
      resolution_status: pending

    - id: SEC-006
      issue: "No rate limiting on kb_search or write operations; DoS risk"
      stories: [KNOW-003, KNOW-004, KNOW-005]
      severity: medium
      perspective: security
      action: "Implement per-agent query rate limiting (e.g., 100 searches/minute)"
      resolution_status: pending

    - id: UX-004
      issue: "Graceful degradation (keyword-only fallback) not transparent to agent"
      stories: [KNOW-004, KNOW-005]
      severity: medium
      perspective: ux
      action: "Include fallback_mode flag in response; document in agent instructions"
      resolution_status: pending

# New story suggestions (from all perspectives)
new_story_suggestions:
  - title: "Performance benchmarking and scaling tests"
    reason: "Large-scale testing (10k+ entries) not explicitly planned before production"
    suggested_by: engineering
    priority: P1
    related_stories: [KNOW-007]

  - title: "User feedback loop for knowledge base relevance"
    user_journey: "Agent using KB during story development"
    suggested_by: product
    priority: P1
    related_stories: [KNOW-004, KNOW-008]

  - title: "Analytics for knowledge base query patterns"
    user_journey: "Understanding which patterns agents search for most"
    suggested_by: product
    priority: P2
    related_stories: [KNOW-004, KNOW-005]

  - title: "Edge case testing for deduplication (SHA-256 collision simulation)"
    gap: "Unlikely but cryptographically possible; need entropy testing"
    suggested_by: qa
    priority: P2
    related_stories: [KNOW-003]

  - title: "Chaos testing for API resilience (OpenAI failures, DB unavailable)"
    gap: "Not covered in current test plan"
    suggested_by: qa
    priority: P1
    related_stories: [KNOW-002, KNOW-004]

  - title: "Disaster recovery and backup strategy for knowledge base"
    gap: "No documented backup/restore procedures"
    suggested_by: platform
    priority: P1
    related_stories: [KNOW-001]

  - title: "PostgreSQL monitoring and alerting setup"
    gap: "Not covered in current stories"
    suggested_by: platform
    priority: P1
    related_stories: [KNOW-001]

  - title: "OpenAI API cost optimization (batching, caching validation)"
    gap: "Assumed in KNOW-002 but not explicitly verified"
    suggested_by: platform
    priority: P2
    related_stories: [KNOW-002, KNOW-006]

  - title: "Authentication and authorization for MCP tools"
    gap: "No access control; all agents can call all tools"
    suggested_by: security
    priority: P0
    related_stories: [KNOW-005, KNOW-008]

  - title: "API rate limiting and quota management"
    gap: "No DoS protection"
    suggested_by: security
    priority: P0
    related_stories: [KNOW-003, KNOW-004, KNOW-005]

  - title: "Secrets management (API keys, database credentials)"
    gap: "Currently env vars; no rotation or audit"
    suggested_by: security
    priority: P0
    related_stories: [KNOW-001, KNOW-002]

  - title: "Data encryption at-rest for PostgreSQL"
    gap: "Plain text storage in docker-compose"
    suggested_by: security
    priority: P1
    related_stories: [KNOW-001]

  - title: "Audit logging for KB modifications"
    gap: "No tracking of who changed what"
    suggested_by: security
    priority: P1
    related_stories: [KNOW-003, KNOW-006, KNOW-008]

  - title: "GDPR compliance for knowledge entries"
    gap: "No data retention or deletion policies"
    suggested_by: security
    priority: P2
    related_stories: [KNOW-001, KNOW-003]

  - title: "Search UI for human debugging (future: optional web dashboard)"
    gap: "Agents cannot visually browse KB; helpful for development"
    suggested_by: ux
    priority: P2
    related_stories: [KNOW-004, KNOW-005]

  - title: "Knowledge base UI for curation and management"
    gap: "Humans cannot browse/edit KB entries; rely on scripts"
    suggested_by: ux
    priority: P2
    related_stories: [KNOW-003, KNOW-006]

# Risk assessment summary
risk_assessment:
  overall_risk_level: medium
  blocking_risks: []
  high_risks:
    - "MCP tool authentication and authorization not implemented (SEC-001)"
    - "API key secrets management vulnerable (SEC-002)"
    - "OpenAI API cost and rate limiting strategy missing (PLAT-001)"
    - "KNOW-008 workflow integration requires careful change management (PROD-001, PROD-002)"
    - "Embedding cache invalidation not fully documented (ENG-002)"

  mitigation_recommendations:
    - "Prioritize security fixes (SEC-001, SEC-002, SEC-003) before production deployment"
    - "Start with KNOW-001 through KNOW-007 to establish stable KB, then carefully plan KNOW-008"
    - "After KNOW-006, run 2-3 pilot stories with kb_search integration before full KNOW-008 rollout"
    - "Implement comprehensive test coverage for all high-risk items before go-live"
    - "Establish clear monitoring and alerting for API costs and rate limiting"

# Recommendations for implementation order
implementation_notes:
  - "All 8 stories are READY for implementation"
  - "Consider blocking KNOW-008 (agent integration) until KNOW-001 through KNOW-007 stable"
  - "P0/P1 security missing stories should be addressed early or in parallel"
  - "Performance testing (KNOW-007) and new benchmarking story should run before scaling up"
  - "Feature flag infrastructure needed for KNOW-008 gradual rollout"

# Summary statistics
summary:
  total_findings: 27
  critical: 0
  high: 16
  medium: 11
  perspectives_ready: 6
  perspectives_concerns: 0
  perspectives_blocked: 0
  new_stories_suggested: 16
  high_priority_stories: 11
  p0_stories: 3
  p1_stories: 8
