---
id: WISH-20300
title: "VS Code snippets for test utility discovery (createMockFile, mockS3Upload)"
status: backlog
created: 2026-01-30
updated: 2026-01-30
depends_on:
  - WISH-2120
follow_up_from: WISH-2120
phase: "2 - Infrastructure"
priority: P2
complexity: Small
effort: 1
category: Developer Experience
---

# WISH-20300: VS Code snippets for test utility discovery (createMockFile, mockS3Upload)

## Follow-up Context

**Parent Story:** WISH-2120 (Test utility helpers for S3 upload testing)
**Source:** QA Discovery Notes - Enhancement Opportunity #1
**Original Finding:** "VS Code snippets for test utility discovery - Create VS Code snippet for `createMockFile()` and `mockS3Upload()` in `.vscode/test-utils.code-snippets` to improve discoverability for developers"
**Category:** Enhancement Opportunity
**Impact:** Medium (Developer Experience improvement)
**Effort:** Low (1 point)

## Context

WISH-2120 introduces reusable test utilities (`createMockFile()` and `mockS3Upload()`) to reduce S3 upload test boilerplate. However, new developers joining the project or existing developers writing tests may not be aware these utilities exist, leading to:

1. **Rediscovering patterns:** Developers may write manual `new File()` calls and MSW setup instead of using utilities
2. **Inconsistent test patterns:** Some tests use utilities, others don't
3. **Reduced adoption:** Utilities remain underutilized despite saving time
4. **Slower onboarding:** New developers spend time learning test patterns that could be snippets

VS Code snippets provide immediate discoverability via autocomplete (`cm` → `createMockFile()` with full options), reducing friction and improving adoption.

## Goal

Create VS Code snippets for test utilities from WISH-2120 to improve discoverability, accelerate test writing, and ensure consistent test patterns across the codebase.

## Non-Goals

- Snippets for production code (test utilities only)
- Snippets for other editors (VS Code only - most common in team)
- Snippets for non-S3 test patterns (focused on WISH-2120 utilities)
- Documentation beyond JSDoc comments (snippets should be self-documenting)

---

## Scope

### VS Code Snippets File

Create `.vscode/test-utils.code-snippets` with snippets for test utilities:

#### Snippet 1: createMockFile - Defaults

```json
{
  "Create Mock File (defaults)": {
    "prefix": "cmf",
    "scope": "typescript",
    "body": [
      "const ${1:file} = createMockFile()"
    ],
    "description": "Create a mock File object with default properties (test-image.jpg, image/jpeg, 1024 bytes)"
  }
}
```

#### Snippet 2: createMockFile - Custom Properties

```json
{
  "Create Mock File (custom)": {
    "prefix": "cmfc",
    "scope": "typescript",
    "body": [
      "const ${1:file} = createMockFile({",
      "  name: '${2:custom-photo.png}',",
      "  type: '${3:image/png}',",
      "  size: ${4:5 * 1024 * 1024}, // ${5:5MB}",
      "})"
    ],
    "description": "Create a mock File object with custom properties"
  }
}
```

#### Snippet 3: mockS3Upload - Success Scenario

```json
{
  "Mock S3 Upload (success)": {
    "prefix": "ms3s",
    "scope": "typescript",
    "body": [
      "const ${1:cleanup} = mockS3Upload({ scenario: 'success' })",
      "${0}",
      "${1:cleanup}()"
    ],
    "description": "Mock S3 upload success scenario with cleanup"
  }
}
```

#### Snippet 4: mockS3Upload - Error Scenarios

```json
{
  "Mock S3 Upload (error)": {
    "prefix": "ms3e",
    "scope": "typescript",
    "body": [
      "const ${1:cleanup} = mockS3Upload({",
      "  scenario: '${2|presign-error,s3-error,timeout|}',",
      "  statusCode: ${3:403}",
      "})",
      "${0}",
      "${1:cleanup}()"
    ],
    "description": "Mock S3 upload error scenario (presign-error, s3-error, timeout)"
  }
}
```

#### Snippet 5: mockS3Upload - With Progress

```json
{
  "Mock S3 Upload (with progress)": {
    "prefix": "ms3p",
    "scope": "typescript",
    "body": [
      "const ${1:cleanup} = mockS3Upload({",
      "  scenario: 'success',",
      "  progressSteps: [${2:25, 50, 75, 100}]",
      "})",
      "${0}",
      "${1:cleanup}()"
    ],
    "description": "Mock S3 upload with progress simulation"
  }
}
```

### Packages Affected

| Package | Change Type | Description |
|---------|-------------|-------------|
| `.vscode/test-utils.code-snippets` | **New** | VS Code snippet definitions |
| `.vscode/README.md` | **Update** | Document snippet usage (if file exists) |

---

## Acceptance Criteria

### Snippet Creation

- [ ] **AC1:** `.vscode/test-utils.code-snippets` file exists with valid JSON structure
- [ ] **AC2:** Snippet `cmf` expands to `createMockFile()` with cursor positioned after closing parenthesis
- [ ] **AC3:** Snippet `cmfc` expands to `createMockFile({ name, type, size })` with tabstops for all properties
- [ ] **AC4:** Snippet `ms3s` expands to `mockS3Upload({ scenario: 'success' })` with cleanup function call and variable name tabstop
- [ ] **AC5:** Snippet `ms3e` expands to `mockS3Upload({ scenario, statusCode })` with dropdown for error scenarios (`presign-error`, `s3-error`, `timeout`)
- [ ] **AC6:** Snippet `ms3p` expands to `mockS3Upload({ scenario: 'success', progressSteps })` with tabstop for progress array
- [ ] **AC7:** All snippets include clear `description` fields visible in VS Code autocomplete

### TypeScript Integration

- [ ] **AC8:** All snippets are scoped to `typescript` files only (no JavaScript)
- [ ] **AC9:** Snippets include import statement insertion if `createMockFile` or `mockS3Upload` not already imported from `@/test/utils`
- [ ] **AC10:** Snippets use proper TypeScript syntax (no type errors when expanded)

### Documentation & Discoverability

- [ ] **AC11:** `.vscode/README.md` documents all snippet prefixes, descriptions, and usage examples (create file if it doesn't exist)
- [ ] **AC12:** Snippet prefixes follow consistent naming convention (`cmf` = create mock file, `ms3` = mock s3, `s/e/p` = success/error/progress)
- [ ] **AC13:** All snippets tested manually in VS Code with autocomplete confirmation

---

## Reuse Plan

### Existing Patterns

| Pattern | Source | Usage |
|---------|--------|-------|
| VS Code snippets syntax | `.vscode/*.code-snippets` (if exists) | Follow existing JSON format |
| Test utility APIs | `src/test/utils/` (WISH-2120) | Match exact function signatures |
| TypeScript scope | `.vscode/settings.json` | Use existing language scope patterns |

### No New Dependencies

All snippets use existing VS Code snippet infrastructure:
- JSON snippet format (VS Code native)
- TypeScript language scope (already configured)

---

## Architecture Notes

### Developer Experience

This story is **developer tooling only** and does not affect production code or runtime architecture. Snippets improve:

- **Discoverability:** Developers find utilities via autocomplete
- **Consistency:** All tests use same utilities with same patterns
- **Onboarding:** New developers learn test patterns faster
- **Productivity:** Reduce time spent writing boilerplate test setup

### Directory Structure

```
.vscode/
├── settings.json          # Existing VS Code settings
├── test-utils.code-snippets  # NEW - Test utility snippets
└── README.md              # NEW/UPDATE - Snippet documentation
```

---

## Infrastructure Notes

- **No infrastructure changes** - Developer tooling only
- **No deployment** - Local development environment only
- **No CI impact** - Snippets don't affect tests or builds

---

## Test Plan

### Manual Testing

| Snippet | Test | Expected Result |
|---------|------|-----------------|
| `cmf` | Type `cmf` in test file, press Tab | Expands to `createMockFile()` |
| `cmfc` | Type `cmfc`, press Tab, fill tabstops | Expands with custom properties |
| `ms3s` | Type `ms3s`, press Tab | Success scenario with cleanup |
| `ms3e` | Type `ms3e`, press Tab, select from dropdown | Error scenario with statusCode |
| `ms3p` | Type `ms3p`, press Tab | Progress simulation |
| TypeScript scope | Type snippet in `.ts` file | Works |
| TypeScript scope | Type snippet in `.js` file | Does not trigger |

### Evidence

After implementation:

1. Open VS Code in workspace root
2. Create new test file: `apps/web/app-wishlist-gallery/src/test/example.test.ts`
3. Type each snippet prefix and verify expansion
4. Take screenshots of autocomplete suggestions
5. Verify no type errors after expansion

---

## TypeScript Interfaces

Snippets generate code matching these interfaces from WISH-2120:

```typescript
// createMockFile
interface CreateMockFileOptions {
  name?: string     // default: 'test-image.jpg'
  type?: string     // default: 'image/jpeg'
  size?: number     // default: 1024 (bytes)
  content?: string  // optional explicit content
}

function createMockFile(options?: CreateMockFileOptions): File

// mockS3Upload
interface MockS3UploadOptions {
  scenario: 'success' | 'presign-error' | 's3-error' | 'timeout'
  statusCode?: number        // default depends on scenario
  delay?: number             // default: 0 (ms)
  progressSteps?: number[]   // default: [100]
}

type MockS3UploadCleanup = () => void

function mockS3Upload(options: MockS3UploadOptions): MockS3UploadCleanup
```

---

## Risks

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Snippets not committed to repo | Medium | High | Add `.vscode/` directory to git (not ignored) |
| Developers don't discover snippets | Medium | Medium | Document in onboarding guide, README |
| Snippet syntax breaks in new VS Code | Low | Low | Test in current stable version |

---

## Open Questions

_None - straightforward snippet creation based on existing utilities_
