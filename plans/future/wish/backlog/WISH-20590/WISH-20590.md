---
doc_type: story
title: "WISH-20590: Migrate Accessibility Hooks to @repo/accessibility"
story_id: WISH-20590
story_prefix: WISH
status: backlog
phase: 1
created_at: "2026-01-31T19:00:00-07:00"
updated_at: "2026-01-31T19:00:00-07:00"
depends_on: [WISH-2006]
follow_up_from: WISH-2006
estimated_points: 3
---

# WISH-20590: Migrate Accessibility Hooks to @repo/accessibility

## Follow-up Context

**Parent Story:** WISH-2006 (Accessibility)
**Source:** QA Discovery Notes - Enhancement Opportunity #1
**Original Finding:** "Migrate accessibility hooks to @repo/accessibility package once proven in production"
**Category:** Enhancement Opportunity
**Impact:** Medium - Enables reuse of accessibility patterns across multiple apps
**Effort:** Low - Straightforward migration of proven utilities to shared package

**Background:**

WISH-2006 implemented comprehensive keyboard navigation and screen reader support for the wishlist gallery. As part of that work, three reusable accessibility hooks were created in `apps/web/app-wishlist-gallery/src/hooks/`:

1. `useRovingTabIndex` - Manages 2D grid keyboard navigation with arrow keys
2. `useKeyboardShortcuts` - Global keyboard shortcut manager
3. `useAnnouncer` - Screen reader live region manager

These hooks were intentionally created app-local first to allow for rapid iteration and validation in production. Now that they have been proven effective, this story migrates them to the shared `@repo/accessibility` package where they can be reused across all React applications in the monorepo.

---

## Context

The `@repo/accessibility` package currently contains drag-and-drop specific utilities (`useKeyboardDragAndDrop`, `KeyboardDragDropArea`). The three hooks created in WISH-2006 represent general-purpose accessibility patterns that should be available to all apps:

- **Roving tabindex** is a standard WAI-ARIA pattern for grid and list navigation
- **Keyboard shortcuts** are useful for any feature-rich UI requiring power-user shortcuts
- **Screen reader announcements** are essential for dynamic content updates in accessible applications

By migrating these to `@repo/accessibility`, we establish reusable patterns that future accessibility work can build upon, reducing duplication and ensuring consistency across the platform.

---

## Goal

Move proven accessibility hooks from `app-wishlist-gallery` to `@repo/accessibility` package, enabling reuse across all React apps.

**Success Criteria:**
- `useRovingTabIndex`, `useKeyboardShortcuts`, `useAnnouncer` exported from `@repo/accessibility`
- Wishlist gallery updated to import from shared package
- All existing tests continue to pass
- Hooks are documented with TSDoc comments and usage examples
- No breaking changes to existing `@repo/accessibility` exports

---

## Non-goals

- Adding new features to the hooks (this is a refactor/move only)
- Migrating other app-specific utilities (focus on accessibility only)
- Creating UI components (hooks only)
- Modifying hook implementation beyond necessary TypeScript packaging adjustments
- Updating other apps to use these hooks (future work as needed)

---

## Scope

### Packages Affected

**Modified:**
- `packages/core/accessibility` - Add three new hook exports
- `apps/web/app-wishlist-gallery` - Update imports to use `@repo/accessibility`

**No backend changes** - This is a frontend refactor.

### Files to Migrate

**Source (app-wishlist-gallery):**
- `src/hooks/useRovingTabIndex.ts` → `packages/core/accessibility/src/hooks/useRovingTabIndex.ts`
- `src/hooks/useKeyboardShortcuts.ts` → `packages/core/accessibility/src/hooks/useKeyboardShortcuts.ts`
- `src/hooks/useAnnouncer.ts` → `packages/core/accessibility/src/hooks/useAnnouncer.ts`

**Tests to Migrate:**
- `src/hooks/__tests__/useRovingTabIndex.test.ts` → `packages/core/accessibility/src/hooks/__tests__/useRovingTabIndex.test.ts`
- `src/hooks/__tests__/useKeyboardShortcuts.test.ts` → `packages/core/accessibility/src/hooks/__tests__/useKeyboardShortcuts.test.ts`
- `src/hooks/__tests__/useAnnouncer.test.ts` → `packages/core/accessibility/src/hooks/__tests__/useAnnouncer.test.ts`

### Updated Exports

**`packages/core/accessibility/src/index.ts`:**
```typescript
// Existing exports (unchanged)
export { useKeyboardDragAndDrop } from './hooks/useKeyboardDragAndDrop'
export { KeyboardDragDropArea } from './components/KeyboardDragDropArea'

// New exports (from WISH-2006)
export { useRovingTabIndex } from './hooks/useRovingTabIndex'
export { useKeyboardShortcuts } from './hooks/useKeyboardShortcuts'
export { useAnnouncer } from './hooks/useAnnouncer'
```

### Component Updates

**app-wishlist-gallery:**
- `src/components/WishlistGallery/index.tsx` - Update imports
- `src/components/WishlistCard/index.tsx` - Update imports
- `src/pages/MainPage.tsx` - Update imports (if using hooks directly)

---

## Acceptance Criteria

### Migration

- [ ] `useRovingTabIndex.ts` moved to `packages/core/accessibility/src/hooks/`
- [ ] `useKeyboardShortcuts.ts` moved to `packages/core/accessibility/src/hooks/`
- [ ] `useAnnouncer.ts` moved to `packages/core/accessibility/src/hooks/`
- [ ] All three hooks exported from `packages/core/accessibility/src/index.ts`
- [ ] Original files removed from `apps/web/app-wishlist-gallery/src/hooks/`

### Tests

- [ ] Unit tests for all three hooks moved to `packages/core/accessibility/src/hooks/__tests__/`
- [ ] All migrated tests pass in new location
- [ ] Wishlist gallery E2E tests still pass (no regression)
- [ ] Test coverage maintained at >= 45% for accessibility package

### Documentation

- [ ] Each hook has TSDoc comments with description, parameters, return values
- [ ] Usage examples added to each hook's JSDoc
- [ ] `packages/core/accessibility/README.md` updated with new exports
- [ ] Architecture decision documented in `packages/core/accessibility/docs/` (optional)

### Import Updates

- [ ] All imports in `app-wishlist-gallery` updated to use `@repo/accessibility`
- [ ] No direct file path imports (e.g., `@repo/accessibility/hooks/useAnnouncer` is wrong)
- [ ] All imports use barrel export: `import { useAnnouncer } from '@repo/accessibility'`

### No Breaking Changes

- [ ] Existing `@repo/accessibility` exports unchanged
- [ ] Hook APIs unchanged (same function signatures)
- [ ] TypeScript compilation passes for all apps
- [ ] No new peer dependencies required

---

## Reuse Plan

### From Existing Code

**Source hooks (WISH-2006):**
- Copy implementations from `apps/web/app-wishlist-gallery/src/hooks/`
- Preserve all logic, no modifications beyond packaging adjustments
- Keep existing TypeScript types

**Source tests (WISH-2006):**
- Copy unit tests from `apps/web/app-wishlist-gallery/src/hooks/__tests__/`
- Update import paths only

### From Existing Packages

**`@repo/accessibility` (existing structure):**
- Follow existing directory structure (`src/hooks/`, `src/__tests__/`)
- Follow existing export pattern (barrel export via `src/index.ts`)
- Follow existing testing setup (Vitest + React Testing Library)

---

## Architecture Notes

### Package Structure

After migration, `@repo/accessibility` will have:

```
packages/core/accessibility/
├── src/
│   ├── hooks/
│   │   ├── useKeyboardDragAndDrop.ts      # Existing
│   │   ├── useRovingTabIndex.ts           # New (from WISH-2006)
│   │   ├── useKeyboardShortcuts.ts        # New (from WISH-2006)
│   │   └── useAnnouncer.ts                # New (from WISH-2006)
│   ├── components/
│   │   └── KeyboardDragDropArea.tsx       # Existing
│   ├── __tests__/
│   │   ├── useRovingTabIndex.test.ts      # New
│   │   ├── useKeyboardShortcuts.test.ts   # New
│   │   └── useAnnouncer.test.ts           # New
│   └── index.ts                            # Barrel export
├── package.json
├── tsconfig.json
└── README.md
```

### Barrel Export Pattern

**CRITICAL:** All imports MUST use the barrel export pattern (never direct file imports):

```typescript
// CORRECT
import { useRovingTabIndex, useAnnouncer } from '@repo/accessibility'

// WRONG - never import from individual paths
import { useRovingTabIndex } from '@repo/accessibility/hooks/useRovingTabIndex'
```

This follows project guidelines in `CLAUDE.md` (Critical Import Rules).

### Hook API Stability

The migrated hooks MUST maintain identical APIs to ensure no breaking changes:

**useRovingTabIndex:**
```typescript
function useRovingTabIndex<T>(
  items: T[],
  options?: { columns?: number }
): {
  activeIndex: number
  handleKeyDown: (e: KeyboardEvent) => void
  getTabIndex: (index: number) => number
}
```

**useKeyboardShortcuts:**
```typescript
function useKeyboardShortcuts(shortcuts: Record<string, () => void>): void
```

**useAnnouncer:**
```typescript
function useAnnouncer(): {
  announcement: string
  announce: (message: string, priority?: 'polite' | 'assertive') => void
}
```

---

## HTTP Contract Plan

**No API changes** - This is a frontend-only refactor.

---

## Seed Requirements

**No seed data changes** - This story does not affect database or backend.

---

## Test Plan

### Happy Path Tests

#### Test 1: useRovingTabIndex Hook in New Package

**Setup:**
- Import `useRovingTabIndex` from `@repo/accessibility`
- Render a test component with 9 items in 3x3 grid

**Action:**
- Call hook with items array
- Simulate ArrowDown keypress
- Simulate ArrowRight keypress
- Simulate Home keypress

**Expected:**
- Active index updates correctly for each key
- `getTabIndex` returns 0 for active item, -1 for others
- No TypeScript errors
- Hook behaves identically to app-local version

**Evidence:**
- Unit test passes in `packages/core/accessibility/src/__tests__/useRovingTabIndex.test.ts`
- Test coverage >= 80% for hook

---

#### Test 2: useKeyboardShortcuts Hook in New Package

**Setup:**
- Import `useKeyboardShortcuts` from `@repo/accessibility`
- Define shortcut map: `{ a: mockOpenModal, escape: mockCloseModal }`

**Action:**
- Simulate 'a' keypress
- Simulate 'escape' keypress
- Simulate keypress in input element

**Expected:**
- Shortcut handlers called correctly
- Shortcuts ignored when target is input/textarea
- No memory leaks (event listeners cleaned up)

**Evidence:**
- Unit test passes in `packages/core/accessibility/src/__tests__/useKeyboardShortcuts.test.ts`
- Test coverage >= 80% for hook

---

#### Test 3: useAnnouncer Hook in New Package

**Setup:**
- Import `useAnnouncer` from `@repo/accessibility`
- Render test component

**Action:**
- Call `announce('Test message', 'polite')`
- Check announcement value immediately
- Wait 150ms and check announcement cleared

**Expected:**
- `announcement` state updates with message
- Message clears after timeout
- Multiple announcements work sequentially
- 'polite' and 'assertive' priorities both work

**Evidence:**
- Unit test passes in `packages/core/accessibility/src/__tests__/useAnnouncer.test.ts`
- Test coverage >= 80% for hook

---

#### Test 4: Wishlist Gallery Import Updates

**Setup:**
- Update all imports in `app-wishlist-gallery` to use `@repo/accessibility`
- Run Playwright E2E test suite from WISH-2006

**Action:**
- Run `pnpm test:e2e --grep accessibility`

**Expected:**
- All accessibility E2E tests pass
- No import errors
- Keyboard navigation works identically
- Screen reader announcements work identically

**Evidence:**
- Playwright test suite passes with 0 failures
- No console errors in browser

---

### Error Cases

#### Error 1: Missing Barrel Export

**Setup:**
- Accidentally omit one hook from `src/index.ts`

**Action:**
- Try to import omitted hook from `@repo/accessibility`

**Expected:**
- TypeScript compilation fails with clear error
- Error message indicates missing export

**Evidence:**
- `pnpm check-types` catches error before commit

---

#### Error 2: Direct File Import Attempt

**Setup:**
- Developer tries to import hook directly: `import { useAnnouncer } from '@repo/accessibility/hooks/useAnnouncer'`

**Action:**
- Run ESLint

**Expected:**
- Linter catches direct import violation (if configured)
- Build fails on CI

**Evidence:**
- CI pipeline rejects PR with linting error

---

### Edge Cases

#### Edge 1: Parallel Package Builds

**Setup:**
- Run `pnpm build` in monorepo root
- `app-wishlist-gallery` depends on `@repo/accessibility`

**Action:**
- Turborepo builds packages in dependency order

**Expected:**
- `@repo/accessibility` builds first
- `app-wishlist-gallery` builds after (no build errors)
- All TypeScript types resolve correctly

**Evidence:**
- `pnpm build` completes successfully
- No type errors in build output

---

### Required Tooling Evidence

**Unit Tests:**
- `packages/core/accessibility/src/__tests__/useRovingTabIndex.test.ts`
- `packages/core/accessibility/src/__tests__/useKeyboardShortcuts.test.ts`
- `packages/core/accessibility/src/__tests__/useAnnouncer.test.ts`

**E2E Regression Tests:**
- `apps/web/app-wishlist-gallery/e2e/accessibility.spec.ts` (from WISH-2006)

**Assertions:**
- All three hooks export correctly from `@repo/accessibility`
- Import updates in `app-wishlist-gallery` resolve without errors
- No breaking changes to existing `@repo/accessibility` exports
- TypeScript compilation passes for all apps
- Test coverage maintained >= 45% for accessibility package
- E2E tests from WISH-2006 still pass (no regression)

**Artifacts:**
- Test coverage report for `@repo/accessibility`
- Build output confirming package dependency resolution
- Updated README.md in `@repo/accessibility`

---

## UI/UX Notes

**No UI changes** - This is an internal refactor with zero user-facing impact.

**Developer Experience:**
- Simpler imports for future accessibility work
- Documented hooks reduce implementation time for new features
- Consistent patterns across apps

---

## Infrastructure Notes

**No infrastructure changes.**

**Build System:**
- Turborepo will cache `@repo/accessibility` build
- Dependent apps rebuild when accessibility package changes
- No changes to package.json workspace configuration required

---

## Risk Notes

### Import Path Confusion

**Risk:** Developers may accidentally use direct file imports instead of barrel exports.

**Mitigation:**
- Document correct import pattern in README
- Add ESLint rule to catch direct imports (if possible)
- Code review checklist item: "Verify barrel export usage"

**Fallback:** Manual code review catches violations before merge.

---

### Circular Dependency Risk

**Risk:** If `@repo/accessibility` depends on app-specific code, circular dependencies may occur.

**Mitigation:**
- Verify hooks have zero app-specific dependencies
- Only migrate pure, reusable utilities
- `@repo/accessibility` should only depend on React and shared design-system tokens

**Verification:** Check `package.json` dependencies before migration.

---

### Test Flakiness After Migration

**Risk:** Tests may behave differently in shared package environment.

**Mitigation:**
- Copy existing test setup exactly
- Run tests 10x locally before merging (`pnpm test --run --reporter=verbose`)
- Monitor CI for flakiness in first week after merge

**Fallback:** Revert migration if tests become unreliable.

---

## Definition of Done

- [ ] All acceptance criteria met
- [ ] Three hooks migrated to `@repo/accessibility/src/hooks/`
- [ ] Three test files migrated to `@repo/accessibility/src/__tests__/`
- [ ] All hooks exported from `@repo/accessibility/src/index.ts`
- [ ] All imports in `app-wishlist-gallery` updated to use barrel export
- [ ] Original files deleted from `app-wishlist-gallery/src/hooks/`
- [ ] README.md updated in `@repo/accessibility`
- [ ] TSDoc comments added to all hooks
- [ ] All unit tests pass in new location
- [ ] E2E tests from WISH-2006 still pass (no regression)
- [ ] TypeScript compilation passes for all apps
- [ ] Build completes successfully (`pnpm build`)
- [ ] Test coverage >= 45% for `@repo/accessibility`
- [ ] No breaking changes to existing exports
- [ ] Code reviewed
- [ ] PR merged to main

---

## Token Budget

### Phase Summary

| Phase | Estimated | Actual | Delta | Notes |
|-------|-----------|--------|-------|-------|
| Elaboration | ~5k | — | — | Simple refactor, minimal elaboration needed |
| Implementation | ~8k | — | — | File moves, import updates, documentation |
| Code Review | ~4k | — | — | Verify migration correctness |
| Testing | ~3k | — | — | Run existing tests, verify no regression |
| **Total** | ~20k | — | — | — |

### Actual Measurements

| Date | Phase | Before | After | Delta | Notes |
|------|-------|--------|-------|-------|-------|

---

## Agent Log

Append-only.

| Timestamp (America/Denver) | Agent | Action | Outputs |
|---|---|---|---|
| 2026-01-31 19:00 | pm-story-followup-leader | Generated follow-up story from WISH-2006 QA Discovery (Enhancement #1) | WISH-20590.md |

---
