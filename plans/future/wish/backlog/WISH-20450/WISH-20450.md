---
doc_type: story
title: "WISH-20450: HEIC/HEIF Upload E2E Tests (Playwright + Cucumber)"
story_id: WISH-20450
story_prefix: WISH
status: backlog
e2e_required: true
follow_up_from: WISH-2045
phase: 4
created_at: "2026-02-09T00:00:00-07:00"
updated_at: "2026-02-09T00:00:00-07:00"
depends_on: [WISH-2045]
estimated_points: 1
---

# WISH-20450: HEIC/HEIF Upload E2E Tests (Playwright + Cucumber)

## Follow-up Context

**Parent Story:** WISH-2045: HEIC/HEIF Image Format Support
**Source:** Deferred AC from WISH-2045 implementation
**Original Finding:** Playwright E2E tests were deferred during WISH-2045 implementation to keep story scope focused on core HEIC conversion logic
**Category:** Test Coverage Gap
**Impact:** Medium - E2E coverage needed to validate full user journey for HEIC uploads
**Effort:** Low - Implementation exists; tests need to exercise it end-to-end

## Context

WISH-2045 implemented HEIC/HEIF image format support with full unit tests (23) and integration tests (12), but Playwright E2E tests with Cucumber/Gherkin were deferred. This story adds the missing E2E test coverage using the project's established Playwright + Cucumber BDD pattern.

The HEIC conversion flow to test:
1. User selects HEIC file from iPhone
2. HEIC detection triggers automatic conversion
3. Progress indicator shows conversion status
4. Converted JPEG enters compression workflow
5. Compressed image uploads to S3
6. Error/fallback scenarios handled gracefully

## Goal

Write Playwright E2E tests in Cucumber/Gherkin format covering the HEIC upload happy path, conversion failure handling, and browser compatibility fallback.

## Non-goals

- Not modifying any HEIC conversion implementation code
- Not adding new features to the HEIC workflow
- Not testing server-side conversion (that's WISH-20530)

## Scope

**Components Affected:**
- `apps/web/playwright/features/wishlist/` - New `.feature` file
- `apps/web/playwright/steps/` - New step definitions

**Packages Affected:**
- `apps/web/playwright`

## Acceptance Criteria

- [ ] Gherkin feature file: `wishlist-heic-upload.feature` with scenarios for HEIC upload happy path
- [ ] Gherkin scenario: HEIC file detected and converted to JPEG before upload
- [ ] Gherkin scenario: Conversion progress indicator displayed during HEIC conversion
- [ ] Gherkin scenario: Conversion failure falls back to original HEIC upload with warning
- [ ] Gherkin scenario: "High quality" mode skips compression but still converts HEIC to JPEG
- [ ] Gherkin scenario: Non-HEIC images bypass conversion step entirely
- [ ] Step definitions implement all scenarios with proper Playwright selectors
- [ ] All E2E tests pass in CI

## Reuse Plan

- Follows existing Playwright + Cucumber patterns from other wishlist feature files
- Reuses existing test fixtures and page objects where available
- Builds on upload test infrastructure from `wishlist-images.feature` and `wishlist-image-compression.feature`

## Test Plan

Run the full Playwright suite to verify:
1. All new HEIC scenarios pass
2. No regressions in existing wishlist E2E tests

## Risks / Edge Cases

1. HEIC test files needed - may need to create synthetic HEIC blobs or use file input mocking
2. `heic2any` uses WebAssembly - E2E tests run in real browser so this should work, but may need consideration for CI environments
