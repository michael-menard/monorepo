---
doc_type: story
title: "WISH-2069: Run and Fix Image Compression E2E Tests"
story_id: WISH-2069
story_prefix: WISH
status: backlog
e2e_required: false
follow_up_from: WISH-2022
phase: 4
created_at: "2026-02-09T18:30:00-07:00"
updated_at: "2026-02-09T18:30:00-07:00"
depends_on: [WISH-2022]
estimated_points: 1
---

# WISH-2069: Run and Fix Image Compression E2E Tests

## Follow-up Context

**Parent Story:** WISH-2022: Client-side Image Compression
**Source:** Implementation gap - E2E tests were authored in WISH-2022 but could not be executed due to missing AWS Cognito infrastructure locally
**Category:** Test Validation
**Impact:** Medium - ensures E2E tests are validated and working
**Effort:** Low - tests are already written, just need execution and potential fixes

## Context

WISH-2022 implemented client-side image compression with comprehensive unit tests (132 passing) and authored Playwright E2E tests (13 BDD scenarios). However, the E2E tests could not be executed during implementation because they require AWS Cognito environment variables that were not available in the local development environment.

The E2E tests, feature files, step definitions, and dedicated Playwright config are all in place. This story covers running them with proper infrastructure and fixing any issues discovered.

## Goal

Execute the existing WISH-2022 Playwright E2E tests against the running application with AWS Cognito authentication, and fix any test failures or infrastructure issues.

## Non-goals

- Not writing new E2E tests (they already exist)
- Not modifying compression functionality
- Not changing the compression UI

## Scope

**Components Affected:**
- `apps/web/playwright/features/wishlist/wishlist-image-compression.feature` (fix if needed)
- `apps/web/playwright/steps/wishlist-image-compression.steps.ts` (fix if needed)
- `apps/web/playwright/playwright.compression.config.ts` (fix if needed)

**Packages Affected:**
- `apps/web/playwright`

## Acceptance Criteria

- [ ] AWS Cognito environment variables are configured in `apps/web/playwright/.env`
- [ ] `pnpm bdd:gen:compression` completes without errors
- [ ] `pnpm test:compression` runs all 13 BDD scenarios
- [ ] All compression E2E test scenarios pass (or are updated to match current UI)
- [ ] Any test step definitions updated to match current DOM structure
- [ ] Compression smoke tests pass: `pnpm test:compression:smoke`

## Existing Test Infrastructure

### Feature File
`apps/web/playwright/features/wishlist/wishlist-image-compression.feature`

13 scenarios covering:
- UI elements (quality selector, skip checkbox, preset options)
- Happy path (large image compression, sequential progress)
- Skip logic (small images)
- User preferences (toggle, persistence)
- Form state (disabled during upload)
- Full E2E flow (add item with compression)

### Step Definitions
`apps/web/playwright/steps/wishlist-image-compression.steps.ts`

Uses:
- Playwright route interception for presign/upload mocking
- Test fixtures: `large-test-image.jpg`, `sample-thumbnail.jpg`
- Real browser login via Cognito

### Config
`apps/web/playwright/playwright.compression.config.ts`

### Run Commands
```bash
pnpm bdd:gen:compression          # Generate BDD test files
pnpm test:compression             # Run all compression tests
pnpm test:compression:headed      # View browser during tests
pnpm test:compression:smoke       # Run @smoke tagged tests
```

## Risks / Edge Cases

1. DOM selectors may have changed since tests were authored (e.g., `#compressionPreset`, `#skipCompression`)
2. Toast messages may have changed wording
3. Cognito test users may need to be seeded first (`pnpm seed:users`)
4. Main-app dev server must be running on port 3000

## Open Questions

None - all test infrastructure is in place, just needs execution with proper environment.
