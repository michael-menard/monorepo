---
doc_type: story
title: "WISH-20490: Background Compression E2E Tests"
story_id: WISH-20490
story_prefix: WISH
status: backlog
follow_up_from: WISH-2049
phase: 4
created_at: "2026-02-09T00:00:00-07:00"
depends_on: [WISH-2049]
estimated_points: 1
---

# WISH-20490: Background Compression E2E Tests

## Follow-up Context

**Parent Story:** WISH-2049: Background Compression for Perceived Performance
**Source:** Split from WISH-2049 implementation - E2E tests deferred due to broken dev server
**Category:** Testing
**Impact:** Medium - validates background compression in real browser environment
**Effort:** Low - E2E test files already written, need execution and potential fixes

## Context

WISH-2049 implemented background image compression with full unit test coverage (22/22 tests, 100% statement coverage). Playwright E2E tests were written (feature file + step definitions) but could not be executed because the dev server is currently broken.

This story covers:
1. Fixing the dev server issue blocking E2E test execution
2. Running the existing Playwright E2E tests for background compression
3. Fixing any E2E test failures discovered during live execution
4. Validating AC12 (E2E coverage) from WISH-2049

## Goal

Execute and pass all Playwright E2E tests for WISH-2049's background compression feature in live browser mode.

## Non-goals

- Not re-implementing any compression logic (already done in WISH-2049)
- Not adding new unit tests (already comprehensive)
- Not changing the background compression architecture

## Scope

**Files Already Created (from WISH-2049):**
- `apps/web/playwright/features/wishlist/wishlist-background-compression.feature` - 3 scenarios
- `apps/web/playwright/steps/wishlist-background-compression.steps.ts` - Step definitions
- `apps/web/playwright/playwright.bg-compression.config.ts` - Focused Playwright config
- `apps/web/playwright/fixtures/uploader/large-test-image.jpg` - Test fixture

**Packages Affected:**
- `apps/web/playwright`
- `apps/web/main-app` (dev server fix if needed)

## Acceptance Criteria

- [ ] AC1: Dev server starts successfully and serves the wishlist gallery app
- [ ] AC2: BDD test generation succeeds (`pnpm bdd:gen:bg-compression`)
- [ ] AC3: E2E Scenario "Background compression completes before form submission" passes
- [ ] AC4: E2E Scenario "Form remains interactive during background compression" passes
- [ ] AC5: E2E Scenario "Skip compression checkbox bypasses background compression" passes
- [ ] AC6: All 3 E2E scenarios pass in headless Chromium (`pnpm test:bg-compression`)

## Test Plan

1. Start dev server: `pnpm dev` in apps/web/main-app
2. Generate BDD tests: `pnpm bdd:gen:bg-compression`
3. Run E2E tests: `pnpm test:bg-compression`
4. Fix any failures and re-run
5. Capture results for EVIDENCE.yaml

## Risks / Edge Cases

1. **Dev server fix may require separate investigation**: If the dev server issue is systemic, this story may need to wait
2. **E2E selectors may not match live DOM**: Step definitions use selectors like `#title`, `#store` that may differ in live app
3. **Authentication flow**: Tests require signing in with test credentials that may need Cognito setup

---

Deferred AC from WISH-2049 implementation (E2E tests split out to separate story due to broken dev server)

**Story File:** `plans/future/wish/backlog/WISH-20490/WISH-20490.md`
