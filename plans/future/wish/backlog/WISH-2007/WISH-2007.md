---
doc_type: story
title: "WISH-2007: Run Migration"
story_id: WISH-2007
story_prefix: WISH
status: Approved
phase: 1
created_at: "2026-01-24T02:00:00-07:00"
updated_at: "2026-01-24T02:00:00-07:00"
depends_on: [WISH-2000]
estimated_points: 1
---

# WISH-2007: Run Migration

## Goal

Apply schema changes to database for all environments (dev, staging, prod).

## Feature

Execute database migration to create `wishlist_items` table in all environments.

## Phase

Phase 1: Foundation

## Acceptance Criteria

- [ ] Migration file created with CREATE TABLE statement
- [ ] Migration successfully applied to dev environment
- [ ] Migration successfully applied to staging environment
- [ ] Migration successfully applied to prod environment (or planned for release)
- [ ] Rollback script available if needed

## Risk Notes

Must run after WISH-2000 is approved; rollback plan needed if issues arise.

## Technical Details

### Migration File

**Location:** `apps/api/core/database/migrations/0006_wishlist_items_table.sql`

Creates the `wishlist_items` table with all constraints and indexes.

```sql
CREATE TABLE wishlist_items (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id TEXT NOT NULL,
  title TEXT NOT NULL,
  store TEXT NOT NULL,
  set_number TEXT,
  source_url TEXT,
  image_url TEXT,
  price DECIMAL(10, 2),
  currency TEXT DEFAULT 'USD',
  piece_count INTEGER,
  release_date TIMESTAMP,
  tags TEXT[] DEFAULT ARRAY[]::TEXT[],
  priority INTEGER DEFAULT 0,
  notes TEXT,
  sort_order INTEGER DEFAULT 0,
  created_at TIMESTAMP NOT NULL DEFAULT now(),
  updated_at TIMESTAMP NOT NULL DEFAULT now()
);

CREATE INDEX idx_wishlist_items_user_id ON wishlist_items(user_id);
CREATE INDEX idx_wishlist_items_user_sort ON wishlist_items(user_id, sort_order);
```

### Environments

Migrations applied to:
1. Local dev environment
2. Staging database
3. Production database (coordinated with release)

### Rollback Plan

Rollback script available:
```sql
DROP TABLE IF EXISTS wishlist_items CASCADE;
```

## Dependencies

- **Depends On:** WISH-2000 (schema must be approved first)
- **Unblocks:** WISH-2001, WISH-2002, WISH-2003, WISH-2004

## Reuse Plan

- Use existing migration infrastructure from `apps/api/core/database/migrations`
- Follow naming conventions and patterns from previous migrations
- Use standard SQL dialect for Aurora PostgreSQL

## Definition of Done

- [ ] Migration file created
- [ ] Migration runs without errors in dev
- [ ] Migration runs without errors in staging
- [ ] Production migration planned/applied
- [ ] Rollback script tested
- [ ] Team notified of changes
- [ ] Ready for WISH-2001

## Token Budget

### Phase Summary

| Phase | Estimated | Actual | Delta | Notes |
|-------|-----------|--------|-------|-------|
| Story Gen | ~2k | — | — | — |
| Elaboration | ~2k | — | — | — |
| Implementation | ~3k | — | — | — |
| Code Review | ~2k | — | — | — |
| **Total** | ~9k | — | — | — |

### Actual Measurements

| Date | Phase | Before | After | Delta | Notes |
|------|-------|--------|-------|-------|-------|

## Agent Log

Append-only.

| Timestamp (America/Denver) | Agent | Action | Outputs |
|---|---|---|---|
| 2026-01-24 02:00 | pm-bootstrap-generation-leader | Created story file | WISH-2007.md |
