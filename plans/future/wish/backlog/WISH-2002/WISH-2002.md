---
doc_type: story
title: "WISH-2002: Add Item Flow"
story_id: WISH-2002
story_prefix: WISH
status: Approved
phase: 3
created_at: "2026-01-24T02:00:00-07:00"
updated_at: "2026-01-24T02:00:00-07:00"
depends_on: [WISH-2001]
estimated_points: 5
---

# WISH-2002: Add Item Flow

## Goal

Enable users to add wishlist items manually with all fields and image upload.

## Feature

POST endpoint, add item form with all fields, image upload to S3, form validation with Zod, RTK Query mutation.

## Phase

Phase 3: Core Features

## Acceptance Criteria

- [ ] POST `/api/wishlist` endpoint validates and creates item
- [ ] Add item page with form fields: store (required), title (required), set number, price, currency, piece count, priority, image, source URL, notes, tags
- [ ] Store selector: LEGO, Barweer, Cata, BrickLink, Other
- [ ] Priority selector: 0-5 scale
- [ ] Image upload field with S3 presigned URL
- [ ] Form validation with Zod (client and server)
- [ ] RTK Query mutation: `useAddToWishlistMutation`
- [ ] Success toast with link to view item
- [ ] Error handling for API failures

## Risk Notes

Image upload to S3 can fail or timeout; needs robust error handling and retry logic.

## Technical Details

### Backend (API)

**Location:** `apps/api/endpoints/wishlist/create/handler.ts`

**POST /api/wishlist**

Creates new wishlist item.

Request body:
```json
{
  "title": "string (required)",
  "store": "enum (required)",
  "setNumber": "string (optional)",
  "sourceUrl": "string (optional)",
  "imageUrl": "string (optional)",
  "price": "number (optional)",
  "currency": "string (optional, default: USD)",
  "pieceCount": "number (optional)",
  "releaseDate": "ISO date (optional)",
  "tags": "string[] (optional)",
  "priority": "0-5 (optional)",
  "notes": "string (optional)"
}
```

Response: `201 Created` with full item object

Validation: Zod schema from WISH-2000

### Frontend (React)

**Locations:**
- `apps/web/app-wishlist-gallery/src/pages/AddItemPage.tsx`
- `apps/web/app-wishlist-gallery/src/components/WishlistForm.tsx`
- `apps/web/app-wishlist-gallery/src/hooks/useS3Upload.ts`

**Add Item Page**

- Breadcrumb: Gallery > Add Item
- Form with all fields
- Image upload preview
- Submit button disabled while uploading
- Success toast with link to view item

**WishlistForm Component**

Reusable form for add/edit with:
- Text inputs: title, setNumber, sourceUrl, notes
- Select dropdowns: store, currency, priority
- Number inputs: price, pieceCount
- Date picker: releaseDate
- Tag input: comma-separated or chip interface
- Image upload with preview

**Form Validation**

Client-side: Zod schema from `@repo/api-client`
Server-side: POST endpoint validates again

**Image Upload**

1. User selects image file
2. Request presigned S3 URL from backend
3. Upload directly to S3 with presigned URL
4. Form submission includes S3 URL

Error handling:
- Presigned URL expired: retry
- S3 upload failed: clear error, allow retry
- Timeout: show error message
- Invalid file type: reject immediately

### RTK Query Integration

**Location:** `packages/core/api-client/src/rtk/wishlist-api.ts`

Mutation:
- `useAddToWishlistMutation()` - POST endpoint
- Invalidates `useGetWishlistQuery` cache on success

## Dependencies

- **Depends On:** WISH-2001 (gallery page)
- **Can run in parallel with:** WISH-2003, WISH-2004
- **Unblocks:** WISH-2005 (UX Polish)

## Reuse Plan

- Use `WishlistItemSchema` from WISH-2000 for validation
- Use `@repo/app-component-library` for form inputs, buttons
- Leverage S3 presigned URL pattern from Instructions epic (if available)
- Use RTK Query mutation patterns from existing endpoints

## Test Coverage

**Backend Tests:**
- Create with all required fields
- Create with optional fields
- Validation errors for missing required fields
- Validation errors for invalid field types
- Unauthorized user rejection

**Frontend Tests:**
- Form renders with all fields
- Form validation feedback
- Image upload preview
- Success/error toasts
- Mutation call with correct payload

**E2E Tests:**
- User can add item with all fields
- User can upload image
- User receives success message
- User is redirected to item detail view
- Added item appears in gallery

## Definition of Done

- [ ] POST endpoint created and deployed
- [ ] Form component created and styled
- [ ] Image upload working with presigned URLs
- [ ] Form validation complete (client + server)
- [ ] RTK Query mutation created
- [ ] Success/error handling
- [ ] Tests passing
- [ ] Code reviewed
- [ ] Ready for WISH-2005

## Token Budget

### Phase Summary

| Phase | Estimated | Actual | Delta | Notes |
|-------|-----------|--------|-------|-------|
| Story Gen | ~6k | — | — | — |
| Elaboration | ~10k | — | — | — |
| Implementation | ~25k | — | — | Image upload adds complexity |
| Code Review | ~8k | — | — | — |
| **Total** | ~49k | — | — | — |

### Actual Measurements

| Date | Phase | Before | After | Delta | Notes |
|------|-------|--------|-------|-------|-------|

## Agent Log

Append-only.

| Timestamp (America/Denver) | Agent | Action | Outputs |
|---|---|---|---|
| 2026-01-24 02:00 | pm-bootstrap-generation-leader | Created story file | WISH-2002.md |
