---
doc_type: story
title: "WISH-20220: Schedule UI/UX (admin dashboard for schedule management)"
story_id: WISH-20220
story_prefix: WISH
status: backlog
phase: 3
created_at: "2026-01-30T00:00:00Z"
updated_at: "2026-01-30T00:00:00Z"
depends_on: [WISH-2119]
follow_up_from: WISH-2119
estimated_points: 3
sizing_warning: false
---

# WISH-20220: Schedule UI/UX (admin dashboard for schedule management)

## Follow-up Context

**Parent Story:** WISH-2119 (Flag scheduling - auto-enable/disable at scheduled times)

**Source:** QA Discovery Notes - Enhancement Opportunity #6

**Original Finding:** "Admin dashboard for schedule management - Deferred to Phase 3+ follow-up story"

**Category:** Enhancement Opportunity

**Impact:** Medium (improves admin experience for managing scheduled flag updates)

**Effort:** Medium (admin UI components + calendar/timeline views + integration with backend endpoints)

## Context

WISH-2119 implemented backend infrastructure for scheduled flag updates with three admin endpoints (POST, GET, DELETE schedules) and a cron job for automated processing. However, there is no user-facing UI for admins to create, view, or cancel schedules. Admins must currently use HTTP clients or cURL to interact with the scheduling API.

This story adds a dedicated admin dashboard page for schedule management with visual timeline/calendar views, interactive schedule creation forms, and real-time status updates. The dashboard provides admins with an intuitive interface for managing scheduled flag updates without requiring API knowledge.

## Goal

Provide admins with a visual, user-friendly dashboard for creating, viewing, and canceling scheduled flag updates, replacing manual API calls with intuitive calendar and timeline views.

## Non-goals

- **Recurring schedules UI** - cron-like syntax deferred to future story (backend support required first)
- **Schedule preview** - simulate flag state before schedule applies (backend support required first)
- **Bulk schedule operations** - multiple schedules in single operation (backend support required first)
- **Real-time WebSocket updates** - polling-based updates only in MVP
- **Mobile-responsive dashboard** - desktop-first in MVP (mobile optimization deferred)
- **Schedule notifications** - email/push notifications deferred to future story
- **Schedule analytics** - metrics and trends deferred to future story

## Scope

### Pages/Surfaces Affected

**New Pages:**
- `/admin/feature-flags/:flagKey/schedules` - Schedule management dashboard for specific flag
- `/admin/feature-flags/schedules` - All schedules across all flags (optional)

**Existing Pages (Extended):**
- `/admin/feature-flags` - Add "Manage Schedules" button to flag list
- `/admin/feature-flags/:flagKey` - Add "Schedules" tab to flag detail page

### Packages Affected

1. **Admin Dashboard App**: `apps/web/admin-dashboard/` (new or extend existing)
   - `src/pages/ScheduleManagementPage.tsx` - Main dashboard page (new)
   - `src/components/ScheduleCalendar/` - Calendar view component (new)
   - `src/components/ScheduleTimeline/` - Timeline visualization component (new)
   - `src/components/CreateScheduleForm/` - Schedule creation form (new)
   - `src/components/ScheduleCard/` - Individual schedule card (new)

2. **API Client**: `packages/core/api-client/src/rtk/`
   - `feature-flags-api.ts` - Add RTK Query endpoints for schedules (extend existing)

3. **Shared Schemas**: `packages/core/api-client/src/schemas/`
   - `feature-flags.ts` - Import schedule schemas from WISH-2119 (already exists)

### UI Components

**ScheduleCalendar Component:**
- Full calendar view showing all schedules by date
- Color-coded schedule markers (pending: blue, applied: green, failed: red, cancelled: gray)
- Click date to create new schedule for that time
- Hover to show schedule details tooltip
- Navigate between months

**ScheduleTimeline Component:**
- Chronological list of all schedules for a flag
- Visual timeline with status indicators
- Past schedules (applied/failed) at top, future schedules (pending) at bottom
- Click schedule to view details or cancel

**CreateScheduleForm Component:**
- Date/time picker for scheduledAt
- Checkboxes for updates: enabled (boolean), rolloutPercentage (0-100 slider)
- Validation: scheduledAt must be in future, at least one update required
- Submit button triggers POST /api/admin/flags/:flagKey/schedule
- Success toast with schedule ID, error toast on failure

**ScheduleCard Component:**
- Display schedule details: scheduledAt, status, updates, createdAt, appliedAt/errorMessage
- Cancel button for pending schedules (DELETE endpoint)
- Status badge with color coding
- Countdown timer for pending schedules

## Acceptance Criteria

### Schedule Management Dashboard Page

**AC1**: Schedule management page navigation
- Admin navigates to `/admin/feature-flags/:flagKey/schedules`
- Page renders with flag name in header
- Back button navigates to flag detail page
- "Create Schedule" button opens CreateScheduleForm modal

**AC2**: Schedule calendar view
- ScheduleCalendar component renders full month calendar
- All schedules for flag displayed as markers on calendar dates
- Color-coded markers: pending (blue), applied (green), failed (red), cancelled (gray)
- Click date opens CreateScheduleForm with pre-filled date
- Navigate between months with prev/next buttons

**AC3**: Schedule timeline view
- ScheduleTimeline component renders chronological list of schedules
- Past schedules (applied/failed/cancelled) at top, future schedules (pending) at bottom
- Each schedule displays: scheduledAt, status badge, updates preview
- Click schedule to expand details (createdAt, appliedAt, errorMessage if failed)

**AC4**: View toggle (calendar vs timeline)
- Toggle button switches between calendar view and timeline view
- View preference saved to localStorage
- Default view: timeline

### Create Schedule Form

**AC5**: Create schedule form validation
- CreateScheduleForm modal renders with date/time picker and update controls
- scheduledAt date/time picker validates future time (error if past)
- At least one update required: enabled checkbox or rolloutPercentage slider
- rolloutPercentage slider range: 0-100 with live preview
- Form submit disabled until valid

**AC6**: Create schedule form submission
- Submit button triggers POST /api/admin/flags/:flagKey/schedule
- Request body: `{ scheduledAt: ISO8601, updates: { enabled?, rolloutPercentage? } }`
- Success: Close modal, show toast "Schedule created", refresh schedule list
- Error: Display error toast with error message (400, 403, 404 errors)

**AC7**: Create schedule from calendar
- Click date in ScheduleCalendar pre-fills scheduledAt in CreateScheduleForm
- Time defaults to 9:00 AM for selected date
- User can adjust time in form before submitting

### Schedule Cards & Details

**AC8**: Schedule card rendering
- Each ScheduleCard displays: scheduledAt (formatted), status badge, updates summary
- Pending schedules show countdown timer (e.g., "in 2 hours 15 minutes")
- Applied schedules show appliedAt timestamp
- Failed schedules show error message with red alert icon
- Cancelled schedules show "Cancelled" badge (gray)

**AC9**: Cancel pending schedule
- Pending ScheduleCard displays "Cancel" button
- Click Cancel triggers DELETE /api/admin/flags/:flagKey/schedule/:scheduleId
- Confirmation modal: "Cancel schedule for [time]? This cannot be undone."
- Success: Update schedule status to 'cancelled', show toast "Schedule cancelled"
- Error: Display error toast (400 if already applied/failed, 404 if not found)

**AC10**: Disable cancel for non-pending schedules
- Applied, failed, and cancelled schedules do NOT display "Cancel" button
- Tooltip on hover: "Cannot cancel schedule with status [status]"

### Real-time Updates (Polling)

**AC11**: Auto-refresh schedule list
- Schedule list refreshes every 60 seconds via RTK Query polling
- Applied schedules move from pending to applied automatically
- Failed schedules update with error message
- Toast notification on status change: "Schedule applied for [flagKey]"

**AC12**: Manual refresh button
- "Refresh" button triggers immediate re-fetch of schedule list
- Loading spinner during fetch
- Success toast: "Schedules refreshed"

### Authorization & Error Handling

**AC13**: Admin-only access enforcement
- Schedule management page requires admin role
- Non-admin users redirected to login or 403 error page
- All API calls include auth token from auth context

**AC14**: Error handling for non-existent flags
- Navigate to `/admin/feature-flags/invalid-flag/schedules`
- API returns 404 for non-existent flag
- Display error page: "Flag not found"
- Back button navigates to flag list

**AC15**: Network error handling
- API call fails with network error (500, timeout)
- Display error toast: "Failed to load schedules. Try again."
- Retry button triggers re-fetch

### Accessibility

**AC16**: Keyboard navigation for calendar
- Calendar navigable with arrow keys (move between dates)
- Enter key on date opens CreateScheduleForm
- Tab key cycles through prev/next month buttons

**AC17**: Screen reader support for schedule timeline
- Each ScheduleCard has aria-label describing schedule
- Status badges have aria-label: "Status: pending/applied/failed/cancelled"
- Countdown timers have aria-live region for updates

**AC18**: Focus management for modals
- CreateScheduleForm modal traps focus on open
- Close modal returns focus to "Create Schedule" button
- Cancel confirmation modal traps focus on open

### Testing

**AC19**: Frontend component tests (minimum 15 tests)
- ScheduleCalendar: Renders calendar with schedules, click date opens form
- ScheduleTimeline: Renders chronological list, click schedule expands details
- CreateScheduleForm: Validation, submission, error handling
- ScheduleCard: Renders schedule details, cancel button behavior
- RTK Query hooks: Create, list, cancel schedule endpoints

**AC20**: Integration tests (Playwright E2E)
- Admin navigates to schedule management page, creates schedule, verifies in timeline
- Admin cancels pending schedule, verifies status changed to 'cancelled'
- Admin views calendar, clicks date, creates schedule for selected date
- Non-admin user redirected from schedule management page

## Reuse Plan

### Existing Components (WISH-2119 backend)
- `POST /api/admin/flags/:flagKey/schedule` - Create schedule endpoint
- `GET /api/admin/flags/:flagKey/schedule` - List schedules endpoint
- `DELETE /api/admin/flags/:flagKey/schedule/:scheduleId` - Cancel schedule endpoint
- Schedule Zod schemas from `packages/core/api-client/src/schemas/feature-flags.ts`

### Existing UI Patterns
- Admin dashboard layout from existing admin pages
- Modal components from `@repo/app-component-library/_primitives/Dialog`
- Form components from `@repo/app-component-library/_primitives/Input`, `Checkbox`, `Slider`
- Toast notifications from `@repo/app-component-library`
- Date/time picker from `react-datepicker` or `@repo/app-component-library` (if exists)

### New Components
- `ScheduleCalendar` - Full calendar view with schedule markers
- `ScheduleTimeline` - Chronological timeline visualization
- `CreateScheduleForm` - Schedule creation form with validation
- `ScheduleCard` - Individual schedule card with details and actions

### Reusable Utilities
- Date/time formatting utilities
- Countdown timer hook (`useCountdown`)
- RTK Query hooks for schedule endpoints

## Architecture Notes

### Component Structure

**Page-Level Component:**
```typescript
// apps/web/admin-dashboard/src/pages/ScheduleManagementPage.tsx
export function ScheduleManagementPage() {
  const { flagKey } = useParams()
  const { data: schedules } = useGetSchedulesQuery(flagKey)
  const [view, setView] = useState<'calendar' | 'timeline'>('timeline')

  return (
    <DashboardLayout>
      <PageHeader title={`Schedules for ${flagKey}`} />
      <ViewToggle value={view} onChange={setView} />
      {view === 'calendar' && <ScheduleCalendar schedules={schedules} />}
      {view === 'timeline' && <ScheduleTimeline schedules={schedules} />}
    </DashboardLayout>
  )
}
```

**RTK Query Endpoints:**
```typescript
// packages/core/api-client/src/rtk/feature-flags-api.ts
export const featureFlagsApi = createApi({
  endpoints: builder => ({
    getSchedules: builder.query<Schedule[], string>({
      query: flagKey => `/api/admin/flags/${flagKey}/schedule`,
    }),
    createSchedule: builder.mutation<Schedule, CreateScheduleRequest>({
      query: ({ flagKey, ...body }) => ({
        url: `/api/admin/flags/${flagKey}/schedule`,
        method: 'POST',
        body,
      }),
    }),
    cancelSchedule: builder.mutation<Schedule, CancelScheduleRequest>({
      query: ({ flagKey, scheduleId }) => ({
        url: `/api/admin/flags/${flagKey}/schedule/${scheduleId}`,
        method: 'DELETE',
      }),
    }),
  }),
})
```

## Test Plan

### Scope Summary
- **Pages:** 1 main page (schedule management dashboard)
- **UI Touched:** Calendar view, timeline view, create form, schedule cards
- **Data/Storage:** No (reads from WISH-2119 backend endpoints)
- **Infrastructure:** No (frontend only)

### Happy Path Tests

1. **Admin navigates to schedule management page**: Navigate to `/admin/feature-flags/wishlist-gallery/schedules`, assert page renders with flag name in header
2. **Admin views schedule calendar**: Assert calendar renders with current month, schedules displayed as color-coded markers
3. **Admin creates schedule from calendar**: Click date in calendar, assert CreateScheduleForm opens with pre-filled date, fill form, submit, assert success toast and schedule appears in timeline
4. **Admin views schedule timeline**: Switch to timeline view, assert schedules ordered chronologically (past → future)
5. **Admin cancels pending schedule**: Click Cancel on pending schedule, confirm modal, assert status changed to 'cancelled'

### Error Cases

1. **Unauthorized access**: Non-admin user navigates to schedule management page, assert redirected to 403 error page
2. **Invalid flag key**: Navigate to `/admin/feature-flags/invalid-flag/schedules`, assert 404 error page
3. **Create schedule with past time**: Fill form with past scheduledAt, assert validation error
4. **Create schedule with empty updates**: Uncheck enabled, set rolloutPercentage to 0, assert form submit disabled
5. **Cancel non-existent schedule**: Simulate DELETE 404 error, assert error toast

### Edge Cases

1. **Calendar navigation across months**: Navigate to future month, create schedule, verify appears in calendar and timeline
2. **Countdown timer for pending schedule**: Create schedule 5 minutes in future, verify countdown updates every second
3. **Auto-refresh on status change**: Create schedule with scheduledAt = now + 2 minutes, wait for cron job to process, verify schedule moves to 'applied' status automatically
4. **Large number of schedules**: Create 50 schedules for flag, verify calendar and timeline render without performance issues
5. **Cancel already-applied schedule**: Attempt to cancel applied schedule, assert Cancel button hidden

### Required Tooling Evidence

**Frontend Component Tests:**
- Minimum 15 Vitest + React Testing Library tests covering component rendering, user interactions, and error states

**Playwright E2E Tests:**
- Minimum 4 E2E tests covering admin navigation, schedule creation, schedule cancellation, and unauthorized access

**Backend Tests:**
- N/A (backend endpoints tested in WISH-2119)

## UI/UX Notes

### Calendar View Design

**Layout:**
- Full month calendar grid (7 columns for days of week)
- Schedule markers displayed as colored dots on dates
- Multiple schedules on same date: stacked dots (max 3 visible, "+N more" indicator)
- Hover tooltip shows schedule details (time, status, updates)

**Color Coding:**
- Pending: Blue (#3B82F6)
- Applied: Green (#10B981)
- Failed: Red (#EF4444)
- Cancelled: Gray (#6B7280)

**Interactions:**
- Click date: Open CreateScheduleForm with pre-filled date
- Click schedule marker: Expand tooltip with full details and Cancel button (if pending)
- Prev/Next month buttons: Navigate between months
- Today button: Return to current month

### Timeline View Design

**Layout:**
- Vertical timeline with chronological ordering
- Past schedules at top (gray background), future schedules at bottom (white background)
- Divider line: "Now" separator between past and future
- Each schedule card displays: time, status badge, updates preview

**Interactions:**
- Click schedule card: Expand to show full details (createdAt, appliedAt, errorMessage)
- Cancel button on pending schedules: Trigger confirmation modal
- Refresh button at top: Manual re-fetch

### CreateScheduleForm Design

**Layout:**
- Modal dialog with header "Create Schedule"
- Date/time picker with min date = now (prevent past dates)
- Update controls: Enabled checkbox, Rollout percentage slider (0-100)
- Live preview: "Flag will be [enabled/disabled] at [rolloutPercentage]% on [date/time]"
- Submit button (disabled until valid), Cancel button

**Validation Feedback:**
- Red error text below scheduledAt if past time
- Red error text below updates if empty
- Disabled submit button with tooltip explaining validation errors

## Risks & Mitigations

### MVP-Critical Risks

1. **Calendar library complexity**
   - Risk: Full calendar implementation may be complex (date handling, timezone issues)
   - Mitigation: Use existing React calendar library (e.g., `react-calendar`, `react-big-calendar`)
   - Severity: Medium

2. **Polling performance impact**
   - Risk: Polling every 60 seconds may impact performance with many concurrent admins
   - Mitigation: Use RTK Query built-in polling with automatic de-duplication
   - Severity: Low

3. **Timezone handling**
   - Risk: scheduledAt timestamps must display in admin's local timezone
   - Mitigation: Use `date-fns` or `dayjs` for timezone-aware formatting
   - Severity: Medium

4. **Real-time status updates lag**
   - Risk: Polling-based updates have up to 60-second lag for status changes
   - Mitigation: Document in UI ("Schedules refresh every 60 seconds"), provide manual refresh button
   - Severity: Low (acceptable for MVP)

## Open Questions

None - all decisions finalized for MVP scope.

## Definition of Done

- [ ] All 20 Acceptance Criteria pass
- [ ] Frontend: 15+ component tests pass (Vitest + React Testing Library)
- [ ] Frontend: 4+ E2E tests pass (Playwright)
- [ ] Schedule management page renders with calendar and timeline views
- [ ] CreateScheduleForm validates and submits schedules successfully
- [ ] Schedule cards display with status badges and cancel functionality
- [ ] Auto-refresh polling updates schedule list every 60 seconds
- [ ] Keyboard navigation and screen reader support implemented
- [ ] TypeScript compilation passes
- [ ] ESLint passes
- [ ] Code review approved

## Token Budget

### Phase Summary

| Phase | Estimated | Actual | Delta | Notes |
|-------|-----------|--------|-------|-------|
| Story Generation | ~12k | — | — | Follow-up story from WISH-2119 |
| Elaboration | ~10k | — | — | Standard UI story |
| Implementation | ~20k | — | — | UI components + calendar/timeline + forms + tests |
| Code Review | ~5k | — | — | Frontend story |
| **Total** | ~47k | — | — | Medium-sized UI story |

## Agent Log

| Timestamp (UTC) | Agent | Action | Outputs |
|---|---|---|---|
| 2026-01-30 00:00 | pm-story-followup-leader | Generated follow-up story from WISH-2119 | WISH-20220.md |

---

## Source

Follow-up from QA Elaboration of WISH-2119 (Enhancement Opportunity #6)

**Original Finding:** "Admin dashboard for schedule management - Deferred to Phase 3+ follow-up story"

**Category:** Enhancement Opportunity

**Impact:** Medium (improves admin experience for managing scheduled flag updates)

**Effort:** Medium (admin UI components + calendar/timeline views + integration with backend endpoints)

**Use Cases:**
- Admin views all scheduled flag updates in calendar view
- Admin creates new schedule with visual date picker
- Admin cancels pending schedules before they execute
- Admin monitors failed schedules and retries manually
- Admin visualizes timeline of flag updates across multiple schedules
