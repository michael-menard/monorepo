---
doc_type: story
title: "WISH-2006: Accessibility"
story_id: WISH-2006
story_prefix: WISH
status: Draft
phase: 5
created_at: "2026-01-24T02:00:00-07:00"
updated_at: "2026-01-24T02:00:00-07:00"
depends_on: [WISH-2005]
estimated_points: 5
---

# WISH-2006: Accessibility

## Goal

Ensure full accessibility with keyboard navigation, screen reader support, and WCAG AA compliance.

## Feature

Full keyboard navigation with roving tabindex, keyboard shortcuts, screen reader announcements, modal focus trap, WCAG AA compliance.

## Phase

Phase 5: Accessibility

## Acceptance Criteria

- [ ] Arrow keys navigate gallery grid (↑ ↓ ← → to move between cards)
- [ ] Space selects/focuses item (toggles selection or focus state)
- [ ] Enter opens detail view (on focused item)
- [ ] Escape closes modals (applies to all modals)
- [ ] Home/End jumps to first/last item (in gallery)
- [ ] Keyboard shortcuts: A (add), G (got it on focused item), Delete (remove focused item)
- [ ] Screen reader announces card focus: "[Title], [price], [pieces] pieces, priority [n] of [total]"
- [ ] Screen reader announces state changes: "Priority updated", "Item removed", "Added to collection"
- [ ] Modal focus trap and return to trigger element on close
- [ ] WCAG AA color contrast compliance (automated axe check)
- [ ] VoiceOver testing on macOS (if available)
- [ ] NVDA testing on Windows (if available)

## Risk Notes

Roving tabindex in gallery grid is complex and error-prone; screen reader testing requires specific hardware/software.

## Technical Details

### Frontend (React)

**Locations:**
- `apps/web/app-wishlist-gallery/src/hooks/useRovingTabIndex.ts`
- `apps/web/app-wishlist-gallery/src/hooks/useKeyboardShortcuts.ts`
- `apps/web/app-wishlist-gallery/src/components/AccessibleGalleryGrid.tsx`
- `apps/web/app-wishlist-gallery/src/utils/a11y.ts`

**Keyboard Navigation**

**Roving Tabindex Pattern** (Gallery Grid)

Implements WAI-ARIA roving tabindex pattern:
- Container has `tabindex={0}`
- Active item has `tabindex={0}`, others have `tabindex={-1}`
- Arrow keys move focus and update tabindex
- Only one focusable item in tab order

Implementation:
```typescript
function useRovingTabIndex(items: any[], options?: RovingOptions) {
  const [activeIndex, setActiveIndex] = useState(0)

  const handleKeyDown = (e: KeyboardEvent) => {
    switch (e.key) {
      case 'ArrowUp':
        e.preventDefault()
        setActiveIndex(prev => Math.max(0, prev - columns))
        break
      case 'ArrowDown':
        e.preventDefault()
        setActiveIndex(prev => Math.min(items.length - 1, prev + columns))
        break
      case 'ArrowLeft':
        e.preventDefault()
        setActiveIndex(prev => (prev === 0 ? items.length - 1 : prev - 1))
        break
      case 'ArrowRight':
        e.preventDefault()
        setActiveIndex(prev => (prev === items.length - 1 ? 0 : prev + 1))
        break
      case 'Home':
        e.preventDefault()
        setActiveIndex(0)
        break
      case 'End':
        e.preventDefault()
        setActiveIndex(items.length - 1)
        break
    }
  }

  return { activeIndex, handleKeyDown }
}
```

**Keyboard Shortcuts**

Global shortcuts (with focus state awareness):

| Key | Action | Applicable |
|-----|--------|-----------|
| `A` | Open Add Item form | Anywhere in gallery |
| `G` | Mark focused item as "Got It" | When card is focused |
| `Delete` | Delete focused item | When card is focused |
| `Escape` | Close modal | Modal is open |
| `Enter` | Open detail view | When card is focused |

Implementation: Global keyboard event listener with focus checks

```typescript
function useGalleryKeyboardShortcuts() {
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      // Only if gallery is focused
      if (e.key === 'a' || e.key === 'A') {
        // Open add form
      }
      if (focused && (e.key === 'g' || e.key === 'G')) {
        // Open got it modal
      }
      if (focused && e.key === 'Delete') {
        // Open delete modal
      }
      if (e.key === 'Escape') {
        // Close modal if open
      }
    }
  }, [focusedItemId])
}
```

**Screen Reader Announcements**

Using `aria-live` regions for dynamic updates:

```jsx
<div
  role="status"
  aria-live="polite"
  aria-atomic="true"
  className="sr-only"
>
  {announcement}
</div>
```

Announcements:
- Card focus: "List item N of M. [Title], [Price], [Pieces] pieces, Priority [Level]"
- State change: "Item moved to position N", "Item removed from wishlist", "Item added to your collection"
- Filter/sort: "Filtered to show [count] items sorted by [method]"
- Modal open: "[Modal title]. [Instructions]"

**Modal Focus Management**

Use `focus-trap` library or custom implementation:

```typescript
function useModalFocusLock(isOpen: boolean, containerRef: RefObject) {
  useEffect(() => {
    if (!isOpen) return

    const container = containerRef.current
    const focusableElements = container?.querySelectorAll(
      'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
    )

    const firstElement = focusableElements?.[0] as HTMLElement
    const lastElement = focusableElements?.[focusableElements.length - 1] as HTMLElement

    const handleTab = (e: KeyboardEvent) => {
      if (e.key !== 'Tab') return

      if (e.shiftKey) {
        // Shift + Tab
        if (document.activeElement === firstElement) {
          e.preventDefault()
          lastElement?.focus()
        }
      } else {
        // Tab
        if (document.activeElement === lastElement) {
          e.preventDefault()
          firstElement?.focus()
        }
      }
    }

    document.addEventListener('keydown', handleTab)
    firstElement?.focus()

    return () => document.removeEventListener('keydown', handleTab)
  }, [isOpen])
}
```

**ARIA Labels and Descriptions**

All interactive elements:
```jsx
<button
  aria-label="Add new wishlist item"
  title="Add new wishlist item (Press 'A')"
>
  Add Item
</button>

<div
  role="button"
  tabIndex={0}
  aria-label={`${item.title}, ${item.price}, ${item.pieceCount} pieces, Priority ${item.priority}`}
  aria-describedby="priority-explanation"
>
  {/* Card content */}
</div>
```

**Color Contrast**

WCAG AA requirements:
- Normal text: 4.5:1 contrast ratio
- Large text (18pt+): 3:1 contrast ratio

Validation: Automated with axe or manual testing

**Testing**

Locations:
- `apps/web/app-wishlist-gallery/src/__tests__/accessibility.test.tsx`

Tools:
- axe-core for automated checks
- Manual VoiceOver testing on macOS
- Manual NVDA testing on Windows

## Dependencies

- **Depends On:** WISH-2005 (UX Polish)
- **Unblocks:** Epic completion

## Reuse Plan

- Use `@repo/accessibility` package utilities (if available)
- Create reusable roving tabindex hook for other galleries
- Use focus-trap library (standard, not per-story)
- Follow WCAG 2.1 AA guidelines and WAI-ARIA patterns

## Test Coverage

**Unit Tests:**
- Roving tabindex moves focus correctly with arrow keys
- Home/End keys work
- Shortcuts trigger correct actions
- Screen reader announcements generated correctly

**Integration Tests:**
- Gallery navigable with keyboard
- Modals can be closed with Escape
- Focus trap prevents tabbing out of modal
- All shortcuts work end-to-end

**Accessibility Tests:**
- axe automation passes
- Manual VoiceOver testing (if available)
- Manual NVDA testing (if available)
- Color contrast verified

**E2E Tests:**
- User can navigate gallery with arrow keys
- User can open add form with 'A' key
- User can mark item purchased with 'G' key
- User can delete item with 'Delete' key
- Screen reader reads card information

## Definition of Done

- [ ] Roving tabindex implemented and tested
- [ ] All keyboard shortcuts working
- [ ] Screen reader announcements working
- [ ] Modal focus trap implemented
- [ ] Color contrast verified (axe checks)
- [ ] VoiceOver testing completed (if available)
- [ ] NVDA testing completed (if available)
- [ ] ARIA labels on all interactive elements
- [ ] All tests passing
- [ ] Code reviewed
- [ ] Epic WISH complete

## Token Budget

### Phase Summary

| Phase | Estimated | Actual | Delta | Notes |
|-------|-----------|--------|-------|-------|
| Story Gen | ~5k | — | — | — |
| Elaboration | ~8k | — | — | Complex patterns |
| Implementation | ~18k | — | — | Multiple hooks/utilities |
| Code Review | ~7k | — | — | — |
| Testing | ~8k | — | — | Manual a11y testing |
| **Total** | ~46k | — | — | — |

### Actual Measurements

| Date | Phase | Before | After | Delta | Notes |
|------|-------|--------|-------|-------|-------|

## Agent Log

Append-only.

| Timestamp (America/Denver) | Agent | Action | Outputs |
|---|---|---|---|
| 2026-01-24 02:00 | pm-bootstrap-generation-leader | Created story file | WISH-2006.md |
