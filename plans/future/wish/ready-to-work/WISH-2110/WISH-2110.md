---
status: ready-to-work
follow_up_from: WISH-2010
updated_at: '2026-01-30T23:00:00Z'
---

# WISH-2110: Custom Zod error messages for better form UX

## Follow-up Context

**Parent Story:** WISH-2010
**Source:** QA Discovery Notes
**Original Finding:** Customize Zod error messages with user-friendly text. Example: "Title must be between 1-200 characters" instead of generic "String must contain at least 1 character(s)"
**Category:** Enhancement Opportunity
**Impact:** Medium (better UX for form validation)
**Effort:** Low

## Context

The wishlist feature uses Zod schemas for validation across frontend forms and backend API endpoints (from WISH-2010). While Zod provides powerful validation, the default error messages are generic and technical, reducing form usability.

Examples of current generic messages:
- `"String must contain at least 1 character(s)"` → Better: `"Title is required"`
- `"String must contain at most 200 character(s)"` → Better: `"Title must be 200 characters or less"`
- `"Invalid enum value"` → Better: `"Priority must be low, medium, or high"`
- `"Number must be greater than or equal to 0"` → Better: `"Price cannot be negative"`

Custom error messages improve:
- User comprehension (non-technical language)
- Error specificity (field-aware messages)
- Form accessibility (screen reader clarity)
- International consistency (easier to localize)

This story customizes Zod error messages for all wishlist schemas defined in WISH-2010.

## Goal

Improve form validation UX by replacing generic Zod error messages with user-friendly, field-specific messages.

## Non-goals

- Internationalization/localization framework (future enhancement)
- Error message design system (use existing patterns)
- Frontend error display components (already exist in form libraries)
- Backend API error response formatting (covered by existing response utils)

## Scope

### Packages Affected

1. **API Client Schemas**: `packages/core/api-client/src/schemas/wishlist.ts`
   - Add `.refine()` and custom error messages to existing schemas
   - Update all schema definitions from WISH-2010

### Schema Updates

All schemas from WISH-2010 will be updated with custom error messages using Zod's `.refine()` method and custom error map:

**WishlistItemSchema**:
```typescript
export const WishlistItemSchema = z.object({
  id: z.string().uuid({ message: "Invalid wishlist item ID" }),
  userId: z.string().uuid({ message: "Invalid user ID" }),
  name: z.string()
    .min(1, { message: "Title is required" })
    .max(200, { message: "Title must be 200 characters or less" }),
  setNumber: z.string().optional(),
  store: z.string()
    .max(100, { message: "Store name must be 100 characters or less" })
    .optional(),
  price: z.number()
    .min(0, { message: "Price cannot be negative" })
    .optional(),
  pieceCount: z.number()
    .int({ message: "Piece count must be a whole number" })
    .min(0, { message: "Piece count cannot be negative" })
    .optional(),
  priority: z.enum(['low', 'medium', 'high'], {
    errorMap: () => ({ message: "Priority must be low, medium, or high" })
  }).default('medium'),
  notes: z.string()
    .max(1000, { message: "Notes must be 1000 characters or less" })
    .optional(),
  imageUrl: z.string()
    .url({ message: "Invalid image URL format" })
    .optional(),
  sortOrder: z.number()
    .int({ message: "Sort order must be a whole number" })
    .min(0, { message: "Sort order cannot be negative" }),
  createdAt: z.string().datetime({ message: "Invalid creation date format" }),
  updatedAt: z.string().datetime({ message: "Invalid update date format" }),
})
```

**WishlistFilterSchema**:
```typescript
export const WishlistFilterSchema = z.object({
  store: z.string().optional(),
  priority: z.enum(['low', 'medium', 'high'], {
    errorMap: () => ({ message: "Priority filter must be low, medium, or high" })
  }).optional(),
  minPrice: z.number()
    .min(0, { message: "Minimum price cannot be negative" })
    .optional(),
  maxPrice: z.number()
    .min(0, { message: "Maximum price cannot be negative" })
    .optional(),
  search: z.string()
    .max(100, { message: "Search query must be 100 characters or less" })
    .optional(),
  sortBy: z.enum(['createdAt', 'price', 'pieceCount', 'priority', 'sortOrder'], {
    errorMap: () => ({ message: "Invalid sort field" })
  }).default('sortOrder'),
  sortOrder: z.enum(['asc', 'desc'], {
    errorMap: () => ({ message: "Sort order must be 'asc' or 'desc'" })
  }).default('asc'),
  page: z.number()
    .int({ message: "Page number must be a whole number" })
    .min(1, { message: "Page number must be at least 1" })
    .default(1),
  limit: z.number()
    .int({ message: "Limit must be a whole number" })
    .min(1, { message: "Limit must be at least 1" })
    .max(100, { message: "Limit cannot exceed 100 items" })
    .default(20),
})
```

**ReorderItemsSchema**:
```typescript
export const ReorderItemsSchema = z.object({
  items: z.array(z.object({
    id: z.string().uuid({ message: "Invalid item ID in reorder list" }),
    sortOrder: z.number()
      .int({ message: "Sort order must be a whole number" })
      .min(0, { message: "Sort order cannot be negative" }),
  }))
  .min(1, { message: "At least one item is required for reordering" }),
})
```

**PurchaseItemSchema**:
```typescript
export const PurchaseItemSchema = z.object({
  purchaseDate: z.string()
    .datetime({ message: "Invalid purchase date format" })
    .optional(),
  purchasePrice: z.number()
    .min(0, { message: "Purchase price cannot be negative" })
    .optional(),
  purchaseStore: z.string()
    .max(100, { message: "Store name must be 100 characters or less" })
    .optional(),
  notes: z.string()
    .max(500, { message: "Purchase notes must be 500 characters or less" })
    .optional(),
})
```

## Acceptance Criteria

### Error Message Updates

**AC1**: Update WishlistItemSchema with custom error messages
- All fields have field-specific error messages
- Messages use non-technical language
- Messages specify exact constraints (e.g., character limits)
- No generic "String must..." or "Number must..." messages remain

**AC2**: Update CreateWishlistItemSchema error messages
- Inherits custom messages from WishlistItemSchema
- Omitted fields (id, userId, etc.) maintain appropriate messages if accessed

**AC3**: Update UpdateWishlistItemSchema error messages
- Inherits custom messages from CreateWishlistItemSchema
- Partial validation maintains field-specific messages

**AC4**: Update WishlistFilterSchema with custom error messages
- Enum fields have user-friendly enum value lists
- Pagination constraints clearly explained
- Search and filter limits specified

**AC5**: Update ReorderItemsSchema with custom error messages
- Array validation messages are actionable
- Item validation messages specify field context

**AC6**: Update PurchaseItemSchema with custom error messages
- Optional field messages clear about requirements
- Constraint messages user-friendly

### Validation Testing

**AC7**: Test updated error messages in validation tests
- Update existing tests in `packages/core/api-client/src/schemas/__tests__/wishlist.test.ts`
- Assert specific error messages, not just validation failure
- Cover all custom message paths

**AC8**: Test error message specificity
- Different validation failures produce different messages
- Messages reference correct field names
- Messages specify exact constraint violated

**AC9**: Test enum error messages
- Priority field rejection shows "low, medium, or high"
- Sort field rejection shows valid sort options
- Custom errorMap functions work correctly

### Integration

**AC10**: Verify frontend displays custom messages
- React Hook Form shows custom Zod messages
- Error display components render field-specific messages
- No generic messages leak through

**AC11**: Verify backend returns custom messages
- API validation errors include custom messages
- Error response format unchanged (only message content)
- 400 responses include actionable error text

### Documentation

**AC12**: Update JSDoc comments with error message examples
- Document common validation failures and their messages
- Provide examples of valid vs. invalid inputs

**AC13**: Document error message patterns in package README
- List all custom error message patterns
- Explain when messages appear (field validation, enum validation, etc.)

## Test Plan

### Unit Tests (packages/core/api-client/src/schemas/__tests__/wishlist.test.ts)

**Error Message Tests**:
1. Name validation: empty string returns "Title is required"
2. Name validation: 201 chars returns "Title must be 200 characters or less"
3. Price validation: negative number returns "Price cannot be negative"
4. PieceCount validation: decimal returns "Piece count must be a whole number"
5. Priority validation: invalid enum returns "Priority must be low, medium, or high"
6. ImageUrl validation: invalid URL returns "Invalid image URL format"
7. Store validation: 101 chars returns "Store name must be 100 characters or less"
8. Notes validation: 1001 chars returns "Notes must be 1000 characters or less"
9. SortOrder validation: negative returns "Sort order cannot be negative"
10. DateTime validation: invalid format returns appropriate message

**Filter Schema Tests**:
11. Page validation: 0 returns "Page number must be at least 1"
12. Limit validation: 101 returns "Limit cannot exceed 100 items"
13. Search validation: 101 chars returns "Search query must be 100 characters or less"
14. Priority filter: invalid enum returns "Priority filter must be low, medium, or high"
15. SortBy validation: invalid field returns "Invalid sort field"

**Reorder Schema Tests**:
16. Empty array returns "At least one item is required for reordering"
17. Invalid ID returns "Invalid item ID in reorder list"
18. Negative sortOrder returns "Sort order cannot be negative"

**Purchase Schema Tests**:
19. Invalid date format returns "Invalid purchase date format"
20. Negative price returns "Purchase price cannot be negative"
21. Store over 100 chars returns appropriate message
22. Notes over 500 chars returns appropriate message

**Minimum**: 25 unit tests covering all error message paths

### Integration Tests

**Frontend Integration**:
- Form validation displays custom messages
- Error messages accessible to screen readers
- Messages appear inline with form fields

**Backend Integration**:
- API 400 responses include custom error messages
- Error format matches existing API error structure
- Multiple validation errors include all custom messages

## Reuse Plan

**Builds on WISH-2010**:
- Uses existing Zod schema definitions
- Adds custom messages without changing validation logic
- Maintains schema structure and exports

**Reusable Patterns**:
- Error message patterns can apply to future schemas
- Custom errorMap pattern for enums reusable
- Testing approach for error messages portable

## Risks / Edge Cases

1. **Message consistency across frontend/backend**
   - Risk: Different error message formatting on client vs. server
   - Mitigation: Both use same Zod schemas from @repo/api-client
   - Severity: Low

2. **Error message verbosity**
   - Risk: Messages too long for UI display
   - Mitigation: Keep messages concise (under 60 characters)
   - Severity: Low

3. **Localization future-proofing**
   - Risk: Hardcoded English messages block i18n
   - Mitigation: Non-goal for MVP, but structure allows future i18n layer
   - Severity: Low

4. **Enum message maintenance**
   - Risk: Adding new enum values requires updating error messages
   - Mitigation: Use errorMap that dynamically lists valid values
   - Severity: Low

## Open Questions

None - scope is clear and builds directly on WISH-2010 schemas.

## Definition of Done

- [ ] All 13 Acceptance Criteria pass
- [ ] 25+ unit tests pass with error message assertions
- [ ] TypeScript compilation passes
- [ ] ESLint passes
- [ ] Frontend displays custom messages in forms
- [ ] Backend returns custom messages in 400 responses
- [ ] JSDoc updated with error message examples
- [ ] Code review approved

## Source

Follow-up from QA Elaboration of WISH-2010

**Original Finding:** Custom Zod error messages for better form UX
**Category:** Enhancement Opportunity
**Impact:** Medium (better UX for form validation)
**Effort:** Low

## QA Discovery Notes (for PM Review)

_Added by QA Elaboration on 2026-01-30_

### Gaps Identified

| # | Finding | User Decision | Notes |
|---|---------|---------------|-------|
| — | No gaps identified | Not Reviewed | Story has clear scope, well-defined acceptance criteria, and builds cleanly on WISH-2010 |

### Enhancement Opportunities

| # | Finding | User Decision | Notes |
|---|---------|---------------|-------|
| — | No additional opportunities identified | Not Reviewed | Scope is focused and appropriate for error message customization |

### Follow-up Stories Suggested

None - story is self-contained.

### Items Marked Out-of-Scope

- Internationalization/localization framework (future enhancement)
- Error message design system (use existing patterns)
- Frontend error display components (already exist in form libraries)
- Backend API error response formatting (covered by existing response utils)
