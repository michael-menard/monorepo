---
doc_type: story
title: "WISH-2046: Client-side Image Compression Quality Presets"
story_id: WISH-2046
story_prefix: WISH
status: uat
follow_up_from: WISH-2022
phase: 4
created_at: "2026-01-29T18:30:00-07:00"
updated_at: "2026-01-31T19:00:00-07:00"
depends_on: [WISH-2022]
estimated_points: 2
---

# WISH-2046: Client-side Image Compression Quality Presets

## Follow-up Context

**Parent Story:** WISH-2022: Client-side Image Compression
**Source:** QA Discovery Notes - Gaps Identified
**Original Finding:** Compression quality presets - Add user-selectable presets: "Low bandwidth" (0.6 quality, 1200px), "Balanced" (0.8 quality, 1920px - default), "High quality" (0.9 quality, 2400px)
**Category:** Gap
**Impact:** Medium - enables user control over compression trade-offs based on their needs
**Effort:** Low - extends existing compression logic from WISH-2022

## Context

WISH-2022 implements fixed compression settings (quality 0.8, max 1920px) which work well for most users but don't account for different user needs:

- **Mobile users on limited data plans** need aggressive compression to minimize bandwidth usage
- **Users prioritizing image quality** want minimal compression for showcase images
- **Users with slow connections** need smaller file sizes to reduce upload time

By offering compression quality presets, users can choose the trade-off between image quality, file size, and upload time that best suits their situation.

## Goal

Add user-selectable compression quality presets to give users control over image quality vs file size trade-offs.

## Non-goals

- Not implementing per-image preset selection (preset applies globally to all uploads)
- Not implementing custom preset creation (only predefined presets)
- Not implementing dynamic preset recommendations based on network speed
- Not implementing image quality metrics or comparison tools
- Not re-implementing compression logic from WISH-2022

## Scope

**Components Affected:**
- `apps/web/app-wishlist-gallery/src/utils/imageCompression.ts` - Add preset definitions and logic
- `apps/web/app-wishlist-gallery/src/components/WishlistForm/` - Add preset selector UI
- `apps/web/app-wishlist-gallery/src/hooks/useS3Upload.ts` - Pass selected preset to compression utility

**Packages Affected:**
- `apps/web/app-wishlist-gallery`

**Configuration:**
- Preset stored in localStorage: `wishlist:preferences:compressionPreset`

## Acceptance Criteria

- [ ] Three compression quality presets are defined: "Low bandwidth", "Balanced" (default), "High quality"
- [ ] Low bandwidth preset: quality 0.6, max dimension 1200px, target < 500KB
- [ ] Balanced preset: quality 0.8, max dimension 1920px, target < 1MB (WISH-2022 default)
- [ ] High quality preset: quality 0.9, max dimension 2400px, target < 2MB
- [ ] Preset selector UI in upload form shows radio buttons or dropdown with all three presets
- [ ] Preset selector shows estimated file size for each preset (e.g., "Low bandwidth (~300KB)")
- [ ] Selected preset is saved to localStorage and persists across sessions
- [ ] Default preset is "Balanced" if no preference stored
- [ ] Compression utility uses selected preset settings when compressing images
- [ ] Toast notification shows which preset was used: "Image compressed with [Preset name]: X MB → Y MB"
- [ ] "Skip compression" checkbox from WISH-2022 still works and overrides preset selection
- [ ] Unit tests cover preset definitions, localStorage persistence, and compression settings application
- [ ] Playwright E2E tests cover preset selection, persistence, and compression results for each preset
- [ ] Documentation explains preset trade-offs and when to use each one

## Reuse Plan

- Builds on compression logic from WISH-2022 (imageCompression.ts)
- Leverages localStorage preference pattern from WISH-2022 (skip compression checkbox)
- Reuses toast notification patterns from WISH-2022
- Can reuse form UI patterns from existing WishlistForm components

## Architecture Notes

**Preset Definitions:**
```typescript
type CompressionPreset = {
  name: 'low-bandwidth' | 'balanced' | 'high-quality'
  label: string
  description: string
  settings: {
    maxSizeMB: number
    maxWidthOrHeight: number
    initialQuality: number
  }
  estimatedSize: string
}

const COMPRESSION_PRESETS: CompressionPreset[] = [
  {
    name: 'low-bandwidth',
    label: 'Low bandwidth',
    description: 'Smallest file size, fastest upload',
    settings: { maxSizeMB: 0.5, maxWidthOrHeight: 1200, initialQuality: 0.6 },
    estimatedSize: '~300KB'
  },
  {
    name: 'balanced',
    label: 'Balanced',
    description: 'Good quality, reasonable file size (recommended)',
    settings: { maxSizeMB: 1, maxWidthOrHeight: 1920, initialQuality: 0.8 },
    estimatedSize: '~800KB'
  },
  {
    name: 'high-quality',
    label: 'High quality',
    description: 'Best quality, larger file size',
    settings: { maxSizeMB: 2, maxWidthOrHeight: 2400, initialQuality: 0.9 },
    estimatedSize: '~1.5MB'
  }
]
```

**UI Layout:**
- Preset selector appears below image upload field
- Radio buttons or dropdown (depending on space constraints)
- Each option shows preset label and description
- Visual indicator for recommended "Balanced" preset
- "Skip compression" checkbox appears below preset selector

**localStorage Key:**
- Key: `wishlist:preferences:compressionPreset`
- Value: preset name string ('low-bandwidth' | 'balanced' | 'high-quality')
- Default: 'balanced'

## Test Plan

### Happy Path

1. User opens add item form
2. Preset selector shows "Balanced" selected by default
3. User selects "Low bandwidth" preset
4. User uploads 5MB image
5. Compression uses low bandwidth settings (0.6 quality, 1200px max)
6. Toast shows: "Image compressed with Low bandwidth: 5.2 MB → 0.3 MB"
7. User navigates away and returns
8. "Low bandwidth" preset is still selected (localStorage persistence)

### Error Cases

1. **Invalid localStorage value**: If localStorage contains invalid preset name, fall back to "Balanced" default
2. **Preset selection with skip compression**: If "Skip compression" is checked, preset selector is disabled/grayed out
3. **Compression failure**: If compression fails, error message includes selected preset name for debugging

### Edge Cases

1. **Already small images**: Even with "High quality" preset, skip compression if image < 500KB and dimensions < maxWidthOrHeight
2. **Preset exceeds limits**: If "High quality" preset produces > 10MB file (unlikely), fall back to "Balanced" preset automatically
3. **First-time user**: Default to "Balanced" preset with visual indicator

## Risks / Edge Cases

1. **User confusion about presets**: Mitigate with clear descriptions and visual "recommended" badge on Balanced preset
2. **High quality preset produces large files**: Acceptable; users explicitly chose quality over size
3. **Preset selector UI clutter**: Keep UI minimal with radio buttons or collapsible dropdown
4. **Estimated sizes may not match actual results**: Estimates are approximate; actual compression varies by image content

## Open Questions

None - all requirements are clear and non-blocking.

---

## QA Discovery Notes (for PM Review)

_Added by QA Elaboration on 2026-01-31_

### Gaps Identified

| # | Finding | User Decision | Notes |
|---|---------|---------------|-------|
| 1 | Per-image preset selection | Not Reviewed | Story non-goal states preset applies globally. Could be future enhancement. |
| 2 | Preset validation edge case (High quality > 10MB fallback) | Not Reviewed | Mitigated by adding fallback logic and user notification toast. |
| 3 | Estimated sizes are approximations | Not Reviewed | Story acknowledges estimates vary by image content. Acceptable as-is. |
| 4 | Preset interaction with auto-skip (images < 500KB) | Not Reviewed | Should add toast feedback when compression is skipped to avoid user confusion. |

### Enhancement Opportunities

| # | Finding | User Decision | Notes |
|---|---------|---------------|-------|
| 1 | Dynamic preset recommendations based on usage patterns | Not Reviewed | Future enhancement (Phase 5+). Out-of-scope for MVP. |
| 2 | Custom preset creation for power users | Not Reviewed | Future enhancement. Non-goal excludes custom presets. |
| 3 | Real-time compression preview before upload | Not Reviewed | Future enhancement. Would improve decision-making but is high-effort. |
| 4 | Compression telemetry per preset | Not Reviewed | Future enhancement. Could integrate with WISH-2023 telemetry tracking. |
| 5 | Preset label internationalization | Not Reviewed | Future enhancement. Hardcoded English labels acceptable for MVP. |
| 6 | Visual preset indicators (icons/badges) | Not Reviewed | Phase 4 polish. Could add WiFi icon for Low bandwidth, Star for High quality. |
| 7 | Preset export/import for multi-device users | Not Reviewed | Future enhancement. Niche use case, medium effort. |

### Follow-up Stories Suggested

- [x] WISH-2047: Per-image preset selection for multi-upload workflows (Phase 5+) → WISH-20550
- [x] WISH-2048: Real-time compression preview before upload (Phase 5+) → WISH-20560
- [x] WISH-2049: Dynamic preset recommendations based on upload history (Phase 5+) → WISH-20570
- [x] WISH-2050: Compression telemetry per preset (Phase 5+ - integrate with WISH-2023) → WISH-20580

### Items Marked Out-of-Scope

- Per-image preset selection: Preset applies globally to all uploads. Can be added as Phase 5+ follow-up.
- Custom preset creation: Only predefined presets are offered. Power users can skip compression and re-upload if needed.
- Dynamic preset recommendations: No network-speed or analytics-based suggestions. Users manually select preset.
- Image quality metrics or comparison tools: Estimated sizes are approximate. Actual results vary by image content.
- Re-implementation of compression logic: Builds on WISH-2022's existing compression utility.
