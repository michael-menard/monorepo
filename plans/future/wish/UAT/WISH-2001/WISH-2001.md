---
doc_type: story
title: "WISH-2001: Gallery MVP"
story_id: WISH-2001
story_prefix: WISH
status: uat
phase: 2
created_at: "2026-01-24T02:00:00-07:00"
updated_at: "2026-01-28T13:56:00-07:00"
depends_on: [WISH-2000, WISH-2007]
estimated_points: 5
sizing_warning: false
---

# WISH-2001: Gallery MVP

## Goal

Deliver read-only gallery view to validate UX and API integration end-to-end using existing backend endpoints and RTK Query hooks.

## Feature

Frontend gallery UI with WishlistCard component, gallery page with store filters, search, sorting, and view modes. Backend and RTK Query already implemented.

## Phase

Phase 2: Gallery MVP (Vertical Slice)

## Scope Change

Story rescoped to FRONTEND ONLY after discovering backend endpoints and RTK Query hooks already exist. Backend verification added as prerequisite.

## Acceptance Criteria

### Backend Verification (Prerequisite)
- [ ] `.http` test file created at `__http__/wishlist-gallery-mvp.http` verifying GET `/api/wishlist` and GET `/api/wishlist/:id` work correctly
- [ ] Backend auth middleware verified as configured (existing at `apps/api/lego-api/domains/wishlist/routes.ts` line 32)
- [ ] Schema synchronization verified - RTK Query `transformResponse` handles Date→datetime string conversion

### Frontend Implementation
- [ ] `WishlistCard` component renders: image, title, store badge, price, piece count, priority indicator
- [ ] Gallery page has store filter tabs: All, LEGO, Barweer, Cata, BrickLink, Other (per `WishlistStoreSchema`)
- [ ] Search by title/set number works (uses existing RTK Query `useGetWishlistQuery` with `q` param)
- [ ] Sort dropdown: date, price, pieces, priority (uses existing RTK Query `sort`/`order` params)
- [ ] Grid/List view toggle in gallery header (default: grid view)
- [ ] Mobile-responsive card layout using Tailwind responsive classes (sm:, md:, lg:)
- [ ] Hover action menu: "View Details" only (Edit/Remove/Got It are placeholder UI slots for WISH-2003/WISH-2004)
- [ ] Loading skeleton states reuse primitives from `@repo/app-component-library`
- [ ] Empty state with illustration + "Add your first item" CTA button
- [ ] Error handling for RTK Query errors (404, 403, 500) using existing patterns from `gallery-api.ts`
- [ ] Pagination controls (prev/next buttons) using existing RTK Query `page`/`limit` params

## Risk Notes

First vertical slice; integration issues between API and frontend likely.

## Technical Details

### Backend (API) - Existing Implementation

**Status**: ✅ ALREADY IMPLEMENTED

Backend endpoints exist in `apps/api/lego-api/domains/wishlist/routes.ts` using Hexagonal Architecture:
- GET `/api/wishlist` - List with filters, sorting, pagination (lines 41-66)
- GET `/api/wishlist/:id` - Single item detail (lines 97-109)

**Service Layer**: `apps/api/lego-api/domains/wishlist/application/` (Hexagonal Architecture compliant)

**Query Parameters** (existing):
- `q` (search): Search title/setNumber
- `store`: Filter by store enum
- `tags`: Comma-separated tags
- `priority`: Filter by priority level
- `sort`: Field to sort by (date|price|pieces|priority)
- `order`: Sort order (asc|desc)
- `page`: Page number (default: 1)
- `limit`: Items per page (default: 20)

**Response Format** (existing):
```json
{
  "items": [...],
  "total": 42,
  "page": 1,
  "limit": 20
}
```

**Auth**: Existing `auth` middleware at line 32 - no changes needed.

**Verification Required**: Create `.http` test file to verify endpoints work correctly.

### Frontend (React) - New Implementation Required

**Frontend App**: `apps/web/app-wishlist-gallery` (verified to exist)

**New Components to Create:**
- `apps/web/app-wishlist-gallery/src/pages/GalleryPage.tsx`
- `apps/web/app-wishlist-gallery/src/components/WishlistCard.tsx`
- `apps/web/app-wishlist-gallery/src/components/GalleryHeader.tsx`
- `apps/web/app-wishlist-gallery/src/components/StoreTabs.tsx`
- `apps/web/app-wishlist-gallery/src/components/ViewToggle.tsx`

**WishlistCard Component**

Displays:
- Item image (thumbnail or placeholder from `imageUrl`)
- Store badge (colored per store enum)
- Title (truncate if > 40 chars)
- Price (with currency, format: "$99.99")
- Piece count (format: "1,234 pieces")
- Priority indicator (icon + color: low=gray, medium=yellow, high=red)
- Hover menu: "View Details" button only (Edit/Remove/Got It are empty placeholder slots)

**Mobile Responsive**:
- Grid: 1 col (mobile), 2 cols (tablet), 3-4 cols (desktop)
- Card: Stacks vertically on mobile, horizontal on desktop
- Hover menu: Tap on mobile, hover on desktop

**Gallery Page Features**

- Store filter tabs: All, LEGO, Barweer, Cata, BrickLink, Other (6 tabs total)
- Search input: debounced search (300ms delay), searches title and setNumber
- Sort dropdown: date (newest first), price (low/high), pieces (low/high), priority (high first)
- View toggle: Grid (default) / List view
- Pagination: prev/next buttons + page indicator ("Page 1 of 5")
- Empty state: Illustration + "No items in your wishlist yet" + "Add Item" CTA button
- Loading state: 6 skeleton cards matching card layout (reuse from `@repo/app-component-library`)

### RTK Query Integration - Existing Implementation

**Status**: ✅ ALREADY IMPLEMENTED

**Location**: `packages/core/api-client/src/rtk/wishlist-gallery-api.ts` (80 lines)

**Existing Hooks** (no changes needed):
- `useGetWishlistQuery(params)` - Lines 38-61
  - Params: `{ q?, store?, tags?, priority?, sort?, order?, page?, limit? }`
  - Returns: `WishlistListResponse` with items array, total, page, limit
  - Cache: Medium TTL, tags: `Wishlist`, `WishlistItem`
  - Response validation: `WishlistListResponseSchema.parse(response)`
- `useGetWishlistItemQuery(id)` - Lines 68-73
  - Returns: Single `WishlistItem`
  - Response validation: `WishlistItemSchema.parse(response)`

**Schema Synchronization**:
- Backend: `releaseDate: z.date().nullable()` (Date object)
- Frontend: `releaseDate: z.string().datetime().nullable()` (ISO string)
- Handled automatically via RTK Query `transformResponse` + Zod parsing

**Cache Strategy** (already configured):
- TTL: Medium (5 minutes)
- Tags: `Wishlist` (list), `WishlistItem` (individual items)
- Invalidation: Handled by mutation hooks in `wishlist-api.ts` (WISH-2002, WISH-2003, WISH-2004)

**Error Handling**: Use existing pattern from `packages/core/api-client/src/rtk/gallery-api.ts`:
```typescript
const { data, error, isLoading } = useGetWishlistQuery(params)
if (error) {
  if ('status' in error) {
    // Handle 404, 403, 500
  }
}
```

## Dependencies

- **Depends On:** WISH-2000 (schema), WISH-2007 (migration)
- **Unblocks:** WISH-2002, WISH-2003, WISH-2004

## Reuse Plan

- **Primitives** from `@repo/app-component-library`:
  - `Card`, `CardContent`, `CardHeader` for WishlistCard structure
  - `Badge` for store badges and priority indicators
  - `Button` for CTA, hover menu, view toggle
  - `Tabs`, `TabsList`, `TabsTrigger` for store filter tabs
  - `Select`, `SelectTrigger`, `SelectContent` for sort dropdown
  - `Input` for search input
  - `Skeleton` for loading states
- **Layout Patterns** from `apps/web/app-sets-gallery`:
  - Responsive grid layout (Tailwind: `grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4`)
  - Card hover states and transitions
  - Empty state layout with illustration + CTA
- **RTK Query Hooks**: Existing `useGetWishlistQuery` and `useGetWishlistItemQuery` (no new hooks needed)
- **Error Handling**: Reuse pattern from `packages/core/api-client/src/rtk/gallery-api.ts`
- **Tailwind CSS**: Utility classes for all styling (no custom CSS)
- **Design Tokens**: LEGO-inspired Sky/Teal palette from design system

**Important**: Create NEW WishlistCard component - do not copy/paste Sets gallery components.

## Test Coverage

**Backend Tests** (existing - no new tests needed):
- Existing tests in `apps/api/lego-api/domains/wishlist/__tests__/services.test.ts`
- NEW: `.http` file at `__http__/wishlist-gallery-mvp.http` for manual verification

**Frontend Tests** (new):
- `WishlistCard.test.tsx`:
  - Renders with all props (image, title, store badge, price, pieces, priority)
  - Displays placeholder image when `imageUrl` is null
  - Shows hover menu on mouse enter
  - Handles priority indicator colors (low=gray, medium=yellow, high=red)
  - Mobile responsive layout (stacks vertically on mobile)
- `GalleryPage.test.tsx`:
  - Renders gallery with store filter tabs
  - Search input debounces and triggers query update
  - Sort dropdown updates query params
  - Grid/List view toggle switches layout
  - Pagination prev/next buttons work correctly
  - Loading skeleton states display while fetching
  - Empty state shows when no items exist
  - Error handling displays appropriate messages (404, 403, 500)
- `StoreTabs.test.tsx`:
  - All 6 tabs render (All, LEGO, Barweer, Cata, BrickLink, Other)
  - Active tab highlights correctly
  - Clicking tab triggers filter change
- Accessibility:
  - ARIA labels on interactive elements
  - Keyboard navigation (Tab, Enter, Space)
  - Screen reader announcements for loading/empty states

**E2E Tests** (new):
- `wishlist-gallery.spec.ts`:
  - User can view their wishlist gallery
  - User can filter by store (click tabs, verify results)
  - User can search items (type in search, verify filtered results)
  - User can sort by date/price/pieces/priority
  - User can toggle between grid and list view
  - User can navigate pages with prev/next buttons
  - Empty state displays when user has no items

## Definition of Done

- [ ] `.http` test file verifies backend endpoints work correctly
- [ ] WishlistCard component renders with all required fields
- [ ] Gallery page renders with store tabs, search, sort, view toggle
- [ ] All filter/sort/search features working with existing RTK Query hooks
- [ ] Grid/List view toggle works correctly
- [ ] Mobile responsive layout (1/2/3/4 col grid)
- [ ] Skeleton loading states visible during fetch
- [ ] Empty state displays with illustration + CTA
- [ ] Error handling for 404/403/500 implemented
- [ ] All frontend tests passing (unit + integration)
- [ ] E2E test passing (gallery navigation, filters, search)
- [ ] Code reviewed and merged
- [ ] Ready for WISH-2002 (Add Item), WISH-2003 (Edit Item), WISH-2004 (Delete/Got It)

## Token Budget

### Phase Summary

| Phase | Estimated | Actual | Delta | Notes |
|-------|-----------|--------|-------|-------|
| Story Gen | ~8k | — | — | Large story |
| Elaboration | ~15k | — | — | Multiple domains |
| PM Fix | ~5k | — | — | Rescope to frontend only |
| Implementation | ~20k | — | — | Frontend only (reduced from 35k) |
| Code Review | ~8k | — | — | Single domain |
| **Total** | ~56k | — | — | Reduced after rescope |

### Actual Measurements

| Date | Phase | Before | After | Delta | Notes |
|------|-------|--------|-------|-------|-------|

## Agent Log

Append-only.

| Timestamp (America/Denver) | Agent | Action | Outputs |
|---|---|---|---|
| 2026-01-24 02:00 | pm-bootstrap-generation-leader | Created story file | WISH-2001.md |
| 2026-01-27 00:00 | elab-completion-leader | Generated ELAB-WISH-2001.md, appended QA notes | ELAB-WISH-2001.md, story updated |
| 2026-01-27 12:00 | pm-story-fix-leader | Fixed QA audit failures, rescoped to frontend only | WISH-2001.md v2 |

## QA Discovery Notes (for PM Review)

_Added by QA Elaboration on 2026-01-27_

### Gaps Identified

| # | Finding | User Decision | Notes |
|---|---------|---------------|-------|
| 1 | No specification of which frontend app hosts gallery | Frontend app clarified as `apps/web/app-wishlist-gallery` | Story should verify this app exists and justify its creation vs reusing existing app |
| 2 | Schema synchronization gap between backend and frontend | **Added to AC**: Schema synchronization between backend Date and frontend datetime string | Backend has `releaseDate: z.date().nullable()`, frontend has datetime string. Needs serialization layer. |
| 3 | No error handling specification for RTK Query | **Added to AC**: RTK Query error handling for 404, 403, 500 errors | Story should use existing RTK Query error patterns from gallery-api.ts |
| 4 | No specification of auth middleware | **Added to AC**: Auth middleware configuration verification | Backend requires `auth` middleware. Story should verify auth is configured. |
| 5 | Pagination strategy not specified | **Added to AC**: Pagination strategy specification (cursor vs offset) | Backend supports page/limit params. Frontend should clarify strategy. |
| 6 | Loading skeleton states not detailed | **Added to AC**: Loading skeleton details (count, animation, component reuse) | AC #9 mentions "skeleton states" but doesn't specify reuse from @repo/app-component-library |
| 7 | Empty state not specified | **Added to AC**: Empty state design (CTA button, illustration) | Should specify if there's CTA button, illustration, or just text |
| 8 | No specification of RTK Query cache strategy | **Added to AC**: RTK Query cache strategy (TTL, invalidation) | Should specify cache TTL, invalidation, and optimistic updates |
| 9 | No specification of view modes | **Added to AC**: Grid vs List view toggle | Users may want list view for scanning titles, grid for browsing images |
| 10 | Mobile layout not optimized | **Added to AC**: Mobile-optimized card layout | Critical for mobile users. Use Tailwind responsive classes. |

### Enhancement Opportunities

| # | Finding | User Decision | Notes |
|---|---------|---------------|-------|
| 1 | Gallery view modes: Grid vs List | **Added to AC**: Grid vs List view toggle | Users want list view for scanning, grid view for browsing. Toggle in header. |
| 2 | Quick preview on card hover | OUT OF SCOPE | Show expanded card on hover. Defer to future story. |
| 3 | Bulk selection mode | OUT OF SCOPE | Select multiple items for batch ops. Foundation for future bulk actions. |
| 4 | Store logo badges instead of text | OUT OF SCOPE | Replace text with logos. Need assets. Lower priority. |
| 5 | Price trend indicators | OUT OF SCOPE | Show ↑↓ if price history exists. Depends on price tracking feature. |
| 6 | Smart sorting: "Best deals first" | OUT OF SCOPE | Sort by price-per-piece. Nice-to-have for budget users. |
| 7 | Recently viewed items | OUT OF SCOPE | Track last 5 viewed. Nice-to-have for quick access. |
| 8 | Infinite scroll option | OUT OF SCOPE | Alternative to pagination. Better for mobile but adds complexity. |
| 9 | Filter chips with counts | OUT OF SCOPE | Show active filters as removable chips. Improves discoverability but adds complexity. |
| 10 | Keyboard shortcuts hint tooltip | OUT OF SCOPE | Show search hint. Foundation for WISH-2006 keyboard nav. |
| 11 | Gallery stats summary | OUT OF SCOPE | Show "X items, $Y total". Nice motivational feature. |
| 12 | Tag cloud for quick filtering | OUT OF SCOPE | Popular tags with frequency sorting. Requires tag aggregation. |
| 13 | Export to CSV button | OUT OF SCOPE | Quick spreadsheet export. One-line implementation but not MVP priority. |
| 14 | Mobile-optimized card layout | **Added to AC**: Mobile-optimized card layout | Critical for mobile. Use Tailwind responsive. Part of MVP. |
| 15 | "Share this wishlist" button | OUT OF SCOPE | Shareable link. Social feature. Defer to WISH-2009. |

### Follow-up Stories Suggested

- [ ] WISH-2001-A: Backend Verification - Verify existing endpoints, add .http tests, document service layer
- [ ] WISH-2001-B: Frontend Gallery UI - WishlistCard component, Gallery page with filters/search/sort, loading states
- [ ] WISH-2001-C: RTK Query Integration - Wire hooks to UI, cache strategy, performance monitoring

### Items Marked Out-of-Scope

- URL query params for filter bookmarking: Defer to WISH-2008 (privacy/sharing)
- Quick preview on hover: Nice-to-have, deferred
- Bulk selection mode: Foundation for future bulk operations
- Store logo badges: Need assets, lower priority
- Price trend indicators: Depends on price history feature
- Smart sorting: Nice-to-have, not MVP
- Recently viewed items: Nice-to-have, not MVP
- Infinite scroll: Adds complexity, pagination sufficient for MVP
- Filter chips with counts: Improves UX but adds complexity, defer
- Keyboard shortcuts hint: Foundation for WISH-2006, defer
- Gallery stats summary: Motivational but not MVP
- Tag cloud filtering: Requires tag aggregation endpoint
- Export to CSV: One-line but not MVP priority
- Share wishlist button: Social feature, defer to WISH-2009

---

## Revision History

### v2 - 2026-01-27 (PM Fix)

**QA Audit Failures Addressed**: 10/10 items fixed

**Critical Fixes**:
1. **Backend architecture mismatch** - Removed plan to create new endpoints. Backend ALREADY EXISTS at `apps/api/lego-api/domains/wishlist/routes.ts` with GET / and GET /:id. Story now verifies existing implementation only.
2. **RTK Query duplication** - Removed plan to create new `wishlist-api.ts`. File EXISTS at `packages/core/api-client/src/rtk/wishlist-gallery-api.ts` with `useGetWishlistQuery` and `useGetWishlistItemQuery`. Story now uses existing hooks.
3. **Scope creep in AC #8** - Removed "Edit, Remove, Got It" from hover menu. These belong to WISH-2003/WISH-2004. AC now specifies "View Details" only with placeholder UI slots.
4. **Missing service layer** - Added reference to existing Hexagonal Architecture service layer at `apps/api/lego-api/domains/wishlist/application/`.
5. **Schema synchronization** - Added AC verifying RTK Query handles Date→datetime string conversion via `transformResponse`.
6. **Frontend app location** - Verified `apps/web/app-wishlist-gallery` EXISTS. Story now explicitly states this app hosts gallery.
7. **Missing .http test** - Added AC for `__http__/wishlist-gallery-mvp.http` to verify backend endpoints.
8. **Store filter mismatch** - Fixed inconsistency. AC now lists all 5 stores per schema: LEGO, Barweer, Cata, BrickLink, Other (plus "All").
9. **Gallery layout reuse** - Clarified reuse plan. References `app-sets-gallery` patterns. Creates NEW components, reuses Tailwind patterns.
10. **Story oversized** - Removed backend implementation work (already done). Focused on frontend only. Reduced from 9 ACs to 14 specific ACs (3 backend verification + 11 frontend).

**Scope Changes**:
- Story rescoped to FRONTEND ONLY after discovering backend and RTK Query already implemented
- Estimated points reduced from 8 to 5
- Token budget reduced from 70k to 56k
- Removed "sizing warning" (no longer spans multiple domains)

**New ACs Added** (from QA discovery gaps):
- Grid/List view toggle
- Mobile-responsive card layout
- Loading skeleton details (reuse from component library)
- Empty state design (illustration + CTA)
- Error handling specification (404, 403, 500)
- Auth middleware verification
- Schema synchronization verification
- .http test file requirement

**Files Updated**:
- YAML frontmatter: status `needs-refinement` → `backlog`, points 8 → 5, sizing_warning removed
- Goal: Clarified use of existing backend/RTK Query
- Feature: Changed from "full-stack" to "frontend only"
- Technical Details: Complete rewrite of Backend and RTK Query sections
- Acceptance Criteria: Expanded from 9 to 14 ACs, organized into Backend Verification (3) and Frontend Implementation (11)
- Reuse Plan: Added specific component imports and layout patterns
- Test Coverage: Expanded with specific test cases
- Definition of Done: Updated with frontend focus

**Ready for Re-Audit**: Yes - All QA feedback addressed, story ready for implementation.

---

## QA Discovery Notes - Elaboration Phase (for PM Review)

_Added by QA Elaboration on 2026-01-27_

### Gaps Identified & User Decisions

| # | Finding | Decision | Implementation Note |
|---|---------|----------|-------------------|
| gap-2 | Search debounce timing not specified | **Added to AC** | Specify 300ms delay as industry standard |
| gap-3 | Empty search results vs empty wishlist distinction | **Added to AC** | Show "No items match your search" vs "No items in wishlist yet" |
| gap-4 | Loading states during filter/sort changes | **Added to AC** | Show skeletons for any data fetch to maintain UX consistency |
| gap-8 | Mobile hover menu UI pattern | **Added to AC** | Use bottom sheet pattern for mobile consistency |

### Enhancement Opportunities & User Decisions

| # | Finding | Decision | Implementation Note |
|---|---------|----------|-------------------|
| enh-3 | Keyboard shortcuts for common actions | **Added to AC** | "/" for search focus, "G" for grid, "L" for list, "1-5" for store tabs |
| enh-10 | Infinite scrolling with virtual scrolling | **Added to AC** | Implement infinite scrolling (with virtual scrolling if needed for performance) |
| enh-11 | Gallery statistics in header | **Added to AC** | Show "42 items, $1,250 total" in header - aggregate from current filtered view |
| enh-12 | Smart sorting algorithms | **Follow-up story** → WISH-2014 | Recommend new story for "Best Value", "Expiring Soon", "Hidden Gems" sorting modes |

### Items Marked Out-of-Scope

- **enh-4**: Quick add to collection from hover menu - Power user feature, defer post-MVP
- **enh-5**: Compare mode for side-by-side viewing - Significant UI work, separate story
- **enh-6**: Saved filter presets - Quality-of-life feature, defer to post-MVP
- **enh-7**: Gallery layout density control - Not MVP priority
- **enh-8**: Batch operations from selection mode - Defer to dedicated story
- **enh-9**: Export to CSV - Not MVP priority
- **enh-15**: Gallery themes - Requires app-level theming, defer to global story
