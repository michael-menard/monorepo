---
doc_type: story
title: "WISH-20172: Frontend Filter Panel UI"
story_id: WISH-20172
story_prefix: WISH
status: deferred
split_from: WISH-2017
split_part: 2 of 2
phase: 6
created_at: "2026-01-29T00:00:00-07:00"
updated_at: "2026-01-29T08:00:00-07:00"
depends_on: [WISH-20171]
estimated_points: 4
---

# WISH-20172: Frontend Filter Panel UI

## Split Context

This story is part of a split from WISH-2017.
- **Original Story:** WISH-2017 (Advanced Multi-Sort Filtering)
- **Split Reason:** Story was oversized (20 ACs) with significant frontend AND backend work. Split enables parallel development and independent testing of backend and frontend concerns.
- **This Part:** 2 of 2 (Frontend implementation)
- **Dependency:** Depends on WISH-20171 (Backend Combined Filter + Sort Queries)

## Context

This is the frontend portion of WISH-2017, focusing exclusively on creating the FilterPanel UI component and integrating it with the backend filtering capabilities established in WISH-20171. Users will be able to apply multiple filter criteria (store, priority range, price range) through an intuitive UI, with URL state management for deep linking and bookmarking.

The backend filter + sort query implementation is handled separately in WISH-20171, which must be completed before this story begins.

## Goal

Create a user-friendly FilterPanel component that enables users to combine filters (store, priority, price range) with smart sort algorithms for advanced item discovery and decision-making workflows.

## Non-goals

- Backend API implementation (handled by WISH-20171)
- Saved filter presets (deferred to Phase 5 UX Polish - WISH-2018)
- Filter history/undo (deferred to Phase 5)
- Real-time collaborative filtering (deferred to Phase 7)
- Custom user-defined filter logic (deferred to Phase 7)

## Scope

### Packages Affected

1. **Frontend**: `apps/web/app-wishlist-gallery/`
   - `src/pages/main-page.tsx` - Add filter UI components
   - `src/components/FilterPanel/` - New component for advanced filters

2. **Shared API Client**: `packages/core/api-client/`
   - RTK Query hooks (extend with filter params)

### UI Surface

**Filter Panel** (new component):
- Store filter: Multi-select dropdown (LEGO, BrickLink, Amazon, Other)
- Priority range: Slider (0-5)
- Price range: Dual slider or min/max inputs
- "Apply Filters" button
- "Clear All" button

**Sort Dropdown** (existing):
- Continues to work with filters applied
- Smart sort options: Best Value, Expiring Soon, Hidden Gems

**Query State**:
- URL query params reflect all active filters + sort
- Deep linkable: `/wishlist?store=LEGO&priority=3-5&sort=bestValue`

## Acceptance Criteria

### AC7: Filter panel component renders all filter controls

**Criterion**: All filter controls render correctly
- Store filter: Multi-select with checkboxes or Select primitive
- Priority range: Slider component (or dual input)
- Price range: Dual slider or min/max number inputs
- "Apply Filters" and "Clear All" buttons

**Verification**:
- Component test verifies all controls render
- Visual regression test captures FilterPanel appearance
- Snapshot test validates component structure

---

### AC8: Filter panel uses design system primitives

**Criterion**: Design system compliance
- Import from `@repo/app-component-library/_primitives/`
- Token-only colors (neutral-100, neutral-700, etc.)
- Consistent spacing and layout with existing UI

**Verification**:
- Code review confirms primitive usage
- No hardcoded colors (only design tokens)
- Component follows design system patterns

---

### AC9: Filter state managed via URL query parameters

**Criterion**: URL state synchronization
- URL updates when filters applied: `/wishlist?store=LEGO,BrickLink&priority=3-5&sort=bestValue`
- Deep linking works: User can bookmark or share filtered URL
- Browser back/forward navigation updates filters

**Verification**:
- Component tests verify URL updates on filter change
- E2E tests verify deep linking functionality
- Browser navigation test verifies back/forward behavior

---

### AC10: RTK Query triggers API call with combined parameters

**Criterion**: API integration
- `useGetWishlistQuery({ store: ['LEGO'], priority: { min: 3, max: 5 }, sort: 'bestValue' })` calls API correctly
- Loading state shown during fetch
- Items re-render after fetch completes with filtered results

**Verification**:
- Component tests with MSW verify API calls
- Network requests match expected parameters
- Loading states display correctly

---

### AC11: Filter panel shows active filter count badge

**Criterion**: Active filter feedback
- Badge displays: "3 filters active" when store + priority + price applied
- Badge hidden when no filters active
- Clicking badge expands filter panel (if collapsed)

**Verification**:
- Component tests verify badge visibility logic
- E2E tests verify badge click interaction
- Visual test captures badge states

---

### AC12: "Clear All" button resets all filters

**Criterion**: Clear filters functionality
- Removes all filter query params from URL
- RTK Query refetches with no filters
- Sort mode preserved (if set)

**Verification**:
- Component test verifies URL params cleared
- E2E test confirms API refetch occurs
- Sort parameter remains unchanged

---

### AC13: Frontend component tests verify filter panel rendering

**Criterion**: Comprehensive component test coverage
- Test: Filter controls render correctly
- Test: Apply button triggers API call with correct params
- Test: Clear All resets state
- Test: URL sync works (filter state â†” URL query params)
- Minimum: 15 component tests

**Verification**:
- All 15+ component tests pass
- Test coverage includes edge cases
- Tests follow React Testing Library best practices

---

### AC14: Playwright E2E test covers combined filter + sort flow

**Criterion**: End-to-end testing
- Test: Apply store filter + Best Value sort
- Test: Apply priority range + Hidden Gems sort
- Test: Apply all filters + sort, verify results
- Test: Clear filters, verify results reset
- Evidence: Screenshots + network HAR

**Verification**:
- All 4 Playwright tests pass
- Screenshots captured for evidence
- HAR files show correct API requests

---

### AC17: Empty result sets handled gracefully

**Criterion**: Empty state UX
- No items match filters: Empty array returned with 200 status
- Frontend shows: "No items match your filters. Try adjusting filters."
- "Clear All" button shown as suggested action

**Verification**:
- Component test verifies empty state rendering
- E2E test confirms empty state behavior
- Empty state message is helpful and actionable

---

### AC19: Filter panel is keyboard navigable

**Criterion**: Keyboard accessibility
- Tab focuses each filter control
- Arrow keys navigate multi-select options
- Enter applies filters
- Escape clears focus or closes panel

**Verification**:
- Keyboard navigation test passes
- All controls reachable via keyboard
- Focus indicators visible

---

### AC20: Screen reader announces filter state changes

**Criterion**: Screen reader accessibility
- Filter applied: "3 filters active. 42 items found."
- Filters cleared: "Filters cleared. Showing all 150 items."
- Loading state: "Loading filtered results..."

**Verification**:
- Axe-core audit passes (0 violations)
- ARIA live regions configured correctly
- Screen reader announcements tested manually

---

## Reuse Plan

### Existing Components

- âœ… `useGetWishlistQuery` RTK Query hook (extend with filter params)
- âœ… Sort dropdown UI (continues to work with filters)
- âœ… Design system primitives from `@repo/app-component-library/_primitives/`
- âœ… URL query parameter state management (from main-page.tsx)

### Existing Patterns

- âœ… RTK Query cache management (existing tags: Wishlist, WishlistItem)
- âœ… Error handling patterns from WISH-2001
- âœ… Design system token usage
- âœ… Accessibility patterns (ARIA labels, keyboard navigation)

### New Components (to build)

- ðŸ†• `FilterPanel` component
- ðŸ†• Priority range slider component
- ðŸ†• Price range dual slider component
- ðŸ†• Active filter badge component

## Architecture Notes

### Component Structure

**FilterPanel Component**:
```typescript
// apps/web/app-wishlist-gallery/src/components/FilterPanel/index.tsx
export function FilterPanel() {
  // URL state management
  const [searchParams, setSearchParams] = useSearchParams()

  // Parse filters from URL
  const filters = parseFiltersFromURL(searchParams)

  // RTK Query hook with filters
  const { data, isLoading } = useGetWishlistQuery(filters)

  // Filter state handlers
  const handleApplyFilters = (newFilters) => {
    setSearchParams(serializeFiltersToURL(newFilters))
  }

  const handleClearFilters = () => {
    setSearchParams({})
  }

  return (
    <div className="filter-panel">
      <StoreFilter value={filters.store} onChange={...} />
      <PriorityRangeSlider value={filters.priority} onChange={...} />
      <PriceRangeSlider value={filters.priceRange} onChange={...} />
      <Button onClick={handleApplyFilters}>Apply Filters</Button>
      <Button variant="secondary" onClick={handleClearFilters}>Clear All</Button>
    </div>
  )
}
```

### URL State Management

**Filter Serialization**:
- Store: Comma-separated string `?store=LEGO,BrickLink`
- Priority: Min-max format `?priority=3-5`
- Price: Min-max format `?priceRange=50-200`
- Sort: Simple string `?sort=bestValue`

**Example URL**:
```
/wishlist?store=LEGO&priority=3-5&priceRange=50-200&sort=bestValue
```

## Test Plan

### Frontend Component Tests

**FilterPanel Component**:
- Rendering: All filter controls render correctly (5 tests)
- Interaction: Apply filters triggers API call (5 tests)
- State management: URL sync, Clear All (5 tests)
- Validation: Min/max range validation (5 tests)

**Minimum**: 20 component tests

### E2E Tests (Playwright)

**Full Filter Flow**:
1. Full filter flow: Apply filters â†’ verify results â†’ clear filters (1 test)
2. Combined scenarios: Store + priority + sort (1 test)
3. Accessibility: Keyboard navigation (1 test)
4. Deep linking: URL with filters loads correctly (1 test)

**Minimum**: 4 E2E tests

## UI/UX Notes

### MVP-Critical Requirements

**Filter Panel Design**:
- Collapsible panel (desktop: sidebar, mobile: drawer)
- "Filter" button with active count badge: "Filter (3)"
- Store filter: Checkbox group (4 options: LEGO, BrickLink, Amazon, Other)
- Priority range: Dual-handle slider (0-5) with numeric labels
- Price range: Dual number inputs (min/max) with currency symbol ($)
- Apply button: Primary style (calls API)
- Clear All button: Secondary style (resets all filters)

**Design System Compliance**:
- Import primitives from `@repo/app-component-library/_primitives/`
- Token-only colors (neutral, primary, secondary)
- Icons from lucide-react: Filter, X, TrendingDown, ArrowUpDown

**Accessibility**:
- Keyboard navigation for all controls
- Screen reader announcements for filter state changes
- Focus management: Return focus to "Filter" button after panel closes
- ARIA labels: "Filter panel", "Active filters: 3"

**Responsive Design**:
- Desktop: Sidebar filter panel (left or right)
- Tablet: Collapsible sidebar
- Mobile: Bottom drawer or modal

### Future Enhancements (Non-MVP)

**Phase 5 - UX Polish** (WISH-2018):
- Filter state persistence in localStorage
- Saved filter presets
- Filter history/undo
- Animated filter transitions

**Phase 7 - Advanced Features**:
- Custom filter logic builder (boolean AND/OR/NOT)
- Cross-user filter sharing
- Filter templates for common use cases

## Risks & Mitigations

### MVP-Critical Risks

1. **URL Length Limits**
   - Risk: Long filter query strings may exceed browser URL length limits (2083 chars)
   - Mitigation: Encode filter state as base64 JSON if length > 1500 chars, or use POST for complex filters
   - Acceptance Criteria: AC9 validates deep linking works

2. **Filter State Synchronization**
   - Risk: URL state and RTK Query state may drift if not carefully managed
   - Mitigation: Single source of truth (URL), RTK Query derives from URL params
   - Acceptance Criteria: AC9 validates URL sync, AC13 validates state consistency

3. **Empty Result Set UX**
   - Risk: Users may apply overly restrictive filters and see empty results
   - Mitigation: AC17 requires helpful empty state with "Clear All" CTA
   - Acceptance Criteria: AC17 validates empty state UX

### Non-MVP Risks

- Filter discoverability: Users may not notice filter panel (mitigate with onboarding tooltip in Phase 5)
- Mobile filter UX: Small screen filter panels may be cramped (mitigate with bottom drawer pattern)
- Filter complexity: Too many options may overwhelm users (mitigate with progressive disclosure in Phase 7)

## Implementation Notes

### Recommended Implementation Sequence

**Phase 1: Component Structure** (Day 1)
1. Create FilterPanel component skeleton
2. Add design system primitives (buttons, inputs, selects)
3. Implement basic rendering

**Phase 2: URL State Management** (Day 2)
1. Implement filter serialization/deserialization
2. Connect URL params to component state
3. Add URL sync tests

**Phase 3: RTK Query Integration** (Day 3)
1. Wire FilterPanel to useGetWishlistQuery
2. Implement Apply Filters functionality
3. Add loading states

**Phase 4: Additional Features** (Day 4)
1. Add active filter badge
2. Implement Clear All functionality
3. Add 20 component tests

**Phase 5: E2E Verification** (Day 5)
1. Add 4 Playwright tests
2. Test full filter flow
3. Verify accessibility (keyboard nav, screen reader)
4. Capture evidence (screenshots, HAR files)

**Estimated Total Effort**: 4 days (1 frontend developer)

## Definition of Done

- [ ] All 11 Acceptance Criteria pass (AC7, AC8, AC9, AC10, AC11, AC12, AC13, AC14, AC17, AC19, AC20)
- [ ] Frontend: 20 component tests pass
- [ ] Frontend: 4 Playwright E2E tests pass with evidence
- [ ] Accessibility: Axe-core audit passes (0 violations)
- [ ] Accessibility: Keyboard navigation test passes
- [ ] TypeScript compilation passes
- [ ] ESLint passes
- [ ] Code review approved
- [ ] Documentation updated (UI component docs)
- [ ] QA verification complete

## Open Questions

None - Frontend scope is clear and implementation-ready (pending WISH-20171 completion).
