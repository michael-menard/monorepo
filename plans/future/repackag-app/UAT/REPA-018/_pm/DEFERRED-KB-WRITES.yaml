# Deferred Knowledge Base Writes
# These records should be persisted to the KB stories table when available

deferred_writes:
  - table: stories
    operation: INSERT_OR_UPDATE
    data:
      story_id: REPA-018
      feature: repackag-app
      title: "Create @repo/auth-services Package"
      story_dir: plans/future/repackag-app/backlog/REPA-018
      story_file: plans/future/repackag-app/backlog/REPA-018/REPA-018.md
      story_type: tech_debt
      points: 3
      priority: medium
      state: backlog
      touches_backend: true
      touches_frontend: false
      touches_database: false
      touches_infra: false
    reason: KB unavailable (psql not found)
    timestamp: "2026-02-10T00:00:00Z"

# SQL Query for Manual Execution:
#
# INSERT INTO stories (
#   story_id, feature, title, story_dir, story_file, story_type,
#   points, priority, state, touches_backend, touches_frontend,
#   touches_database, touches_infra
# ) VALUES (
#   'REPA-018',
#   'repackag-app',
#   'Create @repo/auth-services Package',
#   'plans/future/repackag-app/backlog/REPA-018',
#   'plans/future/repackag-app/backlog/REPA-018/REPA-018.md',
#   'tech_debt',
#   3,
#   'medium',
#   'backlog',
#   true,
#   false,
#   false,
#   false
# )
# ON CONFLICT (story_id) DO UPDATE SET
#   feature = EXCLUDED.feature,
#   title = EXCLUDED.title,
#   story_dir = EXCLUDED.story_dir,
#   story_file = EXCLUDED.story_file,
#   story_type = EXCLUDED.story_type,
#   points = EXCLUDED.points,
#   priority = EXCLUDED.priority,
#   state = EXCLUDED.state,
#   touches_backend = EXCLUDED.touches_backend,
#   touches_frontend = EXCLUDED.touches_frontend,
#   touches_database = EXCLUDED.touches_database,
#   touches_infra = EXCLUDED.touches_infra;
