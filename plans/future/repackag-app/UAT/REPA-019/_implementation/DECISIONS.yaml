# Auto-generated by elab-autonomous-decider
generated_at: "2026-02-10T22:00:00Z"
mode: autonomous
story_id: "REPA-019"

verdict: CONDITIONAL PASS

decisions:
  gaps:
    - id: 1
      finding: "Error code accuracy - story claims 27+ but actual count is 21"
      decision: "Add as AC"
      notes: "Auto-resolved: blocks core journey - developer may create wrong test cases or miss edge cases during migration"
      action: add_ac
      ac_added: 11
    - id: 2
      finding: "API reset coordination - authFailureHandler dynamically imports API slices for cache clearing, unclear how this works after refactor"
      decision: "Add as AC"
      notes: "Auto-resolved: blocks core journey - 401 handling may break after migration if API reset mechanism not clarified"
      action: add_ac
      ac_added: 12
    - id: 3
      finding: "Legacy error format support may be obsolete"
      decision: "KB-logged"
      notes: "Non-blocking edge case, logged to KB for future cleanup story"
      action: kb_write
      kb_category: "edge-cases"
      kb_tags: ["edge-case", "future-work", "legacy-support"]
    - id: 4
      finding: "Error code enum may not match backend exactly"
      decision: "KB-logged"
      notes: "Non-blocking data sync issue, logged to KB for future schema sync story"
      action: kb_write
      kb_category: "edge-cases"
      kb_tags: ["edge-case", "schema-sync", "future-work"]
    - id: 5
      finding: "Correlation ID extraction has dual sources"
      decision: "KB-logged"
      notes: "Non-blocking edge case, logged to KB for future standardization"
      action: kb_write
      kb_category: "edge-cases"
      kb_tags: ["edge-case", "future-work"]
    - id: 6
      finding: "Auth page list hardcoded in multiple places"
      decision: "KB-logged"
      notes: "Non-blocking architecture issue, logged to KB - may coordinate with REPA-013"
      action: kb_write
      kb_category: "architecture-cleanup"
      kb_tags: ["future-work", "coordination", "repa-013"]
    - id: 7
      finding: "Retry delay logic could be more sophisticated"
      decision: "KB-logged"
      notes: "Non-blocking enhancement, logged to KB for future improvement"
      action: kb_write
      kb_category: "architecture-cleanup"
      kb_tags: ["enhancement", "future-work"]

  enhancements:
    - id: 1
      finding: "Error telemetry and analytics"
      decision: "KB-logged"
      notes: "High-impact observability enhancement, logged to KB"
      action: kb_write
      kb_category: "observability"
      kb_tags: ["observability", "monitoring", "enhancement"]
    - id: 2
      finding: "User-friendly error UI components"
      decision: "KB-logged"
      notes: "High-impact UX enhancement, logged to KB - depends on REPA-019 completion"
      action: kb_write
      kb_category: "ux-polish"
      kb_tags: ["ux-polish", "enhancement", "depends-repa-019"]
    - id: 3
      finding: "Error recovery suggestions"
      decision: "KB-logged"
      notes: "Medium-impact UX enhancement, logged to KB"
      action: kb_write
      kb_category: "ux-polish"
      kb_tags: ["ux-polish", "enhancement"]
    - id: 4
      finding: "Contextual error messages"
      decision: "KB-logged"
      notes: "Medium-impact UX enhancement, logged to KB"
      action: kb_write
      kb_category: "ux-polish"
      kb_tags: ["ux-polish", "enhancement"]
    - id: 5
      finding: "Error code documentation"
      decision: "KB-logged"
      notes: "Low-effort developer experience enhancement, logged to KB"
      action: kb_write
      kb_category: "developer-experience"
      kb_tags: ["documentation", "enhancement"]
    - id: 6
      finding: "Auth failure handler improvements"
      decision: "KB-logged"
      notes: "Medium-impact UX enhancement with multiple sub-features, logged to KB"
      action: kb_write
      kb_category: "ux-polish"
      kb_tags: ["ux-polish", "enhancement", "auth"]
    - id: 7
      finding: "Error retry UI with countdown"
      decision: "KB-logged"
      notes: "Low-priority UX enhancement, logged to KB"
      action: kb_write
      kb_category: "ux-polish"
      kb_tags: ["ux-polish", "enhancement"]
    - id: 8
      finding: "Offline error detection"
      decision: "KB-logged"
      notes: "Medium-impact UX enhancement for network handling, logged to KB"
      action: kb_write
      kb_category: "ux-polish"
      kb_tags: ["ux-polish", "enhancement", "network"]

  audit_resolutions:
    - check: "Internal Consistency"
      resolution: "Added AC-11 to verify exact error code count (21) and remove INVALID_TOKEN reference"
      status: "resolved"
    - check: "Decision Completeness"
      resolution: "Added AC-12 to clarify API slice reset coordination mechanism"
      status: "resolved"
    - check: "Reuse-First"
      resolution: "Added import verification step to implementation checklist to ensure no imports from old paths"
      status: "resolved"

summary:
  acs_added: 2
  kb_entries_planned: 13
  audit_issues_resolved: 3
  audit_issues_flagged: 0

kb_write_requests:
  # Non-blocking gaps
  - entry_type: finding
    source_stage: elab
    story_id: "REPA-019"
    category: "edge-cases"
    content: |
      **[REPA-019] Legacy Error Format Edge Case**
      - Current code supports legacy error format with 'type' instead of 'code' field
      - Impact: Low | Effort: Low
      - Recommendation: Review API error logs to determine if this format is still in use. If not, remove legacy parsing logic in future cleanup story.
    additional_tags: ["edge-case", "future-work", "legacy-support"]

  - entry_type: finding
    source_stage: elab
    story_id: "REPA-019"
    category: "edge-cases"
    content: |
      **[REPA-019] Frontend/Backend Error Code Schema Sync**
      - Frontend ApiErrorCodeSchema (21 codes) may not be in sync with backend error codes
      - Impact: Low | Effort: Medium
      - Recommendation: Create future story to generate frontend schema from backend OpenAPI spec or shared schema file.
    additional_tags: ["edge-case", "schema-sync", "future-work"]

  - entry_type: finding
    source_stage: elab
    story_id: "REPA-019"
    category: "edge-cases"
    content: |
      **[REPA-019] Correlation ID Dual Sources**
      - Code extracts correlation ID from both headers (X-Correlation-Id) and body (correlationId field)
      - Impact: Low | Effort: Low
      - Recommendation: Document which source is canonical or create priority order. Consider standardizing on one source in future.
    additional_tags: ["edge-case", "future-work"]

  - entry_type: finding
    source_stage: elab
    story_id: "REPA-019"
    category: "architecture-cleanup"
    content: |
      **[REPA-019] Auth Page List Consolidation**
      - AUTH_PAGES constant exists in authFailureHandler.ts (6 entries). REPA-013 may create similar list in route guards.
      - Impact: Low | Effort: Medium
      - Recommendation: Future story to consolidate auth page definitions in @repo/auth-utils and import from there. Coordinate with REPA-013 implementation.
    additional_tags: ["future-work", "coordination", "repa-013"]

  - entry_type: finding
    source_stage: elab
    story_id: "REPA-019"
    category: "architecture-cleanup"
    content: |
      **[REPA-019] Sophisticated Retry Logic**
      - Current retry delays are hardcoded per error code
      - Impact: Low | Effort: Medium
      - Recommendation: Future enhancement to support Retry-After header parsing for date format (not just seconds), exponential backoff calculation, jitter for distributed systems.
    additional_tags: ["enhancement", "future-work"]

  # Enhancements
  - entry_type: finding
    source_stage: elab
    story_id: "REPA-019"
    category: "observability"
    content: |
      **[REPA-019] Error Telemetry and Analytics**
      - Current code logs errors but doesn't send telemetry
      - Impact: Medium | Effort: High
      - Recommendation: Future enhancement to integrate with analytics service to track error rates, correlation IDs, user impact. Useful for debugging production issues and measuring API reliability.
    additional_tags: ["observability", "monitoring", "enhancement"]

  - entry_type: finding
    source_stage: elab
    story_id: "REPA-019"
    category: "ux-polish"
    content: |
      **[REPA-019] Shared Error UI Components**
      - Error mapping provides title/message/icon but no UI components
      - Impact: High | Effort: Medium
      - Recommendation: Future enhancement to create shared ErrorAlert, ErrorToast, ErrorBoundary components in @repo/app-component-library that consume ParsedApiError. Eliminates per-app error display logic. Depends on REPA-019 completion.
    additional_tags: ["ux-polish", "enhancement", "depends-repa-019"]

  - entry_type: finding
    source_stage: elab
    story_id: "REPA-019"
    category: "ux-polish"
    content: |
      **[REPA-019] Error Recovery Suggestions**
      - Current error messages say "try again" but don't provide actionable steps
      - Impact: Medium | Effort: Medium
      - Recommendation: Future enhancement to enhance error mapping with specific recovery actions (e.g., "Check your internet connection", "Verify file size is under 10MB").
    additional_tags: ["ux-polish", "enhancement"]

  - entry_type: finding
    source_stage: elab
    story_id: "REPA-019"
    category: "ux-polish"
    content: |
      **[REPA-019] Contextual Error Messages**
      - Current implementation uses getContextualMessage() to prefer API messages for validation errors
      - Impact: Medium | Effort: Medium
      - Recommendation: Future enhancement to expand this pattern to more error types, use error details to enrich user messages (e.g., "Title 'My MOC' already exists" instead of generic "Title already exists").
    additional_tags: ["ux-polish", "enhancement"]

  - entry_type: finding
    source_stage: elab
    story_id: "REPA-019"
    category: "developer-experience"
    content: |
      **[REPA-019] Error Code Documentation**
      - No central documentation of what each error code means, when it occurs, and how to fix it
      - Impact: Low | Effort: Low
      - Recommendation: Future enhancement to generate markdown docs from error mappings, include in Storybook or developer portal. Useful for support teams and QA.
    additional_tags: ["documentation", "enhancement"]

  - entry_type: finding
    source_stage: elab
    story_id: "REPA-019"
    category: "ux-polish"
    content: |
      **[REPA-019] Auth Failure Handler Improvements**
      - Current implementation redirects to /login with return URL
      - Impact: Medium | Effort: Medium
      - Recommendation: Future enhancements: (a) show toast explaining why redirect happened, (b) preserve form data/drafts before redirect, (c) support configurable redirect URL per app, (d) handle concurrent 401s gracefully (debounce redirects).
    additional_tags: ["ux-polish", "enhancement", "auth"]

  - entry_type: finding
    source_stage: elab
    story_id: "REPA-019"
    category: "ux-polish"
    content: |
      **[REPA-019] Error Retry UI with Countdown**
      - For retryable errors, show countdown timer and auto-retry button
      - Impact: Low | Effort: Medium
      - Recommendation: Current implementation provides retry delay but no UI affordance. Future enhancement to add visual countdown and auto-retry functionality.
    additional_tags: ["ux-polish", "enhancement"]

  - entry_type: finding
    source_stage: elab
    story_id: "REPA-019"
    category: "ux-polish"
    content: |
      **[REPA-019] Offline Error Detection**
      - Current code detects network errors but doesn't distinguish between offline (no connectivity) and server errors
      - Impact: Medium | Effort: Medium
      - Recommendation: Future enhancement to use navigator.onLine + custom offline detection to show "You're offline" message instead of generic network error.
    additional_tags: ["ux-polish", "enhancement", "network"]
