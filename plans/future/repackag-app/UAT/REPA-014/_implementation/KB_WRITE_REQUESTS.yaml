# KB Write Requests for REPA-014
# Auto-generated by elab-autonomous-decider
# These findings are non-blocking and logged for future reference

generated_at: "2026-02-10T20:15:00Z"
story_id: "REPA-014"
source_stage: "elab"

requests:
  - id: 1
    entry_type: finding
    category: "edge-case"
    finding: "Consumer count mismatch - story claims 21 files but actual count is 18 files"
    impact: Low
    effort: Low
    content: |
      - **Documentation discrepancy**: Story claims "101 total import references across 21 files" but analysis shows 18 files (6 hook definitions to delete, 8 consumer files for import updates, 3 test files to migrate, 1 re-export file)
      - **Impact**: Low - close enough for planning purposes, doesn't block implementation
      - **Effort**: Low - documentation clarification only
      - **Recommendation**: Post-MVP clarify what "import references" means (may include internal function calls within hooks). Update story documentation for accuracy.
    additional_tags:
      - non-blocking
      - documentation
      - future-work

  - id: 2
    entry_type: finding
    category: "test-coverage"
    finding: "Missing test verification AC for useUnsavedChangesPrompt"
    impact: Medium
    effort: Low
    content: |
      - **Test gap**: Story identifies missing tests for useUnsavedChangesPrompt in Risk section (line 319) and Test Plan (Test 4). AC-16 covers type-checking verification implicitly but could be more explicit.
      - **Impact**: Medium - explicit AC would improve clarity
      - **Effort**: Low - documentation enhancement only
      - **Recommendation**: Post-MVP add explicit AC for useUnsavedChangesPrompt verification or add basic unit tests (100-150 lines covering dialog state, blocker integration, beforeunload handler).
      - **Note**: Hook is already in production without tests in current locations, so acceptable for MVP.
    additional_tags:
      - non-blocking
      - test-coverage
      - observability

  - id: 3
    entry_type: finding
    category: "documentation"
    finding: "Export pattern inconsistency - clarify file-level vs barrel exports"
    impact: Low
    effort: Low
    content: |
      - **Pattern clarification**: Story AC-3 specifies direct file exports (`./useLocalStorage`) which aligns with CLAUDE.md "no barrel files" rule. This differs from REPA-001 pattern (@repo/upload) which uses subdirectory barrel exports.
      - **Impact**: Low - pattern is correct, just needs documentation
      - **Effort**: Low - documentation note only
      - **Recommendation**: Post-MVP document package export patterns. Direct file exports are correct for simple hooks packages. Subdirectory barrel exports (REPA-001 pattern) are for more complex packages with multiple related exports per feature.
    additional_tags:
      - non-blocking
      - documentation
      - architecture

  - id: 4
    entry_type: finding
    category: "test-coverage"
    finding: "Incomplete test coverage for useUnsavedChangesPrompt"
    impact: Medium
    effort: Low
    content: |
      - **Test gap**: No test file exists for useUnsavedChangesPrompt hook. Story acknowledges this and specifies type-checking as mitigation (AC-16).
      - **Impact**: Medium - reduced confidence in refactor safety
      - **Effort**: Low - estimated 100-150 lines of tests
      - **Recommendation**: Post-MVP add basic unit tests covering:
        * Dialog state toggling
        * Blocker integration with TanStack Router
        * beforeunload event handler
        * Enable/disable functionality
      - **Note**: Hook is already in production without tests, so acceptable for MVP.
    additional_tags:
      - non-blocking
      - test-coverage
      - future-work

  - id: 5
    entry_type: finding
    category: "edge-case"
    finding: "Consumer count verification needed"
    impact: Low
    effort: Low
    content: |
      - **Verification gap**: Story claims "101 total import references" but this count could not be verified during analysis. May include internal function calls within hooks, not just file-level imports.
      - **Impact**: Low - doesn't affect implementation
      - **Effort**: Low - clarification only
      - **Recommendation**: Post-MVP define "import references" metric clearly for future stories. Distinguish between file-level imports and internal function call counts.
    additional_tags:
      - non-blocking
      - edge-case
      - metrics

  - id: 6
    entry_type: enhancement
    category: "feature"
    finding: "useLocalStorage could support TTL/expiration"
    impact: Medium
    effort: Medium
    content: |
      - **Enhancement**: Add optional TTL parameter to useLocalStorage for auto-expiring cached data
      - **Impact**: Medium - useful for ephemeral preferences or temporary state
      - **Effort**: Medium - estimated 50-100 LOC + tests
      - **Recommendation**: Post-MVP story REPA-014d. Add TTL/expiration with automatic cleanup. Use timestamp-based storage format.
    additional_tags:
      - enhancement
      - performance
      - post-mvp-candidate

  - id: 7
    entry_type: enhancement
    category: "feature"
    finding: "useLocalStorage could support storage events"
    impact: Low
    effort: Low
    content: |
      - **Enhancement**: Add optional listener for storage events to sync state across tabs/windows
      - **Impact**: Low - reduces unnecessary re-renders across tabs
      - **Effort**: Low - add event listener wrapper
      - **Recommendation**: Post-MVP enhancement for cross-tab state synchronization. Currently each instance is independent.
    additional_tags:
      - enhancement
      - performance
      - future-work

  - id: 8
    entry_type: enhancement
    category: "ux-polish"
    finding: "useMultiSelect could support keyboard-only range selection"
    impact: Low
    effort: Medium
    content: |
      - **Enhancement**: Add keyboard-only range selection (Shift+Arrow) to complement existing shift-click behavior
      - **Impact**: Low - accessibility improvement
      - **Effort**: Medium - implement ARIA patterns for keyboard navigation
      - **Recommendation**: Post-MVP accessibility enhancement. Current shift-click works great with mouse but lacks keyboard equivalent.
    additional_tags:
      - enhancement
      - ux-polish
      - accessibility

  - id: 9
    entry_type: enhancement
    category: "ux-polish"
    finding: "useDelayedShow could support custom easing"
    impact: Low
    effort: Low
    content: |
      - **Enhancement**: Accept easing function or transition config for sophisticated animations
      - **Impact**: Low - improved animation flexibility
      - **Effort**: Low - add optional config parameter
      - **Recommendation**: Post-MVP UX polish. Currently hard-coded 300ms default delay.
    additional_tags:
      - enhancement
      - ux-polish
      - future-work

  - id: 10
    entry_type: enhancement
    category: "ux-polish"
    finding: "useUnsavedChangesPrompt could support custom dialog content"
    impact: Medium
    effort: Medium
    content: |
      - **Enhancement**: Accept custom dialog component or message prop for app-specific styling/wording
      - **Impact**: Medium - improved flexibility for different apps
      - **Effort**: Medium - refactor to support customization
      - **Recommendation**: Post-MVP enhancement. Currently hardcoded dialog state management.
    additional_tags:
      - enhancement
      - ux-polish
      - future-work

  - id: 11
    entry_type: enhancement
    category: "feature"
    finding: "Package could include useDebounce / useThrottle"
    impact: High
    effort: Medium
    content: |
      - **Enhancement**: Add useDebounce and useThrottle hooks to package
      - **Impact**: High - common need across apps
      - **Effort**: Medium - estimated 100 LOC + 200 LOC tests each
      - **Recommendation**: Post-MVP story REPA-014b (Priority: High). Out of scope per Non-Goals line 52 but high-value addition.
    additional_tags:
      - enhancement
      - feature
      - post-mvp-candidate
      - high-priority

  - id: 12
    entry_type: enhancement
    category: "feature"
    finding: "Package could include useMediaQuery hook"
    impact: Medium
    effort: Low
    content: |
      - **Enhancement**: Add useMediaQuery hook for responsive behavior
      - **Impact**: Medium - useful for responsive design patterns
      - **Effort**: Low - estimated 50 LOC + tests
      - **Recommendation**: Post-MVP enhancement. May already exist in one of the apps - audit codebase for additional hook consolidation candidates.
    additional_tags:
      - enhancement
      - feature
      - future-work

  - id: 13
    entry_type: enhancement
    category: "edge-case"
    finding: "TypeScript branded types for localStorage keys"
    impact: Low
    effort: Low
    content: |
      - **Enhancement**: Use branded types to prevent typos in localStorage keys: `type LocalStorageKey = string & { __brand: 'localStorage' }`
      - **Impact**: Low - improved type safety
      - **Effort**: Low - add type definitions
      - **Recommendation**: Post-MVP type safety enhancement. Improves safety but adds complexity.
    additional_tags:
      - enhancement
      - edge-case
      - type-safety

  - id: 14
    entry_type: enhancement
    category: "integration"
    finding: "Add error boundary wrapper for browser API hooks"
    impact: Low
    effort: Medium
    content: |
      - **Enhancement**: Wrap hooks that interact with browser APIs (e.g., useLocalStorage) with error boundary or fallback error handling
      - **Impact**: Low - improved robustness
      - **Effort**: Medium - design error handling pattern
      - **Recommendation**: Post-MVP robustness enhancement. useLocalStorage interacts with browser localStorage which can throw in certain contexts (private browsing, quota exceeded).
    additional_tags:
      - enhancement
      - integration
      - error-handling

  - id: 15
    entry_type: enhancement
    category: "developer-experience"
    finding: "Versioning strategy for breaking changes"
    impact: Medium
    effort: Low
    content: |
      - **Enhancement**: Define deprecation and versioning strategy for shared hooks
      - **Impact**: Medium - important once 10+ apps consume hooks
      - **Effort**: Low - documentation and planning
      - **Recommendation**: Post-MVP planning. Once multiple apps consume hooks, breaking changes become costly. Define strategy (e.g., useLocalStorageV2 or feature flags).
    additional_tags:
      - enhancement
      - developer-experience
      - architecture

  - id: 16
    entry_type: finding
    category: "documentation"
    finding: "JSDoc completeness varies across hooks"
    impact: Low
    effort: Low
    content: |
      - **Documentation gap**: useLocalStorage has comprehensive JSDoc with examples. useMultiSelect and useUnsavedChangesPrompt have good coverage. useDelayedShow has minimal JSDoc.
      - **Impact**: Low - documentation consistency
      - **Effort**: Low - standardize JSDoc format
      - **Recommendation**: Post-MVP story REPA-014c (documentation bundle). Standardize JSDoc format and add usage examples for all hooks.
    additional_tags:
      - non-blocking
      - documentation
      - developer-experience

  - id: 17
    entry_type: finding
    category: "documentation"
    finding: "No guidance on when to use each hook"
    impact: Medium
    effort: Low
    content: |
      - **Documentation gap**: README.md mentioned in AC-1 but no requirements for what it should contain. No decision tree or usage guide provided.
      - **Impact**: Medium - developer experience
      - **Effort**: Low - create usage guide
      - **Recommendation**: Post-MVP story REPA-014c (documentation bundle). Add decision tree: "When to use useLocalStorage vs context API?", "When to use useDelayedShow vs CSS transitions?"
    additional_tags:
      - non-blocking
      - documentation
      - developer-experience

  - id: 18
    entry_type: finding
    category: "documentation"
    finding: "No Storybook documentation"
    impact: Medium
    effort: Medium
    content: |
      - **Documentation gap**: Unlike @repo/upload or @repo/gallery, no Storybook examples provided for hooks.
      - **Impact**: Medium - developer experience
      - **Effort**: Medium - create Storybook stories with interactive examples
      - **Recommendation**: Post-MVP story REPA-014c (documentation bundle). Add Storybook stories showing each hook in action with interactive examples.
    additional_tags:
      - non-blocking
      - documentation
      - developer-experience

  - id: 19
    entry_type: finding
    category: "documentation"
    finding: "Missing changelog/migration guide"
    impact: Medium
    effort: Low
    content: |
      - **Documentation gap**: When hooks move from apps to package, developers may have questions about the change.
      - **Impact**: Medium - developer experience
      - **Effort**: Low - create MIGRATION.md
      - **Recommendation**: Post-MVP story REPA-014c (documentation bundle). Create MIGRATION.md documenting the move and any breaking changes (even if none expected).
    additional_tags:
      - non-blocking
      - documentation
      - developer-experience

  - id: 20
    entry_type: finding
    category: "observability"
    finding: "No ESLint rule to prevent re-duplication"
    impact: Medium
    effort: Medium
    content: |
      - **Maintenance gap**: After consolidation, nothing prevents developers from re-implementing these hooks in apps.
      - **Impact**: Medium - could lead to duplication creep
      - **Effort**: Medium - create custom ESLint rule
      - **Recommendation**: Post-MVP story REPA-014e. Add ESLint rule to detect hook duplicates or warn on new hook files in apps/web/**/hooks/ that could be shared.
    additional_tags:
      - non-blocking
      - observability
      - maintenance

summary:
  total_requests: 20
  by_category:
    edge-case: 3
    test-coverage: 2
    documentation: 6
    feature: 3
    ux-polish: 3
    integration: 1
    developer-experience: 1
    observability: 1
  by_priority:
    high: 1  # useDebounce/useThrottle
    medium: 11
    low: 8

post_mvp_story_candidates:
  - id: REPA-014b
    title: "Add useDebounce and useThrottle to @repo/hooks"
    priority: High
    effort: 2 SP
    dependencies: [REPA-014]
    kb_request_ids: [11]

  - id: REPA-014c
    title: "Enhance @repo/hooks Documentation"
    priority: Medium
    effort: 1 SP
    dependencies: [REPA-014]
    kb_request_ids: [16, 17, 18, 19]

  - id: REPA-014d
    title: "Add TTL Support to useLocalStorage"
    priority: Medium
    effort: 2 SP
    dependencies: [REPA-014]
    kb_request_ids: [6]

  - id: REPA-014e
    title: "Prevent Hook Duplication via Linting"
    priority: Low
    effort: 1 SP
    dependencies: [REPA-014]
    kb_request_ids: [20]
