# STORY-SEED.md - REPA-011: Standardize GalleryFilterBar Across Apps

**Story ID:** REPA-011
**Epic:** REPACK (Code Reuse & Package Consolidation)
**Phase:** 2 - Gallery Enhancement
**Priority:** P3 - Low
**Estimate:** 2 story points
**Status:** Pending
**Created:** 2026-02-10

---

## WARNING: No Baseline Reality File

‚ö†Ô∏è **No baseline reality file exists at** `plans/baselines/` for this story.

This seed file was generated by scanning the current codebase state. Context may be incomplete or outdated. Proceed with caution and validate all assumptions during elaboration.

---

## Story Overview

### Feature Summary

Make `GalleryFilterBar` extensible to support app-specific filters by adding a `customFilters` slot. Create a dedicated `BuildStatusFilter` component for the sets gallery and refactor app-sets-gallery to use the shared `GalleryFilterBar` instead of its custom implementation.

### Goal

Single extensible `GalleryFilterBar` used across all gallery apps, eliminating duplicate filter bar implementations while supporting app-specific filter requirements.

### Context from PLAN.md (REPACK-205)

**Current Issue:**
- app-sets-gallery has a custom `GalleryFilterBar` implementation for the build status filter
- This duplicates the core filter bar functionality from `@repo/gallery`
- Should use the shared component with proper extension points

**Why This Matters:**
- Eliminates ~135 lines of duplicate filter bar code
- Establishes pattern for app-specific filter extensions
- Improves consistency across gallery apps
- Reduces maintenance burden

---

## Current State Analysis

### Existing Implementations

#### Shared GalleryFilterBar (`@repo/gallery`)

**Location:** `/packages/core/gallery/src/components/GalleryFilterBar.tsx`

**Current Features:**
- Search input with debounce support
- Tag filter (multi-select)
- Theme filter (single-select dropdown)
- Sort dropdown
- Active filters display with clear all
- Responsive layout (stacks on mobile)
- **Already has `children` prop** for custom filters (store tabs in wishlist)
- **Already has `rightSlot` prop** for view toggle controls

**Key API:**
```typescript
interface GalleryFilterBarProps {
  // Search
  search?: string
  onSearchChange?: (value: string) => void
  onSearch?: (value: string) => void
  searchPlaceholder?: string
  searchAriaLabel?: string

  // Tags
  tags?: string[]
  selectedTags?: string[]
  onTagsChange?: (tags: string[]) => void

  // Themes
  themes?: string[]
  selectedTheme?: string | null
  onThemeChange?: (theme: string | null) => void

  // Sort
  sortOptions?: SortOption[]
  selectedSort?: string
  onSortChange?: (sort: string) => void

  // Extensibility
  children?: React.ReactNode  // Custom filter UI slot (above search/sort)
  rightSlot?: React.ReactNode // Right-aligned controls (same row as filters)

  // Other
  onClearAll?: () => void
  showActiveFilters?: boolean
  className?: string
}
```

**Current Usage Examples:**

1. **app-wishlist-gallery** - Uses `children` for store tabs:
```typescript
<GalleryFilterBar
  search={search}
  onSearchChange={handleSearch}
  tags={availableFilters?.availableTags ?? []}
  selectedTags={selectedTags}
  onTagsChange={handleTagsChange}
  sortOptions={wishlistSortOptions}
  selectedSort={sortValue}
  onSortChange={handleSortChange}
  rightSlot={
    <GalleryViewToggle
      currentView={viewMode}
      onViewChange={setViewMode}
    />
  }
>
  {/* Store Tabs - custom filter UI */}
  <Tabs value={selectedStore ?? 'all'} onValueChange={handleStoreChange}>
    <TabsList>
      <TabsTrigger value="all">All ({counts?.total ?? 0})</TabsTrigger>
      {stores.map(store => (
        <TabsTrigger key={store} value={store}>
          {store} ({storeCounts[store] ?? 0})
        </TabsTrigger>
      ))}
    </TabsList>
  </Tabs>
</GalleryFilterBar>
```

2. **app-instructions-gallery** - Uses `rightSlot` only:
```typescript
<GalleryFilterBar
  search={searchTerm}
  onSearchChange={setSearchTerm}
  searchPlaceholder="Search instructions..."
  rightSlot={
    <GalleryViewToggle
      currentView={viewMode}
      onViewChange={setViewMode}
    />
  }
/>
```

#### Custom GalleryFilterBar (app-sets-gallery)

**Location:** `/apps/web/app-sets-gallery/src/components/GalleryFilterBar.tsx`

**Duplicate Features:**
- Search input (reimplemented)
- Theme dropdown (reimplemented)
- Sort dropdown (reimplemented)
- **Build status filter** (app-specific - the reason for custom implementation)
- Right-aligned children slot (for view toggle)

**Build Status Filter Logic:**
```typescript
export type BuiltFilterValue = 'all' | 'built' | 'unbuilt'

const builtOptions: { value: BuiltFilterValue; label: string }[] = [
  { value: 'all', label: 'All statuses' },
  { value: 'built', label: 'Built' },
  { value: 'unbuilt', label: 'In Pieces' },
]

// In component:
{hasBuiltFilter ? (
  <div className="min-w-[160px]">
    <AppSelect
      options={builtOptions}
      value={builtFilter}
      onValueChange={value => onBuiltFilterChange?.((value as BuiltFilterValue) ?? 'all')}
      aria-label="Filter by build status"
    />
  </div>
) : null}
```

**Current Usage in Sets Main Page:**
```typescript
<GalleryFilterBar
  searchTerm={searchTerm}
  onSearchChange={handleSearchChange}
  themes={availableThemes}
  selectedTheme={theme}
  onThemeChange={handleThemeChange}
  builtFilter={builtFilter}  // App-specific
  onBuiltFilterChange={handleBuiltFilterChange}  // App-specific
  sortField={sortField}
  sortOptions={sortOptions}
  onSortChange={handleSortFieldChange}
>
  <GalleryViewToggle currentView={viewMode} onViewChange={setViewMode} />
</GalleryFilterBar>
```

**Key Differences:**
- Different prop names (searchTerm vs search, sortField vs selectedSort)
- Build status filter hardcoded into component
- No tag filter support
- No active filters display
- Children rendered as right-aligned slot (not custom filter slot)

### Other Gallery Apps

1. **app-inspiration-gallery** - Does NOT use GalleryFilterBar
   - Has custom search/sort/view controls embedded in main page
   - Uses custom Tabs, Input, Select components
   - Candidate for future standardization (out of scope for this story)

---

## Technical Analysis

### Extension Pattern Discovery

**Good News:** The shared `GalleryFilterBar` already has the extension mechanism we need!

The `children` prop is designed for exactly this use case:
- Renders **above** the standard search/sort controls
- Used successfully in wishlist-gallery for store tabs
- Perfect slot for app-specific filters like build status

### What Actually Needs to Change

#### 1. ‚úÖ Extension Slot (Already Exists)

The `children` prop already provides the custom filter slot. No changes needed to GalleryFilterBar API.

#### 2. üÜï Create BuildStatusFilter Component

Extract the build status filter logic into a reusable component:

**Proposed Location:** `/apps/web/app-sets-gallery/src/components/BuildStatusFilter/index.tsx`

**Why app-sets-gallery and not @repo/gallery?**
- Build status is sets-specific domain concept
- Not applicable to wishlist, instructions, or inspiration galleries
- Follows pattern of domain-specific components living in their apps
- If other apps need it later, can promote to shared package

**Component API:**
```typescript
export type BuiltFilterValue = 'all' | 'built' | 'unbuilt'

export interface BuildStatusFilterProps {
  /** Current build status filter value */
  value: BuiltFilterValue
  /** Called when filter value changes */
  onChange: (value: BuiltFilterValue) => void
  /** Optional CSS classes */
  className?: string
  /** Test ID for testing */
  'data-testid'?: string
}

export function BuildStatusFilter({
  value,
  onChange,
  className,
  'data-testid': testId = 'build-status-filter',
}: BuildStatusFilterProps) {
  const options: { value: BuiltFilterValue; label: string }[] = [
    { value: 'all', label: 'All statuses' },
    { value: 'built', label: 'Built' },
    { value: 'unbuilt', label: 'In Pieces' },
  ]

  return (
    <div className={cn('min-w-[160px]', className)} data-testid={testId}>
      <AppSelect
        options={options}
        value={value}
        onValueChange={value => onChange((value as BuiltFilterValue) ?? 'all')}
        aria-label="Filter by build status"
      />
    </div>
  )
}
```

#### 3. üîß Refactor Sets Main Page

Update `/apps/web/app-sets-gallery/src/pages/main-page.tsx`:

**Before (using custom GalleryFilterBar):**
```typescript
import { GalleryFilterBar } from '../components/GalleryFilterBar'

<GalleryFilterBar
  searchTerm={searchTerm}
  onSearchChange={handleSearchChange}
  themes={availableThemes}
  selectedTheme={theme}
  onThemeChange={handleThemeChange}
  builtFilter={builtFilter}
  onBuiltFilterChange={handleBuiltFilterChange}
  sortField={sortField}
  sortOptions={sortOptions}
  onSortChange={handleSortFieldChange}
>
  <GalleryViewToggle currentView={viewMode} onViewChange={setViewMode} />
</GalleryFilterBar>
```

**After (using shared GalleryFilterBar):**
```typescript
import { GalleryFilterBar } from '@repo/gallery'
import { BuildStatusFilter } from '../components/BuildStatusFilter'

<GalleryFilterBar
  search={searchTerm}
  onSearchChange={handleSearchChange}
  searchPlaceholder="Search sets..."
  themes={availableThemes}
  selectedTheme={theme}
  onThemeChange={handleThemeChange}
  themePlaceholder="All themes"
  sortOptions={sortOptions}
  selectedSort={sortField}
  onSortChange={handleSortFieldChange}
  sortPlaceholder="Sort by"
  rightSlot={
    <GalleryViewToggle currentView={viewMode} onViewChange={setViewMode} />
  }
>
  {/* Custom filter slot for build status */}
  <BuildStatusFilter
    value={builtFilter}
    onChange={handleBuiltFilterChange}
  />
</GalleryFilterBar>
```

**Changes Required:**
- Update prop names to match shared API (searchTerm ‚Üí search, sortField ‚Üí selectedSort)
- Move view toggle to `rightSlot` prop
- Add `BuildStatusFilter` to `children` slot
- Import from `@repo/gallery` instead of local component

#### 4. üóëÔ∏è Delete Custom Filter Bar

Remove `/apps/web/app-sets-gallery/src/components/GalleryFilterBar.tsx` (135 lines eliminated)

#### 5. üß™ Update Tests

Update `/apps/web/app-sets-gallery/src/pages/__tests__/main-page.test.tsx`:
- Tests should continue to pass with minimal changes
- Filter behavior remains the same
- May need to update test selectors if data-testid attributes change

---

## Implementation Tasks

### Task 1: Create BuildStatusFilter Component
**Estimate:** 0.5 SP

- [ ] Create directory `/apps/web/app-sets-gallery/src/components/BuildStatusFilter/`
- [ ] Create `index.tsx` with BuildStatusFilter component
- [ ] Create `__types__/index.ts` with Zod schemas
- [ ] Export component from directory

**Files:**
- ‚úèÔ∏è NEW: `apps/web/app-sets-gallery/src/components/BuildStatusFilter/index.tsx`
- ‚úèÔ∏è NEW: `apps/web/app-sets-gallery/src/components/BuildStatusFilter/__types__/index.ts`

### Task 2: Refactor Sets Main Page
**Estimate:** 0.5 SP

- [ ] Update imports to use `@repo/gallery` GalleryFilterBar
- [ ] Import BuildStatusFilter component
- [ ] Update prop names (searchTerm ‚Üí search, sortField ‚Üí selectedSort)
- [ ] Move view toggle to `rightSlot`
- [ ] Add BuildStatusFilter to `children` slot
- [ ] Update any affected prop handlers if needed

**Files:**
- üìù EDIT: `apps/web/app-sets-gallery/src/pages/main-page.tsx`

### Task 3: Delete Custom Filter Bar
**Estimate:** 0.25 SP

- [ ] Remove custom GalleryFilterBar component
- [ ] Verify no other imports reference it
- [ ] Run build to confirm no broken imports

**Files:**
- ‚ùå DELETE: `apps/web/app-sets-gallery/src/components/GalleryFilterBar.tsx`

### Task 4: Update Tests
**Estimate:** 0.25 SP

- [ ] Run existing tests to verify behavior unchanged
- [ ] Update test selectors if needed
- [ ] Add test for BuildStatusFilter if needed
- [ ] Verify all tests pass

**Files:**
- üìù EDIT: `apps/web/app-sets-gallery/src/pages/__tests__/main-page.test.tsx`

### Task 5: Verification & Documentation
**Estimate:** 0.5 SP

- [ ] Manual testing of sets gallery filter bar
- [ ] Verify all filter combinations work (search, theme, build status, sort)
- [ ] Verify view toggle still works
- [ ] Verify responsive layout
- [ ] Run lint and type-check
- [ ] Update story documentation

---

## Acceptance Criteria

### Functional Requirements

- [ ] ‚úÖ **AC1:** BuildStatusFilter component created in app-sets-gallery
- [ ] ‚úÖ **AC2:** Sets gallery uses shared GalleryFilterBar from `@repo/gallery`
- [ ] ‚úÖ **AC3:** Build status filter works via `children` slot
- [ ] ‚úÖ **AC4:** View toggle works via `rightSlot` prop
- [ ] ‚úÖ **AC5:** Custom GalleryFilterBar deleted from app-sets-gallery
- [ ] ‚úÖ **AC6:** All filter behaviors preserved (search, theme, build status, sort)
- [ ] ‚úÖ **AC7:** Responsive layout maintained

### Technical Requirements

- [ ] ‚úÖ **AC8:** No duplicate filter bar code
- [ ] ‚úÖ **AC9:** Uses Zod schemas for BuildStatusFilter types
- [ ] ‚úÖ **AC10:** All existing tests pass
- [ ] ‚úÖ **AC11:** No breaking changes to sets gallery functionality
- [ ] ‚úÖ **AC12:** TypeScript compilation succeeds
- [ ] ‚úÖ **AC13:** ESLint passes with no errors

### Documentation

- [ ] ‚úÖ **AC14:** BuildStatusFilter component has JSDoc comments
- [ ] ‚úÖ **AC15:** Story documentation updated
- [ ] ‚úÖ **AC16:** Usage example documented

---

## Dependencies & Blockers

### Dependencies

**None** - This story is independent and can be implemented immediately.

### Blockers

**None** - All required extension points already exist in the shared GalleryFilterBar.

---

## Risk Assessment

### Technical Risks

**Risk Level:** üü¢ **LOW**

1. **Prop Mapping Complexity** - LOW
   - Simple prop name changes (searchTerm ‚Üí search, sortField ‚Üí selectedSort)
   - Well-documented API in existing component
   - **Mitigation:** Careful review during refactoring, tests will catch issues

2. **Test Updates** - LOW
   - Tests may need selector updates
   - Behavior should be identical
   - **Mitigation:** Run tests frequently during refactoring

3. **Responsive Layout** - LOW
   - Shared GalleryFilterBar already handles responsive layout
   - BuildStatusFilter is simple dropdown
   - **Mitigation:** Manual testing on mobile viewports

### Business Risks

**None** - No user-facing changes, purely internal refactoring.

### Sizing Warnings

**None** - Story is well-scoped at 2 SP, all requirements clear.

---

## Testing Strategy

### Unit Tests

1. **BuildStatusFilter Component**
   - [ ] Renders all three options (All statuses, Built, In Pieces)
   - [ ] Calls onChange with correct value when option selected
   - [ ] Accepts className and data-testid props
   - [ ] Has proper aria-label for accessibility

### Integration Tests

1. **Sets Main Page**
   - [ ] Existing tests pass with shared GalleryFilterBar
   - [ ] Build status filter changes query parameters correctly
   - [ ] Filter combinations work (search + theme + build status + sort)
   - [ ] View toggle interaction unchanged

### Manual Testing Checklist

- [ ] Search filter works
- [ ] Theme filter dropdown works
- [ ] Build status filter dropdown works
- [ ] Sort dropdown works
- [ ] View toggle (grid/datatable) works
- [ ] Filters can be combined
- [ ] Responsive layout on mobile
- [ ] Keyboard navigation works
- [ ] Screen reader accessibility maintained

---

## Success Metrics

### Code Quality Metrics

| Metric | Before | After | Target |
|--------|--------|-------|--------|
| Duplicate filter bar code | 135 lines | 0 lines | 0 lines |
| Custom filter bars | 1 | 0 | 0 |
| Shared component usage | 2/3 apps | 3/3 apps | 3/3 apps |

### Developer Experience

- Sets gallery uses standard `@repo/gallery` components
- Extension pattern documented for future app-specific filters
- Consistent filter API across all gallery apps

---

## Related ADRs & Knowledge Base

### Completed Stories

- **Story 3.0.5:** Gallery Filter Components
  - Created the original shared GalleryFilterBar
  - Established filter component patterns
  - Location: `docs/_archive/completed-stories/3.0.5.gallery-filter-components.md`

### ADRs

**None directly applicable** - This story follows existing patterns.

### Knowledge Base Entries

**From Codebase Scan:**

1. **GalleryFilterBar Extension Pattern**
   - `children` prop for custom filter UI (renders above search/sort)
   - `rightSlot` prop for right-aligned controls (same row as filters)
   - Successfully used in wishlist-gallery for store tabs
   - No ADR documenting this pattern, but implicit in component design

2. **App-Specific Components Location**
   - Domain-specific filters live in app directories (not @repo/gallery)
   - Only promote to shared package if used by multiple apps
   - Example: BuildStatusFilter is sets-specific, stays in app-sets-gallery

---

## Future Opportunities

### Potential Enhancements (Out of Scope)

1. **Active Filters for Build Status**
   - Currently GalleryActiveFilters only shows tags and theme
   - Could extend to show build status filter when active
   - Would require updating activeFilters logic in GalleryFilterBar

2. **Standardize Inspiration Gallery Filters**
   - app-inspiration-gallery has custom filter UI (not using GalleryFilterBar)
   - Could refactor to use shared component with custom slots
   - Larger effort, deferred to REPA-010 or future story

3. **Build Status Filter Reusability**
   - If other galleries need similar "status" filters, could generalize
   - Create StatusFilter component in @repo/gallery
   - Accept options as props instead of hardcoding

4. **Clear All Filters Including Build Status**
   - Sets gallery `onClearAll` should reset build status too
   - May need to pass custom onClearAll handler

---

## Open Questions

**Q1:** Should BuildStatusFilter be tested separately or only via main page tests?
- **Recommendation:** Add basic unit tests for BuildStatusFilter component
- Main page tests already cover integration behavior
- Unit tests ensure component API works correctly in isolation

**Q2:** Should we update the active filters display to include build status?
- **Recommendation:** Defer to future enhancement
- Current behavior (no active filter badge for build status) is acceptable
- Can be added in follow-up story if desired

**Q3:** Should GalleryFilterBar's `children` slot be renamed to `customFilters` for clarity?
- **Recommendation:** No, keep `children` for React convention
- `children` is idiomatic React
- JSDoc comment already clarifies purpose: "Custom filter UI slot"
- Renaming would require updates in wishlist-gallery (scope creep)

---

## Appendix: File Inventory

### Files to Create

1. `apps/web/app-sets-gallery/src/components/BuildStatusFilter/index.tsx` - Component implementation
2. `apps/web/app-sets-gallery/src/components/BuildStatusFilter/__types__/index.ts` - Zod schemas

### Files to Edit

1. `apps/web/app-sets-gallery/src/pages/main-page.tsx` - Refactor to use shared GalleryFilterBar
2. `apps/web/app-sets-gallery/src/pages/__tests__/main-page.test.tsx` - Update tests if needed

### Files to Delete

1. `apps/web/app-sets-gallery/src/components/GalleryFilterBar.tsx` - Custom filter bar (135 lines)

### Files to Review (No Changes)

1. `packages/core/gallery/src/components/GalleryFilterBar.tsx` - Shared component (reference)
2. `apps/web/app-wishlist-gallery/src/pages/main-page.tsx` - Usage example (reference)
3. `apps/web/app-instructions-gallery/src/pages/main-page.tsx` - Usage example (reference)

---

## Next Steps for PM

1. **Review Scope:** Confirm story scope matches expectations (2 SP)
2. **Validate Approach:** Approve BuildStatusFilter component design
3. **Prioritize:** Confirm P3 priority or adjust based on roadmap
4. **Dependencies:** Verify no hidden dependencies discovered in analysis
5. **Elaborate:** If approved, create full story file (REPA-011.md) with this context
6. **Backlog:** Add to Phase 2 backlog or schedule for sprint

---

**Story Seed Author:** PM Story Seed Agent (Claude Sonnet 4.5)
**Generated:** 2026-02-10
**Codebase Snapshot:** Main branch (commit 8f33f014)
**Total Files Scanned:** 12 key files + 93 related documentation files
