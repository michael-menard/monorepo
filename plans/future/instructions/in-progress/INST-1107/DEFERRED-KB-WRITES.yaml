# Deferred Knowledge Base Writes
# Generated by elab-autonomous-decider when KB unavailable
# These findings should be logged to KB when service becomes available

story_id: INST-1107
generated_at: "2026-02-07T00:00:00Z"
kb_status: unavailable
total_deferred: 16

deferred_writes:
  # Non-Blocking Gaps (6 items)
  - entry_type: finding
    source_stage: elab
    category: "future-opportunities"
    subcategory: "gaps-non-blocking"
    tags: ["non-blocking", "optimization", "caching"]
    content: |
      **Presigned URL Caching Consideration**
      - Finding: Story says "no caching" but doesn't explain why URLs expire in 15 minutes. Future optimization could cache for 10 minutes with refresh mechanism.
      - Impact: Low
      - Effort: Medium
      - Recommendation: Document reasoning: security vs UX tradeoff. Consider longer expiry (30-60 min) for large files in future story.

  - entry_type: finding
    source_stage: elab
    category: "future-opportunities"
    subcategory: "gaps-non-blocking"
    tags: ["non-blocking", "observability", "analytics"]
    content: |
      **Download Analytics Missing**
      - Finding: No metrics for which files are downloaded, failure rates, or popular content.
      - Impact: Low
      - Effort: Low
      - Recommendation: Add CloudWatch metrics in INST-3082 (Download History/Analytics). Track: download count per file, success rate, average presigned URL generation time.
      - Related Story: INST-3082

  - entry_type: finding
    source_stage: elab
    category: "future-opportunities"
    subcategory: "gaps-non-blocking"
    tags: ["non-blocking", "security", "rate-limiting"]
    content: |
      **Rate Limiting Not Specified**
      - Finding: Story doesn't mention rate limits on download endpoint. Could be abused for DDoS or cost attacks.
      - Impact: Medium
      - Effort: Low
      - Recommendation: Add rate limiting in Phase 2 (INST-1203: Rate Limiting & Observability). Suggest: 100 downloads per user per 5 minutes.
      - Related Story: INST-1203

  - entry_type: finding
    source_stage: elab
    category: "future-opportunities"
    subcategory: "gaps-non-blocking"
    tags: ["non-blocking", "infrastructure", "cors"]
    content: |
      **CORS Edge Case**
      - Finding: Story mentions "verify S3 CORS" but doesn't provide CORS config. New deployment environments might miss this.
      - Impact: Medium
      - Effort: Low
      - Recommendation: Document S3 CORS config in infrastructure notes or deployment checklist. Headers: GET allowed, Access-Control-Allow-Origin set.

  - entry_type: finding
    source_stage: elab
    category: "future-opportunities"
    subcategory: "gaps-non-blocking"
    tags: ["non-blocking", "ux", "content-type"]
    content: |
      **Content-Type Handling**
      - Finding: Story uses ResponseContentDisposition for filename but doesn't set ResponseContentType. Browser may guess incorrectly.
      - Impact: Low
      - Effort: Low
      - Recommendation: Future: Set ResponseContentType based on file.mimeType in presigned URL. Ensures PDFs open correctly, CSVs download.

  - entry_type: finding
    source_stage: elab
    category: "future-opportunities"
    subcategory: "gaps-non-blocking"
    tags: ["non-blocking", "ux-polish", "expiry-warning"]
    content: |
      **Download Link Expiry Warning**
      - Finding: User has no indication that presigned URL expires in 15 minutes. Could lead to confusion if shared or delayed.
      - Impact: Low
      - Effort: Medium
      - Recommendation: INST-3081: Show countdown timer or warning if URL older than 10 minutes.
      - Related Story: INST-3081

  # Enhancement Opportunities (10 items)
  - entry_type: finding
    source_stage: elab
    category: "future-opportunities"
    subcategory: "enhancement"
    tags: ["enhancement", "ux-polish", "sharing"]
    content: |
      **Copy Download Link Feature**
      - Finding: Power users might want to share presigned URLs within org (expires in 15 min).
      - Impact: Medium
      - Effort: Low
      - Recommendation: INST-3083: Add "Copy Link" button next to Download. Shows expiry time. Useful for team collaboration.
      - Related Story: INST-3083

  - entry_type: finding
    source_stage: elab
    category: "future-opportunities"
    subcategory: "enhancement"
    tags: ["enhancement", "mobile", "qr-code"]
    content: |
      **QR Code for Mobile Downloads**
      - Finding: Scan QR code on desktop, download on phone.
      - Impact: Low
      - Effort: Low
      - Recommendation: INST-3084: Generate QR code from presigned URL. Useful for large files easier to handle on mobile.
      - Related Story: INST-3084

  - entry_type: finding
    source_stage: elab
    category: "future-opportunities"
    subcategory: "enhancement"
    tags: ["enhancement", "batch-operations", "high-impact"]
    content: |
      **Batch Download (ZIP)**
      - Finding: Mentioned as non-goal but highly requested feature. Users want "Download All Files" button.
      - Impact: High
      - Effort: High
      - Recommendation: INST-3080: Backend generates ZIP file from multiple S3 objects, returns presigned URL for ZIP. Requires S3 Lambda or streaming ZIP generation.
      - Related Story: INST-3080
      - Note: Explicitly deferred in story Non-Goals

  - entry_type: finding
    source_stage: elab
    category: "future-opportunities"
    subcategory: "enhancement"
    tags: ["enhancement", "ux-polish", "progress-tracking"]
    content: |
      **Download Progress Tracking**
      - Finding: Story says "browser handles this" but no custom progress UI. Large files (50MB) would benefit from in-app progress.
      - Impact: Medium
      - Effort: Medium
      - Recommendation: INST-3081: Track download progress using Fetch API with progress events. Show percentage and speed.
      - Related Story: INST-3081
      - Note: Explicitly deferred in story Non-Goals

  - entry_type: finding
    source_stage: elab
    category: "future-opportunities"
    subcategory: "enhancement"
    tags: ["enhancement", "ux-polish", "preview"]
    content: |
      **File Preview Before Download**
      - Finding: PDF thumbnails or previews would improve UX. User confirms correct file before downloading.
      - Impact: Medium
      - Effort: High
      - Recommendation: INST-3085: Generate PDF thumbnails (first page) on upload. Display in file list. Click to preview, button to download.
      - Related Story: INST-3085

  - entry_type: finding
    source_stage: elab
    category: "future-opportunities"
    subcategory: "enhancement"
    tags: ["enhancement", "performance", "cdn"]
    content: |
      **Download Speed Optimization**
      - Finding: S3 direct download is fine but could use CloudFront for global users.
      - Impact: Low
      - Effort: Medium
      - Recommendation: INST-3086: Route downloads through CloudFront signed URLs instead of S3 presigned URLs. Faster for international users.
      - Related Story: INST-3086
      - Note: Explicitly deferred in story Non-Goals (CDN delivery)

  - entry_type: finding
    source_stage: elab
    category: "future-opportunities"
    subcategory: "enhancement"
    tags: ["enhancement", "notifications", "async-processing"]
    content: |
      **Download Notifications**
      - Finding: Email or push notification when large file ready (if async processing added).
      - Impact: Low
      - Effort: Low
      - Recommendation: INST-3087: If file processing (compression, format conversion) added, notify user when ready. Not needed for direct downloads.
      - Related Story: INST-3087

  - entry_type: finding
    source_stage: elab
    category: "future-opportunities"
    subcategory: "enhancement"
    tags: ["enhancement", "security", "integrity"]
    content: |
      **File Integrity Check**
      - Finding: Verify file not corrupted with checksum (MD5 or SHA256).
      - Impact: Low
      - Effort: Medium
      - Recommendation: INST-3088: Store file checksum in database during upload. Display checksum on download page. User can verify after download.
      - Related Story: INST-3088

  - entry_type: finding
    source_stage: elab
    category: "future-opportunities"
    subcategory: "enhancement"
    tags: ["enhancement", "analytics", "history"]
    content: |
      **Download History Tracking**
      - Finding: Track which files user downloaded and when. Useful for auditing or recommendations.
      - Impact: Medium
      - Effort: Low
      - Recommendation: INST-3082: Store download events in database. Show "Downloaded 2 days ago" in file list. Privacy consideration: PII.
      - Related Story: INST-3082

  - entry_type: finding
    source_stage: elab
    category: "future-opportunities"
    subcategory: "enhancement"
    tags: ["enhancement", "performance", "resume-support"]
    content: |
      **Partial Downloads / Resume Support**
      - Finding: S3 supports range requests. Could enable resume for interrupted downloads.
      - Impact: Low
      - Effort: Medium
      - Recommendation: INST-3089: Add Accept-Ranges header to presigned URL. Browser handles resume automatically. Useful for large files on unstable connections.
      - Related Story: INST-3089

notes:
  - "KB service unavailable at time of elaboration (2026-02-07)"
  - "These findings are non-blocking and do not prevent story from proceeding to implementation"
  - "When KB becomes available, import these entries for future reference and story planning"
  - "All findings extracted from FUTURE-OPPORTUNITIES.md during Phase 1 analysis"
  - "Related story IDs (INST-3080 through INST-3089) are already referenced in story Non-Goals and Future Opportunities sections"
