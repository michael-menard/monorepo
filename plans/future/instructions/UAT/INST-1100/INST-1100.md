---
status: uat
story_id: INST-1100
title: View MOC Gallery
epic: instructions
phase: 1
blocked_by: INST-1008
dependencies:
  - INST-1008
created: 2026-02-05
updated: 2026-02-07
elaborated: 2026-02-05
size_estimate: 3
---

# INST-1100: View MOC Gallery

## Context

The instructions gallery frontend app (`apps/web/app-instructions-gallery`) already exists with a main-page.tsx that uses `useGetInstructionsQuery` to fetch MOC data. The backend has a working `GET /mocs` endpoint in `apps/api/lego-api/domains/instructions/routes.ts` that returns paginated MOC lists with filtering capabilities (search, type, status, theme).

However, the RTK Query hooks in `@repo/api-client` for MOC operations are not yet fully wired (pending INST-1008). The existing gallery page needs refinement to match the established patterns from wishlist-gallery, including consistent use of `@repo/gallery` components, proper loading states, empty state handling, and responsive grid layout.

The database schema (`MocInstructionsSchema` in `apps/api/lego-api/domains/instructions/types.ts`) is comprehensive and includes all necessary fields. Sample MOC data exists in `packages/backend/database-schema/src/seeds/mocs.ts`.

## Goal

Create a polished MOC gallery page that allows users to browse their MOC collection with a responsive grid layout, loading states, and empty state handling, following the established patterns from wishlist-gallery.

## Non-Goals

- Creating new MOCs (deferred to INST-1102)
- Editing or deleting MOCs (deferred to INST-1108, INST-1109)
- File upload functionality (deferred to INST-1103, INST-1104, INST-1105)
- Advanced filtering or search beyond basic API params (deferred to Phase 6)
- Numbered pagination or infinite scroll (simple limit/offset sufficient for MVP)
- Drag-to-reorder functionality (deferred to future phase)
- **Protected Features**: Do not modify the existing `MocInstructionsSchema` or database schema

## Scope

### Frontend

**App**: `apps/web/app-instructions-gallery`

**Files**:
- `src/pages/GalleryPage.tsx` (refactor existing `main-page.tsx` if needed)
- `src/components/InstructionCard/index.tsx` (minor updates for gallery context)
- `apps/web/main-app/src/routes/` (ensure `/mocs` route is wired)

**Components to Reuse**:
- `@repo/gallery`: `GalleryGrid`, `GalleryEmptyState`, `GallerySkeleton`, `GalleryFilterBar` (optional), `GalleryViewToggle` (optional)
- `@repo/app-component-library`: `CustomButton`, `Card`
- Existing `InstructionCard` component

### Backend

**Endpoint**: `GET /mocs` (already exists)
- Path: `/mocs` (proxied via APIGW as `/api/v2/mocs`)
- Auth: Required (JWT Bearer token)
- Query params: `page`, `limit`, `search`, `type`, `status`, `theme`
- Response: `{ items: MocInstructions[], total: number, page: number, limit: number }`

**Files** (minimal changes):
- `apps/api/lego-api/domains/instructions/routes.ts` - verify response shape
- Ensure `instructionsService.listMocs` joins `moc_files` for thumbnail URLs

### API Client

**RTK Query Hook** (dependency on INST-1008):
- `packages/core/api-client/src/rtk/mocs-api.ts` (or `instructions-api.ts`)
- `useGetMocsQuery` (or `useGetInstructionsQuery` if equivalent)
- Pattern: Follow `wishlist-gallery-api.ts` structure

### Database

**Tables queried**:
- `moc_instructions` - filtered by `userId`
- `moc_files` - joined for thumbnail URLs

**Performance**: Verify index exists on `moc_instructions.user_id`

## Acceptance Criteria

### Core Display
- [ ] AC-1: Gallery page at `/mocs` displays all user's MOCs in a responsive grid
- [ ] AC-2: Each MOC card shows thumbnail (or placeholder), title, piece count, and theme
- [ ] AC-3: Grid is responsive:
  - Mobile (â‰¤640px): 1 column
  - Tablet (641-1024px): 2 columns
  - Desktop (>1024px): 3-4 columns

### Empty State
- [ ] AC-4: Empty state displays when user has no MOCs
- [ ] AC-5: Empty state includes "Create your first MOC" CTA button
- [ ] AC-6: CTA button links to create page (or shows "Coming soon" if INST-1102 not implemented)

### Loading States
- [ ] AC-7: Loading skeleton states show while fetching data
- [ ] AC-8: Skeleton uses `GallerySkeleton` component from `@repo/gallery`
- [ ] AC-9: Skeleton is replaced with actual cards when data loads

### API Integration
- [ ] AC-10: Gallery uses `useGetMocsQuery` (or `useGetInstructionsQuery`) from `@repo/api-client`
- [ ] AC-11: API call includes query params: `page=1`, `limit=50`
- [ ] AC-12: Response is validated with Zod schema
- [ ] AC-13: Thumbnail URLs are retrieved from `moc_files` table or `mocs.thumbnailUrl` field

### Error Handling
- [ ] AC-14: API errors display user-friendly error message
- [ ] AC-15: Retry option available on error (via error state component)
- [ ] AC-16: Auth errors (401) redirect to login page

### Accessibility
- [ ] AC-17: Gallery has `role="region"` and `aria-label="MOC Gallery"`
- [ ] AC-18: Loading state announced to screen readers: "Loading MOCs..."
- [ ] AC-19: Empty state message announced to screen readers
- [ ] AC-20: MOC cards are keyboard navigable (Tab key)
- [ ] AC-21: Cards activate with Enter or Space key

### Performance
- [ ] AC-22: Gallery loads in <2 seconds with 50 MOCs
- [ ] AC-23: No memory leaks (verified with React DevTools Profiler)
- [ ] AC-24: Lighthouse performance score >70

## Reuse Plan

### Components
- **@repo/gallery**: Reuse `GalleryGrid`, `GalleryEmptyState`, `GallerySkeleton` (exact pattern from wishlist-gallery)
- **@repo/app-component-library**: Reuse `CustomButton` for CTA, `Card` for wrappers if needed
- **Existing InstructionCard**: Update props if needed to support gallery context

### Patterns
- **RTK Query**: Copy pattern from `packages/core/api-client/src/rtk/wishlist-gallery-api.ts`
  - `providesTags` for cache invalidation
  - `transformResponse` with Zod validation
  - `getServerlessCacheConfig('medium')` for performance
- **Gallery Layout**: Copy from `apps/web/app-wishlist-gallery/src/pages/main-page.tsx`
  - Responsive grid with view mode state
  - Empty state with CTA
  - Loading skeleton pattern

### Packages
- `@repo/api-client` - RTK Query hooks
- `@repo/gallery` - Gallery components
- `@repo/app-component-library` - UI primitives
- `@repo/logger` - Logging

## Architecture Notes

### Component Structure
```
apps/web/app-instructions-gallery/src/pages/GalleryPage.tsx
â”œâ”€â”€ Uses useGetMocsQuery (from @repo/api-client)
â”œâ”€â”€ Manages view state (loading, error, empty, success)
â”œâ”€â”€ Renders GalleryGrid (from @repo/gallery)
â”‚   â””â”€â”€ Maps mocs.map(moc => <InstructionCard moc={moc} />)
â”œâ”€â”€ Renders GalleryEmptyState (from @repo/gallery)
â”‚   â””â”€â”€ Shows CTA: <CustomButton>Create your first MOC</CustomButton>
â””â”€â”€ Renders GallerySkeleton (from @repo/gallery)
```

### Data Flow
```
User navigates to /mocs
  â†“
React Router loads GalleryPage component
  â†“
useGetMocsQuery() fetches GET /mocs (RTK Query)
  â†“
Backend: apps/api/lego-api/domains/instructions/routes.ts
  â†“
instructionsService.listMocs(userId, {page, limit}, filters)
  â†“
Database query: moc_instructions JOIN moc_files (for thumbnails)
  â†“
Response: { items: [...], total, page, limit }
  â†“
transformResponse: MocListResponseSchema.parse(response)
  â†“
RTK Query cache updated, providesTags: ['Mocs', ...MocItem[]]
  â†“
GalleryPage re-renders with data
  â†“
GalleryGrid displays InstructionCard components
```

### RTK Query Setup
```typescript
// packages/core/api-client/src/rtk/mocs-api.ts (or instructions-api.ts)

export const mocsApi = createApi({
  reducerPath: 'mocsApi',
  baseQuery: createServerlessBaseQuery({ enableJwtAuth: true }),
  tagTypes: ['Mocs', 'MocItem'],
  endpoints: builder => ({
    getMocs: builder.query<MocListResponse, Partial<MocQueryParams>>({
      query: params => ({
        url: '/mocs',
        params: {
          page: params.page ?? 1,
          limit: params.limit ?? 50,
          search: params.search,
          type: params.type,
          status: params.status,
          theme: params.theme,
        },
      }),
      transformResponse: (response: unknown) => MocListResponseSchema.parse(response),
      providesTags: result =>
        result
          ? [
              ...result.items.map(({ id }) => ({ type: 'MocItem' as const, id })),
              { type: 'Mocs', id: 'LIST' },
            ]
          : [{ type: 'Mocs', id: 'LIST' }],
      ...getServerlessCacheConfig('medium'),
    }),
  }),
})

export const { useGetMocsQuery } = mocsApi
```

## Infrastructure Notes

### Database Indexes
**Required**: Index on `moc_instructions.user_id` for query performance

```sql
-- Verify index exists
SELECT indexname, indexdef
FROM pg_indexes
WHERE tablename = 'moc_instructions'
  AND indexdef LIKE '%user_id%';

-- If missing, add:
CREATE INDEX idx_moc_instructions_user_id ON moc_instructions(user_id);
```

### API Gateway Configuration
- Route: `/mocs` â†’ Lambda: `lego-api` â†’ Function: `instructions.routes.ts`
- Auth: JWT validation via Cognito Authorizer
- CORS: Ensure `/mocs` endpoint has CORS headers

### CloudFront/CDN
- Thumbnail URLs served from S3 via CloudFront distribution
- No configuration changes needed (already set up)

## HTTP Contract Plan

### GET /mocs

**Request**:
```http
GET /mocs?page=1&limit=50&search=castle&theme=Castle
Authorization: Bearer <jwt-token>
```

**Query Parameters**:
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| page | number | No | Page number (default: 1) |
| limit | number | No | Items per page (default: 50) |
| search | string | No | Search query (title, description) |
| type | string | No | Filter by type ('moc', 'set') |
| status | string | No | Filter by status ('draft', 'published', 'archived') |
| theme | string | No | Filter by theme ('Castle', 'Space', etc.) |

**Response** (200 OK):
```json
{
  "items": [
    {
      "id": "dddddddd-dddd-dddd-dddd-dddddddd0001",
      "userId": "dev-user-...",
      "title": "King's Castle",
      "description": "A majestic medieval castle...",
      "type": "moc",
      "thumbnailUrl": "https://cdn.example.com/...",
      "partsCount": 2500,
      "theme": "Castle",
      "tags": ["castle", "medieval", "modular"],
      "status": "published",
      "createdAt": "2026-01-15T00:00:00.000Z",
      "updatedAt": "2026-01-15T00:00:00.000Z"
    }
  ],
  "total": 1,
  "page": 1,
  "limit": 50
}
```

**Error Responses**:
- `401 Unauthorized`: Missing or invalid JWT token
- `400 Bad Request`: Invalid query parameters (Zod validation failure)
- `500 Internal Server Error`: Database query failure or service error

### Zod Schema Validation

**Request Query Schema**:
```typescript
const ListMocsQuerySchema = z.object({
  page: z.coerce.number().int().min(1).default(1),
  limit: z.coerce.number().int().min(1).max(100).default(50),
  search: z.string().optional(),
  type: InstructionTypeSchema.optional(),
  status: StatusSchema.optional(),
  theme: z.string().optional(),
})
```

**Response Schema**:
```typescript
const MocListResponseSchema = z.object({
  items: z.array(MocInstructionsSchema),
  total: z.number().int(),
  page: z.number().int(),
  limit: z.number().int(),
})
```

## Test Plan

### Unit Tests

**Location**: `apps/web/app-instructions-gallery/src/pages/__tests__/GalleryPage.test.tsx`

**Test Cases**:
1. Renders grid layout with GalleryGrid component
2. Shows empty state when no MOCs (mocked empty response)
3. Displays MOC cards with correct data (thumbnail, title, piece count, theme)
4. Shows loading skeletons during fetch (isLoading: true)
5. Handles missing thumbnailUrl with placeholder image

**Framework**: Vitest + React Testing Library

### Integration Tests

**Location**: `apps/web/app-instructions-gallery/src/pages/__tests__/GalleryPage.integration.test.tsx`

**Test Cases**:
1. API call fetches MOC list via useGetMocsQuery
2. Error state displays on API failure (500 response)
3. Auth error (401) triggers redirect to login
4. Sort parameter passed correctly to API
5. Zod validation error handled gracefully

**Framework**: Vitest + MSW (Mock Service Worker)

**MSW Handler Example**:
```typescript
http.get('/mocs', () => {
  return HttpResponse.json({
    items: [
      { id: '1', title: 'Castle', thumbnailUrl: 'url', partsCount: 100, theme: 'Castle' }
    ],
    total: 1,
    page: 1,
    limit: 50
  })
})
```

### E2E Tests (Playwright)

**Feature File**: `apps/web/playwright/features/instructions/inst-1100-gallery.feature`

**Scenarios**:
1. **Display user's MOC collection**:
   - Given user has 5 MOCs
   - When user navigates to /mocs
   - Then gallery displays 5 MOC cards
   - And each card shows thumbnail, title, piece count, theme
   - And grid is responsive (test at 375px, 768px, 1024px)

2. **Empty gallery state**:
   - Given user has no MOCs
   - When user navigates to /mocs
   - Then empty state displays
   - And "Create your first MOC" button is visible

3. **Gallery loading state**:
   - Given API response delayed by 1 second
   - When user navigates to /mocs
   - Then loading skeletons display
   - And MOC cards appear after delay

**Steps File**: `apps/web/playwright/steps/inst-1100-gallery.steps.ts`

## UI/UX Notes

### Design System Compliance

**Colors** (token-only):
- Card background: `bg-background` or `bg-lego-sky-50`
- Card border: `border-lego-sky-300`
- Text: `text-foreground` or `text-lego-gray-900`
- Accents: `text-lego-teal-700` for theme/piece count

**Components** (via @repo/app-component-library):
- `CustomButton` for CTA button
- Do NOT import shadcn primitives directly

### Responsive Grid

**Breakpoints**:
- Mobile (â‰¤640px): `grid-cols-1`
- Tablet (641-1024px): `grid-cols-2`
- Desktop (>1024px): `grid-cols-3 lg:grid-cols-4`

**Grid Gap**: `gap-4 md:gap-6`

### Card Design

**Pattern** (match wishlist-gallery):
```tsx
<div className="group relative overflow-hidden rounded-lg border border-lego-sky-300 bg-background shadow-sm transition-shadow hover:shadow-lg">
  <div className="aspect-video overflow-hidden">
    <img src={thumbnailUrl || placeholderImage} alt={title} className="h-full w-full object-cover" />
  </div>
  <div className="p-4">
    <h3 className="text-lg font-semibold text-foreground">{title}</h3>
    <p className="text-sm text-lego-gray-600">{partsCount} pieces</p>
    <p className="text-sm text-lego-teal-700">{theme}</p>
  </div>
</div>
```

### Accessibility

**ARIA Labels**:
- Gallery region: `<div role="region" aria-label="MOC Gallery">`
- Loading: `<div aria-live="polite">Loading MOCs...</div>`
- Empty state: `<div role="status" aria-live="polite">No MOCs found...</div>`
- Card: `aria-label="{title}, {partsCount} pieces, {theme} theme"`

**Keyboard Navigation**:
- Cards focusable with `tabIndex={0}`
- Activate with Enter or Space
- Focus visible with `focus:ring-2 focus:ring-lego-teal-500`

## Reality Baseline

### What Exists (Confirmed)

**Backend**:
- âœ… `GET /mocs` endpoint in `apps/api/lego-api/domains/instructions/routes.ts`
- âœ… `instructionsService.listMocs()` with pagination and filtering
- âœ… `MocInstructionsSchema` in types.ts (comprehensive Zod schema)
- âœ… Seed data in `packages/backend/database-schema/src/seeds/mocs.ts`

**Frontend**:
- âœ… `apps/web/app-instructions-gallery` app structure
- âœ… `src/pages/main-page.tsx` (uses `useGetInstructionsQuery`)
- âœ… `src/components/InstructionCard` component
- âœ… `@repo/gallery` package with reusable components

**Database**:
- âœ… `moc_instructions` table (schema defined)
- âœ… `moc_files` table (for thumbnails and other files)

### What Is In-Progress

- ðŸš§ **INST-1008**: Wire RTK Query Mutations (status: ready-to-work)
  - Blocks: `useGetMocsQuery` hook may not exist yet
  - Resolution: Complete INST-1008 first, or expand INST-1100 scope to include RTK wiring

### Established Patterns to Follow

- **RTK Query**: Use `wishlist-gallery-api.ts` as template
- **Gallery Layout**: Use `app-wishlist-gallery/main-page.tsx` as pattern
- **Zod Schemas**: All types inferred from Zod (no interfaces)
- **Import Rules**: Always use `@repo/app-component-library`, never `@repo/ui` directly
- **Logging**: Use `@repo/logger`, never `console.log`

### Changed Constraints

None identified.

### Protected Features (Do Not Modify)

- `MocInstructionsSchema` - comprehensive schema already defined
- Database schema (`moc_instructions`, `moc_files` tables)
- Backend `instructionsService` interface (only verify, do not refactor)

---

## Story Size Estimate

**Size**: 3 points

**Justification**:
- Backend already exists (minimal changes)
- Gallery components exist and are reusable
- Primary work: Wire RTK Query, refactor main-page.tsx, add tests
- Dependency on INST-1008 (may expand scope)
- Testing: Unit, integration, E2E required

**Breakdown**:
- RTK Query wiring: 0.5 points (if INST-1008 done) or 1 point (if included here)
- Frontend refactor: 1 point
- Testing: 1 point
- Documentation: 0.5 points

---

## Dependencies and Blockers

### Blocked By
- **INST-1008**: Wire RTK Query Mutations
  - Status: ready-to-work
  - Impact: `useGetMocsQuery` hook may not exist
  - Resolution: Complete INST-1008 first, or expand INST-1100 scope

### Depends On
- âœ… INST-1003: Extract Upload Types Package (Completed 2024-12-26)
- âœ… INST-1004: Extract Upload Config Package (Completed 2025-12-09)
- ðŸš§ INST-1008: Wire RTK Query Mutations (ready-to-work)

### Unblocks
- INST-1101: View MOC Details (depends on gallery for navigation)
- INST-1102: Create Basic MOC (CTA from empty state)

---

## Notes for Implementer

1. **Check INST-1008 status**: If not completed, either wait or expand this story to include RTK Query wiring
2. **Verify endpoint response**: Ensure `GET /mocs` returns `thumbnailUrl` in response
3. **Reuse existing components**: Do NOT create new gallery components - use `@repo/gallery`
4. **Follow wishlist pattern**: Copy RTK Query and layout patterns from wishlist-gallery
5. **Test responsive design**: Verify grid at 375px, 768px, 1024px, 1440px breakpoints
6. **Accessibility first**: Ensure keyboard navigation and screen reader support from the start

---

**Generated**: 2026-02-05
**PM**: Claude Sonnet 4.5
**Workers**: Test Plan Writer (Haiku), UI/UX Advisor (Haiku), Dev Feasibility (Haiku)

---

## Review Findings

> **Review Date:** 2026-02-05T23:30:00Z
> **Reviewed By:** Claude Code
> **Gate:** CONCERNS (score: 68/100)
> **Gate File:** plans/future/instructions/ready-for-qa/INST-1100/REVIEW.yaml

### T-Shirt Size Estimate

**Recommended Size: M** (Confidence: high)

**Specialist Breakdown:**
| Specialist | Size | Rationale |
|------------|------|-----------|
| Requirements | L | 24 ACs, 3 gaps (auth redirect, keyboard, performance manual) |
| Code Quality | M | Moderate complexity, some Zod schema issues |
| Security | M | Open redirect vulnerabilities via window.location.href |
| Performance | M | O(nÂ²) lookup in grid, missing React.memo |
| Accessibility | M | Search input lacks label, hover-only actions |
| Test Coverage | L | Search/filter functionality not tested |
| Tech Debt | M | TODOs for unimplemented features, manual schema mapping |

**Size Distribution:** XS: 0, S: 0, **M: 5**, L: 2, XL: 0, XXL: 0

**Synthesis:**
Modal size is M (5/7 specialists). Requirements and Test Coverage flagged as L due to 24 acceptance criteria scope and gaps in test coverage for search functionality. Overall recommendation: **M** with awareness that testing effort and AC coverage drive complexity.

---

### Summary

- **Files Analyzed:** 4 (main-page.tsx, main-page.test.tsx, inst-1100-gallery.spec.ts, InstructionCard)
- **Total Findings:** 75 (high: 8, medium: 25, low: 42)
- **Traceability:** 21/24 acceptance criteria have test coverage

### Required Checks

| Check | Status |
|-------|--------|
| Tests | PASS |
| Types | PASS |
| Lint  | PASS |

### Requirements Traceability

- **[REQ-001] medium:** AC-16 (Auth errors redirect to login) - No direct test, relies on RTK base query
  - **File:** N/A
  - **Action:** Add integration test for 401 handling

- **[REQ-002] medium:** AC-20/21 (Keyboard navigation) - E2E test exists but is defensive
  - **File:** inst-1100-gallery.spec.ts
  - **Action:** Add unit tests for keyboard handlers

- **[REQ-003] low:** AC-22/23/24 (Performance) - Manual verification required
  - **File:** N/A
  - **Action:** Document performance testing procedure

### Code Quality

- **[QUAL-001] high:** TypeScript `Instruction` interface used instead of Zod schema
  - **File:** apps/web/app-instructions-gallery/src/__types__/index.ts
  - **Action:** Convert to Zod schema per CLAUDE.md guidelines

- **[QUAL-002] medium:** Inline button in error state instead of Button component
  - **File:** apps/web/app-instructions-gallery/src/pages/main-page.tsx:164
  - **Action:** Replace with Button from @repo/app-component-library

- **[QUAL-003] medium:** O(nÂ²) lookup pattern in grid rendering
  - **File:** apps/web/app-instructions-gallery/src/pages/main-page.tsx:246
  - **Action:** Create Map for O(1) lookup or use useMemo

- **[QUAL-004] low:** Multiple useState calls could be consolidated
  - **File:** apps/web/app-instructions-gallery/src/pages/main-page.tsx:42-43
  - **Action:** Consider useReducer for related state

### Security

- **[SEC-001] medium:** Open redirect via window.location.href (edit handler)
  - **File:** apps/web/app-instructions-gallery/src/pages/main-page.tsx:100
  - **Action:** Use React Router navigate() for internal navigation

- **[SEC-002] medium:** Open redirect via window.location.href (card click)
  - **File:** apps/web/app-instructions-gallery/src/pages/main-page.tsx:106
  - **Action:** Use React Router navigate() for internal navigation

- **[SEC-003] medium:** Open redirect via window.location.href (empty state CTA)
  - **File:** apps/web/app-instructions-gallery/src/pages/main-page.tsx:236
  - **Action:** Use React Router navigate() for internal navigation

- **[SEC-004] medium:** Open redirect via window.location.href (datatable row)
  - **File:** apps/web/app-instructions-gallery/src/pages/main-page.tsx:275
  - **Action:** Use React Router navigate() for internal navigation

### Performance

- **[PERF-001] high:** O(nÂ²) complexity in grid rendering
  - **File:** apps/web/app-instructions-gallery/src/pages/main-page.tsx:245-246
  - **Impact:** Performance degrades significantly with 50+ items
  - **Action:** Convert instructions array to Map for O(1) lookups

- **[PERF-002] medium:** InstructionCard not wrapped in React.memo
  - **File:** apps/web/app-instructions-gallery/src/components/InstructionCard/index.tsx
  - **Impact:** Unnecessary re-renders on parent state changes
  - **Action:** Wrap component with React.memo

- **[PERF-003] medium:** handleFavorite/handleEdit/handleCardClick recreated on every render
  - **File:** apps/web/app-instructions-gallery/src/pages/main-page.tsx:86-108
  - **Impact:** Breaks React.memo optimization
  - **Action:** Already using useCallback - verify stable dependencies

- **[PERF-004] low:** Filtering applied on every render without throttle
  - **File:** apps/web/app-instructions-gallery/src/pages/main-page.tsx:129-133
  - **Impact:** Minor - useMemo already applied
  - **Action:** No action needed for current scale

### Accessibility

- **[A11Y-001] high:** Search input lacks associated label
  - **File:** apps/web/app-instructions-gallery/src/pages/main-page.tsx:196-208
  - **WCAG:** 1.3.1 Info and Relationships
  - **Action:** Add aria-label or visible label to GalleryFilterBar search input

- **[A11Y-002] medium:** Favorite/edit actions only visible on hover
  - **File:** apps/web/app-instructions-gallery/src/components/InstructionCard/index.tsx
  - **WCAG:** 2.1.1 Keyboard
  - **Action:** Make actions accessible via focus, not just hover

- **[A11Y-003] medium:** Loading skeleton count hardcoded to 12
  - **File:** apps/web/app-instructions-gallery/src/pages/main-page.tsx:224
  - **WCAG:** N/A
  - **Action:** Consider matching expected data count or viewport

- **[A11Y-004] low:** Empty state CTA button could use aria-describedby
  - **File:** apps/web/app-instructions-gallery/src/pages/main-page.tsx:229-241
  - **WCAG:** 1.3.1 Info and Relationships
  - **Action:** Add aria-describedby linking to description text

### Test Coverage

- **[TEST-001] high:** Search/filter functionality not unit tested
  - **File:** apps/web/app-instructions-gallery/src/pages/__tests__/main-page.test.tsx
  - **Action:** Add tests for searchTerm state changes and filtering

- **[TEST-002] high:** Card click handlers not tested
  - **File:** apps/web/app-instructions-gallery/src/pages/__tests__/main-page.test.tsx
  - **Action:** Add tests for handleFavorite, handleEdit, handleCardClick

- **[TEST-003] medium:** E2E tests use defensive .catch() patterns
  - **File:** apps/web/playwright/tests/instructions/inst-1100-gallery.spec.ts
  - **Action:** Use more specific assertions; tests may pass when they should fail

- **[TEST-004] medium:** No integration test for RTK Query cache behavior
  - **File:** N/A
  - **Action:** Add test for cache invalidation on mutations

- **[TEST-005] low:** Mock data uses hardcoded UUIDs
  - **File:** apps/web/app-instructions-gallery/src/pages/__tests__/main-page.test.tsx:57
  - **Action:** Consider using faker or uuid() for test data

### Technical Debt

- **[DEBT-001] high:** TODO comment for unimplemented favorite toggle mutation
  - **File:** apps/web/app-instructions-gallery/src/pages/main-page.tsx:87
  - **Effort:** small
  - **Action:** Track as follow-up story when backend mutation available

- **[DEBT-002] high:** Manual schema field mapping between API and local state
  - **File:** apps/web/app-instructions-gallery/src/pages/main-page.tsx:55-70
  - **Effort:** medium
  - **Action:** Align frontend Instruction type with MocInstructions schema

- **[DEBT-003] medium:** Hardcoded defaults in tableItems transformation
  - **File:** apps/web/app-instructions-gallery/src/pages/main-page.tsx:119-120
  - **Effort:** small
  - **Action:** Wire difficulty/status from API response

- **[DEBT-004] medium:** Temporary defaults comments indicate unfinished wiring
  - **File:** apps/web/app-instructions-gallery/src/pages/main-page.tsx:118
  - **Effort:** small
  - **Action:** Complete API wiring or remove unused fields

- **[DEBT-005] low:** View mode URL sync could use URLSearchParams API consistently
  - **File:** apps/web/app-instructions-gallery/src/pages/main-page.tsx:141-146
  - **Effort:** small
  - **Action:** Consolidate URL handling

### Recommendation

âš  **Review Required** - Address high-severity issues and proceed with awareness.

**Priority fixes before marking as Done:**
1. PERF-001: Fix O(nÂ²) lookup in grid rendering
2. A11Y-001: Add label to search input
3. TEST-001/002: Add tests for search and card handlers
4. QUAL-001: Convert Instruction interface to Zod schema

**Acceptable to defer:**
- SEC-001-004: Open redirect (low risk for internal navigation)
- DEBT-001: Favorite toggle (blocked by backend)
- DEBT-002: Schema alignment (larger refactor)

---

## QA Discovery Notes (for PM Review)

_Added by QA Elaboration on 2026-02-05_

### Gaps Identified

| # | Finding | User Decision | Notes |
|---|---------|---------------|-------|
| 1 | RTK Query hook dependency on INST-1008 | **Wait for INST-1008** - Keep dependency, INST-1008 must complete before INST-1100 starts | Story correctly documents both options. User elected to wait for dependency completion rather than expanding scope. |
| 2 | Hook naming clarity - `useGetMocsQuery` vs `useGetInstructionsQuery` | **Accept both as equivalent** - Document that both hooks exist and are equivalent; implementer can use either | INST-1008 code review confirms both hook names are created and point to same backend `/mocs` endpoint. Story accepts both as valid. |

### Enhancement Opportunities

| # | Finding | User Decision | Notes |
|---|---------|---------------|-------|
| 1 | View mode toggle (grid/datatable) | Not Reviewed | Already partially implemented in main-page.tsx, marked optional in story. Can extend scope if needed. |
| 2 | Filter UI for status, type, theme | Not Reviewed | Backend supports it; frontend exposure deferred to Phase 6. Out of scope for MVP. |
| 3 | Pagination UI controls | Not Reviewed | Story uses simple limit/offset; pagination UI deferred to Phase 2-3. Not critical for MVP. |
| 4 | Image lazy loading | Not Reviewed | Enhancement for performance; can be added in Phase 2. Not blocking. |
| 5 | Thumbnail placeholder specification | Not Reviewed | Story mentions placeholder but doesn't specify source. Design system placeholder should be used. |

### Follow-up Stories Suggested

- [ ] INST-1101: View MOC Details
- [ ] INST-1102: Create Basic MOC
- [ ] INST-1103: Upload MOC File
- [ ] INST-1104: Delete MOC File
- [ ] INST-1105: Download MOC File

### Items Marked Out-of-Scope

- **Creating new MOCs**: Deferred to INST-1102
- **Editing or deleting MOCs**: Deferred to INST-1108, INST-1109
- **File upload functionality**: Deferred to INST-1103, INST-1104, INST-1105
- **Advanced filtering or search**: Deferred to Phase 6
- **Pagination UI**: Simple limit/offset sufficient for MVP
- **Database schema modifications**: Protected feature
