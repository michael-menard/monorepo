schema: 2
feature_dir: "/Users/michaelmenard/Development/Monorepo/plans/future/sets"
prefix: "SETS"
project_name: "sets"
analyzed: "2026-01-25T23:58:00Z"

overall_goal: |
  Enable users to catalog and manage their LEGO and alt-brick set collection, tracking ownership details, build status, and purchase information, with seamless integration to the Wishlist "Got it" flow.

phases:
  - id: 1
    name: "Foundation"
    description: "Core infrastructure, API endpoints, and data model implementation"
  - id: 2
    name: "CRUD Operations"
    description: "Complete create, read, update, and delete functionality for set management"
  - id: 3
    name: "Wishlist Integration"
    description: "Implement 'Got it' flow to transfer items from Wishlist to Sets with purchase details"
  - id: 4
    name: "Advanced Features"
    description: "Build status tracking, quantity management, MOC linking, and duplicate detection"
  - id: 5
    name: "UX & Polish"
    description: "Mobile responsiveness, accessibility, empty states, and interaction refinements"

stories:
  - id: "SETS-1005"
    title: "Add Modal with URL Scrape Flow"
    feature: "Implement add modal with URL paste, product info scraping (shared scraper with Wishlist), and manual entry option"
    phase: 2
    depends_on: []
    endpoints:
      - "POST /api/scraper/product (shared)"
    infrastructure:
      - "Shared scraper service"
      - "S3 for image storage"
    goal: "Enable users to add sets via URL with automatic data population"
    risk_notes: "Depends on shared scraper service reliability; must handle scraper failures gracefully"
    sizing_warning: false

  - id: "SETS-1006"
    title: "Purchase Details Step with Build Status"
    feature: "Add purchase details form (price, tax, shipping, date, quantity) with build status choice during set creation"
    phase: 2
    depends_on: ["SETS-1005"]
    endpoints: []
    infrastructure: []
    goal: "Capture complete purchase information and initial build status when adding sets"
    risk_notes: "Low risk; straightforward form UI"
    sizing_warning: false

  - id: "SETS-1007"
    title: "Sets CRUD API Endpoints"
    feature: "Implement backend API endpoints for creating, reading, updating, and deleting set items with full data model support"
    phase: 1
    depends_on: []
    endpoints:
      - "POST /api/sets"
      - "GET /api/sets"
      - "GET /api/sets/:id"
      - "PATCH /api/sets/:id"
      - "DELETE /api/sets/:id"
    infrastructure:
      - "Aurora PostgreSQL table: sets"
      - "Database indexes for userId, setNumber"
    goal: "Provide complete backend API for set collection management"
    risk_notes: "Must ensure atomic transactions for Wishlist integration; proper indexing needed for performance"
    sizing_warning: true

  - id: "SETS-1008"
    title: "Wishlist 'Got it' Integration"
    feature: "Implement atomic transaction flow to transfer wishlist items to sets with purchase details modal and undo capability"
    phase: 3
    depends_on: ["SETS-1007", "SETS-1006"]
    endpoints:
      - "POST /api/sets/from-wishlist"
      - "DELETE /api/wishlist/:id"
    infrastructure: []
    goal: "Enable seamless transition of wishlist items to owned sets with traceability"
    risk_notes: "High complexity: requires atomic transaction (create Set before deleting Wishlist), rollback handling, and undo support; cross-epic dependency on Wishlist"
    sizing_warning: true

  - id: "SETS-1009"
    title: "Build Status Toggle with Optimistic Updates"
    feature: "Implement build status toggle (In Pieces/Built) with optimistic UI updates, celebration animation, undo toast, and error handling"
    phase: 4
    depends_on: ["SETS-1007"]
    endpoints:
      - "PATCH /api/sets/:id/build-status"
    infrastructure: []
    goal: "Provide quick, responsive build status tracking with delightful UX"
    risk_notes: "Optimistic updates require careful state management and rollback on failure"
    sizing_warning: false

  - id: "SETS-1010"
    title: "Quantity Stepper with Minimum Enforcement"
    feature: "Implement quantity adjustment controls (+/- buttons, direct edit) with minimum of 1, optimistic updates, and undo support"
    phase: 4
    depends_on: ["SETS-1007"]
    endpoints:
      - "PATCH /api/sets/:id/quantity"
    infrastructure: []
    goal: "Enable users to track multiple copies of the same set with intuitive controls"
    risk_notes: "Must handle edge case where user tries to decrement below 1 (prompt to delete instead)"
    sizing_warning: false

  - id: "SETS-1011"
    title: "MOC Linking Picker and Display"
    feature: "Implement MOC picker modal (searchable, multi-select) and bidirectional display of set-to-MOC relationships"
    phase: 4
    depends_on: ["SETS-1007"]
    endpoints:
      - "POST /api/sets/:id/moc-links"
      - "DELETE /api/sets/:id/moc-links/:mocId"
      - "GET /api/mocs (for picker)"
    infrastructure:
      - "Many-to-many join table: set_moc_links"
    goal: "Enable users to track which sets were used in which MOC builds"
    risk_notes: "Cross-epic dependency on MOC Instructions; requires bidirectional updates"
    sizing_warning: false

  - id: "SETS-1012"
    title: "Hard Delete with Confirmation"
    feature: "Implement permanent set deletion with confirmation modal ('This is permanent') and proper cleanup of relationships"
    phase: 2
    depends_on: ["SETS-1007"]
    endpoints:
      - "DELETE /api/sets/:id (already in 1007)"
    infrastructure: []
    goal: "Allow users to remove sets from collection with appropriate safeguards"
    risk_notes: "Must cascade delete MOC links and handle wishlistItemId references properly"
    sizing_warning: false

  - id: "SETS-1013"
    title: "Manual Entry Form"
    feature: "Implement full manual entry form for sets when URL scraping is not available or desired"
    phase: 2
    depends_on: ["SETS-1005"]
    endpoints: []
    infrastructure: []
    goal: "Provide fallback method for adding sets without URL scraping"
    risk_notes: "Low risk; standard form implementation"
    sizing_warning: false

  - id: "SETS-1014"
    title: "Sort and Filter by Build Status"
    feature: "Extend gallery sorting and filtering to include build status (All/Built/In Pieces) and purchase date"
    phase: 5
    depends_on: ["SETS-1007"]
    endpoints:
      - "GET /api/sets (with query params)"
    infrastructure: []
    goal: "Enable users to organize and view their collection by build status and purchase timeline"
    risk_notes: "Depends on shared gallery package implementation"
    sizing_warning: false

  - id: "SETS-1015"
    title: "Tag Management Integration"
    feature: "Integrate shared tag management system for categorizing sets with user-defined tags"
    phase: 5
    depends_on: ["SETS-1007"]
    endpoints:
      - "POST /api/sets/:id/tags"
      - "DELETE /api/sets/:id/tags/:tagId"
    infrastructure:
      - "Shared tags system"
    goal: "Enable flexible, user-defined categorization of set collection"
    risk_notes: "Depends on shared tag management package availability"
    sizing_warning: false

  - id: "SETS-1016"
    title: "Collection Stats Display"
    feature: "Implement collection statistics dashboard (total sets, unique sets, total pieces, total value)"
    phase: 5
    depends_on: ["SETS-1007"]
    endpoints:
      - "GET /api/sets/stats"
    infrastructure: []
    goal: "Provide users with overview insights into their collection"
    risk_notes: "Future enhancement; low priority; may need performance optimization for large collections"
    sizing_warning: false

  - id: "SETS-1017"
    title: "Empty States for All Scenarios"
    feature: "Implement empty state designs for: new collection, no results, filtered views, no MOC links, etc."
    phase: 5
    depends_on: []
    endpoints: []
    infrastructure: []
    goal: "Provide helpful guidance and CTAs when no content is available"
    risk_notes: "Low risk; pure UI implementation"
    sizing_warning: false

  - id: "SETS-1018"
    title: "Duplicate Set Detection"
    feature: "Detect when user adds a set that already exists and prompt: add to quantity vs. create new entry with different purchase details"
    phase: 4
    depends_on: ["SETS-1005", "SETS-1010"]
    endpoints:
      - "GET /api/sets/check-duplicate"
    infrastructure: []
    goal: "Prevent unintentional duplicates while allowing intentional separate entries for different purchases"
    risk_notes: "UX complexity: must clearly explain the two options to users"
    sizing_warning: false

  - id: "SETS-1019"
    title: "Keyboard Navigation and Accessibility"
    feature: "Implement full keyboard shortcuts (B for toggle, +/- for quantity, M for MOC link, A for add) and screen reader support"
    phase: 5
    depends_on: ["SETS-1009", "SETS-1010", "SETS-1011"]
    endpoints: []
    infrastructure: []
    goal: "Ensure Sets Gallery is fully accessible via keyboard and screen readers"
    risk_notes: "Requires careful focus management and ARIA implementation"
    sizing_warning: false

  - id: "SETS-1020"
    title: "Mobile Responsive with Swipe Actions"
    feature: "Implement mobile-optimized responsive design with bottom sheets, touch targets, and swipe gestures for build status toggle"
    phase: 5
    depends_on: ["SETS-1009"]
    endpoints: []
    infrastructure: []
    goal: "Provide optimal mobile experience for Sets Gallery on touch devices"
    risk_notes: "Touch gesture implementation requires careful testing across devices"
    sizing_warning: false

  - id: "SETS-1021"
    title: "Got it Success Experience"
    feature: "Implement delightful success flow when item comes from Wishlist: highlight new item, scroll to position, show toast with View/Undo"
    phase: 3
    depends_on: ["SETS-1008"]
    endpoints: []
    infrastructure: []
    goal: "Create satisfying feedback loop when transitioning items from wishlist to collection"
    risk_notes: "Animation and scroll behavior must work across all viewport sizes"
    sizing_warning: false

dependencies:
  graph:
    "SETS-1005": []
    "SETS-1006": ["SETS-1005"]
    "SETS-1007": []
    "SETS-1008": ["SETS-1007", "SETS-1006"]
    "SETS-1009": ["SETS-1007"]
    "SETS-1010": ["SETS-1007"]
    "SETS-1011": ["SETS-1007"]
    "SETS-1012": ["SETS-1007"]
    "SETS-1013": ["SETS-1005"]
    "SETS-1014": ["SETS-1007"]
    "SETS-1015": ["SETS-1007"]
    "SETS-1016": ["SETS-1007"]
    "SETS-1017": []
    "SETS-1018": ["SETS-1005", "SETS-1010"]
    "SETS-1019": ["SETS-1009", "SETS-1010", "SETS-1011"]
    "SETS-1020": ["SETS-1009"]
    "SETS-1021": ["SETS-1008"]

  critical_path:
    - "SETS-1007"
    - "SETS-1006"
    - "SETS-1008"
    - "SETS-1021"

  critical_path_length: 4

parallelization:
  max_parallel: 6
  groups:
    - stories: ["SETS-1005", "SETS-1007", "SETS-1017"]
      after: null
      description: "Foundation: API, UI scaffolding, and empty states can proceed independently"
    - stories: ["SETS-1006", "SETS-1013"]
      after: "group_1"
      description: "Forms: Purchase details and manual entry depend on add modal"
    - stories: ["SETS-1009", "SETS-1010", "SETS-1011", "SETS-1012", "SETS-1014", "SETS-1015"]
      after: "group_1"
      description: "CRUD features: All depend on SETS-1007 API but can proceed in parallel"
    - stories: ["SETS-1008"]
      after: "group_2"
      description: "Wishlist integration: Depends on API and purchase details form"
    - stories: ["SETS-1018"]
      after: "group_3"
      description: "Duplicate detection: Needs add modal and quantity management"
    - stories: ["SETS-1019", "SETS-1020", "SETS-1021"]
      after: "group_4"
      description: "Polish: Accessibility, mobile, and success experience after core features"
    - stories: ["SETS-1016"]
      after: "group_3"
      description: "Stats: Can implement after core CRUD is complete"

risks:
  - id: "RISK-001"
    description: "Wishlist 'Got it' transaction atomicity: Must ensure Set creation succeeds before Wishlist deletion to prevent data loss"
    affected_stories: ["SETS-1008", "SETS-1021"]
    severity: high
    mitigation: "Implement transaction-based flow with rollback handling; maintain wishlistItemId reference for traceability"

  - id: "RISK-002"
    description: "Shared scraper service dependency: Sets relies on scraper shared with Wishlist; failures or changes impact both features"
    affected_stories: ["SETS-1005"]
    severity: medium
    mitigation: "Modular design with graceful degradation to manual entry; monitor scraper health"

  - id: "RISK-003"
    description: "Cross-epic dependencies: Sets depends on Wishlist (for 'Got it' flow) and MOC Instructions (for linking)"
    affected_stories: ["SETS-1008", "SETS-1011", "SETS-1021"]
    severity: medium
    mitigation: "Coordinate with Wishlist and MOC teams; ensure API contracts are stable; build integration stories last"

  - id: "RISK-004"
    description: "Optimistic UI updates complexity: Build status toggle and quantity changes require careful state management and rollback on failure"
    affected_stories: ["SETS-1009", "SETS-1010"]
    severity: medium
    mitigation: "Implement robust error handling with UI revert; comprehensive testing of failure scenarios"

  - id: "RISK-005"
    description: "Large collection performance: Gallery rendering and filtering may slow down with hundreds or thousands of sets"
    affected_stories: ["SETS-1007", "SETS-1014", "SETS-1016"]
    severity: low
    mitigation: "Implement pagination and virtualized list; proper database indexing on userId and setNumber"

  - id: "RISK-006"
    description: "Duplicate detection UX confusion: Users may not understand difference between 'add to quantity' vs 'new entry'"
    affected_stories: ["SETS-1018"]
    severity: low
    mitigation: "Clear modal copy with examples; user testing to validate understanding"

metrics:
  total_stories: 17
  phases: 5
  max_parallel: 6
  critical_path_length: 4
  stories_with_sizing_warnings: 2
  estimated_completion_phases: 5
  backend_stories: 5
  frontend_stories: 10
  integration_stories: 2
