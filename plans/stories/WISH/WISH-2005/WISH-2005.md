---
doc_type: story
title: "WISH-2005: UX Polish"
story_id: WISH-2005
story_prefix: WISH
status: Draft
phase: 4
created_at: "2026-01-24T02:00:00-07:00"
updated_at: "2026-01-24T02:00:00-07:00"
depends_on: [WISH-2002, WISH-2003, WISH-2004]
estimated_points: 5
---

# WISH-2005: UX Polish

## Goal

Deliver polished UX with drag-and-drop priority reordering and thoughtful empty states.

## Feature

Drag-and-drop reordering with dnd-kit, PATCH reorder endpoint, optimistic updates, empty states, loading skeletons.

## Phase

Phase 4: UX Polish

## Acceptance Criteria

- [ ] PATCH `/api/wishlist/reorder` endpoint updates sortOrder
- [ ] dnd-kit setup with PointerSensor (8px threshold), TouchSensor (300ms long-press), KeyboardSensor
- [ ] SortableContext with rectSortingStrategy
- [ ] Visual feedback during drag (ghost image, drop zone highlight)
- [ ] Optimistic update on drop with undo (5-second window)
- [ ] Empty state for new user: "Nothing on your wishlist yet" with Add CTA
- [ ] Empty state for all purchased: "You got everything!" with Add More CTA
- [ ] Empty state for no results: "No matches" with Clear Filters button
- [ ] Loading skeletons match card layout
- [ ] Touch support for mobile drag-and-drop

## Risk Notes

dnd-kit integration can be complex; touch support on mobile needs thorough testing.

## Technical Details

### Backend (API)

**Location:** `apps/api/endpoints/wishlist/reorder/handler.ts`

**PATCH /api/wishlist/reorder**

Updates the `sortOrder` field for items to reorder them.

Request body:
```json
{
  "items": [
    { "id": "uuid", "sortOrder": 0 },
    { "id": "uuid", "sortOrder": 1 },
    { "id": "uuid", "sortOrder": 2 }
  ]
}
```

Response: `200 OK` with updated items array

Transaction: Update all items in single batch query for consistency.

### Frontend (React)

**Locations:**
- `apps/web/app-wishlist-gallery/src/components/DraggableWishlistGallery.tsx`
- `apps/web/app-wishlist-gallery/src/components/SortableWishlistCard.tsx`
- `apps/web/app-wishlist-gallery/src/components/EmptyStates.tsx`
- `apps/web/app-wishlist-gallery/src/hooks/useDragAndDrop.ts`

**Drag-and-Drop Implementation**

Use dnd-kit library with:
- **PointerSensor:** 8px pointer movement threshold (for mouse)
- **TouchSensor:** 300ms long-press activation (for touch)
- **KeyboardSensor:** Arrow keys to reorder (accessibility)

Gallery layout:
- Grid container with sortable items
- Each card wrapped in SortableWishlistCard with dnd-kit integration
- Visual feedback: semi-transparent ghost during drag, highlight drop zone

**Visual Feedback**

- Dragging item: 0.5 opacity, scale 1.02
- Drop zone: Subtle background highlight
- Animation: Smooth transition when item snaps to position
- Touch target size: At least 44px for mobile

**Optimistic Updates**

- Update UI immediately on drop
- Send PATCH request to backend
- If request fails: Show error toast, revert items to previous order
- Undo action available for 5 seconds

**Empty States**

Component: `EmptyStates.tsx`

Three variants:

1. **New User** (no items ever added)
   - Illustration: Empty wishlist icon
   - Heading: "Nothing on your wishlist yet"
   - Description: "Add items you want to purchase"
   - CTA: "Start Browsing" → Add Item form

2. **All Purchased** (had items, now all purchased)
   - Illustration: Celebration/checked icon
   - Heading: "You got everything!"
   - Description: "Congratulations on your purchases!"
   - CTA: "Add More" → Add Item form

3. **No Filter Matches** (items exist, but no matches for filters)
   - Illustration: Magnifying glass icon
   - Heading: "No matches"
   - Description: "Try adjusting your filters or search"
   - CTA: "Clear Filters" → Reset filters

**Loading Skeletons**

- Match WishlistCard layout
- Show 6 skeleton cards on initial load
- Pulse animation
- Placeholder image area, title area, metadata areas

### RTK Query Integration

**Location:** `packages/core/api-client/src/rtk/wishlist-api.ts`

Mutation:
- `useReorderWishlistMutation()` - PATCH reorder endpoint

## Dependencies

- **Depends On:** WISH-2002 (Add), WISH-2003 (Edit), WISH-2004 (Delete)
- **Unblocks:** WISH-2006 (Accessibility)

## Reuse Plan

- Use `dnd-kit` library (already in project dependencies or add as new)
- Use `@repo/app-component-library` for card, button, icon primitives
- Create reusable `EmptyStates` component for other galleries
- Use RTK Query mutation patterns

## Test Coverage

**Backend Tests:**
- Reorder updates sortOrder correctly
- Batch update in transaction
- Invalid item IDs rejected
- Unauthorized user rejected

**Frontend Tests:**
- Drag and drop works with pointer
- Drag and drop works with touch
- Optimistic update reflects changes
- Undo works within 5 seconds
- Empty states render correctly
- Loading skeletons visible during fetch
- Keyboard navigation with arrow keys (+ WISH-2006)

**E2E Tests:**
- User can drag item to new position
- Reorder persists after page reload
- User can undo reorder
- Empty states show at appropriate times
- Loading skeletons visible on slow network

## Definition of Done

- [ ] PATCH reorder endpoint created
- [ ] dnd-kit configured and working
- [ ] Drag-and-drop visual feedback complete
- [ ] Optimistic updates with undo
- [ ] Empty states implemented and styled
- [ ] Loading skeletons rendered
- [ ] Mobile touch support tested
- [ ] All tests passing
- [ ] Code reviewed
- [ ] Ready for WISH-2006

## Token Budget

### Phase Summary

| Phase | Estimated | Actual | Delta | Notes |
|-------|-----------|--------|-------|-------|
| Story Gen | ~6k | — | — | — |
| Elaboration | ~10k | — | — | dnd-kit learning |
| Implementation | ~22k | — | — | D&D + empty states |
| Code Review | ~8k | — | — | — |
| **Total** | ~46k | — | — | — |

### Actual Measurements

| Date | Phase | Before | After | Delta | Notes |
|------|-------|--------|-------|-------|-------|

## Agent Log

Append-only.

| Timestamp (America/Denver) | Agent | Action | Outputs |
|---|---|---|---|
| 2026-01-24 02:00 | pm-bootstrap-generation-leader | Created story file | WISH-2005.md |
