---
doc_type: story
title: "WISH-2000: Database Schema & Types"
story_id: WISH-2000
story_prefix: WISH
status: Ready for Review
phase: 1
created_at: "2026-01-24T02:00:00-07:00"
updated_at: "2026-01-24T02:00:00-07:00"
depends_on: []
estimated_points: 3
---

# WISH-2000: Database Schema & Types

## Goal

Establish data model foundation for wishlist items with runtime validation and type safety.

## Feature

Drizzle schema for `wishlist_items` table with all PRD fields, Zod schemas in shared package, TypeScript types via `z.infer`.

## Phase

Phase 1: Foundation

## Acceptance Criteria

- [ ] Drizzle schema includes all fields: id, userId, title, store, setNumber, sourceUrl, imageUrl, price, currency, pieceCount, releaseDate, tags, priority, notes, sortOrder, timestamps
- [ ] Zod schemas created: `WishlistItemSchema`, `CreateWishlistItemSchema`, `UpdateWishlistItemSchema`, `WishlistQueryParamsSchema`, `WishlistListResponseSchema`
- [ ] 31+ unit tests for schema validation
- [ ] TypeScript types inferred via `z.infer`

## Risk Notes

Schema must support all PRD fields; changes after migration are costly.

## Technical Details

### Database Schema

**Location:** `apps/api/core/database/schema/wishlist.ts`

Table: `wishlist_items`

| Column | Type | Required | Default | Notes |
|--------|------|----------|---------|-------|
| id | UUID | Yes | random | Primary key |
| userId | text | Yes | — | Foreign key to users |
| title | text | Yes | — | Item name |
| store | text | Yes | — | LEGO, Barweer, Cata, BrickLink, Other |
| setNumber | text | No | — | Set identification |
| sourceUrl | text | No | — | URL where item was found |
| imageUrl | text | No | — | S3 URL for image |
| price | decimal(10,2) | No | — | Item cost |
| currency | text | No | USD | Currency code |
| pieceCount | integer | No | — | Number of pieces |
| releaseDate | timestamp | No | — | Release date |
| tags | text[] | No | [] | User-defined tags |
| priority | integer | No | 0 | Priority level 0-5 |
| notes | text | No | — | User notes |
| sortOrder | integer | No | 0 | Manual sort order |
| createdAt | timestamp | Yes | now | Creation timestamp |
| updatedAt | timestamp | Yes | now | Update timestamp |

**Indexes:**
- Primary key: `id`
- User query: `(userId, createdAt DESC)`
- Sorting: `(userId, sortOrder)`

### Zod Schemas

**Location:** `packages/core/api-client/src/schemas/wishlist.ts`

Required schemas:
1. `WishlistItemSchema` - Full item with all fields
2. `CreateWishlistItemSchema` - Required fields for creation
3. `UpdateWishlistItemSchema` - Partial update fields
4. `WishlistQueryParamsSchema` - Query filters and pagination
5. `WishlistListResponseSchema` - Paginated list response

### Test Coverage

Minimum 31 test cases covering:
- Field validation (required vs optional)
- Type coercion
- Default values
- Array handling (tags)
- Timestamp formats
- Numeric ranges (price, priority, piece count)
- String length constraints
- Enum validation (store, currency)

## Dependencies

None - this is foundation work.

## Reuse Plan

- Use existing Drizzle patterns from `apps/api/core/database/schema`
- Follow Zod schema structure from other epics (Sets, Instructions)
- No per-story one-off utilities

## Definition of Done

- [ ] Drizzle schema file created and compiles
- [ ] Zod schemas created with correct types
- [ ] All 31+ tests pass
- [ ] TypeScript strict mode passes
- [ ] Code review completed
- [ ] Ready for WISH-2007

## Token Budget

### Phase Summary

| Phase | Estimated | Actual | Delta | Notes |
|-------|-----------|--------|-------|-------|
| Story Gen | ~5k | — | — | — |
| Elaboration | ~8k | — | — | — |
| Implementation | ~12k | — | — | — |
| Code Review | ~5k | — | — | — |
| **Total** | ~30k | — | — | — |

### Actual Measurements

| Date | Phase | Before | After | Delta | Notes |
|------|-------|--------|-------|-------|-------|

## Agent Log

Append-only.

| Timestamp (America/Denver) | Agent | Action | Outputs |
|---|---|---|---|
| 2026-01-24 02:00 | pm-bootstrap-generation-leader | Created story file | WISH-2000.md |
