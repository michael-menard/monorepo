---
status: uat
---

# wrkf-1000: Package Scaffolding

## Context

The LangGraph Orchestrator project requires a new TypeScript package to house the orchestration runtime, graph definitions, and adapters. This is the foundational story that establishes the workspace package before any LangGraph-specific code is added.

The monorepo already has established patterns for backend packages (e.g., `@repo/lambda-utils`, `@repo/logger`) which this story will follow.

---

## Goal

Create the `packages/orchestrator` workspace package with proper TypeScript configuration, pnpm workspace integration, and LangGraphJS dependencies installed and importable.

---

## Non-Goals

- **NOT** implementing GraphState schema (that is wrkf-1010)
- **NOT** implementing any LangGraph nodes or graphs
- **NOT** adding adapters (OpenCode, MCP tools)
- **NOT** adding subgraph definitions
- **NOT** creating any runtime logic beyond placeholder exports

---

## Scope

### Endpoints and Surfaces

**None.** This is a pure TypeScript library package with no API endpoints.

### Packages/Apps Affected

| Package/App | Change Type |
|-------------|-------------|
| `packages/orchestrator` | **NEW** — Create entire package |
| Root `package.json` | MODIFY — Add workspace path |

---

## Acceptance Criteria

- [ ] **AC-1:** `packages/orchestrator/` directory exists with valid structure
- [ ] **AC-2:** `package.json` defines name as `@repo/orchestrator` with version `0.0.1`
- [ ] **AC-3:** `tsconfig.json` extends repo patterns with `strict: true` and `declaration: true`
- [ ] **AC-4:** `@langchain/langgraph` and `@langchain/core` are listed in dependencies
- [ ] **AC-5:** `zod` is listed in dependencies
- [ ] **AC-6:** `pnpm install` succeeds from monorepo root
- [ ] **AC-7:** `pnpm build --filter @repo/orchestrator` succeeds and produces `dist/`
- [ ] **AC-8:** `pnpm test --filter @repo/orchestrator` runs at least one passing test
- [ ] **AC-9:** Package can be imported as `import { version } from '@repo/orchestrator'`
- [ ] **AC-10:** Root `package.json` workspaces array includes `packages/orchestrator`

---

## Reuse Plan

### Existing Packages to Reuse

| Package | Usage |
|---------|-------|
| `@repo/logger` | Future: Logging within orchestrator nodes |
| Root `zod` | Schema definitions (will use workspace zod) |

### New Shared Code Created

| Export | Purpose | Consumers |
|--------|---------|-----------|
| `version` | Package version constant | Internal diagnostics |
| (Placeholder) | Future GraphState exports | wrkf-1010+ |

### Prohibited Patterns

- ❌ `console.log` — must use `@repo/logger` in future stories
- ❌ TypeScript interfaces without Zod
- ❌ Barrel files (single index.ts export is allowed)

---

## Architecture Notes (Ports & Adapters)

### Package Structure

```
packages/orchestrator/
├── package.json
├── tsconfig.json
├── vitest.config.ts
├── src/
│   ├── index.ts              # Main exports
│   └── __tests__/
│       └── index.test.ts     # Smoke test
└── dist/                      # Generated
```

### Future Structure (for reference only)

```
packages/orchestrator/
├── src/
│   ├── index.ts
│   ├── state/                 # wrkf-1010: GraphState schemas
│   ├── nodes/                 # wrkf-1020: Node infrastructure
│   ├── adapters/              # wrkf-1110+: OpenCode, MCP
│   └── graphs/                # wrkf-1030+: Subgraph definitions
```

This story only creates the root structure. Subdirectories are added in subsequent stories.

---

## Required Vercel / Infra Notes

**None.** This package is not deployed directly. It is consumed by other packages/apps at build time.

---

## HTTP Contract Plan

**Not applicable.** This story does not expose or consume any HTTP endpoints.

---

## Seed Requirements

**Not applicable.** No database entities or seed data required.

---

## Test Plan (Happy Path / Error Cases / Edge Cases)

### Happy Path Tests

| ID | Test | Evidence |
|----|------|----------|
| HP-1 | Package compiles with `pnpm build --filter @repo/orchestrator` | Terminal output showing success |
| HP-2 | Package appears in `pnpm list --filter @repo/orchestrator` | pnpm list output |
| HP-3 | Import resolves: `import { version } from '@repo/orchestrator'` | Type-check passes |
| HP-4 | Dependencies installed: langgraph, core, zod | pnpm list --depth 0 output |

### Error Cases

| ID | Test | Evidence |
|----|------|----------|
| EC-1 | TypeScript strict mode enabled (`strict: true`) | tsconfig.json content |

### Edge Cases

| ID | Test | Evidence |
|----|------|----------|
| EDGE-1 | Turborepo caches build correctly | Second build shows "FULL TURBO" |
| EDGE-2 | Clean rebuild works after dist removal | Terminal output |

### Evidence Requirements

- **Build output:** Copy/paste `pnpm build --filter @repo/orchestrator` terminal output
- **Test output:** Copy/paste `pnpm test --filter @repo/orchestrator` terminal output
- **Dependency list:** Copy/paste `pnpm list --filter @repo/orchestrator --depth 0`

---

## Demo Script

1. `cd /path/to/monorepo`
2. `pnpm install` — Verify no errors
3. `pnpm list --filter @repo/orchestrator` — Verify package exists
4. `pnpm build --filter @repo/orchestrator` — Verify build succeeds
5. `pnpm test --filter @repo/orchestrator` — Verify tests pass
6. Open `packages/orchestrator/dist/index.d.ts` — Verify type definitions generated
7. Verify `@langchain/langgraph` in `packages/orchestrator/node_modules/@langchain/`

---

## Constraints

| Constraint | Value |
|------------|-------|
| Node.js version | >= 18 (already enforced) |
| TypeScript version | ^5.8.0 (repo standard) |
| Module system | ESM (`"type": "module"`) |
| LangGraphJS version | ^1.1.0 |

---

## File Touch List (High-Level)

| Path | Action |
|------|--------|
| `packages/orchestrator/package.json` | CREATE |
| `packages/orchestrator/tsconfig.json` | CREATE |
| `packages/orchestrator/vitest.config.ts` | CREATE |
| `packages/orchestrator/src/index.ts` | CREATE |
| `packages/orchestrator/src/__tests__/index.test.ts` | CREATE |
| `package.json` (root) | MODIFY — add workspace |

---

## Token Budget

| Phase | Agent | Est. Tokens | Actual Tokens |
|-------|-------|-------------|---------------|
| Elaboration | QA | ~3,000 | ~8,084 |
| Implementation | Dev | ~5,000 | ~51,700 |
| Verification | QA | ~2,000 | ~7,281 |

### Implementation Token Breakdown
- Planner: ~16,000
- Validator: ~5,700
- Backend Coder: ~10,500
- Verifier: ~5,000
- Proof Writer: ~8,200
- Learnings: ~6,300

---

## QA Discovery Notes (for PM Review)

_Added by QA Elaboration on 2026-01-23_

### Gaps Identified

| # | Finding | User Decision | Notes |
|---|---------|---------------|-------|
| 1 | Missing `.gitignore` in file touch list | Skipped | User declined review |
| 2 | Missing `README.md` in file touch list | Skipped | User declined review |
| 3 | Missing `lint` script in package.json | Skipped | User declined review |

### Enhancement Opportunities

| # | Finding | User Decision | Notes |
|---|---------|---------------|-------|
| 1 | Add `check-types` script alias for consistency | Skipped | User declined review |
| 2 | Add `"sideEffects": false` for tree-shaking | Skipped | User declined review |

### Follow-up Stories Suggested

- [ ] (Optional) wrkf-tooling: Standardize package scripts across monorepo

### Items Marked Out-of-Scope

- None

---

*Generated by PM Agent | 2026-01-23*
