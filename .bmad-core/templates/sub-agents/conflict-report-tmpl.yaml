# <!-- Powered by BMADâ„¢ Core -->
# Conflict Report Template
# Used by worker/specialist sub-agents to report conflicts to coordinator

message_type: conflict_report
version: 1.0

metadata:
  from_agent_id: "{{worker_id}}"
  from_agent_type: "{{worker_type}}"
  to_agent_id: "{{coordinator_id}}"
  to_agent_type: "{{coordinator_type}}"
  session_id: "{{session_id}}"
  timestamp: "{{timestamp}}"
  message_id: "{{message_id}}"
  severity: "{{severity}}"  # critical, high, medium, low

task_reference:
  task_id: "{{task_id}}"
  task_type: "{{task_type}}"
  work_item_id: "{{work_item_id}}"

conflict:
  conflict_id: "{{conflict_id}}"
  conflict_type: "{{conflict_type}}"  # file, dependency, resource, logical, scope
  detected_at: "{{timestamp}}"
  
  # Detailed conflict information
  details:
    description: "{{conflict_description}}"
    affected_resources: "{{affected_resources}}"  # Files, APIs, data structures
    conflicting_agents: "{{conflicting_agent_ids}}"  # Other workers involved
    
  # File conflicts
  file_conflict:
    file_path: "{{file_path}}"
    conflict_type: "{{file_conflict_type}}"  # concurrent_edit, overlapping_changes, deletion
    my_changes: "{{my_changes}}"
    other_changes: "{{other_changes}}"
    conflicting_lines: "{{line_ranges}}"
    
  # Dependency conflicts
  dependency_conflict:
    needed_artifact: "{{artifact_path}}"
    needed_from_task: "{{dependency_task_id}}"
    needed_by: "{{timestamp}}"
    current_status: "{{dependency_status}}"
    
  # Resource conflicts
  resource_conflict:
    resource_type: "{{resource_type}}"  # database, api, file_lock
    resource_id: "{{resource_id}}"
    held_by: "{{holding_agent_id}}"
    needed_for: "{{usage_description}}"
    
  # Logical conflicts
  logical_conflict:
    conflict_area: "{{area}}"  # API design, data model, architecture
    my_approach: "{{my_approach}}"
    conflicting_approach: "{{other_approach}}"
    incompatibility: "{{incompatibility_description}}"

impact:
  severity: "{{impact_severity}}"  # critical, high, medium, low
  scope: "{{impact_scope}}"  # single_task, multiple_tasks, entire_workflow
  blocking: "{{is_blocking}}"  # true/false
  affected_tasks: "{{affected_task_ids}}"
  estimated_delay: "{{delay_estimate}}"

resolution_options:
  - option_id: "{{option_id}}"
    strategy: "{{strategy}}"  # merge, reorder, redesign, escalate, wait
    description: "{{option_description}}"
    pros: "{{pros}}"
    cons: "{{cons}}"
    estimated_effort: "{{effort}}"
    recommended: "{{is_recommended}}"  # true/false
    
current_action:
  action_taken: "{{action}}"  # paused, continued, attempted_merge, escalated
  reason: "{{reason}}"
  awaiting: "{{awaiting}}"  # coordinator_decision, dependency_completion, user_input

recommendations:
  preferred_resolution: "{{preferred_option_id}}"
  rationale: "{{rationale}}"
  urgency: "{{urgency}}"  # immediate, soon, can_wait
  
context:
  related_conflicts: "{{related_conflict_ids}}"
  previous_resolutions: "{{previous_resolution_history}}"
  notes: "{{additional_notes}}"

# Validation
validation:
  required_fields:
    - conflict
    - impact
    - resolution_options
  optional_fields:
    - recommendations
    - context

