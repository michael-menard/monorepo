# Story 3.0.8: Gallery Lightbox Component

## Status

Draft

## Story

**As a** user,
**I want** to view images in a full-screen lightbox,
**so that** I can see image details clearly.

## Acceptance Criteria

1. ⬜ GalleryLightbox component for full-screen image viewing
2. ⬜ Click image to open lightbox
3. ⬜ Navigation between images (prev/next)
4. ⬜ Close on backdrop click or Escape key
5. ⬜ Zoom capability (optional, stretch goal)
6. ⬜ Keyboard navigation (arrows, Escape)
7. ⬜ Accessible with proper focus management

## Tasks / Subtasks

- [ ] **Task 1: Create Lightbox Component**
  - [ ] Create `src/components/GalleryLightbox.tsx`
  - [ ] Use @repo/ui Dialog as foundation
  - [ ] Full-screen overlay with image

- [ ] **Task 2: Navigation**
  - [ ] Previous/Next buttons
  - [ ] Arrow key navigation
  - [ ] Image counter (3 of 10)

- [ ] **Task 3: Close Behavior**
  - [ ] Close button (X)
  - [ ] Click backdrop to close
  - [ ] Escape key to close

- [ ] **Task 4: Accessibility**
  - [ ] Focus trap within lightbox
  - [ ] Return focus on close
  - [ ] aria-label for buttons
  - [ ] role="dialog" with proper attributes

## Dev Notes

### Component API

```typescript
interface GalleryLightboxProps {
  images: Array<{
    src: string
    alt: string
    title?: string
  }>
  initialIndex?: number
  open: boolean
  onOpenChange: (open: boolean) => void
  onIndexChange?: (index: number) => void
}

// Usage with state
const [lightboxOpen, setLightboxOpen] = useState(false)
const [lightboxIndex, setLightboxIndex] = useState(0)

<GalleryGrid>
  {images.map((image, index) => (
    <GalleryCard
      key={image.id}
      image={image}
      onClick={() => {
        setLightboxIndex(index)
        setLightboxOpen(true)
      }}
    />
  ))}
</GalleryGrid>

<GalleryLightbox
  images={images}
  initialIndex={lightboxIndex}
  open={lightboxOpen}
  onOpenChange={setLightboxOpen}
/>
```

### useLightbox Hook

```typescript
interface UseLightboxReturn {
  open: boolean
  currentIndex: number
  openLightbox: (index: number) => void
  closeLightbox: () => void
  next: () => void
  prev: () => void
  goTo: (index: number) => void
}

function useLightbox(totalImages: number): UseLightboxReturn {
  const [open, setOpen] = useState(false)
  const [currentIndex, setCurrentIndex] = useState(0)

  const next = useCallback(() => {
    setCurrentIndex((i) => (i + 1) % totalImages)
  }, [totalImages])

  const prev = useCallback(() => {
    setCurrentIndex((i) => (i - 1 + totalImages) % totalImages)
  }, [totalImages])

  // ... keyboard handlers

  return { open, currentIndex, openLightbox, closeLightbox, next, prev, goTo }
}
```

### Keyboard Handling

```typescript
useEffect(() => {
  if (!open) return

  const handleKeyDown = (e: KeyboardEvent) => {
    switch (e.key) {
      case 'Escape':
        onOpenChange(false)
        break
      case 'ArrowRight':
        next()
        break
      case 'ArrowLeft':
        prev()
        break
    }
  }

  document.addEventListener('keydown', handleKeyDown)
  return () => document.removeEventListener('keydown', handleKeyDown)
}, [open, next, prev, onOpenChange])
```

## Testing

- [ ] Unit test: opens with correct initial image
- [ ] Unit test: next/prev navigation works
- [ ] Unit test: closes on Escape key
- [ ] Unit test: closes on backdrop click
- [ ] Accessibility test: focus management

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-11-30 | 0.1     | Initial draft | SM Agent |
