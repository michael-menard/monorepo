# Story 4.2: OpenReplay Deployment on ECS/Fargate

## Status

Draft

## Story

**As a** DevOps Engineer,
**I want** OpenReplay deployed on ECS/Fargate with S3 storage,
**so that** Customer Service can replay user sessions for troubleshooting.

## Acceptance Criteria

1. OpenReplay Docker containers configured (multiple services: backend, storage, etc.)
2. ECS task definitions created for OpenReplay services (0.5-1 vCPU, 1-2GB RAM)
3. ECS services deployed with appropriate networking and load balancing
4. S3 bucket integration configured for session storage
5. OpenReplay web UI accessible and initial admin account created
6. Session recording backend validated with test recording

**Integration Verification:**

- IV1: S3 bucket permissions scoped correctly (no access to application buckets)
- IV2: ECS resources within VPC limits and quotas
- IV3: Network traffic from frontend to OpenReplay backend validated

## Tasks / Subtasks

- [ ] **Task 1: Configure OpenReplay Docker containers** (AC: 1)
  - [ ] Pull OpenReplay Docker images (openreplay/frontend, openreplay/backend, etc.)
  - [ ] Create local Docker Compose configuration for testing
  - [ ] Configure OpenReplay services architecture:
    - Frontend service (web UI)
    - Backend service (API and session processing)
    - Storage service (session data management)
    - Worker service (background processing)
  - [ ] Test OpenReplay startup and service communication locally
  - [ ] Validate service dependencies and startup order
  - [ ] Document OpenReplay architecture and service requirements

- [ ] **Task 2: Create ECS task definitions for OpenReplay services** (AC: 2)
  - [ ] Create ECS task definition for OpenReplay frontend (0.25 vCPU, 512MB RAM)
  - [ ] Create ECS task definition for OpenReplay backend (0.5-1 vCPU, 1-2GB RAM)
  - [ ] Create ECS task definition for OpenReplay storage service (0.5 vCPU, 1GB RAM)
  - [ ] Create ECS task definition for OpenReplay worker (0.5 vCPU, 1GB RAM)
  - [ ] Configure environment variables for each service
  - [ ] Set up IAM task roles with appropriate permissions
  - [ ] Configure logging to CloudWatch Logs for all services
  - [ ] Apply comprehensive UserMetrics tagging schema

- [ ] **Task 3: Deploy ECS services with networking** (AC: 3, IV2)
  - [ ] Create or use existing ECS cluster for OpenReplay services
  - [ ] Deploy ECS services in private subnet for security
  - [ ] Configure Application Load Balancer for OpenReplay web UI
  - [ ] Set up internal load balancing between OpenReplay services
  - [ ] Configure security groups for inter-service communication
  - [ ] Set up service discovery for OpenReplay service mesh
  - [ ] Configure auto-scaling policies for each service
  - [ ] Validate ECS resources within VPC limits and quotas

- [ ] **Task 4: Configure S3 bucket for session storage** (AC: 4, IV1)
  - [ ] Create dedicated S3 bucket for OpenReplay session recordings
  - [ ] Configure bucket lifecycle policy (30-day retention from Phase 1)
  - [ ] Set up IAM permissions for OpenReplay services to access S3
  - [ ] Configure S3 bucket encryption (SSE-S3)
  - [ ] Set up bucket policy to prevent access to application buckets
  - [ ] Configure CORS settings for OpenReplay frontend access
  - [ ] Test S3 integration with OpenReplay storage service
  - [ ] Apply UserMetrics tagging schema to S3 bucket

- [ ] **Task 5: Set up OpenReplay web UI and admin access** (AC: 5)
  - [ ] Access OpenReplay web UI via ALB endpoint
  - [ ] Complete initial setup and create admin account
  - [ ] Configure OpenReplay project settings
  - [ ] Set up user accounts for Customer Service team
  - [ ] Configure OpenReplay dashboard and analytics settings
  - [ ] Test OpenReplay web UI functionality and navigation
  - [ ] Document admin credentials and access procedures

- [ ] **Task 6: Validate session recording functionality** (AC: 6, IV3)
  - [ ] Configure OpenReplay tracking script for testing
  - [ ] Generate test user sessions on frontend application
  - [ ] Validate session recordings appear in OpenReplay dashboard
  - [ ] Test session playback functionality and controls
  - [ ] Verify session data storage in S3 bucket
  - [ ] Test network traffic from frontend to OpenReplay backend
  - [ ] Validate session recording quality and completeness

- [ ] **Task 7: Implement health checks and monitoring** (AC: 2, 3)
  - [ ] Configure ECS service health checks for all OpenReplay services
  - [ ] Set up CloudWatch alarms for ECS task health and performance
  - [ ] Configure auto-recovery for failed ECS tasks
  - [ ] Monitor inter-service communication and dependencies
  - [ ] Set up CloudWatch dashboard for OpenReplay ECS metrics
  - [ ] Test service restart and recovery scenarios
  - [ ] Monitor S3 storage usage and costs

- [ ] **Task 8: Create deployment documentation and runbook** (AC: 1-6)
  - [ ] Document OpenReplay ECS deployment architecture
  - [ ] Create troubleshooting guide for OpenReplay services
  - [ ] Document S3 integration and storage management
  - [ ] Create monitoring and alerting procedures
  - [ ] Document scaling and performance optimization
  - [ ] Create backup and disaster recovery procedures
  - [ ] Document integration with existing infrastructure
