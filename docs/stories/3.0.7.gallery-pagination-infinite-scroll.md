# Story 3.0.7: Gallery Pagination & Infinite Scroll

## Status

Draft

## Story

**As a** user,
**I want** galleries to load more items as I scroll,
**so that** I can browse large collections smoothly without page reloads.

## Acceptance Criteria

1. ⬜ GalleryPagination component for traditional pagination
2. ⬜ useInfiniteScroll hook for scroll-based loading
3. ⬜ Loading indicator when fetching more items
4. ⬜ "Load More" button as fallback/alternative
5. ⬜ Configurable page size (default: 20)
6. ⬜ End of results indicator
7. ⬜ Scroll restoration on navigation back

## Tasks / Subtasks

- [ ] **Task 1: useInfiniteScroll Hook**
  - [ ] Create `src/hooks/useInfiniteScroll.ts`
  - [ ] Use Intersection Observer API
  - [ ] Return loading state and trigger ref

- [ ] **Task 2: Load More Button**
  - [ ] Create `src/components/GalleryLoadMore.tsx`
  - [ ] Show when more items available
  - [ ] Loading spinner state

- [ ] **Task 3: Pagination Component**
  - [ ] Create `src/components/GalleryPagination.tsx`
  - [ ] Page numbers with ellipsis
  - [ ] Previous/Next buttons
  - [ ] Items per page selector

- [ ] **Task 4: End State**
  - [ ] Create end-of-results indicator
  - [ ] Show total count if available

## Dev Notes

### useInfiniteScroll Hook

```typescript
interface UseInfiniteScrollOptions {
  hasMore: boolean
  isLoading: boolean
  onLoadMore: () => void
  threshold?: number  // pixels before bottom, default: 200
  enabled?: boolean   // default: true
}

interface UseInfiniteScrollReturn {
  sentinelRef: React.RefObject<HTMLDivElement>
  isNearBottom: boolean
}

function useInfiniteScroll(options: UseInfiniteScrollOptions): UseInfiniteScrollReturn {
  const sentinelRef = useRef<HTMLDivElement>(null)

  useEffect(() => {
    if (!options.enabled || options.isLoading || !options.hasMore) return

    const observer = new IntersectionObserver(
      (entries) => {
        if (entries[0].isIntersecting) {
          options.onLoadMore()
        }
      },
      { rootMargin: `${options.threshold ?? 200}px` }
    )

    if (sentinelRef.current) {
      observer.observe(sentinelRef.current)
    }

    return () => observer.disconnect()
  }, [options])

  return { sentinelRef, isNearBottom: false }
}

// Usage
const { sentinelRef } = useInfiniteScroll({
  hasMore,
  isLoading,
  onLoadMore: () => fetchNextPage(),
})

return (
  <>
    <GalleryGrid>{items}</GalleryGrid>
    <div ref={sentinelRef} />
    {isLoading && <LoadingSpinner />}
  </>
)
```

### Pagination Component

```typescript
interface GalleryPaginationProps {
  currentPage: number
  totalPages: number
  onPageChange: (page: number) => void
  pageSize: number
  onPageSizeChange?: (size: number) => void
  pageSizeOptions?: number[]  // default: [10, 20, 50]
}

<GalleryPagination
  currentPage={page}
  totalPages={totalPages}
  onPageChange={setPage}
  pageSize={pageSize}
  onPageSizeChange={setPageSize}
/>
```

### RTK Query Integration

```typescript
// With RTK Query's infinite query pattern
const { data, fetchNextPage, hasNextPage, isFetchingNextPage } =
  useGetItemsInfiniteQuery({ search, tags, theme, sort })
```

## Testing

- [ ] Unit test: useInfiniteScroll calls onLoadMore at threshold
- [ ] Unit test: pagination shows correct page numbers
- [ ] Unit test: load more button triggers fetch
- [ ] Unit test: end state shows when no more items
- [ ] Integration test: scroll triggers load

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-11-30 | 0.1     | Initial draft | SM Agent |
