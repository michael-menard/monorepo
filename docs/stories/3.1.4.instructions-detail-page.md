# Story 3.1.4: Instructions Detail Page

## Status

Draft

## Story

**As a** user,
**I want** to view full details of an instruction,
**so that** I can see all images and information about a MOC.

## Acceptance Criteria

1. ⬜ Route `/instructions/:instructionId` configured
2. ⬜ Displays all instruction images in gallery view
3. ⬜ Shows instruction metadata (name, pieces, theme, tags)
4. ⬜ Lightbox opens on image click
5. ⬜ Back button returns to gallery
6. ⬜ Edit button navigates to edit page
7. ⬜ Linked inspiration images section (if any)

## Tasks / Subtasks

- [ ] **Task 1: Create Detail Route**
  - [ ] Create `routes/instructions/$instructionId.tsx`
  - [ ] Configure route params
  - [ ] Fetch instruction by ID

- [ ] **Task 2: Detail Page Layout**
  - [ ] Header with back button and title
  - [ ] Image gallery section
  - [ ] Metadata sidebar/section
  - [ ] Actions (edit, delete, favorite)

- [ ] **Task 3: Image Gallery**
  - [ ] Grid of all instruction images
  - [ ] Click to open lightbox
  - [ ] Navigate between images

- [ ] **Task 4: Linked Content**
  - [ ] Show linked inspiration images
  - [ ] Show if part of any sets (alt-build)

## Dev Notes

### Route Structure

```typescript
// routes/instructions/$instructionId.tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/instructions/$instructionId')({
  component: InstructionDetailPage,
  loader: ({ params }) => ({
    instructionId: params.instructionId,
  }),
})
```

### Page Component

```typescript
function InstructionDetailPage() {
  const { instructionId } = Route.useParams()
  const navigate = useNavigate()
  const { data: instruction, isLoading } = useGetInstructionByIdQuery(instructionId)
  const [lightboxOpen, setLightboxOpen] = useState(false)
  const [lightboxIndex, setLightboxIndex] = useState(0)

  if (isLoading) return <DetailPageSkeleton />
  if (!instruction) return <NotFound />

  return (
    <div className="container mx-auto py-6">
      {/* Header */}
      <div className="flex items-center gap-4 mb-6">
        <Button variant="ghost" onClick={() => navigate({ to: '/instructions' })}>
          <ArrowLeft className="w-4 h-4 mr-2" />
          Back
        </Button>
        <h1 className="text-2xl font-bold flex-1">{instruction.name}</h1>
        <div className="flex gap-2">
          <Button variant="outline" onClick={() => navigate({ to: '/instructions/$instructionId/edit', params: { instructionId } })}>
            <Pencil className="w-4 h-4 mr-2" />
            Edit
          </Button>
          <Button variant="ghost" size="icon">
            <Heart className={cn(instruction.isFavorite && 'fill-current text-red-500')} />
          </Button>
        </div>
      </div>

      {/* Content Grid */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
        {/* Images */}
        <div className="lg:col-span-2">
          <GalleryGrid columns={{ sm: 2, lg: 3 }}>
            {instruction.images.map((image, index) => (
              <div
                key={image.id}
                className="cursor-pointer"
                onClick={() => {
                  setLightboxIndex(index)
                  setLightboxOpen(true)
                }}
              >
                <img
                  src={image.thumbnail}
                  alt={`${instruction.name} image ${index + 1}`}
                  className="rounded-lg aspect-square object-cover"
                />
              </div>
            ))}
          </GalleryGrid>
        </div>

        {/* Metadata Sidebar */}
        <div className="space-y-6">
          <Card>
            <CardHeader>
              <CardTitle>Details</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4">
              <div>
                <Label>Piece Count</Label>
                <p className="text-lg font-semibold">{instruction.pieceCount}</p>
              </div>
              <div>
                <Label>Theme</Label>
                <Badge>{instruction.theme}</Badge>
              </div>
              <div>
                <Label>Tags</Label>
                <div className="flex flex-wrap gap-1 mt-1">
                  {instruction.tags.map(tag => (
                    <Badge key={tag} variant="outline">{tag}</Badge>
                  ))}
                </div>
              </div>
              {instruction.pdfUrl && (
                <Button className="w-full" asChild>
                  <a href={instruction.pdfUrl} target="_blank" rel="noopener">
                    <Download className="w-4 h-4 mr-2" />
                    Download PDF
                  </a>
                </Button>
              )}
            </CardContent>
          </Card>

          {/* Linked Inspiration */}
          {instruction.linkedInspirations?.length > 0 && (
            <Card>
              <CardHeader>
                <CardTitle>Inspiration Images</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-3 gap-2">
                  {instruction.linkedInspirations.map(img => (
                    <img
                      key={img.id}
                      src={img.thumbnail}
                      alt=""
                      className="rounded aspect-square object-cover"
                    />
                  ))}
                </div>
              </CardContent>
            </Card>
          )}
        </div>
      </div>

      <GalleryLightbox
        images={instruction.images}
        initialIndex={lightboxIndex}
        open={lightboxOpen}
        onOpenChange={setLightboxOpen}
      />
    </div>
  )
}
```

## Testing

- [ ] Route renders with valid ID
- [ ] 404 shown for invalid ID
- [ ] Lightbox opens on image click
- [ ] Back button navigates to gallery
- [ ] Edit button navigates to edit page
- [ ] Linked content displays when present

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-11-30 | 0.1     | Initial draft | SM Agent |
