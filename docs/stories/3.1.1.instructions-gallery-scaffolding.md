# Story 3.1.1: Instructions Gallery Page Scaffolding

## Status

Ready for Review

## Story

**As a** developer,
**I want** the Instructions Gallery page scaffolded,
**so that** users can browse their MOC instruction collection.

## Acceptance Criteria

1. ✅ Route module created in `apps/web/main-app/src/routes/modules/InstructionsModule.tsx`
2. ✅ InstructionsGalleryPage component renders (via `@repo/app-instructions-gallery`)
3. ✅ Route `/instructions` configured in router
4. ✅ Lazy loading configured for route
5. ✅ Page uses @repo/app-component-library components
6. ✅ Basic page layout with header and grid area

## Tasks / Subtasks

- [x] **Task 1: Create Route Structure**
  - [x] Route module exists at `routes/modules/InstructionsModule.tsx`
  - [x] Micro-app exists at `apps/web/app-instructions-gallery/`
  - [x] Page-specific components in micro-app `src/components/`

- [x] **Task 2: Page Component**
  - [x] InstructionsGalleryModule component created
  - [x] Uses @repo/app-component-library components
  - [x] Page title/header with BookOpen icon

- [x] **Task 3: Router Configuration**
  - [x] `/instructions` route configured in `routes/index.ts`
  - [x] Lazy loading via React.lazy() in InstructionsModule.tsx
  - [x] Route protected with auth guard

## Dev Notes

### Route Structure

```
apps/web/main-app/src/routes/
└── instructions/
    ├── index.tsx              # Main gallery route
    ├── $instructionId.tsx     # Detail page route (future)
    └── -components/
        └── InstructionCard.tsx  # Gallery-specific card
```

### Page Component

```typescript
// routes/instructions/index.tsx
import { createFileRoute } from '@tanstack/react-router'
import {
  GalleryGrid,
  GalleryFilterBar,
  GalleryEmptyState,
  GallerySkeleton,
  useGalleryUrl,
} from '@repo/gallery'
import { useGetInstructionsQuery } from '@/services/api'
import { InstructionCard } from './-components/InstructionCard'

export const Route = createFileRoute('/instructions/')({
  component: InstructionsGalleryPage,
})

function InstructionsGalleryPage() {
  const { state, updateUrl } = useGalleryUrl()

  // API query will be implemented in separate story
  const { data, isLoading } = useGetInstructionsQuery(state)

  return (
    <div className="container mx-auto py-6 space-y-6">
      <h1 className="text-2xl font-bold">My Instructions</h1>

      <GalleryFilterBar
        search={state.search}
        onSearchChange={(s) => updateUrl({ search: s })}
        tags={availableTags}
        selectedTags={state.tags}
        onTagsChange={(t) => updateUrl({ tags: t })}
        themes={availableThemes}
        selectedTheme={state.theme}
        onThemeChange={(t) => updateUrl({ theme: t })}
        sortOptions={sortOptions}
        selectedSort={state.sortField}
        onSortChange={(s, d) => updateUrl({ sortField: s, sortDirection: d })}
      />

      {isLoading ? (
        <GallerySkeleton count={12} />
      ) : data?.items.length === 0 ? (
        <GalleryEmptyState
          title="No instructions yet"
          description="Upload your first MOC instructions to start your collection."
          action={{
            label: "Upload Instructions",
            onClick: () => navigate({ to: '/instructions/upload' })
          }}
        />
      ) : (
        <GalleryGrid>
          {data?.items.map((instruction) => (
            <InstructionCard key={instruction.id} instruction={instruction} />
          ))}
        </GalleryGrid>
      )}
    </div>
  )
}
```

### Dependencies

- @repo/gallery (shared gallery components)
- @repo/ui (base UI components)
- TanStack Router (routing)

## Testing

- [x] Route `/instructions` renders page
- [x] Page shows loading skeleton initially (via Suspense fallback)
- [x] Empty state shows when no data
- [x] Grid area placeholder present

## Change Log

| Date       | Version | Description                                                                              | Author    |
| ---------- | ------- | ---------------------------------------------------------------------------------------- | --------- |
| 2025-11-30 | 0.1     | Initial draft                                                                            | SM Agent  |
| 2025-12-05 | 1.0     | Implementation complete - wired InstructionsModule to app-instructions-gallery micro-app | Dev Agent |

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5

### Debug Log References

N/A

### Completion Notes

- Fixed `InstructionsModule.tsx` to import from `@repo/app-instructions-gallery` instead of non-existent `@repo/gallery.InstructionsGalleryModule`
- Added `@repo/app-instructions-gallery` as dependency to main-app
- Added package exports (`main`, `types`, `exports`) to app-instructions-gallery package.json
- Updated tests to properly mock the lazy-loaded module
- All tests passing: main-app InstructionsModule (2 tests), app-instructions-gallery (3 tests)

### File List

- `apps/web/main-app/src/routes/modules/InstructionsModule.tsx` - Modified import path
- `apps/web/main-app/src/routes/modules/__tests__/InstructionsModule.test.tsx` - Updated test mocks
- `apps/web/main-app/package.json` - Added @repo/app-instructions-gallery dependency
- `apps/web/app-instructions-gallery/package.json` - Added exports configuration
