# Story 1.10: Sidebar Mobile

## Status

Ready for Review

## Story

**As a** mobile user,
**I want** a slide-out navigation drawer,
**so that** I can access navigation on smaller screens.

## Acceptance Criteria

1. ✅ Mobile drawer component for sidebar
2. ✅ Triggered by hamburger menu in Header
3. ✅ Slide-in animation from left
4. ✅ Overlay/backdrop when open
5. ✅ Close on navigation
6. ✅ Close on backdrop click
7. ✅ Close on escape key
8. ✅ Hidden on desktop (md: breakpoint and up)

## Tasks / Subtasks

- [x] **Task 1: Create Mobile Drawer** (AC: 1, 3)
  - [x] Create MobileSidebar component
  - [x] Use Framer Motion for slide animation
  - [x] Animate from x: -100% to x: 0

- [x] **Task 2: Header Integration** (AC: 2)
  - [x] Add hamburger button to Header (mobile only)
  - [x] Connect to globalUISlice.sidebar.isOpen
  - [x] Toggle drawer open/close

- [x] **Task 3: Backdrop & Close Behaviors** (AC: 4-7)
  - [x] Add semi-transparent backdrop (bg-black/60)
  - [x] Close on backdrop click
  - [x] Close on Escape key press
  - [x] Close after navigation (useEffect on route change)

- [x] **Task 4: Responsive Visibility** (AC: 8)
  - [x] Show drawer trigger only on mobile (< md)
  - [x] Show regular sidebar only on desktop (≥ md)
  - [x] Use Tailwind responsive classes (md:hidden)

## Dev Notes

### Component Structure

**File:** `apps/web/main-app/src/components/Layout/MobileSidebar.tsx`

```typescript
export function MobileSidebar() {
  const dispatch = useDispatch()
  const isOpen = useSelector(selectSidebarOpen)
  const location = useLocation()

  // Close on navigation
  useEffect(() => {
    if (isOpen) dispatch(setSidebarOpen(false))
  }, [location.pathname, dispatch])

  // Close on Escape
  useEffect(() => {
    const handler = (e: KeyboardEvent) => {
      if (e.key === 'Escape' && isOpen) dispatch(setSidebarOpen(false))
    }
    document.addEventListener('keydown', handler)
    return () => document.removeEventListener('keydown', handler)
  }, [dispatch, isOpen])

  // Body scroll lock
  useEffect(() => {
    if (isOpen) document.body.style.overflow = 'hidden'
    else document.body.style.overflow = ''
    return () => { document.body.style.overflow = '' }
  }, [isOpen])

  return (
    <AnimatePresence>
      {isOpen && (
        <>
          <motion.div className="fixed inset-0 bg-black/60 z-40 md:hidden" />
          <motion.aside
            role="dialog"
            aria-modal="true"
            aria-label="Navigation menu"
            className="fixed left-0 top-0 bottom-0 w-64 z-50 md:hidden"
          >
            <Sidebar />
          </motion.aside>
        </>
      )}
    </AnimatePresence>
  )
}
```

### Integration Points

1. **Header** uses `toggleSidebar` from `globalUISlice` for hamburger menu
2. **RootLayout** renders `<MobileSidebar />` for authenticated users
3. Desktop sidebar uses `hidden md:block`, mobile sidebar uses `md:hidden`

### Testing

- 16 unit tests written and passing
- Tests cover: visibility, backdrop, close button, escape key, scroll lock, responsive classes, drawer styling

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### File List

| File                                                                       | Action                               |
| -------------------------------------------------------------------------- | ------------------------------------ |
| `apps/web/main-app/src/components/Layout/MobileSidebar.tsx`                | Created                              |
| `apps/web/main-app/src/components/Layout/Header.tsx`                       | Modified (toggleSidebar import)      |
| `apps/web/main-app/src/components/Layout/RootLayout.tsx`                   | Modified (MobileSidebar integration) |
| `apps/web/main-app/src/components/Layout/__tests__/MobileSidebar.test.tsx` | Created                              |
| `apps/web/main-app/src/components/Layout/__tests__/Header.test.tsx`        | Modified (toggleSidebar test)        |

### Completion Notes

1. Created `MobileSidebar.tsx` with all required features:
   - Slide-in animation using Framer Motion spring
   - Semi-transparent backdrop with blur effect
   - Close on backdrop click, Escape key, and navigation
   - Body scroll lock when open
   - Proper accessibility attributes (role="dialog", aria-modal, aria-label)
2. Updated Header to use `toggleSidebar` from `globalUISlice` instead of `toggleMobileMenu` from navigationSlice
3. Changed breakpoint from `lg:hidden` to `md:hidden` for consistency
4. Updated RootLayout to use the new MobileSidebar component
5. Wrote comprehensive test suite with 16 tests
6. Updated Header test to verify `globalUI.sidebar.isOpen` state

### Debug Log References

None - implementation was straightforward.

## Change Log

| Date       | Version | Description                           | Author            |
| ---------- | ------- | ------------------------------------- | ----------------- |
| 2025-11-28 | 0.1     | Initial draft                         | SM Agent          |
| 2025-11-28 | 1.0     | Implementation complete - all ACs met | Dev Agent (James) |
