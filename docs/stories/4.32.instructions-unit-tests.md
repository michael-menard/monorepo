# Story 4.32: Instructions Unit Tests

## Status

Approved

## Story

**As a** developer,
**I want** unit tests for instructions components,
**so that** functionality is verified.

## Acceptance Criteria

1. ⬜ Tests for MocForm with Zod
2. ⬜ Tests for file uploads
3. ⬜ Tests for file manager
4. ⬜ Tests for delete confirmations
5. ⬜ Minimum 45% code coverage

## Tasks / Subtasks

- [ ] **Task 1: Form Tests**
  - [ ] Validation tests
  - [ ] Submit tests
  - [ ] Edit mode tests

- [ ] **Task 2: File Tests**
  - [ ] Upload validation tests
  - [ ] File type/size tests
  - [ ] Delete tests

- [ ] **Task 3: Coverage**
  - [ ] Run coverage report
  - [ ] Verify 45% minimum

## Dev Notes

```typescript
describe('MocForm', () => {
  it('validates required fields', async () => {
    render(<MocForm onSuccess={vi.fn()} />)

    await userEvent.click(screen.getByRole('button', { name: /save/i }))

    expect(screen.getByText(/title is required/i)).toBeInTheDocument()
    expect(screen.getByText(/please select a theme/i)).toBeInTheDocument()
  })

  it('submits valid form', async () => {
    const onSuccess = vi.fn()
    render(<MocForm onSuccess={onSuccess} />)

    await userEvent.type(screen.getByLabelText(/title/i), 'Test MOC')
    await userEvent.click(screen.getByRole('combobox', { name: /theme/i }))
    await userEvent.click(screen.getByText('Star Wars'))
    await userEvent.click(screen.getByRole('button', { name: /save/i }))

    await waitFor(() => expect(onSuccess).toHaveBeenCalled())
  })
})

describe('file validation', () => {
  it('rejects oversized files', () => {
    const file = new File(['x'.repeat(6 * 1024 * 1024)], 'large.jpg')
    expect(validateFileSize(file, 'image')).toBe(false)
  })
})
```

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-11-28 | 0.1     | Initial draft | SM Agent |
