# Story 4.27: Replace File

## Status

Approved

## Story

**As a** user,
**I want** to replace an existing file,
**so that** I can update without deleting first.

## Acceptance Criteria

1. ⬜ Replace button per file
2. ⬜ Opens file picker
3. ⬜ Validates new file same type
4. ⬜ Deletes old, uploads new
5. ⬜ Preserves file order/position

## Tasks / Subtasks

- [ ] **Task 1: Replace Button**
  - [ ] Add to file item
  - [ ] Trigger file input

- [ ] **Task 2: Replace Flow**
  - [ ] Validate replacement
  - [ ] Upload new
  - [ ] Delete old

## Dev Notes

```typescript
function FileItem({ file, mocId }: FileItemProps) {
  const inputRef = useRef<HTMLInputElement>(null)
  const [uploadFile] = useUploadFileMutation()
  const [deleteFile] = useDeleteFileMutation()

  const handleReplace = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const newFile = e.target.files?.[0]
    if (!newFile) return

    // Validate same type
    if (!validateFileType(newFile, file.type)) return

    try {
      // Upload new file
      await uploadFile({ mocId, file: newFile }).unwrap()
      // Delete old file
      await deleteFile({ mocId, fileId: file.id }).unwrap()
      toast.success('File replaced')
    } catch {
      toast.error('Failed to replace file')
    }
  }

  return (
    <>
      <Button variant="ghost" size="icon" onClick={() => inputRef.current?.click()}>
        <RefreshCw className="h-4 w-4" />
      </Button>
      <input
        type="file"
        ref={inputRef}
        onChange={handleReplace}
        accept={getAcceptForType(file.type)}
        hidden
      />
    </>
  )
}
```

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-11-28 | 0.1     | Initial draft | SM Agent |
