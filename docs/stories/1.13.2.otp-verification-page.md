# Story 1.13.2: OTP Verification Page

## Status

Ready for Review

## Story

**As a** user who triggered MFA during login,
**I want** a dedicated verification page to enter my OTP code,
**so that** I can complete the multi-factor authentication process.

## Acceptance Criteria

1. ✅ Page exists at /auth/otp-verification route
2. ✅ Displays appropriate title based on challenge type (SMS, Email, Authenticator)
3. ✅ Shows OTPInput component for code entry
4. ✅ Verify button calls confirmSignIn from AuthProvider
5. ✅ Error messages displayed for invalid codes
6. ✅ Back to Login button available
7. ✅ Redirect to login if no active challenge
8. ✅ Redirect to dashboard on successful verification
9. ✅ Loading state during verification
10. ✅ Uses AuthLayout for consistent styling

## Tasks / Subtasks

- [x] **Task 1: Page Setup** (AC: 1, 10)
  - [x] Create OTPVerificationPage component
  - [x] Configure route at /auth/otp-verification
  - [x] Wrap with AuthLayout

- [x] **Task 2: Challenge Display** (AC: 2)
  - [x] Dynamic title based on challengeName
  - [x] Dynamic description text
  - [x] Support SMS_MFA, SOFTWARE_TOKEN_MFA, EMAIL_OTP

- [x] **Task 3: Form Integration** (AC: 3-4)
  - [x] Use OTPInput component
  - [x] Call confirmSignIn on submit
  - [x] Handle 6-digit validation

- [x] **Task 4: Error Handling** (AC: 5)
  - [x] Display error messages
  - [x] Clear input on error for retry

- [x] **Task 5: Navigation** (AC: 6-8)
  - [x] Back to Login button
  - [x] Redirect to login if no challenge
  - [x] Navigate to dashboard on success

- [x] **Task 6: States** (AC: 9)
  - [x] Loading/submitting state
  - [x] Disable buttons during submission

## Implementation Details

**File:** `apps/web/main-app/src/pages/auth/OTPVerificationPage.tsx`

### Challenge Types Supported

| Challenge Name     | Title                    | Description                     |
| ------------------ | ------------------------ | ------------------------------- |
| SMS_MFA            | Enter SMS Code           | Code sent to phone number       |
| SOFTWARE_TOKEN_MFA | Enter Authenticator Code | Open authenticator app for code |
| EMAIL_OTP          | Enter Email Code         | Code sent to email address      |
| (default)          | Enter Verification Code  | Generic fallback                |

### Route Configuration

```typescript
const otpVerificationRoute = createRoute({
  getParentRoute: () => rootRoute,
  path: '/auth/otp-verification',
  component: OTPVerificationPage,
  beforeLoad: RouteGuards.guestOnly,
})
```

## Change Log

| Date       | Version | Description                         | Author      |
| ---------- | ------- | ----------------------------------- | ----------- |
| 2025-11-28 | 1.0     | Story created - already implemented | Claude Code |
