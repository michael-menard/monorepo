# Story 1.5: Auth Slice

## Status

Approved

## Story

**As a** developer,
**I want** an authSlice managing user authentication state,
**so that** components can access auth status and user info.

## Acceptance Criteria

1. ✅ authSlice created with createSlice
2. ✅ State includes: isAuthenticated, isLoading, user, tokens, error
3. ✅ Actions: setAuthenticated, setUnauthenticated, setLoading, updateUser, setError
4. ✅ Selectors: selectIsAuthenticated, selectUser, selectAuthLoading, selectAuthError
5. ✅ User type defined with id, email, name, avatar, roles
6. ⬜ Tokens include accessToken, idToken, refreshToken
7. ⬜ Integration with Amplify auth (Story 1.15)

## Tasks / Subtasks

- [ ] **Task 1: Verify Slice Structure** (AC: 1-5)
  - [x] Confirm authSlice exists at store/slices/authSlice.ts
  - [x] Check state shape matches requirements
  - [x] Verify all actions are exported
  - [x] Verify all selectors are exported
  - [x] Check User type definition

- [ ] **Task 2: Verify Token Handling** (AC: 6)
  - [x] Confirm tokens state includes all three token types
  - [ ] Verify updateTokens action works correctly

- [ ] **Task 3: Document Amplify Integration** (AC: 7)
  - [ ] Note that Story 1.15 will sync Amplify to this slice
  - [ ] Document expected flow for auth state updates

## Dev Notes

### Existing Implementation ✅

**File:** `apps/web/main-app/src/store/slices/authSlice.ts`

Already implements:

- User interface with id, email, name, avatar, roles, preferences
- AuthState with isAuthenticated, isLoading, user, tokens, error
- All required actions
- All required selectors

### State Shape

```typescript
interface AuthState {
  isAuthenticated: boolean
  isLoading: boolean
  user: User | null
  tokens: {
    accessToken?: string
    idToken?: string
    refreshToken?: string
  } | null
  error: string | null
}
```

### Actions

- setLoading(boolean)
- setAuthenticated({ user, tokens })
- setUnauthenticated()
- updateUser(Partial<User>)
- updateTokens(tokens)
- setError(string)
- clearError()

### Selectors

- selectAuth
- selectIsAuthenticated
- selectUser
- selectAuthLoading
- selectAuthError

### Testing

- Unit test each action
- Test selectors return correct state
- Test initial state is correct

## Change Log

| Date       | Version | Description                                      | Author   |
| ---------- | ------- | ------------------------------------------------ | -------- |
| 2025-11-28 | 0.1     | Initial draft - verified existing implementation | SM Agent |
