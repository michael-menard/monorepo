# Story 1.31: Navigation Loading State

## Status

Approved

## Story

**As a** developer,
**I want** to track navigation pending state globally,
**so that** I can show loading indicators during route transitions.

## Acceptance Criteria

1. ⬜ Add isNavigating flag to global UI state
2. ⬜ Set true when navigation starts
3. ⬜ Set false when navigation completes
4. ⬜ Selector for isNavigating available
5. ⬜ Works with TanStack Router pending state

## Tasks / Subtasks

- [ ] **Task 1: Update Global UI Slice** (AC: 1, 4)
  - [ ] Add isNavigating to state
  - [ ] Create setNavigating action
  - [ ] Create selectIsNavigating selector

- [ ] **Task 2: Router Integration** (AC: 2-3, 5)
  - [ ] Use router.subscribe() for state changes
  - [ ] Or use useRouterState().isLoading
  - [ ] Dispatch setNavigating(true) on start
  - [ ] Dispatch setNavigating(false) on complete

## Dev Notes

### Global UI Slice Update

**File:** `apps/web/main-app/src/store/slices/globalUISlice.ts`

```typescript
interface GlobalUIState {
  sidebar: {
    isOpen: boolean
    isCollapsed: boolean
  }
  loading: {
    isNavigating: boolean
    isPageLoading: boolean
  }
}

const initialState: GlobalUIState = {
  sidebar: {
    isOpen: false,
    isCollapsed: false,
  },
  loading: {
    isNavigating: false,
    isPageLoading: false,
  },
}

export const globalUISlice = createSlice({
  name: 'globalUI',
  initialState,
  reducers: {
    setNavigating: (state, action: PayloadAction<boolean>) => {
      state.loading.isNavigating = action.payload
    },
    // ... other actions
  },
})

export const selectIsNavigating = (state: RootState) => state.globalUI.loading.isNavigating
```

### Router State Integration

```typescript
// Hook to sync router state with Redux
export function useNavigationSync() {
  const dispatch = useAppDispatch()
  const routerState = useRouterState()

  useEffect(() => {
    dispatch(setNavigating(routerState.isLoading))
  }, [routerState.isLoading, dispatch])
}
```

### TanStack Router Pending State

TanStack Router has built-in pending state:

```typescript
const routerState = useRouterState()
// routerState.isLoading - true during navigation
// routerState.isTransitioning - true during transitions
```

### Alternative: Direct Router State

Instead of Redux, could use router state directly:

```typescript
function NavigationIndicator() {
  const isNavigating = useRouterState({
    select: (state) => state.isLoading,
  })

  return isNavigating ? <Spinner /> : null
}
```

### Testing

- Test isNavigating updates on navigation start
- Test isNavigating clears on navigation complete
- Test selector returns correct value

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-11-28 | 0.1     | Initial draft | SM Agent |
