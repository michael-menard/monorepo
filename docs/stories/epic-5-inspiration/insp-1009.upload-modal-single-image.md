# Story insp-1009: Upload Modal (Single Image)

## Status

Draft

## Story

**As a** user,
**I want** to upload a single inspiration image via a modal,
**so that** I can add new images to my gallery.

## Acceptance Criteria

1. "Add" button in gallery header opens upload modal
2. Modal has drag-and-drop zone
3. Modal has file picker button alternative
4. Shows preview thumbnail after selection
5. Validates file type (JPEG, PNG, WebP, GIF)
6. Validates file size (max 10MB)
7. Shows upload progress
8. Creates inspiration after successful upload
9. Closes modal and refreshes gallery on success

## Tasks / Subtasks

- [ ] **Task 1: Add Upload Button** (AC: 1)
  - [ ] Add "Add" button to gallery page header
  - [ ] Button opens upload modal
  - [ ] Use Plus icon

- [ ] **Task 2: Create Upload Modal** (AC: 2, 3)
  - [ ] Create UploadInspirationModal component
  - [ ] Add drag-and-drop zone
  - [ ] Add "Browse files" button
  - [ ] Use Dialog component

- [ ] **Task 3: Handle File Selection** (AC: 4, 5, 6)
  - [ ] Show preview thumbnail on select
  - [ ] Validate file type client-side
  - [ ] Validate file size client-side
  - [ ] Show error for invalid files

- [ ] **Task 4: Implement Upload Flow** (AC: 7, 8)
  - [ ] Call presign endpoint to get URL
  - [ ] Upload file to S3 with progress tracking
  - [ ] Call create inspiration endpoint
  - [ ] Show progress indicator

- [ ] **Task 5: Handle Completion** (AC: 9)
  - [ ] Close modal on success
  - [ ] Invalidate gallery cache to refresh
  - [ ] Show success toast

## Dev Notes

### Component Location
`apps/web/main-app/src/routes/inspiration/-components/UploadInspirationModal/index.tsx`

### Upload Flow

```typescript
async function handleUpload(file: File) {
  setIsUploading(true)
  setProgress(0)

  try {
    // 1. Get presigned URL
    const presign = await presignMutation({
      filename: file.name,
      contentType: file.type,
    }).unwrap()

    // 2. Upload to S3
    await uploadToS3(presign.presignedUrl, file, (pct) => setProgress(pct))

    // 3. Create inspiration record
    await createInspirationMutation({
      imageUrl: presign.imageUrl,
    }).unwrap()

    // 4. Success
    onClose()
    toast.success('Image uploaded!')
  } catch (error) {
    toast.error('Upload failed')
  } finally {
    setIsUploading(false)
  }
}
```

### Drag-and-Drop

```tsx
<div
  className={cn(
    "border-2 border-dashed rounded-lg p-8 text-center",
    isDragging && "border-primary bg-primary/10"
  )}
  onDragOver={(e) => { e.preventDefault(); setIsDragging(true) }}
  onDragLeave={() => setIsDragging(false)}
  onDrop={(e) => {
    e.preventDefault()
    setIsDragging(false)
    const file = e.dataTransfer.files[0]
    if (file) handleFileSelect(file)
  }}
>
  <Upload className="w-12 h-12 mx-auto mb-4 text-muted-foreground" />
  <p>Drag and drop an image here, or</p>
  <Button onClick={() => fileInputRef.current?.click()}>
    Browse files
  </Button>
</div>
```

### Dependencies
- insp-1002: S3 Presign Infrastructure
- insp-1003: Create Inspiration Endpoint

## Testing

- [ ] Modal opens from Add button
- [ ] Drag-and-drop works
- [ ] File picker works
- [ ] Preview shows after selection
- [ ] Invalid file types rejected
- [ ] Oversized files rejected
- [ ] Progress indicator updates
- [ ] Gallery refreshes after upload

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-12-27 | 0.1     | Initial draft | SM Agent |
