# Story insp-1046: Keyboard Navigation

## Status

Draft

## Story

**As a** keyboard user,
**I want** to navigate the gallery with keyboard shortcuts,
**so that** I can use the app without a mouse.

## Acceptance Criteria

1. Arrow keys navigate between gallery items
2. Space selects current item
3. Enter opens detail view
4. Escape closes modals/detail views
5. Delete/Backspace opens delete confirmation
6. "U" key opens upload modal (when in gallery)
7. Focus indicator visible on current item

## Tasks / Subtasks

- [ ] **Task 1: Implement Grid Navigation** (AC: 1)
  - [ ] Track focused item index
  - [ ] Arrow left/right moves horizontally
  - [ ] Arrow up/down moves by row
  - [ ] Wrap or stop at boundaries

- [ ] **Task 2: Add Selection Shortcuts** (AC: 2, 3)
  - [ ] Space toggles selection
  - [ ] Enter navigates to detail
  - [ ] Handle when item focused

- [ ] **Task 3: Add Modal Shortcuts** (AC: 4)
  - [ ] Escape closes current modal
  - [ ] Escape in detail returns to gallery
  - [ ] Focus trap in modals

- [ ] **Task 4: Add Action Shortcuts** (AC: 5, 6)
  - [ ] Delete key on focused item
  - [ ] "U" opens upload from gallery
  - [ ] Document shortcuts

- [ ] **Task 5: Add Focus Styling** (AC: 7)
  - [ ] Clear focus ring on cards
  - [ ] High contrast focus indicator
  - [ ] Visible in all themes

## Dev Notes

### PRD Reference
From PRD Keyboard Navigation:

| Action | Keyboard Shortcut |
|--------|-------------------|
| Navigate gallery | Arrow keys |
| Select item | Space |
| Multi-select | Shift + Arrow / Shift + Click |
| Open detail view | Enter |
| Close modal/detail | Escape |
| Reorder item | Select → Arrow keys → Enter to confirm |
| Group into album | Select multiple → G |
| Delete | Select → Delete/Backspace |
| Upload | U (when in gallery) |

### Grid Navigation

```tsx
function useGridNavigation(itemCount: number, columnsPerRow: number) {
  const [focusedIndex, setFocusedIndex] = useState(0)

  useEffect(() => {
    function handleKeyDown(e: KeyboardEvent) {
      switch (e.key) {
        case 'ArrowLeft':
          e.preventDefault()
          setFocusedIndex(i => Math.max(0, i - 1))
          break
        case 'ArrowRight':
          e.preventDefault()
          setFocusedIndex(i => Math.min(itemCount - 1, i + 1))
          break
        case 'ArrowUp':
          e.preventDefault()
          setFocusedIndex(i => Math.max(0, i - columnsPerRow))
          break
        case 'ArrowDown':
          e.preventDefault()
          setFocusedIndex(i => Math.min(itemCount - 1, i + columnsPerRow))
          break
      }
    }

    document.addEventListener('keydown', handleKeyDown)
    return () => document.removeEventListener('keydown', handleKeyDown)
  }, [itemCount, columnsPerRow])

  return { focusedIndex, setFocusedIndex }
}
```

### Gallery with Keyboard Support

```tsx
function GalleryGrid({ items }) {
  const gridRef = useRef<HTMLDivElement>(null)
  const { focusedIndex, setFocusedIndex } = useGridNavigation(items.length, 4)
  const navigate = useNavigate()

  // Focus management
  useEffect(() => {
    const cards = gridRef.current?.querySelectorAll('[data-gallery-item]')
    cards?.[focusedIndex]?.focus()
  }, [focusedIndex])

  function handleKeyDown(e: React.KeyboardEvent, index: number, item: Item) {
    switch (e.key) {
      case ' ':
        e.preventDefault()
        toggleSelection(item.id)
        break
      case 'Enter':
        e.preventDefault()
        navigate({ to: '/inspiration/$id', params: { id: item.id } })
        break
      case 'Delete':
      case 'Backspace':
        e.preventDefault()
        openDeleteModal(item)
        break
    }
  }

  // Global U for upload
  useEffect(() => {
    function handleGlobalKey(e: KeyboardEvent) {
      if (e.key === 'u' && !isModalOpen) {
        e.preventDefault()
        openUploadModal()
      }
    }
    document.addEventListener('keydown', handleGlobalKey)
    return () => document.removeEventListener('keydown', handleGlobalKey)
  }, [isModalOpen])

  return (
    <div
      ref={gridRef}
      role="grid"
      aria-label="Inspiration gallery"
      className="grid grid-cols-4 gap-4"
    >
      {items.map((item, index) => (
        <div
          key={item.id}
          role="gridcell"
          data-gallery-item
          tabIndex={index === focusedIndex ? 0 : -1}
          onKeyDown={(e) => handleKeyDown(e, index, item)}
          onFocus={() => setFocusedIndex(index)}
          className={cn(
            "focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 rounded-lg",
          )}
        >
          <InspirationCard inspiration={item} />
        </div>
      ))}
    </div>
  )
}
```

### Focus Styling

```css
/* In Tailwind */
.focus-visible:ring-2
.focus-visible:ring-primary
.focus-visible:ring-offset-2

/* Or explicit */
[data-gallery-item]:focus-visible {
  outline: 2px solid hsl(var(--primary));
  outline-offset: 2px;
}
```

## Testing

- [ ] Arrow keys navigate grid
- [ ] Focus moves to correct item
- [ ] Space selects item
- [ ] Enter opens detail
- [ ] Escape closes modals
- [ ] Delete opens confirmation
- [ ] "U" opens upload
- [ ] Focus ring visible

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-12-27 | 0.1     | Initial draft | SM Agent |
