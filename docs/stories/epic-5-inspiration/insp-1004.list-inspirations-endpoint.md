# Story insp-1004: List Inspirations Endpoint

## Status

Draft

## Story

**As a** user,
**I want** to retrieve my list of inspirations,
**so that** I can view my inspiration gallery.

## Acceptance Criteria

1. GET /api/inspirations returns user's inspirations
2. Supports pagination (limit, offset)
3. Supports sorting (sortOrder, createdAt, updatedAt, title)
4. Supports filtering by tags
5. Returns only root-level inspirations (not in albums) by default
6. Optional includeAlbumItems=true to include all
7. Returns total count for pagination

## Tasks / Subtasks

- [ ] **Task 1: Create List Endpoint** (AC: 1)
  - [ ] Create GET /api/inspirations handler
  - [ ] Add authentication middleware
  - [ ] Filter by userId

- [ ] **Task 2: Implement Pagination** (AC: 2, 7)
  - [ ] Accept limit (default 20, max 100)
  - [ ] Accept offset (default 0)
  - [ ] Return total count in response

- [ ] **Task 3: Implement Sorting** (AC: 3)
  - [ ] Accept sortField query param
  - [ ] Accept sortDirection (asc/desc)
  - [ ] Default to sortOrder ascending

- [ ] **Task 4: Implement Filtering** (AC: 4, 5, 6)
  - [ ] Filter by tags (array contains)
  - [ ] Filter out items with albumIds unless includeAlbumItems=true
  - [ ] Support search query on title/description

- [ ] **Task 5: Add to Serverless Config**
  - [ ] Add Lambda function definition
  - [ ] Configure API Gateway route

## Dev Notes

### Endpoint Location
`apps/api/endpoints/inspirations/list/handler.ts`

### Query Parameters

```typescript
const ListQuerySchema = z.object({
  limit: z.coerce.number().int().min(1).max(100).default(20),
  offset: z.coerce.number().int().min(0).default(0),
  sortField: z.enum(['sortOrder', 'createdAt', 'updatedAt', 'title']).default('sortOrder'),
  sortDirection: z.enum(['asc', 'desc']).default('asc'),
  tags: z.array(z.string()).optional(),
  search: z.string().optional(),
  includeAlbumItems: z.coerce.boolean().default(false),
})
```

### Response

```typescript
const InspirationListResponseSchema = z.object({
  items: z.array(InspirationSummarySchema),
  total: z.number().int().nonnegative(),
  limit: z.number().int().positive(),
  offset: z.number().int().nonnegative(),
})
```

### Root-Level Filtering
By default, only show inspirations where `albumIds` is empty. This gives users a clean gallery view with orphan items at the top level.

## Testing

- [ ] Returns user's inspirations only
- [ ] Pagination works correctly
- [ ] Sorting by each field works
- [ ] Tag filtering works
- [ ] Root-level filter excludes album items
- [ ] includeAlbumItems=true includes all items
- [ ] Returns 401 for unauthenticated requests

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-12-27 | 0.1     | Initial draft | SM Agent |
