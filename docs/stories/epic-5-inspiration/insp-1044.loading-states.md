# Story insp-1044: Loading States (skeletons, lazy load)

## Status

Draft

## Story

**As a** user,
**I want** smooth loading experiences,
**so that** the interface feels responsive while data loads.

## Acceptance Criteria

1. Skeleton cards match grid layout during gallery load
2. Image placeholders (blur/skeleton) while loading
3. Lazy loading for images on scroll
4. Loading indicator during actions (save, delete)
5. Smooth transitions from skeleton to content

## Tasks / Subtasks

- [ ] **Task 1: Create Skeleton Components** (AC: 1)
  - [ ] Create InspirationCardSkeleton
  - [ ] Create AlbumCardSkeleton
  - [ ] Create GalleryGridSkeleton
  - [ ] Match actual card dimensions

- [ ] **Task 2: Add Image Placeholders** (AC: 2)
  - [ ] Blur placeholder or gradient
  - [ ] Skeleton shimmer effect
  - [ ] Fade transition on load

- [ ] **Task 3: Implement Lazy Loading** (AC: 3)
  - [ ] Use native loading="lazy" or IntersectionObserver
  - [ ] Load images only when visible
  - [ ] Preload nearby images

- [ ] **Task 4: Action Loading States** (AC: 4)
  - [ ] Button loading spinners
  - [ ] Disabled state during actions
  - [ ] Optimistic UI where applicable

- [ ] **Task 5: Smooth Transitions** (AC: 5)
  - [ ] Fade in content
  - [ ] Stagger animation for grid items
  - [ ] No layout shift

## Dev Notes

### PRD Reference
From PRD Loading & Error States:
> "Gallery loading: Skeleton cards matching grid layout"
> "Image loading: Blurred placeholder or skeleton, lazy-load on scroll"

### Skeleton Component

```tsx
function InspirationCardSkeleton() {
  return (
    <Card className="overflow-hidden">
      <Skeleton className="aspect-square" />
      <CardContent className="p-3 space-y-2">
        <Skeleton className="h-4 w-3/4" />
        <div className="flex gap-1">
          <Skeleton className="h-5 w-12 rounded-full" />
          <Skeleton className="h-5 w-16 rounded-full" />
        </div>
      </CardContent>
    </Card>
  )
}

function GalleryGridSkeleton({ count = 12 }) {
  return (
    <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
      {Array.from({ length: count }).map((_, i) => (
        <InspirationCardSkeleton key={i} />
      ))}
    </div>
  )
}
```

### Image with Placeholder

```tsx
function LazyImage({ src, alt, className }) {
  const [isLoaded, setIsLoaded] = useState(false)
  const [isInView, setIsInView] = useState(false)
  const imgRef = useRef<HTMLImageElement>(null)

  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setIsInView(true)
          observer.disconnect()
        }
      },
      { rootMargin: '100px' }  // Preload slightly ahead
    )

    if (imgRef.current) observer.observe(imgRef.current)
    return () => observer.disconnect()
  }, [])

  return (
    <div ref={imgRef} className={cn("relative overflow-hidden", className)}>
      {/* Skeleton placeholder */}
      {!isLoaded && (
        <Skeleton className="absolute inset-0" />
      )}

      {/* Actual image */}
      {isInView && (
        <img
          src={src}
          alt={alt}
          className={cn(
            "w-full h-full object-cover transition-opacity duration-300",
            isLoaded ? "opacity-100" : "opacity-0"
          )}
          onLoad={() => setIsLoaded(true)}
        />
      )}
    </div>
  )
}
```

### Button Loading State

```tsx
<Button disabled={isLoading}>
  {isLoading ? (
    <>
      <Loader2 className="w-4 h-4 mr-2 animate-spin" />
      Saving...
    </>
  ) : (
    'Save'
  )}
</Button>
```

### Staggered Animation

```tsx
// Using Framer Motion
<motion.div
  initial={{ opacity: 0, y: 20 }}
  animate={{ opacity: 1, y: 0 }}
  transition={{ delay: index * 0.05 }}
>
  <InspirationCard inspiration={item} />
</motion.div>
```

## Testing

- [ ] Skeleton shows during gallery load
- [ ] Skeleton dimensions match content
- [ ] Images lazy load on scroll
- [ ] Placeholders show while loading
- [ ] Smooth fade on image load
- [ ] Button loading states work
- [ ] No layout shift

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-12-27 | 0.1     | Initial draft | SM Agent |
