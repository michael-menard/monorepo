# Story insp-1021: Edit Album Modal

## Status

Draft

## Story

**As a** user,
**I want** to edit an album's metadata via a modal,
**so that** I can rename albums and update their details.

## Acceptance Criteria

1. Edit button in album view opens edit modal
2. Modal pre-fills with current values
3. Can edit title, description, tags
4. Can select cover image from album contents
5. Save button calls update endpoint
6. Cancel button closes without saving
7. Changes reflected immediately after save

## Tasks / Subtasks

- [ ] **Task 1: Add Edit Button** (AC: 1)
  - [ ] Add "Edit" button to album header
  - [ ] Opens EditAlbumModal
  - [ ] Use Pencil icon

- [ ] **Task 2: Create Edit Modal** (AC: 2, 3)
  - [ ] Create EditAlbumModal component
  - [ ] Pre-fill form with current values
  - [ ] Add form validation

- [ ] **Task 3: Add Cover Image Picker** (AC: 4)
  - [ ] Show grid of album's inspirations
  - [ ] Allow selecting one as cover
  - [ ] Show current selection highlighted

- [ ] **Task 4: Implement Save** (AC: 5, 7)
  - [ ] Call update mutation on submit
  - [ ] Show loading state
  - [ ] Invalidate query cache on success

- [ ] **Task 5: Handle Cancel** (AC: 6)
  - [ ] Close modal on cancel
  - [ ] Confirm if unsaved changes

## Dev Notes

### Component Location
`apps/web/main-app/src/routes/inspiration/-components/EditAlbumModal/index.tsx`

### Form Setup

```tsx
const EditAlbumSchema = z.object({
  title: z.string().min(1).max(200),
  description: z.string().max(2000).optional().or(z.literal('')),
  tags: z.array(z.string().max(50)).max(10),
  coverImageId: z.string().uuid().nullable(),
})

function EditAlbumModal({ album, inspirations, onClose }) {
  const form = useForm({
    resolver: zodResolver(EditAlbumSchema),
    defaultValues: {
      title: album.title,
      description: album.description ?? '',
      tags: album.tags,
      coverImageId: album.coverImageId,
    },
  })

  const [updateAlbum, { isLoading }] = useUpdateAlbumMutation()

  async function onSubmit(data) {
    await updateAlbum({ id: album.id, ...data }).unwrap()
    onClose()
  }

  return (
    <Dialog open onOpenChange={onClose}>
      <DialogContent className="max-w-2xl">
        <DialogHeader>
          <DialogTitle>Edit Album</DialogTitle>
        </DialogHeader>
        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
            {/* Title field */}
            {/* Description field */}
            {/* Tags field */}

            {/* Cover image picker */}
            <FormField
              name="coverImageId"
              control={form.control}
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Cover Image</FormLabel>
                  <div className="grid grid-cols-4 gap-2 max-h-40 overflow-y-auto">
                    {inspirations.map(insp => (
                      <button
                        key={insp.id}
                        type="button"
                        className={cn(
                          "aspect-square rounded overflow-hidden border-2",
                          field.value === insp.id
                            ? "border-primary"
                            : "border-transparent"
                        )}
                        onClick={() => field.onChange(insp.id)}
                      >
                        <img
                          src={insp.imageUrl}
                          alt=""
                          className="w-full h-full object-cover"
                        />
                      </button>
                    ))}
                  </div>
                </FormItem>
              )}
            />

            <DialogFooter>
              <Button variant="outline" onClick={onClose}>Cancel</Button>
              <Button type="submit" disabled={isLoading}>
                {isLoading ? 'Saving...' : 'Save Changes'}
              </Button>
            </DialogFooter>
          </form>
        </Form>
      </DialogContent>
    </Dialog>
  )
}
```

### Dependencies
- insp-1020: Update Album Endpoint
- insp-1018: Get Album Contents (for cover picker)

## Testing

- [ ] Edit button opens modal
- [ ] Form pre-fills correctly
- [ ] Cover image picker works
- [ ] Save updates album
- [ ] Cancel closes without saving
- [ ] Album view updates after save

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-12-27 | 0.1     | Initial draft | SM Agent |
