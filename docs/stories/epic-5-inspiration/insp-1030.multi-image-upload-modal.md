# Story insp-1030: Multi-Image Upload Modal

## Status

Draft

## Story

**As a** user,
**I want** to upload multiple images at once,
**so that** I can quickly add many inspirations to my gallery.

## Acceptance Criteria

1. Upload modal accepts multiple file selection
2. Shows preview thumbnails for all selected files
3. Allows removing individual files before upload
4. Shows individual progress for each file
5. Uploads files in parallel (with concurrency limit)
6. Handles partial failures gracefully

## Tasks / Subtasks

- [ ] **Task 1: Enable Multi-Select** (AC: 1)
  - [ ] Update file input to accept multiple
  - [ ] Update drag-and-drop for multiple files
  - [ ] Update state to handle array of files

- [ ] **Task 2: Show Preview Grid** (AC: 2, 3)
  - [ ] Display grid of thumbnail previews
  - [ ] Add remove button on each thumbnail
  - [ ] Update count display

- [ ] **Task 3: Implement Parallel Upload** (AC: 4, 5)
  - [ ] Upload with concurrency limit (3-5)
  - [ ] Track progress per file
  - [ ] Show individual progress bars

- [ ] **Task 4: Handle Partial Failures** (AC: 6)
  - [ ] Mark failed uploads with error indicator
  - [ ] Show retry button per failed file
  - [ ] Allow continuing with successful uploads

## Dev Notes

### Component Update
Extend existing `UploadInspirationModal` from insp-1009.

### File Input

```tsx
<input
  type="file"
  accept="image/jpeg,image/png,image/webp,image/gif"
  multiple  // Enable multi-select
  onChange={(e) => handleFilesSelected(Array.from(e.target.files || []))}
/>
```

### State Management

```typescript
interface UploadFile {
  id: string  // Temporary ID for tracking
  file: File
  preview: string  // Object URL for preview
  status: 'pending' | 'uploading' | 'success' | 'error'
  progress: number  // 0-100
  error?: string
}

const [files, setFiles] = useState<UploadFile[]>([])
```

### Preview Grid

```tsx
<div className="grid grid-cols-4 gap-2 max-h-60 overflow-y-auto">
  {files.map((f) => (
    <div key={f.id} className="relative aspect-square">
      <img
        src={f.preview}
        alt=""
        className="w-full h-full object-cover rounded"
      />
      {f.status === 'pending' && (
        <button
          className="absolute -top-1 -right-1 bg-destructive rounded-full p-0.5"
          onClick={() => removeFile(f.id)}
        >
          <X className="w-3 h-3 text-white" />
        </button>
      )}
      {f.status === 'uploading' && (
        <Progress value={f.progress} className="absolute bottom-1 left-1 right-1" />
      )}
      {f.status === 'error' && (
        <div className="absolute inset-0 bg-destructive/50 flex items-center justify-center">
          <Button size="sm" onClick={() => retryFile(f.id)}>Retry</Button>
        </div>
      )}
      {f.status === 'success' && (
        <div className="absolute bottom-1 right-1">
          <Check className="w-4 h-4 text-green-500" />
        </div>
      )}
    </div>
  ))}
</div>
```

### Parallel Upload with Limit

```typescript
import pLimit from 'p-limit'

const limit = pLimit(3)  // 3 concurrent uploads

async function uploadAll() {
  await Promise.all(
    files.map((f) =>
      limit(() => uploadFile(f))
    )
  )
}
```

### Dependencies
- insp-1009: Upload Modal (Single Image) - base component

## Testing

- [ ] Can select multiple files
- [ ] Previews show for all selected
- [ ] Can remove file before upload
- [ ] Progress shows per file
- [ ] Parallel uploads work
- [ ] Failed files show error state
- [ ] Retry works for failed files
- [ ] Successful files create inspirations

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-12-27 | 0.1     | Initial draft | SM Agent |
