# Story insp-1014: Create Album Endpoint

## Status

Draft

## Story

**As a** user,
**I want** to create a new album,
**so that** I can organize my inspiration images into collections.

## Acceptance Criteria

1. POST /api/albums endpoint creates album
2. Requires authenticated user
3. Accepts title (required), description, tags
4. Returns created album with all fields
5. Assigns next available sortOrder
6. Title must be unique per user (optional - can skip for v1)

## Tasks / Subtasks

- [ ] **Task 1: Create Endpoint Handler** (AC: 1, 2)
  - [ ] Create POST /api/albums handler
  - [ ] Add authentication middleware
  - [ ] Extract userId from auth context

- [ ] **Task 2: Validate Request** (AC: 3)
  - [ ] Parse request with CreateAlbumRequestSchema
  - [ ] Validate title is provided and not empty
  - [ ] Return 400 for invalid data

- [ ] **Task 3: Create Database Record** (AC: 4, 5)
  - [ ] Query max sortOrder for user's root albums
  - [ ] Insert new album with sortOrder + 1
  - [ ] Return created record

- [ ] **Task 4: Add to Serverless Config**
  - [ ] Add Lambda function definition
  - [ ] Configure API Gateway route

## Dev Notes

### Endpoint Location
`apps/api/endpoints/albums/create/handler.ts`

### Request Schema

```typescript
const CreateAlbumRequestSchema = z.object({
  title: z.string().min(1).max(200),
  description: z.string().max(2000).optional(),
  tags: z.array(z.string().max(50)).max(10).optional().default([]),
})
```

### Response

```typescript
// Returns AlbumResponseSchema
{
  id: "uuid",
  userId: "uuid",
  title: "Castle Inspiration",
  description: "Ideas for castle MOCs",
  coverImageId: null,
  tags: ["castle", "medieval"],
  parentAlbumIds: [],
  mocIds: [],
  sortOrder: 3,
  itemCount: 0,
  createdAt: "2025-12-27T...",
  updatedAt: "2025-12-27T..."
}
```

### Sort Order
New albums get placed at the end of the user's root-level albums list.

## Testing

- [ ] Creates album with valid data
- [ ] Returns 401 for unauthenticated
- [ ] Returns 400 for missing title
- [ ] Returns 400 for empty title
- [ ] Assigns correct sortOrder
- [ ] Returns complete album object

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-12-27 | 0.1     | Initial draft | SM Agent |
