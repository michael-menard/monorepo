# Story insp-1035: Stack-to-Create-Album Gesture

## Status

Draft

## Story

**As a** user,
**I want** to drag an image onto another to create an album,
**so that** I can quickly organize related images.

## Acceptance Criteria

1. Dragging image onto another triggers "stack" detection
2. Visual feedback shows merge icon overlay (distinct from reorder)
3. Dropping shows quick modal for album name
4. Album created with both images
5. Keyboard alternative: select multiple → press "G" (group)
6. Onboarding tooltip on first gallery visit

## Tasks / Subtasks

- [ ] **Task 1: Detect Stack Gesture** (AC: 1)
  - [ ] Differentiate from reorder gesture
  - [ ] Detect when dragged over another card (not between)
  - [ ] Track hover duration

- [ ] **Task 2: Add Stack Visual Feedback** (AC: 2)
  - [ ] Show merge/stack icon overlay on target
  - [ ] Different appearance from reorder line
  - [ ] Animate feedback

- [ ] **Task 3: Create Album on Drop** (AC: 3, 4)
  - [ ] Show quick album name modal
  - [ ] Create album with name
  - [ ] Add both images to album
  - [ ] Set first image as cover

- [ ] **Task 4: Add Keyboard Alternative** (AC: 5)
  - [ ] Track multi-selected items
  - [ ] "G" key triggers group action
  - [ ] Show same name modal

- [ ] **Task 5: Add Onboarding Tooltip** (AC: 6)
  - [ ] Detect first gallery visit
  - [ ] Show tooltip: "Tip: Drag images onto each other to create albums"
  - [ ] Dismiss on click or after delay

## Dev Notes

### PRD Reference
From PRD Interaction Patterns - Stack-to-Create-Album:
> "Discoverability: Onboarding tooltip on first gallery visit"
> "Visual feedback: Drop target highlights with 'merge' icon overlay, distinct from reorder line"
> "Confirmation: Quick modal: 'Create album?' with name field"
> "Keyboard: Select multiple items → Press 'G' (group) → Name prompt"

### Stack Detection Logic

```typescript
function isStackGesture(dragPosition: Position, targetRect: DOMRect): boolean {
  // Stack = hovering over center of another card
  // Reorder = hovering between cards
  const centerX = targetRect.left + targetRect.width / 2
  const centerY = targetRect.top + targetRect.height / 2
  const threshold = Math.min(targetRect.width, targetRect.height) * 0.4

  return (
    Math.abs(dragPosition.x - centerX) < threshold &&
    Math.abs(dragPosition.y - centerY) < threshold
  )
}
```

### Stack Visual Feedback

```tsx
function InspirationCard({ inspiration, isStackTarget }) {
  return (
    <Card className={cn(
      "relative transition-all",
      isStackTarget && "ring-4 ring-primary scale-105"
    )}>
      {isStackTarget && (
        <div className="absolute inset-0 bg-primary/20 flex items-center justify-center">
          <Layers className="w-8 h-8 text-primary" />
        </div>
      )}
      {/* Card content */}
    </Card>
  )
}
```

### Quick Album Name Modal

```tsx
function QuickAlbumModal({ images, onCreate, onCancel }) {
  const [name, setName] = useState('')

  return (
    <Dialog open>
      <DialogContent className="sm:max-w-sm">
        <DialogHeader>
          <DialogTitle>Create album?</DialogTitle>
        </DialogHeader>

        {/* Preview of images being combined */}
        <div className="flex gap-2 justify-center">
          {images.map((img) => (
            <img
              key={img.id}
              src={img.imageUrl}
              className="w-16 h-16 object-cover rounded"
            />
          ))}
        </div>

        <Input
          placeholder="Album name"
          value={name}
          onChange={(e) => setName(e.target.value)}
          autoFocus
        />

        <DialogFooter>
          <Button variant="outline" onClick={onCancel}>Cancel</Button>
          <Button onClick={() => onCreate(name)} disabled={!name.trim()}>
            Create
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  )
}
```

### Keyboard "G" Handler

```tsx
useEffect(() => {
  function handleKeyDown(e: KeyboardEvent) {
    if (e.key === 'g' && selectedItems.length >= 2) {
      e.preventDefault()
      setShowQuickAlbumModal(true)
    }
  }
  document.addEventListener('keydown', handleKeyDown)
  return () => document.removeEventListener('keydown', handleKeyDown)
}, [selectedItems])
```

### Dependencies
- insp-1033: Drag-and-Drop Reorder (DnD infrastructure)
- insp-1014: Create Album Endpoint
- insp-1024: Add Inspiration to Album Endpoint

## Testing

- [ ] Dragging over card shows stack indicator
- [ ] Dropping on card opens album modal
- [ ] Album created with both images
- [ ] "G" key works with multi-select
- [ ] Onboarding tooltip shows first visit
- [ ] Tooltip dismisses correctly
- [ ] Visual feedback distinct from reorder

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-12-27 | 0.1     | Initial draft | SM Agent |
