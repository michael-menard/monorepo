# Story insp-1003: Create Inspiration Endpoint

## Status

Draft

## Story

**As a** user,
**I want** to create a new inspiration with an uploaded image,
**so that** I can save images to my inspiration gallery.

## Acceptance Criteria

1. POST /api/inspirations endpoint accepts inspiration data
2. Requires authenticated user
3. Validates imageUrl points to user's S3 path
4. Accepts optional title, description, sourceUrl, tags
5. Returns created inspiration with all fields
6. Assigns next available sortOrder for user's gallery

## Tasks / Subtasks

- [ ] **Task 1: Create Endpoint Handler** (AC: 1, 2)
  - [ ] Create POST /api/inspirations handler
  - [ ] Add authentication middleware
  - [ ] Extract userId from auth context

- [ ] **Task 2: Validate Request** (AC: 3, 4)
  - [ ] Parse request body with CreateInspirationRequestSchema
  - [ ] Validate imageUrl is in user's S3 path
  - [ ] Return 400 for invalid data

- [ ] **Task 3: Create Database Record** (AC: 5, 6)
  - [ ] Query max sortOrder for user
  - [ ] Insert new inspiration with sortOrder + 1
  - [ ] Return created record

- [ ] **Task 4: Add to Serverless Config**
  - [ ] Add Lambda function definition
  - [ ] Configure API Gateway route

## Dev Notes

### Endpoint Location
`apps/api/endpoints/inspirations/create/handler.ts`

### Request Schema

```typescript
const CreateInspirationRequestSchema = z.object({
  imageUrl: z.string().url(),
  title: z.string().max(200).optional(),
  description: z.string().max(2000).optional(),
  sourceUrl: z.string().url().optional(),
  tags: z.array(z.string().max(50)).max(10).optional().default([]),
})
```

### Response

```typescript
// Returns InspirationResponseSchema
{
  id: "uuid",
  userId: "uuid",
  imageUrl: "https://...",
  title: "My inspiration",
  description: null,
  sourceUrl: null,
  tags: ["castle", "medieval"],
  albumIds: [],
  mocIds: [],
  sortOrder: 5,
  createdAt: "2025-12-27T...",
  updatedAt: "2025-12-27T..."
}
```

### S3 Path Validation
Ensure imageUrl starts with expected bucket/prefix:
`s3://bucket/users/{userId}/inspirations/`

## Testing

- [ ] Creates inspiration with valid data
- [ ] Returns 401 for unauthenticated requests
- [ ] Returns 400 for missing imageUrl
- [ ] Returns 400 for invalid imageUrl (wrong user path)
- [ ] Assigns correct sortOrder
- [ ] Returns complete inspiration object

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-12-27 | 0.1     | Initial draft | SM Agent |
