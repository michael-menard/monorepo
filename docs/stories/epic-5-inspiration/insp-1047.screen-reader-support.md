# Story insp-1047: Screen Reader Support (ARIA, announcements)

## Status

Draft

## Story

**As a** screen reader user,
**I want** the gallery to be fully accessible,
**so that** I can browse and manage my inspirations.

## Acceptance Criteria

1. Gallery items announced: "[Title], image, [position] of [total]"
2. Albums announced: "[Title], album containing [count] items"
3. Drag operations announced with instructions
4. Drop completions announced
5. State changes (delete, create) announced
6. Focus moves appropriately after actions

## Tasks / Subtasks

- [ ] **Task 1: Add ARIA Labels** (AC: 1, 2)
  - [ ] Label gallery grid
  - [ ] Label each gallery item
  - [ ] Include position information
  - [ ] Different labels for images vs albums

- [ ] **Task 2: Add Live Regions** (AC: 3, 4, 5)
  - [ ] Create announcement component
  - [ ] Announce drag start/move/end
  - [ ] Announce deletions
  - [ ] Announce creations

- [ ] **Task 3: Manage Focus** (AC: 6)
  - [ ] Focus next item after delete
  - [ ] Focus new item after create
  - [ ] Return focus after modal close

## Dev Notes

### PRD Reference
From PRD Screen Reader Support:

| Element | Announcement |
|---------|--------------|
| Gallery item (image) | "[Title or 'Untitled inspiration'], image, [position] of [total]" |
| Gallery item (album) | "[Album name], album containing [count] items, [position] of [total]" |
| Drag operation | "Grabbed [item]. Use arrow keys to move. Enter to drop. Escape to cancel." |
| Drop completed | "[Item] moved to position [X]" or "Album [name] created with [count] images" |
| Delete completed | "[Item] deleted" or "Album [name] deleted" |
| Upload progress | "[X] of [Y] images uploaded" |

From PRD Focus Management:

| Scenario | Focus Behavior |
|----------|----------------|
| Modal opens | Focus moves to first interactive element in modal |
| Modal closes | Focus returns to element that triggered modal |
| Item deleted | Focus moves to next item (or previous if last) |
| Album created | Focus moves to new album |
| Upload complete | Focus moves to first uploaded item |

### ARIA Implementation

```tsx
function InspirationCard({ inspiration, index, total }) {
  const title = inspiration.title || 'Untitled inspiration'

  return (
    <Card
      role="gridcell"
      aria-label={`${title}, image, ${index + 1} of ${total}`}
      tabIndex={0}
    >
      <img
        src={inspiration.imageUrl}
        alt={title}
        // alt comes from title per PRD
      />
      {/* ... */}
    </Card>
  )
}

function AlbumCard({ album, index, total }) {
  return (
    <Card
      role="gridcell"
      aria-label={`${album.title}, album containing ${album.itemCount} items, ${index + 1} of ${total}`}
      tabIndex={0}
    >
      {/* ... */}
    </Card>
  )
}
```

### Live Region Announcements

```tsx
function useAnnouncer() {
  const [message, setMessage] = useState('')

  const announce = useCallback((text: string, priority: 'polite' | 'assertive' = 'polite') => {
    setMessage('')  // Clear first to ensure re-announcement
    requestAnimationFrame(() => {
      setMessage(text)
    })
  }, [])

  return { message, announce }
}

function Announcer({ message }: { message: string }) {
  return (
    <div
      role="status"
      aria-live="polite"
      aria-atomic="true"
      className="sr-only"
    >
      {message}
    </div>
  )
}

// Usage
const { message, announce } = useAnnouncer()

function handleDelete(item: Inspiration) {
  await deleteMutation(item.id)
  announce(`${item.title || 'Image'} deleted`)
}
```

### Focus Management

```tsx
function useDeleteWithFocus(items: Item[], focusedIndex: number) {
  const itemRefs = useRef<(HTMLElement | null)[]>([])

  async function handleDelete(item: Item) {
    const currentIndex = items.findIndex(i => i.id === item.id)
    await deleteMutation(item.id)

    // Focus next item, or previous if last
    const nextIndex = currentIndex < items.length - 1 ? currentIndex : currentIndex - 1
    if (nextIndex >= 0) {
      itemRefs.current[nextIndex]?.focus()
    }
  }

  return { handleDelete, itemRefs }
}
```

### Modal Focus Trap

```tsx
import { FocusTrap } from '@radix-ui/react-focus-trap'

function Modal({ trigger, children, onClose }) {
  const triggerRef = useRef<HTMLButtonElement>(null)

  function handleClose() {
    onClose()
    // Return focus to trigger
    triggerRef.current?.focus()
  }

  return (
    <>
      <Button ref={triggerRef} onClick={() => setOpen(true)}>
        {trigger}
      </Button>
      <Dialog open={open} onOpenChange={handleClose}>
        <FocusTrap>
          <DialogContent>
            {children}
          </DialogContent>
        </FocusTrap>
      </Dialog>
    </>
  )
}
```

## Testing

- [ ] Screen reader announces images correctly
- [ ] Screen reader announces albums correctly
- [ ] Drag operations have instructions
- [ ] State changes announced
- [ ] Focus moves after delete
- [ ] Focus returns after modal close
- [ ] Upload progress announced

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-12-27 | 0.1     | Initial draft | SM Agent |
