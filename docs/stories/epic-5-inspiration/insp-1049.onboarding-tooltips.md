# Story insp-1049: Onboarding Tooltips

## Status

Draft

## Story

**As a** new user,
**I want** helpful tooltips explaining features,
**so that** I can learn how to use the gallery effectively.

## Acceptance Criteria

1. Tooltip on first gallery visit: "Drag images onto each other to create albums"
2. Tooltips dismissible by click or after delay
3. Don't show again after dismissed
4. Store dismissed state in localStorage
5. Non-intrusive positioning
6. Keyboard accessible (can dismiss with Escape)

## Tasks / Subtasks

- [ ] **Task 1: Create Tooltip Component** (AC: 2, 5, 6)
  - [ ] Create OnboardingTooltip component
  - [ ] Position relative to target element
  - [ ] Dismiss on click or Escape
  - [ ] Auto-dismiss after delay (optional)

- [ ] **Task 2: Track Dismissed State** (AC: 3, 4)
  - [ ] Create useOnboardingTips hook
  - [ ] Store in localStorage
  - [ ] Check before showing

- [ ] **Task 3: Add Stack Gesture Tooltip** (AC: 1)
  - [ ] Show on first gallery visit
  - [ ] Position near gallery grid
  - [ ] "Tip: Drag images onto each other to create albums"

- [ ] **Task 4: Add More Tooltips (Optional)**
  - [ ] First upload tooltip
  - [ ] Keyboard shortcuts tooltip
  - [ ] Album features tooltip

## Dev Notes

### PRD Reference
From PRD Interaction Patterns - Stack-to-Create-Album:
> "Discoverability: Onboarding tooltip on first gallery visit: 'Tip: Drag images onto each other to create albums'"

### Onboarding Hook

```tsx
interface OnboardingTips {
  stackGesture: boolean
  keyboardShortcuts: boolean
  // Add more as needed
}

function useOnboardingTips() {
  const [tips, setTips] = useState<OnboardingTips>(() => {
    const stored = localStorage.getItem('onboarding-tips')
    return stored ? JSON.parse(stored) : {
      stackGesture: false,
      keyboardShortcuts: false,
    }
  })

  function dismissTip(tip: keyof OnboardingTips) {
    const updated = { ...tips, [tip]: true }
    setTips(updated)
    localStorage.setItem('onboarding-tips', JSON.stringify(updated))
  }

  function shouldShowTip(tip: keyof OnboardingTips): boolean {
    return !tips[tip]
  }

  return { shouldShowTip, dismissTip }
}
```

### Tooltip Component

```tsx
interface OnboardingTooltipProps {
  children: React.ReactNode
  content: string
  tipId: string
  position?: 'top' | 'bottom' | 'left' | 'right'
  autoDismissMs?: number
}

function OnboardingTooltip({
  children,
  content,
  tipId,
  position = 'bottom',
  autoDismissMs = 10000,
}: OnboardingTooltipProps) {
  const { shouldShowTip, dismissTip } = useOnboardingTips()
  const [isVisible, setIsVisible] = useState(false)
  const targetRef = useRef<HTMLDivElement>(null)

  useEffect(() => {
    if (shouldShowTip(tipId as keyof OnboardingTips)) {
      // Delay showing to avoid flash
      const timer = setTimeout(() => setIsVisible(true), 500)
      return () => clearTimeout(timer)
    }
  }, [tipId, shouldShowTip])

  useEffect(() => {
    if (isVisible && autoDismissMs) {
      const timer = setTimeout(() => handleDismiss(), autoDismissMs)
      return () => clearTimeout(timer)
    }
  }, [isVisible, autoDismissMs])

  useEffect(() => {
    function handleKeyDown(e: KeyboardEvent) {
      if (e.key === 'Escape' && isVisible) {
        handleDismiss()
      }
    }
    document.addEventListener('keydown', handleKeyDown)
    return () => document.removeEventListener('keydown', handleKeyDown)
  }, [isVisible])

  function handleDismiss() {
    setIsVisible(false)
    dismissTip(tipId as keyof OnboardingTips)
  }

  if (!isVisible) return <>{children}</>

  return (
    <div ref={targetRef} className="relative">
      {children}
      <div
        role="tooltip"
        className={cn(
          "absolute z-50 bg-primary text-primary-foreground rounded-lg p-3 shadow-lg",
          "max-w-xs animate-in fade-in slide-in-from-bottom-2",
          position === 'bottom' && "top-full left-1/2 -translate-x-1/2 mt-2",
          position === 'top' && "bottom-full left-1/2 -translate-x-1/2 mb-2",
        )}
      >
        <button
          onClick={handleDismiss}
          className="absolute top-1 right-1 opacity-70 hover:opacity-100"
          aria-label="Dismiss tip"
        >
          <X className="w-4 h-4" />
        </button>
        <p className="text-sm pr-4">{content}</p>
        {/* Arrow */}
        <div
          className={cn(
            "absolute w-2 h-2 bg-primary rotate-45",
            position === 'bottom' && "-top-1 left-1/2 -translate-x-1/2",
            position === 'top' && "-bottom-1 left-1/2 -translate-x-1/2",
          )}
        />
      </div>
    </div>
  )
}
```

### Usage in Gallery

```tsx
function InspirationGalleryPage() {
  const { shouldShowTip } = useOnboardingTips()

  return (
    <div className="container mx-auto py-6">
      {/* Header */}
      {/* ... */}

      {/* Gallery with tooltip */}
      <OnboardingTooltip
        tipId="stackGesture"
        content="Tip: Drag images onto each other to create albums"
        position="top"
      >
        <GalleryGrid>
          {items.map(item => (
            <InspirationCard key={item.id} inspiration={item} />
          ))}
        </GalleryGrid>
      </OnboardingTooltip>
    </div>
  )
}
```

## Testing

- [ ] Tooltip shows on first visit
- [ ] Click dismisses tooltip
- [ ] Escape dismisses tooltip
- [ ] Tooltip doesn't show after dismissed
- [ ] State persists across sessions
- [ ] Tooltip positioned correctly
- [ ] Auto-dismiss works

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-12-27 | 0.1     | Initial draft | SM Agent |
