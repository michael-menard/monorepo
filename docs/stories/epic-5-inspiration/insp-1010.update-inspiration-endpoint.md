# Story insp-1010: Update Inspiration Endpoint

## Status

Draft

## Story

**As a** user,
**I want** to update an inspiration's metadata,
**so that** I can add or change titles, descriptions, and tags.

## Acceptance Criteria

1. PATCH /api/inspirations/:id updates inspiration
2. Accepts partial updates (only fields provided)
3. Can update: title, description, sourceUrl, tags
4. Returns updated inspiration
5. Returns 404 if not found
6. Returns 403 if user doesn't own inspiration
7. Updates updatedAt timestamp

## Tasks / Subtasks

- [ ] **Task 1: Create Update Endpoint** (AC: 1, 5, 6)
  - [ ] Create PATCH /api/inspirations/:id handler
  - [ ] Add authentication middleware
  - [ ] Validate ownership
  - [ ] Return appropriate error codes

- [ ] **Task 2: Implement Partial Update** (AC: 2, 3, 7)
  - [ ] Parse request with UpdateInspirationRequestSchema
  - [ ] Only update provided fields
  - [ ] Always update updatedAt

- [ ] **Task 3: Return Updated Data** (AC: 4)
  - [ ] Fetch and return complete updated record
  - [ ] Include all fields in response

- [ ] **Task 4: Add to Serverless Config**
  - [ ] Add Lambda function definition
  - [ ] Configure API Gateway route

## Dev Notes

### Endpoint Location
`apps/api/endpoints/inspirations/update/handler.ts`

### Request Schema

```typescript
const UpdateInspirationRequestSchema = z.object({
  title: z.string().max(200).nullable().optional(),
  description: z.string().max(2000).nullable().optional(),
  sourceUrl: z.string().url().nullable().optional(),
  tags: z.array(z.string().max(50)).max(10).optional(),
}).partial()
```

### Database Update

```typescript
const result = await db
  .update(inspirations)
  .set({
    ...validatedData,
    updatedAt: new Date(),
  })
  .where(
    and(
      eq(inspirations.id, id),
      eq(inspirations.userId, userId)
    )
  )
  .returning()
```

### Nullable Fields
Allow setting title/description/sourceUrl to null to clear them.

## Testing

- [ ] Updates title correctly
- [ ] Updates description correctly
- [ ] Updates tags correctly
- [ ] Clears field when set to null
- [ ] Partial update doesn't affect other fields
- [ ] Returns 404 for non-existent
- [ ] Returns 403 for other user's inspiration
- [ ] updatedAt is refreshed

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-12-27 | 0.1     | Initial draft | SM Agent |
