# Story insp-1037: Multi-Select Mode

## Status

Draft

## Story

**As a** user,
**I want** to select multiple items in the gallery,
**so that** I can perform bulk actions on them.

## Acceptance Criteria

1. Shift+click selects range of items
2. Ctrl/Cmd+click adds/removes individual items
3. Checkbox overlay appears on hover in multi-select mode
4. Selection count indicator in toolbar
5. "Select All" and "Clear Selection" actions
6. Selection persists during scroll

## Tasks / Subtasks

- [ ] **Task 1: Implement Selection State** (AC: 1, 2, 6)
  - [ ] Track selected item IDs in state
  - [ ] Handle Shift+click range selection
  - [ ] Handle Ctrl/Cmd+click toggle

- [ ] **Task 2: Add Selection UI** (AC: 3)
  - [ ] Show checkbox on card hover
  - [ ] Checked state for selected items
  - [ ] Visual highlight for selected cards

- [ ] **Task 3: Add Selection Toolbar** (AC: 4, 5)
  - [ ] Show floating toolbar when items selected
  - [ ] Display selection count
  - [ ] Add "Select All" action
  - [ ] Add "Clear Selection" action

- [ ] **Task 4: Preserve Selection** (AC: 6)
  - [ ] Maintain selection during scroll
  - [ ] Handle virtualized list if applicable
  - [ ] Clear on navigation away

## Dev Notes

### PRD Reference
From PRD Gallery View:
> "Multi-select mode for bulk operations (context menu: 'Create album from selected')"

From PRD Keyboard Navigation:
> "Multi-select: Shift + Arrow / Shift + Click"

### Selection State

```typescript
interface SelectionState {
  selectedIds: Set<string>
  lastSelectedId: string | null  // For range selection
}

const [selection, setSelection] = useState<SelectionState>({
  selectedIds: new Set(),
  lastSelectedId: null,
})

function handleItemClick(
  itemId: string,
  event: React.MouseEvent,
  items: Item[]
) {
  if (event.shiftKey && selection.lastSelectedId) {
    // Range selection
    const start = items.findIndex(i => i.id === selection.lastSelectedId)
    const end = items.findIndex(i => i.id === itemId)
    const [from, to] = [Math.min(start, end), Math.max(start, end)]
    const rangeIds = items.slice(from, to + 1).map(i => i.id)

    setSelection({
      selectedIds: new Set([...selection.selectedIds, ...rangeIds]),
      lastSelectedId: itemId,
    })
  } else if (event.ctrlKey || event.metaKey) {
    // Toggle selection
    const next = new Set(selection.selectedIds)
    if (next.has(itemId)) {
      next.delete(itemId)
    } else {
      next.add(itemId)
    }
    setSelection({ selectedIds: next, lastSelectedId: itemId })
  } else {
    // Normal click - navigate to detail
    navigate({ to: '/inspiration/$id', params: { id: itemId } })
  }
}
```

### Card with Selection

```tsx
function InspirationCard({ inspiration, isSelected, onSelect }) {
  const [showCheckbox, setShowCheckbox] = useState(false)

  return (
    <Card
      className={cn(
        "relative cursor-pointer",
        isSelected && "ring-2 ring-primary"
      )}
      onMouseEnter={() => setShowCheckbox(true)}
      onMouseLeave={() => setShowCheckbox(false)}
      onClick={(e) => {
        if (e.shiftKey || e.ctrlKey || e.metaKey) {
          e.preventDefault()
          onSelect(inspiration.id, e)
        }
      }}
    >
      {/* Checkbox overlay */}
      {(showCheckbox || isSelected) && (
        <div className="absolute top-2 left-2 z-10">
          <Checkbox
            checked={isSelected}
            onClick={(e) => {
              e.stopPropagation()
              onSelect(inspiration.id, e)
            }}
          />
        </div>
      )}

      {/* Card content */}
    </Card>
  )
}
```

### Selection Toolbar

```tsx
function SelectionToolbar({ selectedCount, onSelectAll, onClearSelection }) {
  if (selectedCount === 0) return null

  return (
    <div className="fixed bottom-4 left-1/2 -translate-x-1/2 bg-background border rounded-lg shadow-lg p-2 flex items-center gap-4">
      <span className="text-sm font-medium">
        {selectedCount} selected
      </span>
      <div className="flex gap-2">
        <Button size="sm" variant="outline" onClick={onSelectAll}>
          Select All
        </Button>
        <Button size="sm" variant="outline" onClick={onClearSelection}>
          Clear
        </Button>
        <Button size="sm">
          <FolderPlus className="w-4 h-4 mr-1" />
          Create Album
        </Button>
        <Button size="sm" variant="destructive">
          <Trash className="w-4 h-4 mr-1" />
          Delete
        </Button>
      </div>
    </div>
  )
}
```

## Testing

- [ ] Shift+click selects range
- [ ] Ctrl/Cmd+click toggles individual
- [ ] Checkbox appears on hover
- [ ] Selection count shows correctly
- [ ] Select All selects all items
- [ ] Clear clears selection
- [ ] Selection persists during scroll
- [ ] Selection clears on navigation

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-12-27 | 0.1     | Initial draft | SM Agent |
