# Story insp-1025: Add to Album UI (picker modal)

## Status

Draft

## Story

**As a** user,
**I want** to add an inspiration to albums via a picker modal,
**so that** I can easily organize images into collections.

## Acceptance Criteria

1. "+ Add to album" action in inspiration detail view
2. Modal shows list of user's albums with checkboxes
3. Albums containing this inspiration are pre-checked
4. Can check/uncheck to add/remove from albums
5. "Create new album" option at bottom
6. Save applies all changes at once
7. Cancel closes without changes

## Tasks / Subtasks

- [ ] **Task 1: Add Action Button** (AC: 1)
  - [ ] Add "+ Add to album" button to detail view sidebar
  - [ ] Opens AlbumPickerModal

- [ ] **Task 2: Create Picker Modal** (AC: 2, 3)
  - [ ] Create AlbumPickerModal component
  - [ ] Fetch user's albums
  - [ ] Show as checkbox list
  - [ ] Pre-check albums containing this inspiration

- [ ] **Task 3: Add Create Option** (AC: 5)
  - [ ] Add "Create new album" option
  - [ ] Opens inline name input or CreateAlbumModal
  - [ ] New album automatically checked

- [ ] **Task 4: Implement Save** (AC: 4, 6)
  - [ ] Compare initial vs final selections
  - [ ] Call add endpoint for newly checked
  - [ ] Call remove endpoint for unchecked
  - [ ] Show loading state

- [ ] **Task 5: Handle Cancel** (AC: 7)
  - [ ] Close modal on cancel
  - [ ] Reset selections to initial state

## Dev Notes

### Component Location
`apps/web/main-app/src/routes/inspiration/-components/AlbumPickerModal/index.tsx`

### PRD Design Reference

```
┌─────────────────────┐
│  Also in:           │
│  [Castle Ideas]     │  ← Clickable badges
│  [Medieval Builds]  │
│  [Favorites]        │
│  + Add to album...  │  ← Opens album picker
└─────────────────────┘
```

### Implementation

```tsx
function AlbumPickerModal({ inspiration, onClose }) {
  const { data: albums } = useGetAlbumsQuery()
  const [addToAlbum] = useAddInspirationToAlbumMutation()
  const [removeFromAlbum] = useRemoveInspirationFromAlbumMutation()
  const [isLoading, setIsLoading] = useState(false)

  const initialSelected = new Set(inspiration.albumIds)
  const [selected, setSelected] = useState(initialSelected)

  async function handleSave() {
    setIsLoading(true)
    try {
      // Albums to add
      const toAdd = [...selected].filter(id => !initialSelected.has(id))
      // Albums to remove
      const toRemove = [...initialSelected].filter(id => !selected.has(id))

      await Promise.all([
        ...toAdd.map(albumId =>
          addToAlbum({ albumId, inspirationId: inspiration.id }).unwrap()
        ),
        ...toRemove.map(albumId =>
          removeFromAlbum({ albumId, inspirationId: inspiration.id }).unwrap()
        ),
      ])

      onClose()
      toast.success('Album membership updated')
    } catch {
      toast.error('Failed to update albums')
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <Dialog open onOpenChange={onClose}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>Add to Albums</DialogTitle>
        </DialogHeader>

        <div className="space-y-2 max-h-60 overflow-y-auto">
          {albums?.items.map(album => (
            <label
              key={album.id}
              className="flex items-center space-x-3 p-2 hover:bg-muted rounded cursor-pointer"
            >
              <Checkbox
                checked={selected.has(album.id)}
                onCheckedChange={(checked) => {
                  const next = new Set(selected)
                  if (checked) next.add(album.id)
                  else next.delete(album.id)
                  setSelected(next)
                }}
              />
              <span>{album.title}</span>
              <Badge variant="secondary" className="ml-auto">
                {album.itemCount}
              </Badge>
            </label>
          ))}
        </div>

        <Button variant="ghost" className="w-full justify-start">
          <Plus className="w-4 h-4 mr-2" />
          Create new album
        </Button>

        <DialogFooter>
          <Button variant="outline" onClick={onClose}>Cancel</Button>
          <Button onClick={handleSave} disabled={isLoading}>
            {isLoading ? 'Saving...' : 'Save'}
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  )
}
```

### Dependencies
- insp-1024: Add Inspiration to Album Endpoint
- insp-1026: Remove from Album Endpoint

## Testing

- [ ] Modal opens from detail view
- [ ] Shows all user's albums
- [ ] Current memberships pre-checked
- [ ] Check adds to album
- [ ] Uncheck removes from album
- [ ] Create new album works
- [ ] Save applies all changes
- [ ] Cancel closes without changes

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-12-27 | 0.1     | Initial draft | SM Agent |
