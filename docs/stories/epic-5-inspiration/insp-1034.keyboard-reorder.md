# Story insp-1034: Keyboard Reorder

## Status

Draft

## Story

**As a** user using keyboard navigation,
**I want** to reorder items with arrow keys,
**so that** I can organize my gallery without a mouse.

## Acceptance Criteria

1. Select item with Space
2. Arrow keys move item position
3. Enter confirms new position
4. Escape cancels reorder
5. Screen reader announces movement
6. Visual indicator shows reorder mode

## Tasks / Subtasks

- [ ] **Task 1: Add Selection State** (AC: 1)
  - [ ] Track selected item
  - [ ] Space toggles selection
  - [ ] Visual indicator for selected

- [ ] **Task 2: Implement Arrow Key Movement** (AC: 2)
  - [ ] Left/Right moves horizontally
  - [ ] Up/Down moves by row
  - [ ] Calculate grid positions

- [ ] **Task 3: Add Confirmation** (AC: 3, 4)
  - [ ] Enter confirms and exits mode
  - [ ] Escape cancels and reverts
  - [ ] Call reorder API on confirm

- [ ] **Task 4: Add Accessibility** (AC: 5, 6)
  - [ ] Announce mode entry
  - [ ] Announce each move
  - [ ] Show visual reorder indicator

## Dev Notes

### PRD Reference
From PRD Interaction Patterns:
> "Keyboard alternative: Select item → Arrow keys to move → Enter to confirm"

From PRD Screen Reader Support:
> "Drag operation: 'Grabbed [item]. Use arrow keys to move. Enter to drop. Escape to cancel.'"
> "Drop completed: '[Item] moved to position [X]'"

### dnd-kit Keyboard Support
dnd-kit includes keyboard sensors. Extend with custom announcements:

```tsx
import { Announcements } from '@dnd-kit/core'

const announcements: Announcements = {
  onDragStart({ active }) {
    return `Grabbed ${active.data.current?.title || 'item'}. Use arrow keys to move. Enter to drop. Escape to cancel.`
  },
  onDragOver({ active, over }) {
    if (over) {
      return `Moving to position ${over.data.current?.sortIndex + 1}`
    }
    return ''
  },
  onDragEnd({ active, over }) {
    if (over) {
      return `${active.data.current?.title} moved to position ${over.data.current?.sortIndex + 1}`
    }
    return `Movement cancelled`
  },
  onDragCancel({ active }) {
    return `Reorder cancelled. ${active.data.current?.title} returned to original position.`
  },
}

<DndContext
  announcements={announcements}
  // ...
>
```

### Visual Reorder Mode

```tsx
function SortableCard({ item, isReordering }) {
  return (
    <Card
      className={cn(
        "relative",
        isReordering && "ring-2 ring-primary animate-pulse"
      )}
    >
      {isReordering && (
        <div className="absolute -top-2 left-1/2 -translate-x-1/2 bg-primary text-primary-foreground text-xs px-2 py-0.5 rounded">
          Reordering...
        </div>
      )}
      {/* Card content */}
    </Card>
  )
}
```

### Grid Position Calculation

```typescript
function calculateNewPosition(
  currentIndex: number,
  direction: 'up' | 'down' | 'left' | 'right',
  columnsPerRow: number,
  totalItems: number
): number {
  switch (direction) {
    case 'left':
      return Math.max(0, currentIndex - 1)
    case 'right':
      return Math.min(totalItems - 1, currentIndex + 1)
    case 'up':
      return Math.max(0, currentIndex - columnsPerRow)
    case 'down':
      return Math.min(totalItems - 1, currentIndex + columnsPerRow)
  }
}
```

### Dependencies
- insp-1033: Drag-and-Drop Reorder (base DnD setup)

## Testing

- [ ] Space selects item
- [ ] Arrow keys move item
- [ ] Enter confirms position
- [ ] Escape cancels
- [ ] Screen reader announcements work
- [ ] Visual indicator shows mode
- [ ] Grid navigation is intuitive

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-12-27 | 0.1     | Initial draft | SM Agent |
