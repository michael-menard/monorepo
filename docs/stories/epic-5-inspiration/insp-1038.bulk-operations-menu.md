# Story insp-1038: Bulk Operations Menu

## Status

Draft

## Story

**As a** user with multiple items selected,
**I want** a menu of bulk actions,
**so that** I can efficiently manage many items at once.

## Acceptance Criteria

1. Context menu appears on right-click with selection
2. "Create album from selected" option
3. "Add to album" option (opens album picker)
4. "Delete selected" option (with confirmation)
5. Actions apply to all selected items
6. Progress indicator for bulk operations

## Tasks / Subtasks

- [ ] **Task 1: Add Context Menu** (AC: 1)
  - [ ] Show on right-click when items selected
  - [ ] Position near cursor
  - [ ] Show from selection toolbar

- [ ] **Task 2: Implement "Create Album from Selected"** (AC: 2, 5)
  - [ ] Prompt for album name
  - [ ] Create album
  - [ ] Add all selected items
  - [ ] Clear selection after

- [ ] **Task 3: Implement "Add to Album"** (AC: 3, 5)
  - [ ] Open album picker modal
  - [ ] Add all selected to chosen album(s)
  - [ ] Show success count

- [ ] **Task 4: Implement "Delete Selected"** (AC: 4, 5)
  - [ ] Show confirmation with count
  - [ ] Delete all selected items
  - [ ] Refresh gallery

- [ ] **Task 5: Add Progress Indicator** (AC: 6)
  - [ ] Show progress for bulk operations
  - [ ] Handle partial failures
  - [ ] Report results

## Dev Notes

### PRD Reference
From PRD Gallery View:
> "Multi-select mode for bulk operations (context menu: 'Create album from selected')"

From PRD Interaction Patterns - Stack-to-Create-Album:
> "Alternative: Multi-select → Context menu → 'Create album from selected' for precision"

### Context Menu

```tsx
function SelectionContextMenu({ selectedItems, position, onClose }) {
  return (
    <ContextMenu open={true}>
      <ContextMenuContent style={{ left: position.x, top: position.y }}>
        <ContextMenuItem onClick={() => handleCreateAlbum(selectedItems)}>
          <Layers className="w-4 h-4 mr-2" />
          Create album from selected
          <ContextMenuShortcut>G</ContextMenuShortcut>
        </ContextMenuItem>

        <ContextMenuItem onClick={() => handleAddToAlbum(selectedItems)}>
          <FolderPlus className="w-4 h-4 mr-2" />
          Add to album...
        </ContextMenuItem>

        <ContextMenuSeparator />

        <ContextMenuItem
          className="text-destructive"
          onClick={() => handleDeleteSelected(selectedItems)}
        >
          <Trash className="w-4 h-4 mr-2" />
          Delete {selectedItems.length} items
        </ContextMenuItem>
      </ContextMenuContent>
    </ContextMenu>
  )
}
```

### Create Album from Selected

```typescript
async function handleCreateAlbum(items: Inspiration[]) {
  // 1. Prompt for name
  const name = await promptAlbumName()
  if (!name) return

  // 2. Create album
  const album = await createAlbum({ title: name }).unwrap()

  // 3. Add all items with progress
  let completed = 0
  setProgress({ total: items.length, completed: 0 })

  for (const item of items) {
    await addToAlbum({ albumId: album.id, inspirationId: item.id }).unwrap()
    completed++
    setProgress({ total: items.length, completed })
  }

  // 4. Clear selection and navigate
  clearSelection()
  navigate({ to: '/inspiration/albums/$id', params: { id: album.id } })
}
```

### Delete Confirmation

```tsx
function DeleteConfirmationModal({ items, onConfirm, onCancel }) {
  return (
    <AlertDialog open>
      <AlertDialogContent>
        <AlertDialogHeader>
          <AlertDialogTitle>
            Delete {items.length} items?
          </AlertDialogTitle>
          <AlertDialogDescription>
            This will permanently delete {items.length} inspiration images.
            This action cannot be undone.
          </AlertDialogDescription>
        </AlertDialogHeader>
        <AlertDialogFooter>
          <AlertDialogCancel onClick={onCancel}>Cancel</AlertDialogCancel>
          <AlertDialogAction
            onClick={onConfirm}
            className="bg-destructive hover:bg-destructive/90"
          >
            Delete {items.length} items
          </AlertDialogAction>
        </AlertDialogFooter>
      </AlertDialogContent>
    </AlertDialog>
  )
}
```

### Progress Indicator

```tsx
function BulkOperationProgress({ operation, progress }) {
  return (
    <Dialog open={progress !== null}>
      <DialogContent className="sm:max-w-sm">
        <DialogHeader>
          <DialogTitle>{operation}...</DialogTitle>
        </DialogHeader>
        <div className="space-y-2">
          <Progress value={(progress.completed / progress.total) * 100} />
          <p className="text-sm text-muted-foreground text-center">
            {progress.completed} of {progress.total} complete
          </p>
        </div>
      </DialogContent>
    </Dialog>
  )
}
```

### Dependencies
- insp-1037: Multi-Select Mode
- insp-1014: Create Album Endpoint
- insp-1024: Add Inspiration to Album Endpoint
- insp-1012: Delete Inspiration Endpoint

## Testing

- [ ] Context menu appears on right-click
- [ ] "Create album" creates and adds all
- [ ] "Add to album" opens picker and adds all
- [ ] "Delete" confirms and deletes all
- [ ] Progress shows during bulk ops
- [ ] Partial failures handled
- [ ] Selection clears after operations

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-12-27 | 0.1     | Initial draft | SM Agent |
