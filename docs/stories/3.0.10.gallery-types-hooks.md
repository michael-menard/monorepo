# Story 3.0.10: Gallery Types & Shared Hooks

## Status

Draft

## Story

**As a** developer,
**I want** shared TypeScript types and hooks for gallery state,
**so that** all galleries have consistent data structures and behavior.

## Acceptance Criteria

1. ⬜ Core gallery types defined (GalleryItem, GalleryFilter, etc.)
2. ⬜ useGalleryState hook for managing filter/sort/search state
3. ⬜ useGalleryUrl hook for syncing state with URL params
4. ⬜ Types exported from @repo/gallery package
5. ⬜ Hooks composable and reusable across galleries

## Tasks / Subtasks

- [ ] **Task 1: Core Types**
  - [ ] Create `src/types/index.ts`
  - [ ] Define GalleryItem base interface
  - [ ] Define GalleryFilter, GallerySort types
  - [ ] Define pagination types

- [ ] **Task 2: useGalleryState Hook**
  - [ ] Create `src/hooks/useGalleryState.ts`
  - [ ] Manage search, tags, theme, sort state
  - [ ] Provide clear/reset functionality

- [ ] **Task 3: useGalleryUrl Hook**
  - [ ] Create `src/hooks/useGalleryUrl.ts`
  - [ ] Sync state to URL search params
  - [ ] Parse URL params to state on mount
  - [ ] Use TanStack Router's useSearch

- [ ] **Task 4: Exports**
  - [ ] Export all types from package index
  - [ ] Export all hooks from package index

## Dev Notes

### Core Types

```typescript
// src/types/index.ts

export interface GalleryImage {
  id: string
  src: string
  thumbnail: string
  alt: string
  width?: number
  height?: number
}

export interface GalleryItem {
  id: string
  title: string
  description?: string
  images: GalleryImage[]
  tags: string[]
  theme?: string
  createdAt: string
  updatedAt: string
}

export interface GalleryFilterState {
  search: string
  tags: string[]
  theme: string | null
}

export interface GallerySortState {
  field: string
  direction: 'asc' | 'desc'
}

export interface GalleryPaginationState {
  page: number
  pageSize: number
  total?: number
}

export interface GalleryState extends GalleryFilterState, GallerySortState {
  pagination: GalleryPaginationState
}

export type SortOption = {
  value: string
  label: string
  defaultDirection?: 'asc' | 'desc'
}
```

### useGalleryState Hook

```typescript
interface UseGalleryStateOptions {
  defaultSort?: { field: string; direction: 'asc' | 'desc' }
  defaultPageSize?: number
}

interface UseGalleryStateReturn {
  // Filter state
  search: string
  setSearch: (search: string) => void
  tags: string[]
  setTags: (tags: string[]) => void
  addTag: (tag: string) => void
  removeTag: (tag: string) => void
  theme: string | null
  setTheme: (theme: string | null) => void

  // Sort state
  sortField: string
  sortDirection: 'asc' | 'desc'
  setSort: (field: string, direction: 'asc' | 'desc') => void

  // Pagination
  page: number
  setPage: (page: number) => void
  pageSize: number
  setPageSize: (size: number) => void

  // Actions
  clearFilters: () => void
  resetAll: () => void

  // Computed
  hasActiveFilters: boolean
  queryParams: Record<string, string | string[]>
}

function useGalleryState(options?: UseGalleryStateOptions): UseGalleryStateReturn
```

### useGalleryUrl Hook

```typescript
interface UseGalleryUrlOptions {
  // TanStack Router search params schema
  paramKeys?: {
    search?: string   // default: 'q'
    tags?: string     // default: 'tags'
    theme?: string    // default: 'theme'
    sort?: string     // default: 'sort'
    order?: string    // default: 'order'
    page?: string     // default: 'page'
  }
}

function useGalleryUrl(options?: UseGalleryUrlOptions) {
  const search = useSearch({ from: '/' })
  const navigate = useNavigate()

  const state: GalleryState = useMemo(() => ({
    search: search.q ?? '',
    tags: search.tags ?? [],
    theme: search.theme ?? null,
    sortField: search.sort ?? 'dateAdded',
    sortDirection: search.order ?? 'desc',
    page: search.page ?? 1,
  }), [search])

  const updateUrl = useCallback((updates: Partial<GalleryState>) => {
    navigate({
      search: (prev) => ({
        ...prev,
        ...updates,
        // Reset page on filter change
        page: 'search' in updates || 'tags' in updates ? 1 : prev.page,
      }),
    })
  }, [navigate])

  return { state, updateUrl }
}
```

### Combined Usage

```typescript
// In a gallery page
function InstructionsGalleryPage() {
  const { state, updateUrl } = useGalleryUrl()

  const { data, isLoading } = useGetInstructionsQuery({
    search: state.search,
    tags: state.tags,
    theme: state.theme,
    sort: state.sortField,
    order: state.sortDirection,
    page: state.page,
  })

  return (
    <GalleryFilterBar
      search={state.search}
      onSearchChange={(s) => updateUrl({ search: s })}
      // ...
    />
  )
}
```

## Testing

- [ ] Unit test: useGalleryState manages all state correctly
- [ ] Unit test: clearFilters resets filter state only
- [ ] Unit test: hasActiveFilters computed correctly
- [ ] Unit test: useGalleryUrl parses URL params
- [ ] Unit test: updateUrl navigates with correct params

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-11-30 | 0.1     | Initial draft | SM Agent |
