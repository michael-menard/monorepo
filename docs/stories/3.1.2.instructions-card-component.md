# Story 3.1.2: Instructions Card Component

## Status

Ready for Review

## Story

**As a** user,
**I want** instruction items displayed in informative cards,
**so that** I can see key details at a glance.

## Acceptance Criteria

1. ✅ InstructionCard component composes with GalleryCard
2. ✅ Displays thumbnail image (4:3 aspect ratio)
3. ✅ Shows instruction name/title
4. ✅ Shows piece count badge
5. ✅ Shows theme tag
6. ✅ Click navigates to instruction detail page (via onClick prop)
7. ✅ Hover shows additional actions (favorite, edit)

## Tasks / Subtasks

- [x] **Task 1: Create InstructionCard Component**
  - [x] Create `components/InstructionCard/index.tsx` in app-instructions-gallery
  - [x] Compose with GalleryCard from @repo/gallery
  - [x] Define Instruction Zod schema in `__types__/index.ts`

- [x] **Task 2: Card Content**
  - [x] Thumbnail image with 4:3 aspect ratio
  - [x] Title text (truncate via GalleryCard line-clamp)
  - [x] Piece count as Badge (secondary variant)
  - [x] Theme as subtle muted-foreground text

- [x] **Task 3: Card Actions**
  - [x] onClick callback for navigation
  - [x] Hover overlay with action buttons (via GalleryCard actions slot)
  - [x] Favorite heart icon (fills red when favorited)
  - [x] Edit pencil icon

## Dev Notes

### Component API

```typescript
interface Instruction {
  id: string
  name: string
  thumbnail: string
  pieceCount: number
  theme: string
  tags: string[]
  createdAt: string
  isFavorite?: boolean
}

interface InstructionCardProps {
  instruction: Instruction
  onFavorite?: (id: string) => void
  onEdit?: (id: string) => void
}

function InstructionCard({ instruction, onFavorite, onEdit }: InstructionCardProps) {
  const navigate = useNavigate()

  return (
    <GalleryCard
      image={{
        src: instruction.thumbnail,
        alt: instruction.name,
        aspectRatio: '4/3',
      }}
      title={instruction.name}
      onClick={() => navigate({ to: '/instructions/$instructionId', params: { instructionId: instruction.id } })}
      metadata={
        <div className="flex items-center gap-2">
          <Badge variant="secondary">{instruction.pieceCount} pieces</Badge>
          <span className="text-sm text-muted-foreground">{instruction.theme}</span>
        </div>
      }
      actions={
        <div className="flex gap-1">
          <Button
            variant="ghost"
            size="icon"
            onClick={(e) => {
              e.stopPropagation()
              onFavorite?.(instruction.id)
            }}
          >
            <Heart className={cn(instruction.isFavorite && 'fill-current text-red-500')} />
          </Button>
          <Button
            variant="ghost"
            size="icon"
            onClick={(e) => {
              e.stopPropagation()
              onEdit?.(instruction.id)
            }}
          >
            <Pencil />
          </Button>
        </div>
      }
    />
  )
}
```

### Hover State Actions

```typescript
// Actions only visible on hover
<div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
  <Button variant="secondary" size="sm">
    <Heart className="w-4 h-4 mr-1" />
    Favorite
  </Button>
  <Button variant="secondary" size="sm">
    <Pencil className="w-4 h-4 mr-1" />
    Edit
  </Button>
</div>
```

## Testing

- [x] Unit test: renders instruction data correctly
- [x] Unit test: click calls navigation
- [x] Unit test: favorite button calls onFavorite
- [x] Unit test: edit button calls onEdit
- [x] Unit test: buttons stop propagation

## Change Log

| Date       | Version | Description             | Author    |
| ---------- | ------- | ----------------------- | --------- |
| 2025-11-30 | 0.1     | Initial draft           | SM Agent  |
| 2025-12-05 | 1.0     | Implementation complete | Dev Agent |

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5

### Debug Log References

N/A

### Completion Notes

- Created Instruction Zod schema with full type validation in `__types__/index.ts`
- InstructionCard component composes with GalleryCard from @repo/gallery
- 20 unit tests covering all acceptance criteria including event propagation
- Integrated InstructionCard into MainPage with mock data (4 sample instructions)
- Added @repo/gallery dependency to app-instructions-gallery
- All 25 tests passing

### File List

- `apps/web/app-instructions-gallery/src/__types__/index.ts` - New: Instruction Zod schema
- `apps/web/app-instructions-gallery/src/components/InstructionCard/index.tsx` - New: InstructionCard component
- `apps/web/app-instructions-gallery/src/components/InstructionCard/__tests__/InstructionCard.test.tsx` - New: 20 unit tests
- `apps/web/app-instructions-gallery/src/pages/main-page.tsx` - Modified: Integrated InstructionCard with mock data
- `apps/web/app-instructions-gallery/src/App.test.tsx` - Modified: Updated tests for new gallery content
- `apps/web/app-instructions-gallery/package.json` - Modified: Added @repo/gallery dependency
