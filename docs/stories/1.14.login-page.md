# Story 1.14: Login Page

## Status

Approved

## Story

**As a** user,
**I want** a login page with email/password form,
**so that** I can authenticate to access the app.

## Acceptance Criteria

1. ✅ Login page exists at /login route
2. ⬜ Email input with validation
3. ⬜ Password input with show/hide toggle
4. ⬜ Submit button calls Amplify signIn
5. ⬜ Error messages displayed for invalid credentials
6. ⬜ Loading state during authentication
7. ⬜ Redirect to /dashboard on success
8. ⬜ Link to forgot password page
9. ⬜ Link to signup page
10. ⬜ Accessible form with labels and ARIA

## Tasks / Subtasks

- [ ] **Task 1: Verify Page Exists** (AC: 1)
  - [x] Check routes/pages/LoginPage.tsx exists
  - [ ] Verify route configuration at /login

- [ ] **Task 2: Form Validation** (AC: 2-3)
  - [ ] Email field with Zod validation
  - [ ] Password field with min length validation
  - [ ] Show/hide password toggle
  - [ ] Use @repo/ui Input component

- [ ] **Task 3: Amplify Integration** (AC: 4-6)
  - [ ] Call signIn from @aws-amplify/auth
  - [ ] Handle success → dispatch setAuthenticated
  - [ ] Handle error → display message
  - [ ] Show loading spinner during call

- [ ] **Task 4: Navigation** (AC: 7-9)
  - [ ] Redirect to dashboard on success
  - [ ] Use redirect search param if available
  - [ ] Add "Forgot Password?" link
  - [ ] Add "Sign Up" link

- [ ] **Task 5: Accessibility** (AC: 10)
  - [ ] Labels associated with inputs
  - [ ] Error messages have aria-live
  - [ ] Focus management on error

## Dev Notes

### Existing Implementation

**File:** `apps/web/main-app/src/routes/pages/LoginPage.tsx`

### Amplify v6 Sign In

```typescript
import { signIn } from '@aws-amplify/auth'

async function handleSignIn(email: string, password: string) {
  try {
    const result = await signIn({
      username: email,
      password,
      options: {
        authFlowType: 'USER_SRP_AUTH',
      },
    })

    if (result.isSignedIn) {
      // Dispatch to Redux
      dispatch(setAuthenticated({ user, tokens }))
      navigate('/dashboard')
    }
  } catch (error) {
    setError(error.message)
  }
}
```

### Form Schema (Zod)

```typescript
const loginSchema = z.object({
  email: z.string().email('Invalid email address'),
  password: z.string().min(8, 'Password must be at least 8 characters'),
})
```

### @repo/ui Components

- Input (email, password)
- Button (submit)
- Card (form container)
- Alert (error message)

### Testing

- Test form validation
- Test error display
- Test successful login flow (mocked)
- Test redirect behavior

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-11-28 | 0.1     | Initial draft | SM Agent |
