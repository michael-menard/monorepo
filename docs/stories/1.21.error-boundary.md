# Story 1.21: Error Boundary

## Status

Ready for Review

## Story

**As a** user,
**I want** errors to be caught gracefully,
**so that** I see a friendly message instead of a broken page.

## Acceptance Criteria

1. ✅ ErrorBoundary component exists
2. ✅ Catches JavaScript errors in child tree
3. ✅ Displays user-friendly error message
4. ✅ "Try Again" button to retry/reload
5. ✅ Logs errors for debugging
6. ✅ Wraps main content area

## Tasks / Subtasks

- [x] **Task 1: Verify Component Exists** (AC: 1)
  - [x] Check components/ErrorBoundary/ErrorBoundary.tsx
  - [x] Review current implementation

- [x] **Task 2: Error Catching** (AC: 2)
  - [x] Implement componentDidCatch or use react-error-boundary
  - [x] Catch rendering errors
  - [x] Handle async errors where possible

- [x] **Task 3: Error UI** (AC: 3-4)
  - [x] Design friendly error message
  - [x] Add "Try Again" button
  - [x] Optionally show error details in dev
  - [x] Use brand styling

- [x] **Task 4: Logging** (AC: 5)
  - [x] Log to @repo/logger
  - [x] Include error stack, component stack
  - [x] Consider error reporting service

- [x] **Task 5: Integration** (AC: 6)
  - [x] Wrap Outlet in RootLayout
  - [x] Or use router errorComponent

## File List

### Modified Files
- `apps/web/main-app/src/components/ErrorBoundary/ErrorBoundary.tsx` - Fixed imports to use @repo/ui barrel export, added RouteErrorComponent for router integration
- `apps/web/main-app/src/routes/index.ts` - Added errorComponent to root route configuration

### Created Files
- `apps/web/main-app/src/components/ErrorBoundary/__tests__/ErrorBoundary.test.tsx` - Comprehensive test suite (26 tests)

## Dev Notes

### Existing Implementation

**File:** `apps/web/main-app/src/components/ErrorBoundary/ErrorBoundary.tsx`

### Class Component Pattern

```typescript
interface State {
  hasError: boolean
  error: Error | null
}

export class ErrorBoundary extends React.Component<Props, State> {
  state = { hasError: false, error: null }

  static getDerivedStateFromError(error: Error) {
    return { hasError: true, error }
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    logger.error('ErrorBoundary caught error', { error, errorInfo })
  }

  handleRetry = () => {
    this.setState({ hasError: false, error: null })
  }

  render() {
    if (this.state.hasError) {
      return <ErrorFallback onRetry={this.handleRetry} />
    }
    return this.props.children
  }
}
```

### Error Fallback UI

```typescript
function ErrorFallback({ onRetry }: { onRetry: () => void }) {
  return (
    <div className="flex flex-col items-center justify-center min-h-[50vh]">
      <AlertTriangle className="h-12 w-12 text-destructive" />
      <h2 className="mt-4 text-xl font-semibold">Something went wrong</h2>
      <p className="text-muted-foreground">We're sorry, an error occurred.</p>
      <Button onClick={onRetry} className="mt-4">
        Try Again
      </Button>
    </div>
  )
}
```

### TanStack Router Integration

```typescript
const rootRoute = createRootRoute({
  component: RootLayout,
  errorComponent: ErrorFallback,
})
```

### Testing

- Test error boundary catches errors
- Test fallback UI renders
- Test retry button resets state
- Test logging is called

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-11-28 | 0.1     | Initial draft | SM Agent |
| 2025-11-30 | 1.0     | Implementation complete - Fixed imports, added RouteErrorComponent, created comprehensive test suite (26 tests passing) | Dev Agent |
