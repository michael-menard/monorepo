# Story 1.6: MOC Instructions Module Application

## Status

Draft

## Story

**As a** user,
**I want** an enhanced MOC instructions module with better file management and navigation,
**so that** I can create, view, and manage my LEGO MOC instructions more efficiently.

## Acceptance Criteria

1. MOC instructions app extracted to `apps/web/moc-instructions-app/` using existing `@repo/moc-instructions` package
2. Enhanced step-by-step instruction navigation with improved UX
3. Better file upload and management interface with progress indicators
4. Integration with serverless API endpoints for MOC operations
5. Improved thumbnail generation and image optimization
6. Enhanced search and filtering capabilities

## Integration Verification

- **IV1**: Existing MOC instructions and files remain fully accessible
- **IV2**: File upload and management functionality continues working
- **IV3**: MOC creation and editing workflows remain uninterrupted

## Dev Notes

### Technical Context

This story extracts the existing comprehensive MOC instructions functionality from the monolithic app into a standalone modular application, leveraging the existing `@repo/moc-instructions` package while enhancing it with modern UI components and serverless integration.

### Architecture References

- **Component Architecture**: MOC Instructions Module Application with enhanced file handling and step-by-step interface [Source: architecture/component-architecture.md#moc-instructions-module-application]
- **User Flows**: Create and Upload MOC Instructions flow with step-by-step process [Source: front-end-spec/user-flows.md#flow-2-create-and-upload-moc-instructions]
- **Technology Stack**: React 19, file upload optimization, enhanced form components [Source: architecture/tech-stack.md]

### Existing MOC Instructions Package Analysis

**Current MOC Instructions Package** (`@repo/moc-instructions` - `packages/features/moc-instructions/`):

**Comprehensive Feature Set**:

- ✅ **Instruction Builder**: Create step-by-step building instructions
- ✅ **File Management**: Upload and manage instruction files, parts lists, thumbnails
- ✅ **Image Integration**: Add images to each instruction step with S3 storage
- ✅ **Version Control**: Track changes and revisions
- ✅ **Gallery Integration**: Link gallery images to MOC instructions
- ✅ **RTK Query Integration**: Complete API layer with file upload/download
- ✅ **Search & Filtering**: Advanced filtering by category, difficulty, author, tags
- ✅ **Parts List Management**: CSV parts list parsing and management

**Existing Components**:

- `MocInstructionsGallery`: Main gallery with filtering and sorting
- `InstructionsCard`: Individual MOC instruction display
- `DownloadManager`: File download with progress tracking
- `GalleryImageLinker`: Link gallery images to MOC instructions
- `DownloadProgressComponent`: Progress indicators for file operations

**Current API Hooks**:

- `useGetInstructionsQuery`, `useCreateInstructionMutation`
- `useUploadInstructionsFileMutation`, `useDeleteInstructionsFileMutation`
- `useUploadInstructionsImageMutation`, `useDownloadInstructionsFileMutation`
- `useCreateInstructionsPartsListMutation`, `useUploadPartsListFileMutation`

**Current Technology Stack**:

- React 19, RTK Query, S3 file storage, Zod validation
- TypeScript with comprehensive schemas for MOCs and Sets
- Already uses `@repo/ui` components and file upload utilities

### MOC Instructions Module Enhancement Strategy

**Leverage Existing Strengths**:

- ✅ **Rich Feature Set**: Comprehensive MOC management already implemented
- ✅ **File Management**: Advanced file upload/download with S3 integration
- ✅ **Type Safety**: Full TypeScript with Zod schemas for MOCs and Sets
- ✅ **Performance**: RTK Query with caching and optimistic updates

**Enhancement Areas**:

1. **UI Components**: Upgrade to enhanced shadcn/ui components from Story 1.1
2. **API Integration**: Connect to serverless endpoints from Story 1.2
3. **Module Structure**: Extract into standalone app with shell integration
4. **File Upload UX**: Enhanced progress indicators and drag-drop interface
5. **Step Navigation**: Improved step-by-step instruction navigation

### Key Interfaces

- MOC creation wizard with improved UX
- Enhanced file upload with progress indicators
- Step-by-step instruction builder
- Parts list management and integration

### File Locations

- **MOC Instructions App**: `apps/web/moc-instructions-app/` (new standalone application)
- **MOC Components**: `apps/web/moc-instructions-app/src/components/` (app-specific components)
- **MOC Pages**: `apps/web/moc-instructions-app/src/pages/` (MOC routing and pages)
- **MOC Services**: `apps/web/moc-instructions-app/src/services/` (MOC-specific API integration)
- **MOC Store**: `apps/web/moc-instructions-app/src/store/` (MOC state management)
- **Existing Package**: `packages/features/moc-instructions/` (enhanced with new components)

### Enhanced User Experience Features

**Modern Creation Wizard** (using enhanced shadcn/ui components):

- Enhanced Form components with real-time validation
- Step-by-step wizard with progress indicators
- Improved file upload with drag-drop functionality
- Better thumbnail generation and preview

**Advanced File Management**:

- Enhanced file upload with progress tracking
- Drag-and-drop file organization
- Batch file operations and management
- Image optimization and modern formats (WebP, AVIF)

**Improved Navigation**:

- Step-by-step instruction navigation with enhanced UX
- Thumbnail previews for quick navigation
- Keyboard shortcuts for power users
- Mobile-optimized instruction viewing

### Testing Requirements

- Unit tests for MOC components using existing Vitest setup
- Integration tests for serverless API endpoints and file operations
- File upload testing with progress tracking and error handling
- Performance testing for large file uploads and image optimization
- Cross-module integration testing (gallery → MOC instructions linking)

### Technical Constraints

- Must maintain existing `@repo/moc-instructions` package functionality
- Existing MOC API hooks and file management must continue working
- Current MOC data and file storage must remain functional
- S3 file storage integration must be preserved
- Must integrate with shell app routing from Story 1.3

## Tasks / Subtasks

- [ ] **Task 1: Create MOC instructions app structure** (AC: 1)
  - [ ] Create `apps/web/moc-instructions-app/` directory with package.json
  - [ ] Set up Vite configuration for MOC instructions app
  - [ ] Configure TypeScript, ESLint, and testing setup
  - [ ] Create basic app entry point and routing structure

- [ ] **Task 2: Enhance `packages/features/moc-instructions/` package** (AC: 2, 6)
  - [ ] **Update existing components**: Upgrade MocInstructionsGallery, InstructionsCard, DownloadManager with shadcn/ui
  - [ ] **Improve visual hierarchy**: Enhance existing InstructionsCard with better typography and spacing
  - [ ] **Enhance filtering and search**: Update existing gallery filtering with improved UX patterns
  - [ ] **Add enhanced loading states**: Update existing skeleton screens with shadcn/ui loading components

- [ ] **Task 3: Integrate serverless API endpoints** (AC: 4)
  - [ ] Connect existing RTK Query hooks to serverless endpoints from Story 1.2
  - [ ] Implement enhanced MOC API integration with performance monitoring
  - [ ] Add optimistic UI updates for better perceived performance
  - [ ] Update error handling for serverless response patterns

- [ ] **Task 4: Enhance file upload and management** (AC: 3, 5)
  - [ ] Improve file upload interface with enhanced progress indicators
  - [ ] Add drag-and-drop functionality for file uploads
  - [ ] Implement batch file operations and management
  - [ ] Enhance thumbnail generation and image optimization

- [ ] **Task 5: Improve step-by-step navigation** (AC: 2)
  - [ ] Create enhanced step navigation with thumbnail previews
  - [ ] Add keyboard shortcuts for instruction navigation
  - [ ] Implement mobile-optimized instruction viewing
  - [ ] Add step progress tracking and bookmarking

- [ ] **Task 6: Create MOC app pages and routing** (AC: 1, 6)
  - [ ] Create MOC creation wizard with improved UX
  - [ ] Implement MOC editing and management pages
  - [ ] Add MOC viewing page with enhanced navigation
  - [ ] Set up responsive routing for mobile and desktop

- [ ] **Task 7: Enhance search and filtering** (AC: 6)
  - [ ] Improve search functionality with serverless backend performance
  - [ ] Add advanced filtering options with better UX
  - [ ] Implement saved searches and filter presets
  - [ ] Add search result highlighting and relevance scoring

- [ ] **Task 8: Optimize image and file handling** (AC: 5)
  - [ ] Implement progressive image loading for instruction steps
  - [ ] Add image optimization and modern format support
  - [ ] Enhance file compression and storage optimization
  - [ ] Add image editing capabilities (crop, resize, rotate)

- [ ] **Task 9: Integration testing and validation** (IV1, IV2, IV3)
  - [ ] Test existing MOC instructions and files remain fully accessible
  - [ ] Validate file upload and management functionality continues working
  - [ ] Verify MOC creation and editing workflows remain uninterrupted
  - [ ] Test cross-module integration with gallery image linking

## Testing

- Unit tests using Vitest for MOC components and enhanced UI
- Integration tests for serverless API endpoints and file operations
- File upload testing with progress tracking and error handling
- Performance testing for large file uploads and image optimization
- Mobile testing for instruction viewing and creation workflows
- Cross-module integration testing for gallery → MOC instructions linking

## Dependencies

- **Depends on**: Story 1.1 (Enhanced Shared Component Library) - for enhanced UI components
- **Depends on**: Story 1.2 (Serverless API Client Foundation) - for API integration
- **Depends on**: Story 1.3 (Shell Application Foundation) - for app routing and integration
- **Integrates with**: Story 1.4 (Gallery Module) - for gallery image linking functionality

## Change Log

| Date       | Author        | Change                                                                    |
| ---------- | ------------- | ------------------------------------------------------------------------- |
| 2024-11-24 | Story Manager | Initial story creation leveraging existing @repo/moc-instructions package |
