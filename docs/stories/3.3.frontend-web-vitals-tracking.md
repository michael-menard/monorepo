# Story 3.3: Frontend Web Vitals Tracking

## Status

Draft

## Story

**As a** Frontend Developer,
**I want** Web Vitals tracking implemented in the React frontend,
**so that** I can monitor user experience performance in Grafana.

## Acceptance Criteria

1. `web-vitals` npm package installed in frontend project
2. Web Vitals tracking module created in `src/lib/tracking/web-vitals.ts`
3. LCP, FID, CLS, TTFB, INP metrics captured on page load/navigation
4. Metrics sent to CloudWatch via API Gateway endpoint (new Lambda function)
5. Metrics visible in CloudWatch Metrics console under custom namespace
6. Dev environment logging to console, prod environment sends to CloudWatch

**Integration Verification:**

- IV1: Vite build process unaffected, no build errors
- IV2: Web Vitals measurement doesn't impact actual Web Vitals scores
- IV3: Application routing and navigation unchanged

## Tasks / Subtasks

- [ ] **Task 1: Install web-vitals library and configure tracking** (AC: 1, 2, 6)
  - [ ] Install `web-vitals` npm package in frontend project
  - [ ] Create Web Vitals tracking module in `src/lib/tracking/web-vitals.ts`
  - [ ] Configure environment-specific behavior (console logging in dev, CloudWatch in prod)
  - [ ] Set up Web Vitals metric collection configuration
  - [ ] Create TypeScript interfaces for Web Vitals data
  - [ ] Test Web Vitals library integration and basic metric capture

- [ ] **Task 2: Implement Web Vitals metric capture** (AC: 3)
  - [ ] Implement LCP (Largest Contentful Paint) measurement
  - [ ] Implement FID (First Input Delay) measurement
  - [ ] Implement CLS (Cumulative Layout Shift) measurement
  - [ ] Implement TTFB (Time to First Byte) measurement
  - [ ] Implement INP (Interaction to Next Paint) measurement
  - [ ] Add metric metadata capture (page URL, user agent, viewport size)
  - [ ] Test metric capture across different page types and user interactions

- [ ] **Task 3: Create Lambda function for Web Vitals ingestion** (AC: 4, 5)
  - [ ] Create new Lambda function: `web-vitals-ingestion.ts`
  - [ ] Implement API Gateway endpoint: `POST /api/tracking/web-vitals`
  - [ ] Add request validation for Web Vitals payload
  - [ ] Implement CloudWatch EMF metric publishing for Web Vitals
  - [ ] Configure metric namespace: `UserMetrics/Frontend/{stage}`
  - [ ] Add appropriate error handling and response formatting
  - [ ] Configure Lambda function in SST with API Gateway integration

- [ ] **Task 4: Implement Web Vitals data transmission** (AC: 4, 6)
  - [ ] Create API client for sending Web Vitals to Lambda endpoint
  - [ ] Implement batching for efficient metric transmission
  - [ ] Add retry logic for failed metric submissions
  - [ ] Implement rate limiting to prevent excessive API calls
  - [ ] Add error handling for network failures
  - [ ] Configure transmission only in production environment
  - [ ] Test data transmission and API endpoint integration

- [ ] **Task 5: Integrate Web Vitals tracking with React application** (AC: 3, IV3)
  - [ ] Initialize Web Vitals tracking on application startup
  - [ ] Integrate with React Router for navigation-based measurements
  - [ ] Add Web Vitals tracking to key user flows and pages
  - [ ] Ensure tracking doesn't interfere with application performance
  - [ ] Add user session context to Web Vitals data
  - [ ] Test integration across different routes and components

- [ ] **Task 6: Validate Web Vitals metrics in CloudWatch** (AC: 5, IV1, IV2)
  - [ ] Deploy Web Vitals tracking to dev environment
  - [ ] Generate test user interactions to trigger metric collection
  - [ ] Verify metrics appear in CloudWatch Metrics console
  - [ ] Test metric queries and aggregations
  - [ ] Validate that tracking doesn't negatively impact actual Web Vitals scores
  - [ ] Confirm Vite build process works correctly with Web Vitals library
  - [ ] Monitor API Gateway costs and usage patterns

- [ ] **Task 7: Create Web Vitals monitoring and documentation** (AC: 1-6)
  - [ ] Create documentation for Web Vitals tracking implementation
  - [ ] Document metric definitions and measurement methodology
  - [ ] Create troubleshooting guide for Web Vitals tracking issues
  - [ ] Set up CloudWatch alarms for poor Web Vitals performance
  - [ ] Create Grafana dashboard queries for Web Vitals visualization
  - [ ] Document integration with existing frontend monitoring
