# Story 1.3: Shell Application Foundation

## Status

Draft

## Story

**As a** user,
**I want** a unified application shell that provides consistent navigation and layout,
**so that** I can seamlessly navigate between different feature modules.

## Acceptance Criteria

1. Main shell app created in `apps/web/main-app/` with routing infrastructure
2. Unified header and navigation components using enhanced design system
3. Authentication integration with AWS Cognito maintained
4. Layout components support responsive design and accessibility
5. Error boundaries and loading states implemented
6. Progressive loading infrastructure for modular applications

## Integration Verification

- **IV1**: Current application routing continues to function during development
- **IV2**: Authentication flows remain uninterrupted
- **IV3**: Existing performance monitoring and analytics continue working

## Dev Notes

### Technical Context

This story creates the main shell application that will coordinate all modular applications while maintaining the existing user experience during the migration. The shell app provides unified routing, authentication, and layout management.

### Architecture References

- **Component Architecture**: Modular Application Shell provides unified routing, authentication, and layout management [Source: architecture/component-architecture.md#modular-application-shell-main-app]
- **Information Architecture**: Site structure with primary navigation and modular sections [Source: front-end-spec/information-architecture-ia.md]
- **Technology Stack**: React 19, TanStack Router, Redux Toolkit, AWS Amplify [Source: architecture/tech-stack.md]

### Current System Analysis

**Existing Routing and Layout** [Source: brownfield-architecture.md]:

- **Main Entry**: `apps/web/lego-moc-instructions-app/src/main.tsx`
- **App Component**: `apps/web/lego-moc-instructions-app/src/App.tsx`
- **Routing**: `apps/web/lego-moc-instructions-app/src/routes/` (TanStack Router)
- **Authentication**: AWS Cognito via Amplify SDK
- **Store**: Redux Toolkit with RTK Query

### Shell Application Architecture

**Navigation Structure** [Source: front-end-spec/information-architecture-ia.md]:

- **Primary Navigation**: Persistent top navigation bar with main sections (Gallery, Wishlist, MOC Instructions, Profile)
- **Logo/Home**: Left side of navigation
- **User Avatar/Settings**: Right side of navigation
- **Secondary Navigation**: Context-sensitive within each module
- **Breadcrumb Strategy**: For deep navigation within modules

**Module Coordination**:

- **Module Loading**: Lazy loading coordination for modular applications
- **Authentication State**: Shared authentication state across all modules
- **Layout Management**: Consistent layout and navigation components
- **Error Boundaries**: Global error handling and recovery

### Key Interfaces

- Module loading and lazy loading coordination
- Authentication state management across modules
- Shared layout and navigation components
- Error boundary and loading state management

### File Locations

- **Main Shell App**: `apps/web/main-app/` (new application)
- **Layout Components**: `apps/web/main-app/src/components/Layout/` (unified layout)
- **Navigation Components**: `apps/web/main-app/src/components/Navigation/` (enhanced navigation)
- **Routing Configuration**: `apps/web/main-app/src/routes/` (module routing coordination)
- **Authentication**: `apps/web/main-app/src/services/auth/` (centralized auth management)
- **Store Configuration**: `apps/web/main-app/src/store/` (shared store setup)
- **Error Boundaries**: `apps/web/main-app/src/components/ErrorBoundary/` (global error handling)

### Enhanced Design System Integration

- Use shadcn/ui Navigation components as base for primary navigation
- Implement enhanced Button and Card components from Story 1.1
- Apply LEGO MOC color palette and typography from design system
- Ensure responsive design with 4-breakpoint system
- Implement light/dark theme switching across all modules

### Progressive Loading Strategy

- Implement React.lazy() for modular application loading
- Create loading states with skeleton screens using enhanced components
- Add error boundaries for module loading failures
- Implement fallback UI for failed module loads
- Add performance monitoring for module load times

### Testing Requirements

- Unit tests for navigation components and routing logic
- Integration tests for authentication flow across modules
- Accessibility testing for navigation and layout components
- Performance testing for module loading and lazy loading
- Error boundary testing for graceful failure handling

### Technical Constraints

- Must maintain existing TanStack Router patterns and file-based routing
- AWS Cognito authentication integration must remain functional
- Current Redux Toolkit store patterns must be preserved
- Existing performance monitoring and analytics must continue working
- Build and deployment processes must remain compatible with current setup

## Tasks / Subtasks

- [ ] **Task 1: Create main shell app structure** (AC: 1)
  - [ ] Create `apps/web/main-app/` directory with proper package.json
  - [ ] Set up Vite configuration for shell app with module federation support
  - [ ] Configure TypeScript and ESLint for shell app
  - [ ] Create basic app entry point and main component structure

- [ ] **Task 2: Implement unified layout system** (AC: 2, 4)
  - [ ] Create Layout components using enhanced shadcn/ui components
  - [ ] Implement responsive header with primary navigation
  - [ ] Add logo/home link and user avatar/settings areas
  - [ ] Ensure WCAG 2.1 AA accessibility compliance for navigation
  - [ ] Implement mobile-responsive navigation patterns

- [ ] **Task 3: Set up routing infrastructure** (AC: 1, 6)
  - [ ] Configure TanStack Router for module coordination
  - [ ] Implement lazy loading for modular applications
  - [ ] Create route definitions for all modules (Gallery, Wishlist, MOC Instructions, Profile)
  - [ ] Add loading states and error boundaries for route transitions
  - [ ] Implement progressive loading with skeleton screens

- [ ] **Task 4: Integrate authentication system** (AC: 3)
  - [ ] Set up AWS Cognito integration using existing Amplify configuration
  - [ ] Create centralized authentication state management
  - [ ] Implement authentication guards for protected routes
  - [ ] Add user avatar and authentication status display
  - [ ] Ensure authentication state is shared across all modules

- [ ] **Task 5: Implement error boundaries and loading states** (AC: 5)
  - [ ] Create global error boundary components for module failures
  - [ ] Implement loading states using enhanced skeleton components
  - [ ] Add error recovery mechanisms and user feedback
  - [ ] Create fallback UI for failed module loads
  - [ ] Add error reporting and monitoring integration

- [ ] **Task 6: Set up shared store configuration** (AC: 3, 6)
  - [ ] Configure Redux Toolkit store for shell app
  - [ ] Set up shared state management for authentication and theme
  - [ ] Implement store providers for modular applications
  - [ ] Add performance monitoring and analytics integration
  - [ ] Ensure existing store patterns remain compatible

- [ ] **Task 7: Create navigation components** (AC: 2, 4)
  - [ ] Implement primary navigation using enhanced shadcn/ui NavigationMenu
  - [ ] Add active state management and visual indicators
  - [ ] Create mobile navigation drawer for responsive design
  - [ ] Implement breadcrumb navigation for deep module navigation
  - [ ] Add keyboard navigation and accessibility features

- [ ] **Task 8: Integration testing and validation** (IV1, IV2, IV3)
  - [ ] Test that current application routing patterns continue working
  - [ ] Validate authentication flows remain uninterrupted during development
  - [ ] Verify existing performance monitoring and analytics continue functioning
  - [ ] Test module loading and lazy loading performance
  - [ ] Validate responsive design across all breakpoints

- [ ] **Task 9: Theme and design system integration** (AC: 2, 4)
  - [ ] Integrate enhanced theme provider from Story 1.1
  - [ ] Implement light/dark theme switching in navigation
  - [ ] Apply LEGO MOC color palette and typography consistently
  - [ ] Ensure design system components work across all modules
  - [ ] Test theme persistence and switching functionality

## Testing

- Unit tests using Vitest and Testing Library for layout and navigation components
- Integration tests for authentication flow and module coordination
- Accessibility testing with axe-core and manual screen reader testing
- Performance testing for module loading and lazy loading scenarios
- Responsive design testing across all breakpoints
- Error boundary testing for graceful failure handling

## Dependencies

- **Depends on**: Story 1.1 (Enhanced Shared Component Library) - for navigation and layout components
- **Depends on**: Story 1.2 (Serverless API Client Foundation) - for API integration in shell app
- **Enables**: Stories 1.4-1.7 (Module Applications) - provides shell infrastructure for all modules

## Change Log

| Date       | Author        | Change                                                   |
| ---------- | ------------- | -------------------------------------------------------- |
| 2024-11-24 | Story Manager | Initial story creation with shell app coordination focus |
