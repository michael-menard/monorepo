# Story 4.6: Upload File Endpoint

## Status

Approved

## Story

**As a** user,
**I want** to upload files to my MOC,
**so that** I can store instructions and images.

## Acceptance Criteria

1. â¬œ `useUploadFileMutation` hook available
2. â¬œ POST /mocs/:id/files multipart
3. â¬œ Progress tracking support
4. â¬œ Returns uploaded file metadata
5. â¬œ Invalidates MocFiles cache
6. ðŸ”„ Backend: File upload endpoint required

## Tasks / Subtasks

- [ ] **Task 1: Define Mutation**
  - [ ] Add uploadFile mutation
  - [ ] Use FormData
  - [ ] Progress callback

## Dev Notes

```typescript
uploadFile: builder.mutation<MocFile, UploadFileInput>({
  query: ({ mocId, file, onProgress }) => {
    const formData = new FormData()
    formData.append('file', file)

    return {
      url: `/mocs/${mocId}/files`,
      method: 'POST',
      body: formData,
      // Progress handled separately
    }
  },
  invalidatesTags: (result, error, { mocId }) => [
    { type: 'MocDetail', id: mocId },
    { type: 'MocFiles', id: mocId },
  ],
}),

interface UploadFileInput {
  mocId: string
  file: File
  onProgress?: (percent: number) => void
}
```

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-11-28 | 0.1     | Initial draft | SM Agent |
