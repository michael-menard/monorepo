# Story 3.26: Gallery Unit Tests

## Status

Approved

## Story

**As a** developer,
**I want** unit tests for gallery components,
**so that** functionality is verified.

## Acceptance Criteria

1. ⬜ Tests for MocCard component
2. ⬜ Tests for CollectionGrid
3. ⬜ Tests for SearchInput with debounce
4. ⬜ Tests for filter components
5. ⬜ Tests for detail page components
6. ⬜ Minimum 45% code coverage

## Tasks / Subtasks

- [ ] **Task 1: Grid Component Tests**
  - [ ] Test MocCard renders data
  - [ ] Test CollectionGrid responsive
  - [ ] Test infinite scroll trigger

- [ ] **Task 2: Filter Tests**
  - [ ] Test SearchInput debounce
  - [ ] Test TagFilter selection
  - [ ] Test ThemeFilter selection
  - [ ] Test URL sync

- [ ] **Task 3: Detail Tests**
  - [ ] Test ThumbnailStrip selection
  - [ ] Test Lightbox navigation
  - [ ] Test file list downloads

- [ ] **Task 4: Coverage**
  - [ ] Run coverage report
  - [ ] Verify 45% minimum

## Dev Notes

```typescript
describe('MocCard', () => {
  it('displays MOC information', () => {
    render(<MocCard moc={mockMoc} />)
    expect(screen.getByText(mockMoc.title)).toBeInTheDocument()
    expect(screen.getByText(`${mockMoc.pieceCount} pieces`)).toBeInTheDocument()
  })

  it('navigates to detail on click', async () => {
    render(<MocCard moc={mockMoc} />, { wrapper: RouterWrapper })
    await userEvent.click(screen.getByRole('link'))
    expect(mockNavigate).toHaveBeenCalledWith(`/gallery/${mockMoc.id}`)
  })
})

describe('SearchInput', () => {
  it('debounces onChange', async () => {
    const onChange = vi.fn()
    render(<SearchInput value="" onChange={onChange} />)

    await userEvent.type(screen.getByRole('textbox'), 'test')
    expect(onChange).not.toHaveBeenCalled()

    await waitFor(() => expect(onChange).toHaveBeenCalledWith('test'), { timeout: 500 })
  })
})
```

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-11-28 | 0.1     | Initial draft | SM Agent |
