# Story 4.21: Upload Additional Images

## Status

Approved

## Story

**As a** user,
**I want** to add more images to my MOC,
**so that** I can show multiple views.

## Acceptance Criteria

1. ⬜ Upload button in Images section
2. ⬜ Multi-file selection
3. ⬜ Batch upload support
4. ⬜ Progress per file
5. ⬜ Immediate display after upload

## Tasks / Subtasks

- [ ] **Task 1: Multi-Upload**
  - [ ] Multiple file input
  - [ ] Queue uploads

- [ ] **Task 2: Progress Tracking**
  - [ ] Per-file progress
  - [ ] Overall progress

## Dev Notes

```typescript
function ImageUploader({ mocId }: { mocId: string }) {
  const [uploads, setUploads] = useState<UploadItem[]>([])
  const [uploadFile] = useUploadFileMutation()

  const handleFiles = async (files: FileList) => {
    const fileArray = Array.from(files)

    for (const file of fileArray) {
      const uploadId = generateId()
      setUploads(prev => [...prev, { id: uploadId, file, progress: 0 }])

      try {
        await uploadFile({
          mocId,
          file,
          onProgress: (p) => {
            setUploads(prev =>
              prev.map(u => u.id === uploadId ? { ...u, progress: p } : u)
            )
          },
        }).unwrap()

        setUploads(prev => prev.filter(u => u.id !== uploadId))
      } catch {
        setUploads(prev =>
          prev.map(u => u.id === uploadId ? { ...u, error: true } : u)
        )
      }
    }
  }

  return (
    <>
      <Button onClick={() => inputRef.current?.click()}>
        <Plus className="mr-2 h-4 w-4" /> Add Images
      </Button>
      <input type="file" ref={inputRef} multiple accept="image/*" onChange={(e) => handleFiles(e.target.files!)} hidden />
      {uploads.map(u => <UploadProgress key={u.id} {...u} />)}
    </>
  )
}
```

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-11-28 | 0.1     | Initial draft | SM Agent |
