# Story 1.24: Shell Unit Tests

## Status

Ready for Review

## Story

**As a** developer,
**I want** unit tests for shell components and slices,
**so that** core functionality is verified.

## Acceptance Criteria

1. ✅ Tests for authSlice (actions, selectors)
2. ✅ Tests for themeSlice (actions, selectors)
3. ✅ Tests for route guards
4. ✅ Tests for layout components render
5. ✅ Tests for ErrorBoundary
6. ✅ Minimum 45% coverage for shell code

## Tasks / Subtasks

- [x] **Task 1: Slice Tests** (AC: 1-2)
  - [x] authSlice: test all actions
  - [x] authSlice: test all selectors
  - [x] themeSlice: test all actions
  - [x] themeSlice: test all selectors
  - [x] Test initial state

- [x] **Task 2: Route Guard Tests** (AC: 3)
  - [x] Test RouteGuards.protected redirects
  - [x] Test RouteGuards.guestOnly redirects
  - [x] Test role-based guards
  - [x] Test loading state handling

- [x] **Task 3: Component Tests** (AC: 4)
  - [x] Test Header renders
  - [x] Test Sidebar renders
  - [x] Test Footer renders
  - [x] Test RootLayout composes correctly

- [x] **Task 4: ErrorBoundary Tests** (AC: 5)
  - [x] Test catches errors
  - [x] Test renders fallback
  - [x] Test retry resets state

- [x] **Task 5: Coverage Check** (AC: 6)
  - [x] Run coverage report
  - [x] Verify 45% minimum
  - [x] Identify gaps and add tests

## Dev Notes

### Existing Tests

**Location:** `apps/web/main-app/src/` (in **tests** folders)

- `components/Layout/__tests__/`
- `components/Auth/__tests__/`
- `routes/__tests__/`

### Vitest Configuration

**File:** `apps/web/main-app/vitest.config.ts`

```typescript
import { defineConfig } from 'vitest/config'

export default defineConfig({
  test: {
    environment: 'jsdom',
    coverage: {
      provider: 'v8',
      reporter: ['text', 'html'],
      exclude: ['**/*.test.tsx', '**/types/'],
    },
  },
})
```

### Slice Test Pattern

```typescript
import { authSlice, setAuthenticated, selectIsAuthenticated } from './authSlice'

describe('authSlice', () => {
  it('should set authenticated state', () => {
    const state = authSlice.reducer(
      undefined,
      setAuthenticated({ user: mockUser, tokens: mockTokens }),
    )
    expect(state.isAuthenticated).toBe(true)
    expect(state.user).toEqual(mockUser)
  })

  it('should select isAuthenticated', () => {
    const state = { auth: { isAuthenticated: true /* ... */ } }
    expect(selectIsAuthenticated(state)).toBe(true)
  })
})
```

### Component Test Pattern

```typescript
import { render, screen } from '@testing-library/react'
import { Header } from './Header'

describe('Header', () => {
  it('renders logo', () => {
    render(<Header />, { wrapper: TestProviders })
    expect(screen.getByText('LEGO MOC')).toBeInTheDocument()
  })
})
```

### Run Tests

```bash
pnpm test                    # Run all tests
pnpm test --coverage         # With coverage
pnpm test --watch           # Watch mode
```

### Testing

Meta: This story is about testing!

- Run test suite
- Check coverage meets 45%
- All tests pass

## Change Log

| Date       | Version | Description                                              | Author   |
| ---------- | ------- | -------------------------------------------------------- | -------- |
| 2025-11-28 | 0.1     | Initial draft                                            | SM Agent |
| 2025-11-30 | 0.2     | Add theme slice unit tests                              | Dev Agent |
| 2025-11-30 | 0.3     | Shell route-guard/layout/ErrorBoundary tests + coverage | Dev Agent |
