# Story 1.24: Shell Unit Tests

## Status

Approved

## Story

**As a** developer,
**I want** unit tests for shell components and slices,
**so that** core functionality is verified.

## Acceptance Criteria

1. ⬜ Tests for authSlice (actions, selectors)
2. ⬜ Tests for themeSlice (actions, selectors)
3. ⬜ Tests for route guards
4. ⬜ Tests for layout components render
5. ⬜ Tests for ErrorBoundary
6. ⬜ Minimum 45% coverage for shell code

## Tasks / Subtasks

- [ ] **Task 1: Slice Tests** (AC: 1-2)
  - [ ] authSlice: test all actions
  - [ ] authSlice: test all selectors
  - [ ] themeSlice: test all actions
  - [ ] themeSlice: test all selectors
  - [ ] Test initial state

- [ ] **Task 2: Route Guard Tests** (AC: 3)
  - [ ] Test RouteGuards.protected redirects
  - [ ] Test RouteGuards.guestOnly redirects
  - [ ] Test role-based guards
  - [ ] Test loading state handling

- [ ] **Task 3: Component Tests** (AC: 4)
  - [ ] Test Header renders
  - [ ] Test Sidebar renders
  - [ ] Test Footer renders
  - [ ] Test RootLayout composes correctly

- [ ] **Task 4: ErrorBoundary Tests** (AC: 5)
  - [ ] Test catches errors
  - [ ] Test renders fallback
  - [ ] Test retry resets state

- [ ] **Task 5: Coverage Check** (AC: 6)
  - [ ] Run coverage report
  - [ ] Verify 45% minimum
  - [ ] Identify gaps and add tests

## Dev Notes

### Existing Tests

**Location:** `apps/web/main-app/src/` (in **tests** folders)

- `components/Layout/__tests__/`
- `components/Auth/__tests__/`
- `routes/__tests__/`

### Vitest Configuration

**File:** `apps/web/main-app/vitest.config.ts`

```typescript
import { defineConfig } from 'vitest/config'

export default defineConfig({
  test: {
    environment: 'jsdom',
    coverage: {
      provider: 'v8',
      reporter: ['text', 'html'],
      exclude: ['**/*.test.tsx', '**/types/'],
    },
  },
})
```

### Slice Test Pattern

```typescript
import { authSlice, setAuthenticated, selectIsAuthenticated } from './authSlice'

describe('authSlice', () => {
  it('should set authenticated state', () => {
    const state = authSlice.reducer(
      undefined,
      setAuthenticated({ user: mockUser, tokens: mockTokens }),
    )
    expect(state.isAuthenticated).toBe(true)
    expect(state.user).toEqual(mockUser)
  })

  it('should select isAuthenticated', () => {
    const state = { auth: { isAuthenticated: true /* ... */ } }
    expect(selectIsAuthenticated(state)).toBe(true)
  })
})
```

### Component Test Pattern

```typescript
import { render, screen } from '@testing-library/react'
import { Header } from './Header'

describe('Header', () => {
  it('renders logo', () => {
    render(<Header />, { wrapper: TestProviders })
    expect(screen.getByText('LEGO MOC')).toBeInTheDocument()
  })
})
```

### Run Tests

```bash
pnpm test                    # Run all tests
pnpm test --coverage         # With coverage
pnpm test --watch           # Watch mode
```

### Testing

Meta: This story is about testing!

- Run test suite
- Check coverage meets 45%
- All tests pass

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-11-28 | 0.1     | Initial draft | SM Agent |
