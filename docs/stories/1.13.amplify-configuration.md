# Story 1.13: Amplify Configuration

## Status

Complete

## Story

**As a** developer,
**I want** AWS Amplify v6 configured for Cognito auth,
**so that** the app can authenticate users via AWS.

## Acceptance Criteria

1. âœ… @aws-amplify/auth v6 package installed (aws-amplify v6.15.7)
2. âœ… Amplify.configure() called with Cognito config
3. âœ… Environment variables for User Pool ID, Client ID, Region
4. âœ… Configuration loaded before app renders (in main.tsx)
5. âœ… TypeScript types for Amplify available
6. ðŸ”„ Backend: Cognito User Pool must exist (FE+BE coordination)

## Tasks / Subtasks

- [x] **Task 1: Verify Package Installation** (AC: 1, 5)
  - [x] Check @aws-amplify/auth in package.json (aws-amplify v6.15.7)
  - [x] Verify version is 6.x
  - [x] Check TypeScript types available

- [x] **Task 2: Create/Verify Amplify Config** (AC: 2)
  - [x] Create src/lib/amplify-config.ts
  - [x] Call Amplify.configure() with auth settings
  - [x] Export config for reference

- [x] **Task 3: Environment Variables** (AC: 3)
  - [x] Define VITE_AWS_USER_POOL_ID (existing naming convention)
  - [x] Define VITE_AWS_USER_POOL_WEB_CLIENT_ID (existing naming convention)
  - [x] Define VITE_AWS_REGION (existing naming convention)
  - [x] Already in .env.example

- [x] **Task 4: Initialize Early** (AC: 4)
  - [x] Import configureAmplify() in main.tsx
  - [x] Call configureAmplify() before React renders

## Dev Notes

### Package Installation

```bash
pnpm add @aws-amplify/auth
```

### Amplify v6 Configuration

**File:** `apps/web/main-app/src/lib/amplify-config.ts`

```typescript
import { Amplify } from 'aws-amplify'

export const amplifyConfig = {
  Auth: {
    Cognito: {
      userPoolId: import.meta.env.VITE_COGNITO_USER_POOL_ID,
      userPoolClientId: import.meta.env.VITE_COGNITO_CLIENT_ID,
      region: import.meta.env.VITE_COGNITO_REGION || 'us-east-1',
    },
  },
}

export function configureAmplify() {
  Amplify.configure(amplifyConfig)
}
```

### Environment Variables

**File:** `.env.example`

```
VITE_COGNITO_USER_POOL_ID=us-east-1_XXXXXXXXX
VITE_COGNITO_CLIENT_ID=xxxxxxxxxxxxxxxxxxxxxxxxxx
VITE_COGNITO_REGION=us-east-1
```

### Main.tsx Integration

```typescript
import { configureAmplify } from './lib/amplify-config'

// Configure before React
configureAmplify()

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
)
```

### Backend Coordination (FE+BE) ðŸ”„

- Cognito User Pool must be created
- User Pool ID and Client ID must be provided
- Client must allow USER_SRP_AUTH flow

### Testing

- Verify Amplify imports without error
- Test config loads env vars correctly
- Mock Amplify for unit tests

## Change Log

| Date       | Version | Description                                                           | Author      |
| ---------- | ------- | --------------------------------------------------------------------- | ----------- |
| 2025-11-28 | 0.1     | Initial draft                                                         | SM Agent    |
| 2025-11-28 | 1.0     | Implementation complete - created amplify-config.ts, updated main.tsx | Claude Code |
