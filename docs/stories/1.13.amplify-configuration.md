# Story 1.13: Amplify Configuration

## Status

Approved

## Story

**As a** developer,
**I want** AWS Amplify v6 configured for Cognito auth,
**so that** the app can authenticate users via AWS.

## Acceptance Criteria

1. â¬œ @aws-amplify/auth v6 package installed
2. â¬œ Amplify.configure() called with Cognito config
3. â¬œ Environment variables for User Pool ID, Client ID, Region
4. â¬œ Configuration loaded before app renders
5. â¬œ TypeScript types for Amplify available
6. ðŸ”„ Backend: Cognito User Pool must exist (FE+BE coordination)

## Tasks / Subtasks

- [ ] **Task 1: Verify Package Installation** (AC: 1, 5)
  - [ ] Check @aws-amplify/auth in package.json
  - [ ] Verify version is 6.x
  - [ ] Check TypeScript types available

- [ ] **Task 2: Create/Verify Amplify Config** (AC: 2)
  - [ ] Create src/lib/amplify-config.ts
  - [ ] Call Amplify.configure() with auth settings
  - [ ] Export config for reference

- [ ] **Task 3: Environment Variables** (AC: 3)
  - [ ] Define VITE_COGNITO_USER_POOL_ID
  - [ ] Define VITE_COGNITO_CLIENT_ID
  - [ ] Define VITE_COGNITO_REGION
  - [ ] Add to .env.example

- [ ] **Task 4: Initialize Early** (AC: 4)
  - [ ] Import config in main.tsx
  - [ ] Ensure configure() runs before React renders

## Dev Notes

### Package Installation

```bash
pnpm add @aws-amplify/auth
```

### Amplify v6 Configuration

**File:** `apps/web/main-app/src/lib/amplify-config.ts`

```typescript
import { Amplify } from 'aws-amplify'

export const amplifyConfig = {
  Auth: {
    Cognito: {
      userPoolId: import.meta.env.VITE_COGNITO_USER_POOL_ID,
      userPoolClientId: import.meta.env.VITE_COGNITO_CLIENT_ID,
      region: import.meta.env.VITE_COGNITO_REGION || 'us-east-1',
    },
  },
}

export function configureAmplify() {
  Amplify.configure(amplifyConfig)
}
```

### Environment Variables

**File:** `.env.example`

```
VITE_COGNITO_USER_POOL_ID=us-east-1_XXXXXXXXX
VITE_COGNITO_CLIENT_ID=xxxxxxxxxxxxxxxxxxxxxxxxxx
VITE_COGNITO_REGION=us-east-1
```

### Main.tsx Integration

```typescript
import { configureAmplify } from './lib/amplify-config'

// Configure before React
configureAmplify()

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
)
```

### Backend Coordination (FE+BE) ðŸ”„

- Cognito User Pool must be created
- User Pool ID and Client ID must be provided
- Client must allow USER_SRP_AUTH flow

### Testing

- Verify Amplify imports without error
- Test config loads env vars correctly
- Mock Amplify for unit tests

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-11-28 | 0.1     | Initial draft | SM Agent |
