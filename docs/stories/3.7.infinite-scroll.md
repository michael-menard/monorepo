# Story 3.7: Infinite Scroll

## Status

Approved

## Story

**As a** user,
**I want** more MOCs to load as I scroll,
**so that** I don't have to click pagination buttons.

## Acceptance Criteria

1. ⬜ Infinite scroll implemented
2. ⬜ Loads next page at 80% scroll
3. ⬜ Loading indicator at bottom
4. ⬜ "End of results" message when done
5. ⬜ Works with search/filters

## Tasks / Subtasks

- [ ] **Task 1: Scroll Detection**
  - [ ] Use Intersection Observer
  - [ ] Trigger at threshold

- [ ] **Task 2: Page Loading**
  - [ ] Track current page
  - [ ] Append to existing items
  - [ ] Use RTK Query pagination

- [ ] **Task 3: End State**
  - [ ] Detect last page
  - [ ] Show end message

## Dev Notes

```typescript
export function useInfiniteScroll(loadMore: () => void, hasMore: boolean) {
  const observerRef = useRef<IntersectionObserver>()
  const loadMoreRef = useRef<HTMLDivElement>(null)

  useEffect(() => {
    if (!hasMore) return

    observerRef.current = new IntersectionObserver(
      entries => {
        if (entries[0].isIntersecting) {
          loadMore()
        }
      },
      { threshold: 0.8 },
    )

    if (loadMoreRef.current) {
      observerRef.current.observe(loadMoreRef.current)
    }

    return () => observerRef.current?.disconnect()
  }, [loadMore, hasMore])

  return loadMoreRef
}
```

### Usage

```typescript
const loadMoreRef = useInfiniteScroll(
  () => setPage(p => p + 1),
  hasMore
)

return (
  <>
    <CollectionGrid mocs={allMocs} />
    <div ref={loadMoreRef}>
      {isLoadingMore && <Spinner />}
      {!hasMore && <p>End of collection</p>}
    </div>
  </>
)
```

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-11-28 | 0.1     | Initial draft | SM Agent |
