# Story 3.1.13: Owner-Only List & Get

## Status

Implemented

## Story

As a creator,
I want to list and view only my own instructions,
so my uploads remain private in MVP.

## Acceptance Criteria

1. Owner-only ACL

- GET /mocs/uploads → list only owner records; newest-first; pagination.
- GET /mocs/uploads/:id → 403 for non-owners (Forbidden); 200 for owner.

2. Response shape

- List: items[], total?, nextCursor?; item fields include minimal preview and status.

3. Observability & errors

- Logs include requestId, ownerId; 403/404 consistent with error contract (3.1.21).

4. Tests

- Integration: list isolation, get 403 for non-owner, pagination cursor.

## Tasks / Subtasks

- [x] DB queries filtered by ownerId; proper indexes
- [x] Add endpoints with Zod query validation
- [x] Error mapping and logging
- [x] Tests (integration)

## Dev Notes

- MVP visibility private; later public/published status may expand ACL.

### Auth, Cookies, and CSRF

- Cookie-based (HttpOnly) session auth.
- Frontend MUST send `credentials: 'include'` and MUST NOT send `Authorization` headers.
- Cookie attributes: `HttpOnly`; `Secure`; `SameSite=Lax` (recommended) or `SameSite=None; Secure` when API is on a different site/domain.
- CORS: `Access-Control-Allow-Credentials: true`; `Access-Control-Allow-Origin` must be the exact client origin (no `*`). Include `Vary: Origin`.
- Responses are JSON; clients send `Accept: application/json`.
- CSRF for unsafe methods (POST/PUT/PATCH/DELETE): require `X-CSRF-Token` and verify server-side (double-submit cookie or session-bound token). GET endpoints do not require CSRF.

Ensure:

- RTK Query uses `credentials: 'include'` and does not set `Authorization`.
- XHR uploads use `withCredentials = true` and appropriate `Content-Type` (e.g., `application/octet-stream` for binary part uploads).
- Backend sets cookies with `HttpOnly`; `Secure`; `SameSite` (Lax or None+Secure) and CORS allows credentials for the exact origin.
- Optional `X-CSRF-Token` header is included on unsafe methods when CSRF is enabled.

## Change Log

| Date       | Version | Description                    | Author |
| ---------- | ------- | ------------------------------ | ------ |
| 2025-12-06 | 0.1     | Initial draft (owner list/get) | SM     |
