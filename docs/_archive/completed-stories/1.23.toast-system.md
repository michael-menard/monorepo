# Story 1.23: Toast System

## Status

Ready for Review

## Story

**As a** user,
**I want** toast notifications for feedback,
**so that** I know when actions succeed or fail.

## Acceptance Criteria

1. ✅ Toast provider configured
2. ✅ Toast variants: success, error, warning, info
3. ✅ Auto-dismiss after timeout
4. ✅ Manual dismiss button
5. ✅ Toast position (top-right or bottom-right)
6. ✅ useToast hook available
7. ✅ Accessible (aria-live)

## Tasks / Subtasks

- [x] **Task 1: Configure Toast Provider** (AC: 1)
  - [x] Use @repo/ui Toaster component
  - [x] Sonner library integrated via @repo/ui
  - [x] Add provider to App.tsx

- [x] **Task 2: Toast Variants** (AC: 2)
  - [x] Success (green with CheckCircle icon)
  - [x] Error (red with AlertCircle icon)
  - [x] Warning (yellow with AlertTriangle icon)
  - [x] Info (blue with Info icon)

- [x] **Task 3: Dismiss Behavior** (AC: 3-4)
  - [x] Configure auto-dismiss (5s default)
  - [x] Add X button for manual dismiss
  - [x] Progress bar with hover-to-pause feature

- [x] **Task 4: Positioning** (AC: 5)
  - [x] Set position to top-right
  - [x] Sonner handles stacking automatically

- [x] **Task 5: Hook & Accessibility** (AC: 6-7)
  - [x] Export useToast hook from @repo/ui
  - [x] Sonner renders with aria-live="polite"
  - [x] Close button has aria-label="Close notification"

## Dev Notes

### @repo/ui Toast Setup

If using shadcn/ui Toaster:

```typescript
// In App.tsx
import { Toaster } from '@repo/ui'

function App() {
  return (
    <>
      <RouterProvider router={router} />
      <Toaster />
    </>
  )
}
```

### useToast Hook

```typescript
import { useToast } from '@repo/ui'

function MyComponent() {
  const { toast } = useToast()

  const handleSuccess = () => {
    toast({
      title: 'Success!',
      description: 'Your changes have been saved.',
      variant: 'success',
    })
  }

  const handleError = () => {
    toast({
      title: 'Error',
      description: 'Something went wrong. Please try again.',
      variant: 'destructive',
    })
  }
}
```

### Sonner Alternative

```typescript
import { Toaster, toast } from 'sonner'

// In App.tsx
<Toaster position="top-right" richColors />

// Usage
toast.success('Changes saved!')
toast.error('Something went wrong')
toast.warning('Please check your input')
toast.info('New feature available')
```

### Toast Configuration

```typescript
const toastConfig = {
  duration: 5000, // 5 seconds
  position: 'top-right',
  closeButton: true,
}
```

### Testing

- Test toast appears on trigger
- Test auto-dismiss works
- Test manual dismiss works
- Test all variants render correctly

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-11-28 | 0.1     | Initial draft | SM Agent |
| 2025-11-30 | 1.0     | Implementation verified and tests added | Dev Agent |

---

## Dev Agent Record

### File List

**Files Reviewed (already implemented):**
- `apps/web/main-app/src/App.tsx` - Toaster component already integrated
- `packages/core/ui/src/sonner.tsx` - Toaster wrapper with theme support
- `packages/core/ui/src/toast-utils.tsx` - Custom toast component with variants
- `packages/core/ui/src/hooks/useToast.ts` - useToast hook implementation
- `packages/core/ui/src/index.ts` - All exports properly defined

**Files Created:**
- `packages/core/ui/src/__tests__/toast-utils.test.tsx` - 25 unit tests for toast system

### Change Log

| File | Action | Description |
|------|--------|-------------|
| `packages/core/ui/src/__tests__/toast-utils.test.tsx` | Created | Added comprehensive unit tests covering getErrorMessage, useToast hook, Toaster component, and toast utility functions |

### Completion Notes

**Implementation Status:** The toast system was already fully implemented in `@repo/ui` and integrated into `main-app`. This story verification confirmed all acceptance criteria were met.

**Key Features Already Present:**
1. **Toaster Component** (`sonner.tsx`): Theme-aware Sonner wrapper with position='top-right', closeButton=true, duration=5000ms
2. **Custom Toast Component** (`toast-utils.tsx`): Progress bar with hover-to-pause, variant-specific icons (CheckCircle, AlertCircle, AlertTriangle, Info)
3. **Error Message Mapping** (`getErrorMessage`): Handles Error objects, strings, API errors with status codes (400, 401, 403, 404, 500), and custom error codes
4. **useToast Hook**: Returns toast, success, error, warning, info, dismiss, dismissAll - all memoized with useCallback
5. **Accessibility**: Sonner provides aria-live="polite", close button has aria-label

**Test Results:**
- 25 tests passing in `@repo/ui`
- Tests cover: getErrorMessage (12 cases), useToast hook (2 cases), Toaster component (2 cases), toast utility functions (7 cases), type exports (2 cases)

**Dependencies:**
- `sonner@^2.0.6` (already in @repo/ui)
- `lucide-react` for icons (already in @repo/ui)
