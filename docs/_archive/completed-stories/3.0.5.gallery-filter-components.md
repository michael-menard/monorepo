# Story 3.0.5: Gallery Filter Components

## Status

Ready for Review

## Story

**As a** user,
**I want** to filter gallery items by tags and themes,
**so that** I can narrow down results to what I'm looking for.

## Acceptance Criteria

1. ⬜ GalleryTagFilter component for tag selection
2. ⬜ GalleryThemeFilter component for theme dropdown
3. ⬜ Multi-select support for tags (pills/chips display)
4. ⬜ Single-select for theme dropdown
5. ⬜ Clear all filters option
6. ⬜ Filter state managed via props (controlled)
7. ⬜ Accessible dropdowns with keyboard navigation

## Tasks / Subtasks

- [x] **Task 1: Tag Filter Component**
  - [x] Create `src/components/GalleryTagFilter.tsx`
  - [x] Use @repo/ui MultiSelect or Popover+Checkbox
  - [x] Display selected tags as removable pills

- [x] **Task 2: Theme Filter Component**
  - [x] Create `src/components/GalleryThemeFilter.tsx`
  - [x] Use @repo/ui Select component
  - [x] Include "All Themes" option

- [x] **Task 3: Filter Pills Display**
  - [x] Create `src/components/GalleryActiveFilters.tsx`
  - [x] Show all active filters as removable badges
  - [x] "Clear All" button when filters active

- [x] **Task 4: Filter Bar Container**
  - [x] Create `src/components/GalleryFilterBar.tsx`
  - [x] Compose search, tags, theme, sort together
  - [x] Responsive layout (stack on mobile)

## Dev Notes

### Component APIs

```typescript
// Tag Filter
interface GalleryTagFilterProps {
  tags: string[]           // Available tags
  selected: string[]       // Currently selected
  onChange: (tags: string[]) => void
  placeholder?: string     // default: "Filter by tags"
}

// Theme Filter
interface GalleryThemeFilterProps {
  themes: string[]         // Available themes
  selected: string | null  // Currently selected
  onChange: (theme: string | null) => void
  placeholder?: string     // default: "All Themes"
}

// Active Filters Display
interface GalleryActiveFiltersProps {
  filters: Array<{ key: string; value: string; label: string }>
  onRemove: (key: string, value: string) => void
  onClearAll: () => void
}

// Combined Filter Bar
interface GalleryFilterBarProps {
  search: string
  onSearchChange: (value: string) => void
  tags: string[]
  selectedTags: string[]
  onTagsChange: (tags: string[]) => void
  themes: string[]
  selectedTheme: string | null
  onThemeChange: (theme: string | null) => void
  sortOptions: SortOption[]
  selectedSort: string
  onSortChange: (sort: string) => void
}
```

### Usage Example

```typescript
<GalleryFilterBar
  search={search}
  onSearchChange={setSearch}
  tags={availableTags}
  selectedTags={selectedTags}
  onTagsChange={setSelectedTags}
  themes={availableThemes}
  selectedTheme={selectedTheme}
  onThemeChange={setSelectedTheme}
  sortOptions={sortOptions}
  selectedSort={sortBy}
  onSortChange={setSortBy}
/>
```

## Testing

- [x] Unit test: tag selection adds/removes from selected array
- [x] Unit test: theme selection updates single value
- [x] Unit test: clear all resets all filters
- [x] Unit test: pills display correct labels
- [x] Accessibility test: keyboard navigation in dropdowns

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5

### File List

| File                                                        | Action   |
| ----------------------------------------------------------- | -------- |
| packages/core/gallery/src/components/GalleryTagFilter.tsx   | Created  |
| packages/core/gallery/src/components/GalleryThemeFilter.tsx | Created  |
| packages/core/gallery/src/components/GalleryActiveFilters.tsx | Created  |
| packages/core/gallery/src/components/GalleryFilterBar.tsx   | Created  |
| packages/core/gallery/src/index.ts                          | Modified |
| packages/core/gallery/src/__tests__/GalleryFilters.test.tsx | Created  |

### Debug Log References

None

### Completion Notes

- GalleryTagFilter: Multi-select tag filter using existing MultiSelect component
- GalleryThemeFilter: Single-select dropdown with "All Themes" option
- GalleryActiveFilters: Displays active filters as removable badges with "Clear all" button
- GalleryFilterBar: Composes search, tags, theme, sort into responsive filter bar
- All components use controlled pattern (state managed via props)
- Leverages existing @repo/app-component-library components (MultiSelect, AppSelect, Badge, Button)
- 31 unit tests passing for filter components
- Build and lint verified

## Change Log

| Date       | Version | Description             | Author      |
| ---------- | ------- | ----------------------- | ----------- |
| 2025-11-30 | 0.1     | Initial draft           | SM Agent    |
| 2025-12-05 | 1.0     | Implementation complete | Dev (James) |
