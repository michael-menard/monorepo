# Story 1.13.11: Signup Page

## Status

Ready for Review

## Story

**As a** new user,
**I want** a signup page with name, email, and password fields,
**so that** I can create an account and join the LEGO MOC Hub community.

## Acceptance Criteria

1. ✅ Signup page exists at /register route
2. ✅ Full name input with validation (min 2 characters)
3. ✅ Email input with validation
4. ✅ Password input with show/hide toggle
5. ✅ Password strength indicator
6. ✅ Confirm password input with match validation
7. ✅ Terms and conditions checkbox (required)
8. ✅ Submit button calls Amplify signUp
9. ✅ Success message displayed after signup
10. ✅ Redirect to email verification page with email
11. ✅ Error handling for existing accounts and other errors
12. ✅ Loading state during registration
13. ✅ Link to login page
14. ✅ Link back to home page
15. ✅ Accessible form with ARIA labels
16. ✅ Unit tests exist (43 tests)

## Tasks / Subtasks

- [x] **Task 1: Page Setup** (AC: 1, 13, 14)
  - [x] Create SignupPage component
  - [x] Route at /register with guestOnly guard
  - [x] Use AuthLayout wrapper
  - [x] "Sign in here" link to /login
  - [x] "Back to Home" button

- [x] **Task 2: Form Fields** (AC: 2-6)
  - [x] Full name input with User icon
  - [x] Email input with Mail icon
  - [x] Password input with Lock icon and show/hide toggle
  - [x] Password strength indicator (4 segments)
  - [x] Confirm password input with show/hide toggle
  - [x] Zod validation schema with password match refinement

- [x] **Task 3: Terms Acceptance** (AC: 7)
  - [x] Checkbox for terms acceptance
  - [x] Link to Terms of Service page
  - [x] Link to Privacy Policy page
  - [x] Validation requiring acceptance

- [x] **Task 4: Amplify Integration** (AC: 8, 10)
  - [x] Call signUp from AuthProvider
  - [x] Pass name, email, password to Amplify
  - [x] Handle requiresConfirmation response
  - [x] Navigate to /verify-email with email parameter

- [x] **Task 5: Success/Error Handling** (AC: 9, 11, 12)
  - [x] Display success alert with green styling
  - [x] Display error alert with destructive styling
  - [x] Loading spinner during submission
  - [x] Disabled state for form during loading

- [x] **Task 6: Accessibility** (AC: 15)
  - [x] Labels associated with inputs
  - [x] aria-invalid on inputs with errors
  - [x] aria-label on show/hide password buttons
  - [x] LEGO-themed branding consistent with other auth pages

- [x] **Task 7: Unit Tests** (AC: 16)
  - [x] Create SignupPage.test.tsx
  - [x] Tests for form rendering (7 tests)
  - [x] Tests for field validation (4 tests)
  - [x] Tests for password strength indicator (4 tests)
  - [x] Tests for password match validation
  - [x] Tests for terms checkbox validation
  - [x] Tests for successful signup flow (4 tests)
  - [x] Tests for error handling (3 tests)
  - [x] Tests for loading state (2 tests)
  - [x] Tests for navigation links (6 tests)
  - [x] Tests for accessibility (5 tests)
  - [x] Tests for navigation tracking (4 tests)

## Dev Notes

### Existing Implementation

**File:** `apps/web/main-app/src/routes/pages/SignupPage.tsx`

### Amplify v6 Sign Up

```typescript
import { signUp } from 'aws-amplify/auth'

const result = await signUp({
  username: userData.email,
  password: userData.password,
  options: {
    userAttributes: {
      email: userData.email,
      name: userData.name,
    },
    autoSignIn: true, // Enable auto sign-in after confirmation
  },
})

if (result.isSignUpComplete) {
  // Signup complete (rare - usually requires email verification)
} else {
  // User needs to verify email
  navigate({ to: '/verify-email', search: { email } })
}
```

### Form Schema (Zod)

```typescript
const SignupSchema = z
  .object({
    name: z.string().min(2, 'Name must be at least 2 characters'),
    email: z.string().email('Please enter a valid email address'),
    password: z
      .string()
      .min(8, 'Password must be at least 8 characters')
      .regex(
        /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,
        'Password must contain uppercase, lowercase, and number',
      ),
    confirmPassword: z.string(),
    acceptTerms: z
      .boolean()
      .refine(val => val === true, 'You must accept the terms and conditions'),
  })
  .refine(data => data.password === data.confirmPassword, {
    message: "Passwords don't match",
    path: ['confirmPassword'],
  })
```

### Password Strength Indicator

The component displays a 4-segment strength indicator:

- Weak: < 4 characters
- Fair: 4-5 characters
- Good: 6-7 characters
- Strong: 8+ characters

### @repo/ui Components Used

- Input (name, email, password, confirmPassword)
- Button (submit, back to home)
- Card (form container)
- Alert (success/error messages)
- Checkbox (terms acceptance)
- Label (form labels)

### Navigation Flow

1. User fills out form and submits
2. On success: Show success message, wait 2 seconds
3. Navigate to `/verify-email` with email in search params
4. Email verification page handles code entry

### Dependencies

- Story 1.13.3: Email Verification Flow (next step after signup)
- Story 1.14: Login Page (link from signup)

## QA Results

### Review Summary

| Attribute         | Value                      |
| ----------------- | -------------------------- |
| **Gate**          | PASS                       |
| **Quality Score** | 100/100                    |
| **Review Depth**  | DEEP (auth/security story) |
| **Reviewer**      | Quinn (Test Architect)     |
| **Review Date**   | 2025-11-29                 |

### Requirements Traceability

| AC  | Description                                           | Status  | Evidence                                                                               |
| --- | ----------------------------------------------------- | ------- | -------------------------------------------------------------------------------------- |
| 1   | Signup page exists at /register route                 | ✅ PASS | SignupPage.tsx:59-469 with AuthLayout wrapper                                          |
| 2   | Full name input with validation (min 2 characters)    | ✅ PASS | Zod schema line 22; tests: lines 341-352                                               |
| 3   | Email input with validation                           | ✅ PASS | Zod schema line 23; tests: lines 355-367                                               |
| 4   | Password input with show/hide toggle                  | ✅ PASS | Lines 264-326 with toggle; tests: lines 256-290                                        |
| 5   | Password strength indicator                           | ✅ PASS | 4-segment indicator lines 301-325; tests: lines 293-337                                |
| 6   | Confirm password input with match validation          | ✅ PASS | Lines 328-369 with Zod refine; tests: lines 399-412                                    |
| 7   | Terms and conditions checkbox (required)              | ✅ PASS | Lines 371-405 with Zod validation; tests: lines 415-432                                |
| 8   | Submit button calls Amplify signUp                    | ✅ PASS | signUp via useAuth line 89; tests: lines 446-470                                       |
| 9   | Success message displayed after signup                | ✅ PASS | Line 96; tests: lines 473-493                                                          |
| 10  | Redirect to email verification page with email        | ✅ PASS | Navigate to /verify-email lines 103-108; tests: lines 496-527                          |
| 11  | Error handling for existing accounts and other errors | ✅ PASS | Lines 109-123; tests: lines 556-633                                                    |
| 12  | Loading state during registration                     | ✅ PASS | Lines 420-424 spinner; tests: lines 636-681                                            |
| 13  | Link to login page                                    | ✅ PASS | Lines 436-447; tests: lines 241-247, 756-764                                           |
| 14  | Link back to home page                                | ✅ PASS | Lines 449-464; tests: lines 249-252, 767-775                                           |
| 15  | Accessible form with ARIA labels                      | ✅ PASS | aria-invalid lines 220, 250, 280, 345; aria-label lines 286, 351; tests: lines 684-726 |
| 16  | Unit tests exist (43 tests)                           | ✅ PASS | SignupPage.test.tsx: 779 lines, 43 comprehensive tests                                 |

### Code Quality Assessment

| Dimension            | Rating    | Notes                                                         |
| -------------------- | --------- | ------------------------------------------------------------- |
| **Architecture**     | Excellent | Clean functional component with proper separation of concerns |
| **Type Safety**      | Excellent | Full TypeScript with Zod schema inference                     |
| **Error Handling**   | Excellent | Handles both returned errors and thrown exceptions            |
| **State Management** | Excellent | useState for UI state, react-hook-form for form state         |
| **Testability**      | Excellent | Comprehensive mocking, fake timers for delayed navigation     |

### Test Coverage Analysis

| Test Suite                  | Tests | Coverage                                                  |
| --------------------------- | ----- | --------------------------------------------------------- |
| Rendering                   | 12    | AuthLayout, form fields, labels, links, branding          |
| Password Visibility Toggle  | 3     | Default hidden, toggle password, toggle confirm password  |
| Password Strength Indicator | 5     | Weak, Fair, Good, Strong states                           |
| Form Validation             | 7     | Name, email, password requirements, password match, terms |
| Successful Signup           | 4     | Correct data, success message, navigation, tracking       |
| Error Handling              | 3     | Existing account, thrown error, error tracking            |
| Loading State               | 2     | Loading text, disabled button                             |
| Accessibility               | 4     | aria-invalid, aria-label, labels                          |
| Navigation Tracking         | 3     | Signup attempt, signin link, back to home                 |

### NFR Validation

| NFR                 | Status  | Evidence                                                                                                             |
| ------------------- | ------- | -------------------------------------------------------------------------------------------------------------------- |
| **Security**        | ✅ PASS | Strong password validation (8+ chars, uppercase, lowercase, number). Terms acceptance required. Password not logged. |
| **Performance**     | ✅ PASS | Framer Motion animations, react-hook-form with onChange validation                                                   |
| **Reliability**     | ✅ PASS | Handles both returned errors and thrown exceptions. 2-second delay before navigation for success message visibility. |
| **Accessibility**   | ✅ PASS | aria-invalid on all inputs, aria-label on password toggle buttons, proper htmlFor/id associations                    |
| **Maintainability** | ✅ PASS | TypeScript interfaces, Zod validation schema, consistent component structure                                         |

### Risks Identified

None.

### Recommendations

**Future Improvements:**

1. Consider adding E2E Gherkin tests for complete signup → email verification flow
2. Add monitoring/analytics for signup completion rates in production

## Change Log

| Date       | Version | Description                                        | Author    |
| ---------- | ------- | -------------------------------------------------- | --------- |
| 2025-11-29 | 0.1     | Story created - implementation exists, needs tests | SM Agent  |
| 2025-11-29 | 1.0     | Complete: Added 43 unit tests                      | Dev Agent |
