# Story 3.1.17: File UX â€” DnD, Pickers, Previews

## Status

Implemented

## Story

As a creator,
I want an intuitive file selection experience,
so I can add and manage files easily.

## Acceptance Criteria

1. Add files

- Drag-and-drop + file pickers; accept types per env; PDF required; multiple images and parts lists allowed.

2. Manage files

- Show chips/cards with name, size, type; remove before finalize; HEIC shows "preview not available" placeholder.

3. A11y

- DnD has keyboard alternative; live region messages on add/remove.

4. Tests

- Interaction tests for DnD/picker; removal; HEIC placeholder.

## Tasks / Subtasks

- [x] Components under packages/core/upload/src/components/\*
- [x] UploadArea with keyboard accessibility (Enter/Space to open picker)
- [x] FilePreview with HEIC placeholder support
- [x] useLiveAnnouncements hook for screen reader announcements
- [ ] Hooking into useUploadManager (3.1.18)
- [x] Tests (RTL) - 42 new tests

## Dev Notes

- Do not store File/Blob outside component state; keep metadata in session (3.1.9).

## Implementation Details

### Components Enhanced (packages/core/upload)

| Component              | Changes                                                                                                                                   |
| ---------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| `UploadArea`           | Added `role="button"`, `tabIndex`, keyboard handlers (Enter/Space), `aria-label`, `aria-disabled`, focus styling, `onFilesAdded` callback |
| `FilePreview`          | Added HEIC/HEIF detection, "Preview N/A" placeholder, accessible remove button with `aria-label`, progress bar with `role="progressbar"`  |
| `useLiveAnnouncements` | New hook for screen reader announcements with `announce()`, `clear()`, `getLiveRegionProps()`                                             |
| `uploadAnnouncements`  | Pre-built announcement messages for common upload events                                                                                  |

### Test Coverage

| Test File                       | Tests                                          |
| ------------------------------- | ---------------------------------------------- |
| `UploadArea.test.tsx`           | 12 tests - accessibility, keyboard, DnD        |
| `FilePreview.test.tsx`          | 13 tests - rendering, HEIC placeholder, remove |
| `useLiveAnnouncements.test.tsx` | 17 tests - announce, clear, props              |

## Change Log

| Date       | Version | Description                                                                | Author |
| ---------- | ------- | -------------------------------------------------------------------------- | ------ |
| 2025-12-06 | 0.1     | Initial draft (file UX)                                                    | SM     |
| 2025-12-07 | 0.2     | Implemented - enhanced UploadArea, FilePreview, added useLiveAnnouncements | Agent  |
