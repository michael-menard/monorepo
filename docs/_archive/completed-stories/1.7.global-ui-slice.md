# Story 1.7: Global UI Slice

## Status

Done

## Story

**As a** developer,
**I want** a globalUISlice for sidebar state and loading flags,
**so that** UI state is centralized and consistent.

## Acceptance Criteria

1. ✅ globalUISlice created with createSlice
2. ✅ Sidebar state: isOpen, isCollapsed
3. ✅ Loading flags: isNavigating, isPageLoading
4. ✅ Modal state: activeModal, modalProps
5. ✅ Actions: toggleSidebar, setSidebarOpen, setNavigating, openModal, closeModal
6. ✅ Selectors for all state properties
7. ✅ Integrated into store

## Tasks / Subtasks

- [x] **Task 1: Check for Existing Implementation**
  - [x] Search for globalUISlice or similar
  - [x] Check navigationSlice for related state
  - [x] Document what exists vs needs creation

- [x] **Task 2: Create or Enhance Slice** (AC: 1-5)
  - [x] Create globalUISlice if not exists
  - [x] Add sidebar state (isOpen, isCollapsed)
  - [x] Add loading flags (isNavigating, isPageLoading)
  - [x] Add modal state (activeModal, modalProps)
  - [x] Export all actions

- [x] **Task 3: Create Selectors** (AC: 6)
  - [x] selectSidebarOpen
  - [x] selectSidebarCollapsed
  - [x] selectIsNavigating
  - [x] selectActiveModal

- [x] **Task 4: Integrate into Store** (AC: 7)
  - [x] Add reducer to store configuration
  - [x] Verify RootState type includes globalUI

## Dev Notes

### Existing Related Code

**File:** `apps/web/main-app/src/store/slices/navigationSlice.ts`

May contain some of this functionality. Need to check.

### Proposed State Shape

```typescript
interface GlobalUIState {
  sidebar: {
    isOpen: boolean
    isCollapsed: boolean
  }
  loading: {
    isNavigating: boolean
    isPageLoading: boolean
  }
  modal: {
    activeModal: string | null
    modalProps: Record<string, unknown>
  }
}
```

### Actions

- toggleSidebar()
- setSidebarOpen(boolean)
- setSidebarCollapsed(boolean)
- setNavigating(boolean)
- setPageLoading(boolean)
- openModal(name, props)
- closeModal()

### Integration Points

- Sidebar component reads isOpen, isCollapsed
- Page transitions set isNavigating
- Modal system uses activeModal, modalProps

### Testing

- Unit test each action
- Test sidebar toggle logic
- Test modal open/close flow

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### File List

| File                                                                 | Action   |
| -------------------------------------------------------------------- | -------- |
| `apps/web/main-app/src/store/slices/globalUISlice.ts`                | Created  |
| `apps/web/main-app/src/store/slices/__tests__/globalUISlice.test.ts` | Created  |
| `apps/web/main-app/src/store/index.ts`                               | Modified |

### Completion Notes

1. Created new `globalUISlice` with full state management for sidebar, loading, and modal states
2. Implemented all required actions including bonus actions: `toggleSidebarCollapsed`, `setPageLoading`, `resetGlobalUI`
3. Created 10 selectors including computed selector `selectIsLoading`
4. Integrated into store - RootState now includes `globalUI` slice
5. Comprehensive test coverage: 28 tests covering all actions and selectors

### Debug Log References

None - implementation was straightforward.

## Change Log

| Date       | Version | Description                           | Author            |
| ---------- | ------- | ------------------------------------- | ----------------- |
| 2025-11-28 | 0.1     | Initial draft - may need creation     | SM Agent          |
| 2025-11-28 | 1.0     | Implementation complete - all ACs met | Dev Agent (James) |

## QA Results

### Review Date: 2025-11-29

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

The globalUISlice implementation is excellent. At 124 lines, it provides comprehensive UI state management for sidebar, loading, and modal states. The state shape exactly matches the story specification. The implementation includes bonus actions (`toggleSidebarCollapsed`, `setPageLoading`, `resetGlobalUI`) and a computed selector (`selectIsLoading`) that enhance usability.

### Refactoring Performed

None required. Implementation is clean and follows RTK best practices.

### Compliance Check

- Coding Standards: ✓ Follows Redux Toolkit patterns from coding-standards.md
- Project Structure: ✓ Slice in store/slices/, integrated into store/index.ts
- Testing Strategy: ✓ 28 tests passing with comprehensive coverage
- All ACs Met: ✓ 7/7 acceptance criteria verified

### Test Summary

| Metric         | Value |
| -------------- | ----- |
| Test File      | 1     |
| Total Tests    | 28    |
| Pass Rate      | 100%  |
| Execution Time | 7ms   |

Tests cover:

- Initial state for sidebar, loading, and modal
- toggleSidebar, setSidebarOpen, setSidebarCollapsed, toggleSidebarCollapsed
- setNavigating, setPageLoading
- selectIsLoading computed selector
- openModal (with/without props, replacing existing)
- closeModal (with and without active modal)
- resetGlobalUI (all state reset)
- Object selectors (selectSidebar, selectLoading, selectModal)

### Improvements Checklist

- [x] globalUISlice uses createSlice from RTK
- [x] Sidebar state includes isOpen and isCollapsed
- [x] Loading state includes isNavigating and isPageLoading
- [x] Modal state includes activeModal and modalProps
- [x] All required actions exported (plus bonus actions)
- [x] 10 selectors exported (including computed selectIsLoading)
- [x] Integrated into store (RootState includes globalUI)
- [x] Comprehensive test coverage (28 tests)

### Security Review

No security concerns. UI state management for visual elements only.

### Performance Considerations

- Flat state structure enables efficient updates
- Selectors are simple and fast
- resetGlobalUI allows clean slate for testing/cleanup

### Files Modified During Review

None - verification-only review.

### Gate Status

Gate: PASS → docs/qa/gates/1.7-global-ui-slice.yml

### Recommended Status

✓ Ready for Done

All 7 acceptance criteria are fully met. The implementation exceeds requirements with bonus actions and computed selectors. Test coverage is excellent (28 tests, 100% pass rate).
