# Story 3.0.4: Gallery Search Component

## Status

Ready for Review

## Story

**As a** user,
**I want** to search gallery items by text,
**so that** I can quickly find specific items.

## Acceptance Criteria

1. ⬜ GallerySearch component created in @repo/gallery
2. ⬜ Debounced input (300ms default) to prevent excessive API calls
3. ⬜ Clear button appears when text is entered
4. ⬜ Search icon visual indicator
5. ⬜ Accessible with proper label and ARIA attributes
6. ⬜ Controlled and uncontrolled usage patterns supported

## Tasks / Subtasks

- [x] **Task 1: Create Search Component**
  - [x] Create `src/components/GallerySearch.tsx`
  - [x] Use @repo/ui Input as foundation
  - [x] Add search icon (lucide-react)

- [x] **Task 2: Debounce Logic**
  - [x] Create `useDebounce` hook or use existing
  - [x] Default 300ms debounce delay
  - [x] Configurable delay via prop

- [x] **Task 3: Clear Functionality**
  - [x] Show X button when value present
  - [x] Clear on button click
  - [x] Clear on Escape key

- [x] **Task 4: Accessibility**
  - [x] aria-label for search input
  - [x] aria-describedby for help text if provided
  - [x] role="searchbox"

## Dev Notes

### Component API

```typescript
interface GallerySearchProps {
  value?: string
  defaultValue?: string
  onChange: (value: string) => void
  onSearch?: (value: string) => void  // Called after debounce
  placeholder?: string  // default: "Search..."
  debounceMs?: number   // default: 300
  className?: string
}

// Controlled usage
const [search, setSearch] = useState('')
<GallerySearch
  value={search}
  onChange={setSearch}
  onSearch={handleDebouncedSearch}
  placeholder="Search instructions..."
/>

// Uncontrolled usage
<GallerySearch
  onSearch={handleSearch}
/>
```

### useDebounce Hook

```typescript
function useDebounce<T>(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState(value)

  useEffect(() => {
    const timer = setTimeout(() => setDebouncedValue(value), delay)
    return () => clearTimeout(timer)
  }, [value, delay])

  return debouncedValue
}
```

## Testing

- [x] Unit test: onChange fires immediately
- [x] Unit test: onSearch fires after debounce delay
- [x] Unit test: clear button resets value
- [x] Unit test: Escape key clears input
- [x] Accessibility test: proper ARIA attributes

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5

### File List

| File                                                      | Action   |
| --------------------------------------------------------- | -------- |
| packages/core/gallery/src/components/GallerySearch.tsx    | Created  |
| packages/core/gallery/src/index.ts                        | Modified |
| packages/core/gallery/src/__tests__/GallerySearch.test.tsx| Created  |

### Debug Log References

None

### Completion Notes

- GallerySearch component implements debounced search input
- Supports both controlled and uncontrolled usage patterns
- onChange fires immediately, onSearch fires after debounce delay (default 300ms)
- Configurable debounce delay via `debounceMs` prop
- Clear button appears when value is present
- Escape key clears input
- Search icon visual indicator
- Accessible: role="searchbox", aria-label, aria-describedby for help text
- 30 unit tests passing covering all functionality
- Build and lint verified

## Change Log

| Date       | Version | Description             | Author      |
| ---------- | ------- | ----------------------- | ----------- |
| 2025-11-30 | 0.1     | Initial draft           | SM Agent    |
| 2025-12-05 | 1.0     | Implementation complete | Dev (James) |
