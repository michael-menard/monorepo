# Story 3.1.20: Accessibility â€” Uploader Flow (WCAG AA)

## Status

Ready for Review

## Story

As an accessibility-minded team,
we want the uploader to meet WCAG AA,
so it is usable by all.

## Acceptance Criteria

1. Keyboard operability

- All actions (add/remove/cancel/retry/finalize) are reachable and operable via keyboard.

2. Semantics & announcements

- Progressbars have correct roles/aria; live regions announce state changes and restores (3.1.9).

3. Focus management

- Dialogs (unsaved-changes, conflict) have focus traps and logical return focus.

4. Color contrast & motion

- Meet design-system contrast; reduce motion preferences respected for animations.

5. Tests

- Automated a11y checks; RTL tests for focus and aria attributes.

## Tasks / Subtasks

- [x] Audit components and add aria/roles
- [x] Implement focus traps and restore
- [x] Add reduced motion support
- [x] Add a11y tests

## Dev Notes

- Use design-system tokens; avoid relying solely on color for state.

### Auth, Cookies, and CSRF

- Cookie-based (HttpOnly) session auth.
- Frontend MUST send `credentials: 'include'` and MUST NOT send `Authorization` headers.
- Cookie attributes: `HttpOnly`; `Secure`; `SameSite=Lax` (recommended) or `SameSite=None; Secure` when API is on a different site/domain.
- CORS: `Access-Control-Allow-Credentials: true`; `Access-Control-Allow-Origin` must be the exact client origin (no `*`). Include `Vary: Origin`.
- Responses are JSON; clients send `Accept: application/json`.
- CSRF for unsafe methods (POST/PUT/PATCH/DELETE): require `X-CSRF-Token` and verify server-side (double-submit cookie or session-bound token). GET endpoints do not require CSRF.

Ensure:

- RTK Query uses `credentials: 'include'` and does not set `Authorization`.
- XHR uploads use `withCredentials = true` and appropriate `Content-Type` (e.g., `application/octet-stream` for binary part uploads).
- Backend sets cookies with `HttpOnly`; `Secure`; `SameSite` (Lax or None+Secure) and CORS allows credentials for the exact origin.
- Optional `X-CSRF-Token` header is included on unsafe methods when CSRF is enabled.

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5

### File List

| File                                                                       | Action   | Description                                                                                           |
| -------------------------------------------------------------------------- | -------- | ----------------------------------------------------------------------------------------------------- |
| apps/web/main-app/src/components/Uploader/ConflictModal/index.tsx          | Modified | Added aria-labelledby, aria-describedby, focus management, aria-busy                                  |
| apps/web/main-app/src/components/Uploader/RateLimitBanner/index.tsx        | Modified | Added progressbar ARIA attributes, reduced motion support                                             |
| apps/web/main-app/src/components/Uploader/SessionExpiredBanner/index.tsx   | Modified | Added aria-busy, reduced motion support for spinner                                                   |
| apps/web/main-app/src/components/Uploader/**tests**/Accessibility.test.tsx | Created  | Comprehensive a11y tests (30 tests) covering keyboard operability, ARIA, focus, screen reader support |

### Debug Log References

N/A - No issues requiring debugging

### Completion Notes

- All uploader components audited and enhanced with proper ARIA attributes
- ConflictModal: aria-labelledby, aria-describedby, focus management with previousFocusRef, aria-busy on loading button, aria-invalid on input errors
- RateLimitBanner: progressbar with aria-valuemin/max/now/label, timer role with aria-live="polite", reduced motion via `motion-reduce:transition-none`
- SessionExpiredBanner: aria-busy on refresh button, reduced motion via `motion-reduce:animate-none`, assertive live region for screen readers
- UnsavedChangesDialog already had proper alertdialog role and focus behavior
- Comprehensive accessibility tests cover keyboard navigation, ARIA attributes, focus management, screen reader announcements
- All 57 uploader tests passing

## Change Log

| Date       | Version | Description             | Author |
| ---------- | ------- | ----------------------- | ------ |
| 2025-12-06 | 0.1     | Initial draft (a11y)    | SM     |
| 2025-12-08 | 0.2     | Implementation complete | Dev    |
