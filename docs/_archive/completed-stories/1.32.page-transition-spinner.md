# Story 1.32: Page Transition Spinner

## Status

Ready for Review

## Story

**As a** user,
**I want** a loading spinner during page transitions,
**so that** I know the app is loading a new page.

## Acceptance Criteria

1. ⬜ PageTransitionSpinner component created
2. ⬜ Shows when isNavigating is true
3. ⬜ Positioned at top of page (progress bar style)
4. ⬜ Or centered overlay spinner
5. ⬜ Smooth fade-in animation
6. ⬜ LEGO brand colors

## Tasks / Subtasks

- [x] **Task 1: Create Spinner Component** (AC: 1)
  - [x] Create components/PageTransitionSpinner.tsx
  - [x] Accept variant prop (bar vs overlay)

- [x] **Task 2: Progress Bar Style** (AC: 3)
  - [x] Fixed position at top
  - [x] Animated width (indeterminate)
  - [x] Use primary color (teal/primary from theme)

- [x] **Task 3: Overlay Style** (AC: 4)
  - [x] Optional centered overlay
  - [x] Semi-transparent backdrop
  - [x] Spinning LEGO brick animation

- [x] **Task 4: Animation & Styling** (AC: 5-6)
  - [x] Fade in on show
  - [x] Use brand colors
  - [x] Don't block interaction (progress bar default)

- [x] **Task 5: Connect to State** (AC: 2)
  - [x] Use selectIsNavigating from globalUISlice
  - [x] Render conditionally via AnimatePresence

## Dev Notes

### Component Options

#### Option A: Progress Bar (Recommended)

```typescript
export function PageTransitionSpinner() {
  const isNavigating = useRouterState({ select: s => s.isLoading })

  if (!isNavigating) return null

  return (
    <div className="fixed top-0 left-0 right-0 z-50 h-1">
      <motion.div
        className="h-full bg-primary"
        initial={{ width: '0%' }}
        animate={{ width: '90%' }}
        transition={{ duration: 0.5, ease: 'easeOut' }}
      />
    </div>
  )
}
```

#### Option B: NProgress Style

```typescript
import NProgress from 'nprogress'
import 'nprogress/nprogress.css'

// Configure
NProgress.configure({ showSpinner: false })

// In route change effect
useEffect(() => {
  if (isNavigating) {
    NProgress.start()
  } else {
    NProgress.done()
  }
}, [isNavigating])
```

#### Option C: Overlay Spinner

```typescript
export function PageTransitionOverlay() {
  const isNavigating = useRouterState({ select: s => s.isLoading })

  return (
    <AnimatePresence>
      {isNavigating && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          className="fixed inset-0 bg-background/50 z-50 flex items-center justify-center"
        >
          <Loader2 className="h-8 w-8 animate-spin text-primary" />
        </motion.div>
      )}
    </AnimatePresence>
  )
}
```

### Integration in Layout

```typescript
// In RootLayout.tsx
function RootLayout() {
  return (
    <>
      <PageTransitionSpinner />
      <Header />
      <Sidebar />
      <main>
        <Outlet />
      </main>
    </>
  )
}
```

### CSS for Custom Progress Bar

```css
@keyframes progress-indeterminate {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(400%);
  }
}

.progress-bar {
  animation: progress-indeterminate 1.5s ease infinite;
}
```

### Testing

- Test spinner shows during navigation
- Test spinner hides after navigation
- Test animation is smooth
- Visual test styling

## Dev Agent Record

### Agent Model Used

claude-opus-4-5-20250929

### Debug Log References

None - implementation completed without issues.

### Completion Notes

- Created `PageTransitionSpinner` component with two variants:
  - `bar` (default): Fixed progress bar at top of viewport with animated indeterminate state
  - `overlay`: Centered overlay with LEGO brick bounce animation and fallback spinner
- Integrated with existing Redux `globalUISlice.selectIsNavigating` state
- Uses `useNavigationSync` hook (already in App.tsx) to sync TanStack Router navigation state to Redux
- Added component to `RootLayout.tsx` authenticated layout section
- Framer Motion `AnimatePresence` handles smooth enter/exit animations
- 17 unit tests covering both variants, accessibility, and state reactivity
- Pre-existing test failures in codebase (useToast missing export) - not introduced by this story

### File List

| File | Action | Description |
|------|--------|-------------|
| `apps/web/main-app/src/components/PageTransitionSpinner/PageTransitionSpinner.tsx` | Created | Main spinner component with bar and overlay variants |
| `apps/web/main-app/src/components/PageTransitionSpinner/__tests__/PageTransitionSpinner.test.tsx` | Created | 17 unit tests for the component |
| `apps/web/main-app/src/components/Layout/RootLayout.tsx` | Modified | Added PageTransitionSpinner import and usage |

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-11-28 | 0.1     | Initial draft | SM Agent |
| 2025-11-30 | 1.0     | Implementation complete | Dev Agent (James) |
