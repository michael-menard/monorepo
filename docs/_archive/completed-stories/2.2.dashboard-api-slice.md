# Story 2.2: Dashboard API Slice

## Status

Done

## Story

**As a** developer,
**I want** an RTK Query slice for dashboard data,
**so that** I can fetch stats and recent MOCs.

## Acceptance Criteria

1. âœ… `dashboardApi` slice created with RTK Query
2. âœ… Base URL configured for API
3. âœ… Authorization header included
4. âœ… Cache invalidation tags defined
5. ðŸ”„ Backend: Dashboard endpoints must exist

## Tasks / Subtasks

- [x] **Task 1: Create API Slice**
  - [x] Create services/dashboardApi.ts
  - [x] Use createApi from RTK Query
  - [x] Configure baseQuery with auth

- [x] **Task 2: Define Tags**
  - [x] Add 'DashboardStats' tag
  - [x] Add 'RecentMocs' tag

- [x] **Task 3: Integrate with Store**
  - [x] Add reducer to store
  - [x] Add middleware

## Dev Notes

### API Slice Template

```typescript
import { createApi } from '@reduxjs/toolkit/query/react'
import { baseQueryWithReauth } from '@/services/api/baseQuery'

export const dashboardApi = createApi({
  reducerPath: 'dashboardApi',
  baseQuery: baseQueryWithReauth,
  tagTypes: ['DashboardStats', 'RecentMocs'],
  endpoints: builder => ({
    // Endpoints defined in stories 2.3, 2.4
  }),
})
```

---

## Dev Agent Record

### Agent Model Used

claude-opus-4-5-20250929

### File List

| File | Action | Description |
|------|--------|-------------|
| `packages/core/api-client/src/rtk/dashboard-api.ts` | Existing | Dashboard API slice with RTK Query, endpoints for stats and recent MOCs |
| `packages/core/api-client/package.json` | Existing | Exports `./rtk/dashboard-api` for package imports |
| `apps/web/main-app/src/store/index.ts` | Existing | Store integration with dashboardApi reducer and middleware |

### Debug Log References

None - implementation was already complete.

### Completion Notes

- Dashboard API slice was already implemented in `@repo/api-client` package
- Store integration in main-app was already complete with:
  - `dashboardApi.reducer` added to configureStore
  - `dashboardApi.middleware` added to middleware chain
  - Hooks exported: `useGetStatsQuery`, `useGetRecentMocsQuery`, `useRefreshDashboardMutation`
- Features implemented:
  - `createServerlessBaseQuery` with performance monitoring and retry logic
  - Cache tags: `['DashboardStats', 'RecentMocs']`
  - Endpoints: `getStats`, `getRecentMocs`, `refreshDashboard`
  - Type definitions: `DashboardStats`, `RecentMoc`, `DashboardResponse<T>`
- Type checking passes for dashboard-api.ts (no errors)
- Pre-existing type errors in other files do not affect this story

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-11-28 | 0.1     | Initial draft | SM Agent |
| 2025-11-30 | 1.0     | Verified implementation complete, marked ready for review | Dev Agent |
