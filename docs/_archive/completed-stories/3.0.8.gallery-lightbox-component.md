# Story 3.0.8: Gallery Lightbox Component

## Status

Done

## Story

**As a** user,
**I want** to view images in a modal lightbox,
**so that** I can see image details clearly.

## Acceptance Criteria

1. [x] GalleryLightbox component using Dialog (not full-screen)
2. [x] Click image to open lightbox
3. [x] Navigation between images (prev/next)
4. [x] Close on backdrop click or Escape key
5. [ ] Zoom capability (optional, stretch goal)
6. [x] Keyboard navigation (arrows, Escape)
7. [x] Accessible with proper focus management
8. [x] Image fills full dialog area (no header/footer chrome)
9. [x] Close, prev/next buttons hidden until hover

## Tasks / Subtasks

- [x] **Task 1: Create Lightbox Component**
  - [x] Create `src/components/GalleryLightbox.tsx`
  - [x] Use @repo/app-component-library AppDialog as foundation
  - [x] Large modal overlay with image (max-w-4xl via size="xl")

- [x] **Task 2: Navigation**
  - [x] Previous/Next buttons
  - [x] Arrow key navigation
  - [x] Image counter (3 of 10)

- [x] **Task 3: Close Behavior**
  - [x] Close button (X)
  - [x] Click backdrop to close
  - [x] Escape key to close

- [x] **Task 4: Accessibility**
  - [x] Focus trap within lightbox (via AppDialog)
  - [x] Return focus on close (via AppDialog)
  - [x] aria-label for buttons
  - [x] role="dialog" with proper attributes

## Dev Notes

### Implementation Details

Created two main exports:
1. `GalleryLightbox` - Modal component using AppDialog
2. `useLightbox` - Hook for managing lightbox state

### Component API

```typescript
interface LightboxImage {
  src: string
  alt: string
  title?: string
}

interface GalleryLightboxProps {
  images: LightboxImage[]
  open: boolean
  currentIndex: number
  onOpenChange: (open: boolean) => void
  onNext?: () => void
  onPrev?: () => void
  onIndexChange?: (index: number) => void
  className?: string
  'data-testid'?: string
}

// Usage with useLightbox hook
const images = [{ src: '/img1.jpg', alt: 'Image 1' }, ...]
const lightbox = useLightbox(images.length)

<GalleryGrid>
  {images.map((image, index) => (
    <GalleryCard
      key={index}
      image={image}
      onClick={() => lightbox.openLightbox(index)}
    />
  ))}
</GalleryGrid>

<GalleryLightbox
  images={images}
  open={lightbox.open}
  currentIndex={lightbox.currentIndex}
  onOpenChange={(open) => !open && lightbox.closeLightbox()}
  onNext={lightbox.next}
  onPrev={lightbox.prev}
/>
```

### useLightbox Hook

```typescript
interface UseLightboxReturn {
  open: boolean
  currentIndex: number
  openLightbox: (index: number) => void
  closeLightbox: () => void
  next: () => void
  prev: () => void
  goTo: (index: number) => void
  hasMultipleImages: boolean
  positionDisplay: string  // e.g., "3 of 10"
}

function useLightbox(totalImages: number): UseLightboxReturn
```

### Features

- **Not full-screen**: Uses AppDialog with size="xl" (max-w-4xl)
- **Clean viewing**: Image fills entire dialog area with dark background
- **Controls hidden until hover**: Close, prev/next buttons and counter only appear on hover
- **Focus still accessible**: Buttons become visible on focus for keyboard users
- **Image loading states**: Shows spinner while loading, error state on failure
- **Wrap-around navigation**: Goes from last to first (and vice versa)
- **Keyboard navigation**: Arrow keys when lightbox is open
- **Responsive**: Image scales to fit within dialog bounds

## Testing

- [x] Unit test: opens with correct initial image
- [x] Unit test: next/prev navigation works
- [x] Unit test: closes on Escape key (via Dialog)
- [x] Unit test: closes on backdrop click (via Dialog)
- [x] Unit test: keyboard navigation (arrows)
- [x] Hook test: useLightbox state management
- [x] Accessibility test: aria-labels on buttons

All 34 tests passing.

## Change Log

| Date       | Version | Description                                     | Author   |
| ---------- | ------- | ----------------------------------------------- | -------- |
| 2025-11-30 | 0.1     | Initial draft                                   | SM Agent |
| 2025-12-05 | 1.0     | Implemented with Dialog (non-full-screen modal) | Claude   |
