# Story 1.18: TanStack Router Setup

## Status

Ready for Review

## Story

**As a** developer,
**I want** TanStack Router configured with type-safe routes,
**so that** navigation is type-safe and performant.

## Acceptance Criteria

1. ✅ TanStack Router v1.x installed and configured
2. ✅ Root route with RootLayout component
3. ✅ Route tree generated/defined
4. ✅ RouterProvider in App.tsx
5. ✅ Type-safe Link components work
6. ✅ Route context provides auth state

## Tasks / Subtasks

- [x] **Task 1: Verify Package Installation** (AC: 1)
  - [x] Check @tanstack/react-router in package.json
  - [x] Verify version is 1.x (v1.130.2)

- [x] **Task 2: Router Configuration** (AC: 2-4)
  - [x] Create/verify router instance
  - [x] Define root route with RootLayout
  - [x] Generate or define route tree (12 routes)
  - [x] Wrap app in RouterProvider

- [x] **Task 3: Type Safety** (AC: 5)
  - [x] Verify Link component has type-safe "to" prop
  - [x] Test autocomplete works for routes (via Register interface)

- [x] **Task 4: Route Context** (AC: 6)
  - [x] Pass auth state in route context
  - [x] Guards can access context.auth

## File List

| File                                                       | Action   | Description                                           |
| ---------------------------------------------------------- | -------- | ----------------------------------------------------- |
| `apps/web/main-app/package.json`                           | Verified | @tanstack/react-router v1.130.2 installed             |
| `apps/web/main-app/src/routes/index.ts`                    | Verified | Router instance with route tree and type registration |
| `apps/web/main-app/src/App.tsx`                            | Verified | RouterProvider with auth context                      |
| `apps/web/main-app/src/components/Layout/RootLayout.tsx`   | Verified | Root layout component                                 |
| `apps/web/main-app/src/lib/route-guards.ts`                | Verified | Route guards accessing context.auth                   |
| `apps/web/main-app/src/routes/__tests__/router.test.ts`    | Created  | Router configuration tests (11 tests)                 |
| `apps/web/main-app/src/lib/__tests__/route-guards.test.ts` | Verified | Route guards tests (23 tests)                         |

## Dev Notes

### Existing Implementation

**File:** `apps/web/main-app/src/routes/index.ts`

### Router Setup

```typescript
import { createRouter, createRootRoute } from '@tanstack/react-router'
import { RootLayout } from '@/components/Layout/RootLayout'

const rootRoute = createRootRoute({
  component: RootLayout,
})

const routeTree = rootRoute.addChildren([
  // Child routes defined here
])

export const router = createRouter({
  routeTree,
  context: {
    auth: undefined!, // Will be provided by AuthProvider
  },
})

// Type registration
declare module '@tanstack/react-router' {
  interface Register {
    router: typeof router
  }
}
```

### App.tsx Integration

```typescript
import { RouterProvider } from '@tanstack/react-router'
import { router } from './routes'

function App() {
  const auth = useAppSelector(selectAuth)

  return (
    <RouterProvider
      router={router}
      context={{ auth }}
    />
  )
}
```

### Route Definition Pattern

```typescript
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/dashboard')({
  component: DashboardPage,
  beforeLoad: RouteGuards.protected,
})
```

### Testing

- Test router initializes without error
- Test navigation works
- Test Link components render
- Test context is accessible in guards

## Story Wrap-Up

### Summary

TanStack Router v1.130.2 was already fully implemented in the codebase. This story involved:

- Verifying all acceptance criteria were met
- Creating comprehensive router configuration tests (11 tests)
- Validating existing route-guards tests (23 tests)
- Confirming build and lint pass

### Notes for Next Story

- Router is fully configured with 12 routes
- Type-safe navigation via Register interface
- Route guards access auth state via `context.auth`
- Route lazy loading is configured with `defaultPreload: 'intent'`

### Agent Model

Claude Opus 4.5 (Augment Agent)

## Change Log

| Date       | Version | Description                          | Author    |
| ---------- | ------- | ------------------------------------ | --------- |
| 2025-11-28 | 0.1     | Initial draft                        | SM Agent  |
| 2025-11-30 | 1.0     | Implementation verified, tests added | Dev Agent |
