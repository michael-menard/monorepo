# AGENT-HINTS.yaml Schema
# Per-agent actionable recommendations from pattern mining
# Generated by: pattern-miner agent
# Consumer: Dev agents (loaded at runtime)

---

## Core Structure

```yaml
schema: 1
generated_at: "{ISO timestamp}"
analysis_period:
  start: "{ISO date}"
  end: "{ISO date}"
  days: {N}
stories_analyzed: {N}

agents: []
metadata: {}
```

---

## Agent Hints Section

One entry per agent with detected patterns.

```yaml
agents:
  - agent_name: "{agent-name}"
    agent_role: coder | reviewer | planner | leader

    priority_hints: []
    file_hints: []
    anti_patterns: []

    effectiveness_metrics:
      stories_involved: {N}
      avg_review_cycles: {float}
      failure_rate: {0.0-1.0}
```

### Priority Hints

High-priority recommendations for this agent.

```yaml
priority_hints:
  - hint: "{actionable recommendation}"
    severity: high | medium
    pattern_source: "{pattern ID from PATTERNS.yaml}"

    trigger_conditions:
      - "{when to apply this hint}"

    evidence_count: {N}  # Stories supporting this hint

    example:
      story_id: "{STORY_ID}"
      before: "{original behavior}"
      after: "{improved behavior}"
```

### File Hints

File-specific recommendations.

```yaml
file_hints:
  - file_pattern: "{glob pattern}"
    hint: "{actionable recommendation}"
    severity: high | medium

    common_issues:
      - "{issue description}"

    checklist:
      - "{pre-flight check}"

    evidence_count: {N}
```

### Anti-Patterns

Behaviors to avoid.

```yaml
anti_patterns:
  - anti_pattern: "{pattern to avoid}"
    severity: high | medium

    description: "{what goes wrong}"
    alternative: "{what to do instead}"

    evidence_count: {N}
    examples:
      - story_id: "{STORY_ID}"
        issue: "{what happened}"
```

---

## Metadata Section

```yaml
metadata:
  min_sample_size: 3
  hint_threshold: 0.60  # Minimum correlation to generate hint

  agents_analyzed: {N}
  hints_generated: {N}

  warnings:
    - "{warning message}"
```

---

## Example

```yaml
schema: 1
generated_at: "2026-02-07T10:00:00Z"
analysis_period:
  start: "2026-01-08"
  end: "2026-02-07"
  days: 30
stories_analyzed: 15

agents:
  - agent_name: backend-coder
    agent_role: coder

    priority_hints:
      - hint: "For auth routes: Add input sanitization before processing user credentials"
        severity: high
        pattern_source: "agent_correlation_001"

        trigger_conditions:
          - "Working on files matching apps/api/*/auth/*"
          - "Working on files matching apps/api/*/routes.ts with auth endpoints"

        evidence_count: 6

        example:
          story_id: "WISH-002"
          before: "Directly used req.body.email without validation"
          after: "Validated with EmailSchema.parse(req.body.email)"

    file_hints:
      - file_pattern: "apps/api/*/routes.ts"
        hint: "Add explicit type annotations for all handler params (req, res, next)"
        severity: medium

        common_issues:
          - "Missing type annotations on handler params"
          - "Implicit any on request/response objects"

        checklist:
          - "Verify handler signature includes types: (req: Request, res: Response) =>"
          - "Run eslint before committing changes"

        evidence_count: 8

    anti_patterns:
      - anti_pattern: "Implementing validation logic directly in route handlers"
        severity: medium

        description: "Embedding validation in handlers makes them hard to test and violates separation of concerns"
        alternative: "Use Zod schemas + middleware for validation, keep handlers thin"

        evidence_count: 4
        examples:
          - story_id: "WISH-007"
            issue: "Handler had 50+ lines of validation logic, failed security review"

    effectiveness_metrics:
      stories_involved: 12
      avg_review_cycles: 2.3
      failure_rate: 0.58

  - agent_name: code-review-security
    agent_role: reviewer

    priority_hints:
      - hint: "When reviewing auth code, check for hardcoded secrets and ensure env var usage"
        severity: high
        pattern_source: "security_review_pattern_003"

        trigger_conditions:
          - "Reviewing files matching apps/api/*/auth/*"
          - "Reviewing files with 'password', 'secret', 'token' in content"

        evidence_count: 3

        example:
          story_id: "WISH-009"
          before: "Missed hardcoded JWT secret in test file"
          after: "Flag all string literals matching secret patterns"

    file_hints: []
    anti_patterns: []

    effectiveness_metrics:
      stories_involved: 9
      avg_review_cycles: 1.8
      failure_rate: 0.22

  - agent_name: dev-plan-leader
    agent_role: planner

    priority_hints:
      - hint: "For integration stories, apply 1.3x multiplier to token estimates"
        severity: medium
        pattern_source: "token_budget_pattern_001"

        trigger_conditions:
          - "Story tagged with 'integration' or 'external-api'"
          - "Story involves backend + external service"

        evidence_count: 7

        example:
          story_id: "WISH-003"
          before: "Estimated 15k tokens, actually used 22k (47% overrun)"
          after: "Estimated 19.5k tokens (15k * 1.3), came within 10%"

    file_hints: []
    anti_patterns: []

    effectiveness_metrics:
      stories_involved: 8
      avg_review_cycles: 1.5
      failure_rate: 0.12

metadata:
  min_sample_size: 3
  hint_threshold: 0.60
  agents_analyzed: 3
  hints_generated: 4
  warnings:
    - "OUTCOME.yaml unavailable - used VERIFICATION.yaml fallback"
```

---

## Integration with Agents

Agents should load AGENT-HINTS.yaml at initialization:

```markdown
## Agent Initialization

1. Check for `.claude/patterns/AGENT-HINTS.yaml`
2. If exists and fresh (<30 days old):
   - Load hints for `agent_name` matching this agent
   - Integrate `priority_hints` into execution context
   - Apply `file_hints` when working on matching files
   - Avoid `anti_patterns` during implementation
3. If missing or stale:
   - Continue without hints (graceful degradation)
   - Log warning for human awareness
```

---

## Freshness

- **Fresh**: Generated within last 30 days
- **Stale**: Older than 30 days (still usable but should be refreshed)
- **Missing**: Run `/pattern-mine` to generate

Agents should check freshness and log a warning if stale, but continue with available hints rather than blocking.
