---
created: 2026-02-01
updated: 2026-02-01
version: 1.0.0
doc_type: schema
---

# TTDC Schema

Defines the structure, aggregation rules, and reporting format for Time to Dev-Complete (TTDC) metrics in the flow-convergence workflow.

---

## Overview

TTDC measures the time elapsed from **commitment** to **dev-complete** for each story. This metric focuses on predictability rather than raw speed, tracking median and variance to assess delivery consistency.

**CRITICAL**: These metrics are for SYSTEM LEARNING only, NOT performance evaluation.

Key principle from PLAN.md:
> "We value **predictability over raw speed**."

---

## TTDC Event Structure

### Core Event Record

Each TTDC event represents one story's commitment-to-completion cycle.

```yaml
# Story identification
story_id: string           # Story being measured (e.g., "WISH-0500")
feature_dir: string        # Feature directory for context

# Timestamps (ISO 8601)
commitment_time: datetime  # When commitment gate passed
completion_time: datetime  # When dev-complete status reached

# Duration
duration_ms: number        # Milliseconds from commitment to completion
duration_hours: number     # Hours (2 decimal precision) for readability

# Classification
is_outlier: boolean        # True if >2 sigma from mean
outlier_sigma: number      # How many sigmas from mean (if outlier)

# Context
readiness_score: number    # Score at commitment (for correlation analysis)
story_size: string         # Optional: XS | S | M | L | XL (if tracked)
```

### Example Event Record

```yaml
story_id: "WISH-0500"
feature_dir: "plans/future/wish"

commitment_time: "2026-02-01T09:15:00Z"
completion_time: "2026-02-01T17:42:00Z"

duration_ms: 30420000      # 8.45 hours
duration_hours: 8.45

is_outlier: false
outlier_sigma: null

readiness_score: 87
story_size: "M"
```

---

## Aggregation Rules

### Statistical Calculations

#### Median Calculation

Median is preferred over mean for central tendency (robust to outliers).

```yaml
algorithm: "middle_value"
for_even_count: "average of two middle values"
formula: |
  sorted = sort(durations, ascending)
  n = length(sorted)
  if n % 2 == 1:
    median = sorted[floor(n/2)]
  else:
    median = (sorted[n/2 - 1] + sorted[n/2]) / 2
```

#### Variance Calculation

Variance measures spread (predictability signal).

```yaml
algorithm: "sample_variance"
formula: |
  mean = sum(durations) / count
  variance = sum((d - mean)^2 for d in durations) / (count - 1)
rationale: "Use N-1 denominator for unbiased sample variance"
```

#### Coefficient of Variation

The KEY predictability metric (lower = more predictable).

```yaml
formula: "cv = std_dev / mean"
interpretation:
  - cv < 0.30: "High predictability - consistent delivery"
  - cv 0.30-0.50: "Moderate predictability - some variation"
  - cv 0.50-0.70: "Low predictability - significant variation"
  - cv > 0.70: "Very low predictability - highly variable delivery"
```

#### Outlier Detection

Outliers are identified but not removed by default.

```yaml
algorithm: "z_score"
threshold: 2.0  # Standard deviations
formula: |
  z_score = abs(duration - mean) / std_dev
  is_outlier = z_score > threshold
handling:
  default: "include in metrics, flag for investigation"
  optional: "exclude_outliers config to omit from calculations"
```

### Aggregation Intervals

```yaml
aggregation_levels:
  story:
    description: "Single story TTDC data point"
    granularity: "per_event"

  feature:
    description: "All stories within a feature directory"
    granularity: "per_feature"
    file: "{feature_dir}/_metrics/TTDC-HISTORY.yaml"

  global:
    description: "All stories across all features"
    granularity: "cross_feature"
    file: ".claude/metrics/TTDC-GLOBAL.yaml"
    use_case: "System-wide predictability baseline"
```

---

## Reporting Format

### TTDC Metrics Report

Generated by `ttdc-metrics-agent` after each story completion.

```yaml
schema: 1
report_type: ttdc_metrics
generated_at: "{ISO_TIMESTAMP}"
scope: "{feature_dir}" | "global"

# Dataset information
dataset:
  story_count: number
  date_range:
    earliest: "{ISO_TIMESTAMP}"
    latest: "{ISO_TIMESTAMP}"
  outlier_count: number
  outlier_excluded: boolean

# Core metrics
metrics:
  # Central tendency
  median_ms: number
  median_hours: number
  mean_ms: number
  mean_hours: number

  # Variability (predictability signals)
  variance_ms: number
  std_dev_ms: number
  std_dev_hours: number
  coefficient_of_variation: number  # KEY METRIC

  # Range
  min_ms: number
  min_hours: number
  max_ms: number
  max_hours: number

  # Percentiles (for distribution understanding)
  p25_hours: number  # 25th percentile
  p75_hours: number  # 75th percentile
  p90_hours: number  # 90th percentile

# Trend analysis (requires >= 5 data points)
trend:
  direction: improving | stable | degrading | insufficient_data
  recent_median_hours: number  # Last 5 stories
  historical_median_hours: number  # Prior to last 5
  change_percent: number

# Insights for system learning
insights:
  - type: predictability
    message: "High predictability: CV=28%"
    severity: info | warning | critical

  - type: outliers
    message: "2 outliers detected (15% of data)"
    severity: info

  - type: trend
    message: "Median TTDC decreasing over last 10 stories"
    severity: info
```

### Example Report

```yaml
schema: 1
report_type: ttdc_metrics
generated_at: "2026-02-01T18:00:00Z"
scope: "plans/future/wish"

dataset:
  story_count: 15
  date_range:
    earliest: "2026-01-15T10:00:00Z"
    latest: "2026-02-01T17:42:00Z"
  outlier_count: 2
  outlier_excluded: false

metrics:
  median_ms: 28800000      # 8 hours
  median_hours: 8.0
  mean_ms: 32400000        # 9 hours
  mean_hours: 9.0

  variance_ms: 25920000000000
  std_dev_ms: 5091168
  std_dev_hours: 1.41
  coefficient_of_variation: 0.16  # Excellent predictability

  min_ms: 14400000         # 4 hours
  min_hours: 4.0
  max_ms: 72000000         # 20 hours (outlier)
  max_hours: 20.0

  p25_hours: 6.5
  p75_hours: 10.5
  p90_hours: 14.2

trend:
  direction: stable
  recent_median_hours: 7.8
  historical_median_hours: 8.2
  change_percent: -4.9

insights:
  - type: predictability
    message: "High predictability: CV=16% - delivery times are highly consistent"
    severity: info

  - type: distribution
    message: "Right-skewed: mean (9.0h) > median (8.0h) - some stories take longer"
    severity: info

  - type: outliers
    message: "2 outliers detected: WISH-0482 (20h), WISH-0491 (18h)"
    severity: warning

  - type: trend
    message: "TTDC stable over last 10 stories (within 5% of baseline)"
    severity: info
```

---

## TTDC History File Structure

History is stored at `{feature_dir}/_metrics/TTDC-HISTORY.yaml`.

### File Structure

```yaml
schema: 1
feature_dir: "{FEATURE_DIR}"
created_at: "{ISO_TIMESTAMP}"
updated_at: "{ISO_TIMESTAMP}"

# Configuration
config:
  outlier_sigma_threshold: 2.0
  exclude_outliers: false
  max_event_age_days: 0  # 0 = no limit

# Aggregate statistics (updated on each event)
totals:
  events_recorded: number
  events_with_outliers: number
  average_duration_hours: number
  median_duration_hours: number
  coefficient_of_variation: number

# Computed metrics (latest calculation)
computed_metrics:
  calculated_at: "{ISO_TIMESTAMP}"
  count: number
  median_ms: number
  median_hours: number
  mean_ms: number
  mean_hours: number
  variance_ms: number
  std_dev_ms: number
  std_dev_hours: number
  coefficient_of_variation: number
  min_ms: number
  min_hours: number
  max_ms: number
  max_hours: number

# Event history (append-only)
events:
  - story_id: "WISH-0500"
    commitment_time: "{ISO_TIMESTAMP}"
    completion_time: "{ISO_TIMESTAMP}"
    duration_ms: number
    duration_hours: number
    is_outlier: boolean
    readiness_score: number

  - story_id: "WISH-0501"
    commitment_time: "{ISO_TIMESTAMP}"
    completion_time: "{ISO_TIMESTAMP}"
    duration_ms: number
    duration_hours: number
    is_outlier: boolean
    readiness_score: number

# Outlier analysis
outliers:
  threshold_sigma: 2.0
  items:
    - story_id: "WISH-0482"
      duration_hours: 20.0
      sigma_from_mean: 2.8
      investigation_note: "Blocked by external dependency"
```

### Example History File

```yaml
schema: 1
feature_dir: "plans/future/wish"
created_at: "2026-01-15T10:00:00Z"
updated_at: "2026-02-01T17:45:00Z"

config:
  outlier_sigma_threshold: 2.0
  exclude_outliers: false
  max_event_age_days: 0

totals:
  events_recorded: 15
  events_with_outliers: 2
  average_duration_hours: 9.0
  median_duration_hours: 8.0
  coefficient_of_variation: 0.16

computed_metrics:
  calculated_at: "2026-02-01T17:45:00Z"
  count: 15
  median_ms: 28800000
  median_hours: 8.0
  mean_ms: 32400000
  mean_hours: 9.0
  variance_ms: 25920000000000
  std_dev_ms: 5091168
  std_dev_hours: 1.41
  coefficient_of_variation: 0.16
  min_ms: 14400000
  min_hours: 4.0
  max_ms: 72000000
  max_hours: 20.0

events:
  - story_id: "WISH-0500"
    commitment_time: "2026-02-01T09:15:00Z"
    completion_time: "2026-02-01T17:42:00Z"
    duration_ms: 30420000
    duration_hours: 8.45
    is_outlier: false
    readiness_score: 87

  - story_id: "WISH-0499"
    commitment_time: "2026-01-31T14:00:00Z"
    completion_time: "2026-01-31T21:30:00Z"
    duration_ms: 27000000
    duration_hours: 7.5
    is_outlier: false
    readiness_score: 89

  # ... more events

outliers:
  threshold_sigma: 2.0
  items:
    - story_id: "WISH-0482"
      duration_hours: 20.0
      sigma_from_mean: 2.8
      investigation_note: "Blocked by external dependency for 8 hours"
```

---

## Commitment Record Structure

The TTDC agent reads commitment data from the commitment gate output.

### Commitment File

Located at `{feature_dir}/{stage}/{story_id}/_implementation/COMMITMENT.yaml`.

```yaml
schema: 1
story_id: "{STORY_ID}"
feature_dir: "{FEATURE_DIR}"

# When commitment occurred
commitment_time: "{ISO_TIMESTAMP}"

# Gate decision
gate_decision: PASS | OVERRIDE
override_reason: string | null

# Context at commitment
context:
  readiness_score: number
  mvp_blocking_gaps: number
  known_unknowns: number
  baseline_aligned: boolean

# For correlation analysis
story_metadata:
  estimated_size: "XS" | "S" | "M" | "L" | "XL"
  complexity: "low" | "medium" | "high"
  has_frontend: boolean
  has_backend: boolean
```

---

## Integration Points

### Consumed By

| Consumer | Usage |
|----------|-------|
| `ttdc-metrics-agent` | Reads history, calculates metrics, updates file |
| Retrospective tooling | Reviews TTDC trends for process improvement |
| Commitment gate tuning | Correlates readiness scores with TTDC |
| Story estimation | Calibrates estimates against historical TTDC |

### Produces

| Output | Location |
|--------|----------|
| TTDC events | Appended to `{feature_dir}/_metrics/TTDC-HISTORY.yaml` |
| Computed metrics | Updated in history file `computed_metrics` section |
| Reports | Agent output, optionally `{feature_dir}/_metrics/TTDC-REPORT.yaml` |

### Correlation Analysis

TTDC can be correlated with:

| Factor | Analysis |
|--------|----------|
| Readiness score | Does higher readiness predict lower TTDC variance? |
| Story size | Are size estimates accurate predictors? |
| Gap count at commitment | Does gap count correlate with TTDC? |
| Override usage | Do overridden commitments have higher TTDC? |

---

## Interpretation Guidelines

### Healthy TTDC Patterns

```yaml
healthy_signals:
  - name: "Low coefficient of variation"
    threshold: "CV < 0.30"
    meaning: "Delivery times are predictable"
    action: "Continue current process"

  - name: "Stable trend"
    threshold: "Change < 10% over 10 stories"
    meaning: "Process is consistent"
    action: "Monitor, no intervention needed"

  - name: "Few outliers"
    threshold: "Outliers < 10% of events"
    meaning: "Rare exceptional cases"
    action: "Investigate outliers for learning"
```

### Warning TTDC Patterns

```yaml
warning_signals:
  - name: "High coefficient of variation"
    threshold: "CV > 0.50"
    meaning: "Delivery times are unpredictable"
    action: "Review commitment gate effectiveness"

  - name: "Increasing trend"
    threshold: "TTDC increasing > 15% over 10 stories"
    meaning: "Process may be degrading"
    action: "Investigate root cause"

  - name: "Many outliers"
    threshold: "Outliers > 20% of events"
    meaning: "Systemic issues causing delays"
    action: "Analyze outlier patterns"
```

### What TTDC Does NOT Measure

```yaml
explicitly_excluded:
  - "Individual developer performance"
  - "Pre-commitment elaboration time"
  - "Discovery phase duration"
  - "Code quality (measured separately)"
  - "Customer satisfaction"

rationale: |
  TTDC measures workflow predictability, not productivity.
  A longer but predictable TTDC is preferable to a shorter but variable one.
```

---

## Evolution Notes

This schema is designed for evolution:

1. **New correlation factors**: Add to `story_metadata` in commitment record
2. **Threshold tuning**: Adjust based on observed predictability
3. **Aggregation levels**: Add team-level or project-level aggregations
4. **Visualization support**: Add time-series bucketing for charts

When evolving, increment schema version and document migration path.
