#!/bin/sh
# Commit message hook: Enforce conventional commit format

commit_msg_file="$1"
commit_msg=$(cat "$commit_msg_file")

# Conventional commit pattern
# Format: type(scope): description
# Types: feat, fix, docs, style, refactor, perf, test, chore, ci, build, revert
pattern="^(feat|fix|docs|style|refactor|perf|test|chore|ci|build|revert)(\(.+\))?: .+"

# Check if commit message matches pattern
if ! echo "$commit_msg" | grep -qE "$pattern"; then
  echo "‚ùå ERROR: Commit message doesn't follow conventional commit format!"
  echo ""
  echo "üìã Required format: type(scope): description"
  echo ""
  echo "Valid types:"
  echo "  ‚Ä¢ feat:     A new feature"
  echo "  ‚Ä¢ fix:      A bug fix"
  echo "  ‚Ä¢ docs:     Documentation changes"
  echo "  ‚Ä¢ style:    Code style changes (formatting, etc.)"
  echo "  ‚Ä¢ refactor: Code refactoring"
  echo "  ‚Ä¢ perf:     Performance improvements"
  echo "  ‚Ä¢ test:     Adding or updating tests"
  echo "  ‚Ä¢ chore:    Maintenance tasks"
  echo "  ‚Ä¢ ci:       CI/CD changes"
  echo "  ‚Ä¢ build:    Build system changes"
  echo "  ‚Ä¢ revert:   Revert a previous commit"
  echo ""
  echo "Examples:"
  echo "  ‚úÖ feat(auth): add OAuth login"
  echo "  ‚úÖ fix(api): resolve timeout issue"
  echo "  ‚úÖ docs: update README with setup instructions"
  echo "  ‚úÖ refactor(ui): simplify button component"
  echo ""
  echo "Your commit message:"
  echo "  ‚ùå $commit_msg"
  echo ""
  exit 1
fi

# Check commit message length (first line should be <= 100 chars)
first_line=$(echo "$commit_msg" | head -n 1)
if [ ${#first_line} -gt 100 ]; then
  echo "‚ö†Ô∏è  WARNING: Commit message first line is too long (${#first_line} chars)"
  echo "   Recommended: <= 100 characters"
  echo ""
  # Don't exit, just warn
fi

echo "‚úÖ Commit message format is valid"

