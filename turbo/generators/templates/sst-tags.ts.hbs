/**
 * AWS Resource Tagging Schema for SST
 * Generated: {{date}}
 *
 * This module provides standardized AWS tagging utilities for consistent
 * resource tagging across the organization per aws-tagging-schema.md
 */

export interface TagConfig {
  /**
   * Project name (e.g., 'lego-api', 'user-metrics', 'infrastructure')
   */
  project: string;

  /**
   * Deployment environment
   */
  environment: 'dev' | 'staging' | 'prod' | 'shared';

  /**
   * Owner email or team contact
   */
  owner: string;

  /**
   * Cost center for budget allocation
   * @default 'Engineering'
   */
  costCenter?: string;
}

/**
 * Creates required tags that MUST be applied to ALL AWS resources
 *
 * These 5 tags are mandatory per the organization's tagging schema:
 * - Project: Group resources by project/initiative
 * - Environment: Separate resources by deployment environment
 * - ManagedBy: Identify infrastructure-as-code tool
 * - CostCenter: Budget allocation and chargeback
 * - Owner: Point of contact for resource
 */
export const createBaseTags = (config: TagConfig) => ({
  Project: config.project,
  Environment: config.environment,
  ManagedBy: 'SST',
  CostCenter: config.costCenter || 'Engineering',
  Owner: config.owner,
});

/**
 * Functional tags for architectural components
 */
export const componentTags = {
  api: {
    Component: 'API',
    Function: 'Compute',
  },
  frontend: {
    Component: 'Frontend',
    Function: 'Presentation',
  },
  database: {
    Component: 'Database',
    Function: 'Storage',
  },
  observability: {
    Component: 'Observability',
    Function: 'Monitoring',
  },
  analytics: {
    Component: 'Analytics',
    Function: 'Analytics',
  },
  networking: {
    Component: 'Networking',
    Function: 'Networking',
  },
  iam: {
    Component: 'IAM',
    Function: 'AccessControl',
  },
  storage: {
    Component: 'Storage',
    Function: 'Storage',
  },
};

/**
 * Tags for Lambda functions
 */
export const lambdaTags = (endpoint: string, runtime: string = 'nodejs20.x') => ({
  ServiceType: 'Lambda',
  Runtime: runtime,
  Endpoint: endpoint,
});

/**
 * Tags for data storage resources
 */
export const dataTypeTags = {
  metrics: { DataType: 'Metrics' },
  logs: { DataType: 'Logs' },
  sessions: { DataType: 'Sessions' },
  analytics: { DataType: 'Analytics' },
  userData: { DataType: 'UserData' },
  assets: { DataType: 'Assets' },
  backups: { DataType: 'Backups' },
};

/**
 * Operational tags for lifecycle management
 */
export const operationalTags = {
  basic: {
    MonitoringLevel: 'Basic',
    LogRetention: '30',
  },
  enhanced: {
    MonitoringLevel: 'Enhanced',
    LogRetention: '90',
  },
  custom: {
    MonitoringLevel: 'Custom',
    LogRetention: '365',
  },
};

/**
 * Cost allocation tags
 */
export const createCostTags = (budgetAlert?: string, billingCode?: string) => ({
  ...(budgetAlert && { BudgetAlert: budgetAlert }),
  ...(billingCode && { BillingCode: billingCode }),
  CostOptimization: 'Review',
});

/**
 * Complete Lambda function tags
 *
 * @example
 * ```typescript
 * const fn = new Function(stack, 'MyFunction', {
 *   handler: 'src/handler.main',
 *   tags: createLambdaTags({
 *     project: 'lego-api',
 *     environment: stack.stage,
 *     owner: 'engineering@example.com',
 *     endpoint: 'GetUser',
 *   }),
 * });
 * ```
 */
export const createLambdaTags = (config: TagConfig & { endpoint: string; runtime?: string }) => ({
  ...createBaseTags(config),
  ...componentTags.api,
  ...lambdaTags(config.endpoint, config.runtime),
  ...operationalTags.enhanced,
});

/**
 * Complete S3 bucket tags
 */
export const createS3Tags = (
  config: TagConfig & {
    dataType: keyof typeof dataTypeTags;
    retentionPeriod: string;
  }
) => ({
  ...createBaseTags(config),
  ...componentTags.storage,
  ...dataTypeTags[config.dataType],
  RetentionPeriod: config.retentionPeriod,
  EncryptionEnabled: 'true',
});

/**
 * Complete RDS/database tags
 */
export const createDatabaseTags = (config: TagConfig & { dataType: string }) => ({
  ...createBaseTags(config),
  ...componentTags.database,
  DataType: config.dataType,
  BackupEnabled: 'true',
  EncryptionEnabled: 'true',
});

/**
 * IAM role tags
 */
export const createIAMTags = (
  config: TagConfig & {
    purpose: 'LambdaExecution' | 'ECSTaskExecution' | 'ServiceRole';
    accessLevel: 'ReadOnly' | 'ReadWrite' | 'Admin';
  }
) => ({
  ...createBaseTags(config),
  ...componentTags.iam,
  Purpose: config.purpose,
  AccessLevel: config.accessLevel,
});
